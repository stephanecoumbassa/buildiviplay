/* Visioglobe SDK - Copyright 2019 - VisioWeb Error: not found: bash */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).visioweb={})}(this,function(t){"use strict";const e=0,i=1,n=2,r=1,a=2,s=3,o=0,l=1,h=2,c=0,u=1,p=2,d=3,m=4,f=5,g=100,v=101,y=102,x=103,b=104,w=200,_=201,M=202,S=203,T=204,E=205,A=206,P=207,L=208,O=209,C=210,R=0,I=1,D=2,N=3,F=4,z=5,k=6,B=7,U=0,G=1,H=2,j=0,V=1,W=2,q=3,X=4,Y=5,Z=301,J=302,K=303,Q=304,$=306,tt=307,et=1e3,it=1001,nt=1002,rt=1003,at=1004,st=1005,ot=1006,lt=1007,ht=1008,ct=1009,ut=1010,pt=1011,dt=1012,mt=1013,ft=1014,gt=1015,vt=1016,yt=1017,xt=1018,bt=1019,wt=1020,_t=1021,Mt=1022,St=1023,Tt=1024,Et=1025,At=St,Pt=1026,Lt=1027,Ot=1028,Ct=1029,Rt=1030,It=1031,Dt=1032,Nt=1033,Ft=33776,zt=33777,kt=33778,Bt=33779,Ut=35840,Gt=35841,Ht=35842,jt=35843,Vt=36196,Wt=37492,qt=37496,Xt=37808,Yt=37809,Zt=37810,Jt=37811,Kt=37812,Qt=37813,$t=37814,te=37815,ee=37816,ie=37817,ne=37818,re=37819,ae=37820,se=37821,oe=36492,le=37840,he=37841,ce=37842,ue=37843,pe=37844,de=37845,me=37846,fe=37847,ge=37848,ve=37849,ye=37850,xe=37851,be=37852,we=37853,_e=2200,Me=2201,Se=2202,Te=2400,Ee=2401,Ae=2402,Pe=2500,Le=2501,Oe=2,Ce=3e3,Re=3001,Ie=3007,De=3002,Ne=3003,Fe=3004,ze=3005,ke=3006,Be=3200,Ue=3201,Ge=0,He=1,je=7680,Ve=519,We=35044,qe=35048,Xe="300 es";function Ye(){}Object.assign(Ye.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t)}}});const Ze=[];for(let t=0;t<256;t++)Ze[t]=(t<16?"0":"")+t.toString(16);let Je=1234567;const Ke={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Ze[255&t]+Ze[t>>8&255]+Ze[t>>16&255]+Ze[t>>24&255]+"-"+Ze[255&e]+Ze[e>>8&255]+"-"+Ze[e>>16&15|64]+Ze[e>>24&255]+"-"+Ze[63&i|128]+Ze[i>>8&255]+"-"+Ze[i>>16&255]+Ze[i>>24&255]+Ze[255&n]+Ze[n>>8&255]+Ze[n>>16&255]+Ze[n>>24&255]).toUpperCase()},clamp:function(t,e,i){return Math.max(e,Math.min(i,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},lerp:function(t,e,i){return(1-i)*t+i*e},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(Je=t%2147483647),((Je=16807*Je%2147483647)-1)/2147483646},degToRad:function(t){return t*Ke.DEG2RAD},radToDeg:function(t){return t*Ke.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,i,n,r){const a=Math.cos,s=Math.sin,o=a(i/2),l=s(i/2),h=a((e+n)/2),c=s((e+n)/2),u=a((e-n)/2),p=s((e-n)/2),d=a((n-e)/2),m=s((n-e)/2);switch(r){case"XYX":t.set(o*c,l*u,l*p,o*h);break;case"YZY":t.set(l*p,o*c,l*u,o*h);break;case"ZXZ":t.set(l*u,l*p,o*c,o*h);break;case"XZX":t.set(o*c,l*m,l*d,o*h);break;case"YXY":t.set(l*d,o*c,l*m,o*h);break;case"ZYZ":t.set(l*m,l*d,o*c,o*h);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}};class Qe{constructor(t=0,e=0){Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,a=this.y-t.y;return this.x=r*i-a*n+t.x,this.y=r*n+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}class $e{constructor(){Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,a,s,o,l){const h=this.elements;return h[0]=t,h[1]=n,h[2]=s,h[3]=e,h[4]=r,h[5]=o,h[6]=i,h[7]=a,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new this.constructor).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[3],o=i[6],l=i[1],h=i[4],c=i[7],u=i[2],p=i[5],d=i[8],m=n[0],f=n[3],g=n[6],v=n[1],y=n[4],x=n[7],b=n[2],w=n[5],_=n[8];return r[0]=a*m+s*v+o*b,r[3]=a*f+s*y+o*w,r[6]=a*g+s*x+o*_,r[1]=l*m+h*v+c*b,r[4]=l*f+h*y+c*w,r[7]=l*g+h*x+c*_,r[2]=u*m+p*v+d*b,r[5]=u*f+p*y+d*w,r[8]=u*g+p*x+d*_,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],a=t[4],s=t[5],o=t[6],l=t[7],h=t[8];return e*a*h-e*s*l-i*r*h+i*s*o+n*r*l-n*a*o}getInverse(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const i=t.elements,n=this.elements,r=i[0],a=i[1],s=i[2],o=i[3],l=i[4],h=i[5],c=i[6],u=i[7],p=i[8],d=p*l-h*u,m=h*c-p*o,f=u*o-l*c,g=r*d+a*m+s*f;if(0===g)return this.set(0,0,0,0,0,0,0,0,0);const v=1/g;return n[0]=d*v,n[1]=(s*u-p*a)*v,n[2]=(h*a-s*l)*v,n[3]=m*v,n[4]=(p*r-s*c)*v,n[5]=(s*o-h*r)*v,n[6]=f*v,n[7]=(a*c-u*r)*v,n[8]=(l*r-a*o)*v,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).getInverse(this).transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,a,s){const o=Math.cos(r),l=Math.sin(r);this.set(i*o,i*l,-i*(o*a+l*s)+a+t,-n*l,n*o,-n*(-l*a+o*s)+s+e,0,0,1)}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],a=n[3],s=n[6],o=n[1],l=n[4],h=n[7];return n[0]=e*r+i*o,n[3]=e*a+i*l,n[6]=e*s+i*h,n[1]=-i*r+e*o,n[4]=-i*a+e*l,n[7]=-i*s+e*h,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}}let ti;const ei={getDataURL:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===ti&&(ti=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ti.width=t.width,ti.height=t.height;const i=ti.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=ti}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}};let ii=0;function ni(t,e,i,n,r,a,s,o,l,h){Object.defineProperty(this,"id",{value:ii++}),this.uuid=Ke.generateUUID(),this.name="",this.image=void 0!==t?t:ni.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==e?e:ni.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:it,this.wrapT=void 0!==n?n:it,this.magFilter=void 0!==r?r:ot,this.minFilter=void 0!==a?a:ht,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:St,this.internalFormat=null,this.type=void 0!==o?o:ct,this.offset=new Qe(0,0),this.repeat=new Qe(1,1),this.center=new Qe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $e,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==h?h:Ce,this.version=0,this.onUpdate=null}ni.DEFAULT_IMAGE=void 0,ni.DEFAULT_MAPPING=300,ni.prototype=Object.assign(Object.create(Ye.prototype),{constructor:ni,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this},toJSON:function(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=Ke.generateUUID()),!e&&void 0===t.images[n.uuid]){let e;if(Array.isArray(n)){e=[];for(let t=0,i=n.length;t<i;t++)e.push(ei.getDataURL(n[t]))}else e=ei.getDataURL(n);t.images[n.uuid]={uuid:n.uuid,url:e}}i.image=n.uuid}return e||(t.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case et:t.x=t.x-Math.floor(t.x);break;case it:t.x=t.x<0?0:1;break;case nt:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case et:t.y=t.y-Math.floor(t.y);break;case it:t.y=t.y<0?0:1;break;case nt:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(ni.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}});class ri{constructor(t=0,e=0,i=0,n=1){Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*n+a[12]*r,this.y=a[1]*e+a[5]*i+a[9]*n+a[13]*r,this.z=a[2]*e+a[6]*i+a[10]*n+a[14]*r,this.w=a[3]*e+a[7]*i+a[11]*n+a[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const a=t.elements,s=a[0],o=a[4],l=a[8],h=a[1],c=a[5],u=a[9],p=a[2],d=a[6],m=a[10];if(Math.abs(o-h)<.01&&Math.abs(l-p)<.01&&Math.abs(u-d)<.01){if(Math.abs(o+h)<.1&&Math.abs(l+p)<.1&&Math.abs(u+d)<.1&&Math.abs(s+c+m-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(s+1)/2,a=(c+1)/2,f=(m+1)/2,g=(o+h)/4,v=(l+p)/4,y=(u+d)/4;return t>a&&t>f?t<.01?(i=0,n=.707106781,r=.707106781):(n=g/(i=Math.sqrt(t)),r=v/i):a>f?a<.01?(i=.707106781,n=0,r=.707106781):(i=g/(n=Math.sqrt(a)),r=y/n):f<.01?(i=.707106781,n=.707106781,r=0):(i=v/(r=Math.sqrt(f)),n=y/r),this.set(i,n,r,e),this}let f=Math.sqrt((d-u)*(d-u)+(l-p)*(l-p)+(h-o)*(h-o));return Math.abs(f)<.001&&(f=1),this.x=(d-u)/f,this.y=(l-p)/f,this.z=(h-o)/f,this.w=Math.acos((s+c+m-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}function ai(t,e,i){this.width=t,this.height=e,this.scissor=new ri(0,0,t,e),this.scissorTest=!1,this.viewport=new ri(0,0,t,e),i=i||{},this.texture=new ni(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:ot,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function si(t,e,i){ai.call(this,t,e,i),this.samples=4}ai.prototype=Object.assign(Object.create(Ye.prototype),{constructor:ai,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),si.prototype=Object.assign(Object.create(ai.prototype),{constructor:si,isWebGLMultisampleRenderTarget:!0,copy:function(t){return ai.prototype.copy.call(this,t),this.samples=t.samples,this}});class oi{constructor(t=0,e=0,i=0,n=1){Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=e,this._z=i,this._w=n}static slerp(t,e,i,n){return i.copy(t).slerp(e,n)}static slerpFlat(t,e,i,n,r,a,s){let o=i[n+0],l=i[n+1],h=i[n+2],c=i[n+3];const u=r[a+0],p=r[a+1],d=r[a+2],m=r[a+3];if(c!==m||o!==u||l!==p||h!==d){let t=1-s;const e=o*u+l*p+h*d+c*m,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),a=Math.atan2(r,e*i);t=Math.sin(t*a)/r,s=Math.sin(s*a)/r}const r=s*i;if(o=o*t+u*r,l=l*t+p*r,h=h*t+d*r,c=c*t+m*r,t===1-s){const t=1/Math.sqrt(o*o+l*l+h*h+c*c);o*=t,l*=t,h*=t,c*=t}}t[e]=o,t[e+1]=l,t[e+2]=h,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,r,a){const s=i[n],o=i[n+1],l=i[n+2],h=i[n+3],c=r[a],u=r[a+1],p=r[a+2],d=r[a+3];return t[e]=s*d+h*c+o*p-l*u,t[e+1]=o*d+h*u+l*c-s*p,t[e+2]=l*d+h*p+s*u-o*c,t[e+3]=h*d-s*c-o*u-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=t._x,n=t._y,r=t._z,a=t._order,s=Math.cos,o=Math.sin,l=s(i/2),h=s(n/2),c=s(r/2),u=o(i/2),p=o(n/2),d=o(r/2);switch(a){case"XYZ":this._x=u*h*c+l*p*d,this._y=l*p*c-u*h*d,this._z=l*h*d+u*p*c,this._w=l*h*c-u*p*d;break;case"YXZ":this._x=u*h*c+l*p*d,this._y=l*p*c-u*h*d,this._z=l*h*d-u*p*c,this._w=l*h*c+u*p*d;break;case"ZXY":this._x=u*h*c-l*p*d,this._y=l*p*c+u*h*d,this._z=l*h*d+u*p*c,this._w=l*h*c-u*p*d;break;case"ZYX":this._x=u*h*c-l*p*d,this._y=l*p*c+u*h*d,this._z=l*h*d-u*p*c,this._w=l*h*c+u*p*d;break;case"YZX":this._x=u*h*c+l*p*d,this._y=l*p*c+u*h*d,this._z=l*h*d-u*p*c,this._w=l*h*c-u*p*d;break;case"XZY":this._x=u*h*c-l*p*d,this._y=l*p*c-u*h*d,this._z=l*h*d+u*p*c,this._w=l*h*c+u*p*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],a=e[1],s=e[5],o=e[9],l=e[2],h=e[6],c=e[10],u=i+s+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(h-o)*t,this._y=(r-l)*t,this._z=(a-n)*t}else if(i>s&&i>c){const t=2*Math.sqrt(1+i-s-c);this._w=(h-o)/t,this._x=.25*t,this._y=(n+a)/t,this._z=(r+l)/t}else if(s>c){const t=2*Math.sqrt(1+s-i-c);this._w=(r-l)/t,this._x=(n+a)/t,this._y=.25*t,this._z=(o+h)/t}else{const t=2*Math.sqrt(1+c-i-s);this._w=(a-n)/t,this._x=(r+l)/t,this._y=(o+h)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<1e-6?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ke.clamp(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}inverse(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,a=t._w,s=e._x,o=e._y,l=e._z,h=e._w;return this._x=i*h+a*s+n*l-r*o,this._y=n*h+a*o+r*s-i*l,this._z=r*h+a*l+i*o-n*s,this._w=a*h-i*s-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,a=this._w;let s=a*t._w+i*t._x+n*t._y+r*t._z;if(s<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,s=-s):this.copy(t),s>=1)return this._w=a,this._x=i,this._y=n,this._z=r,this;const o=1-s*s;if(o<=Number.EPSILON){const t=1-e;return this._w=t*a+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),h=Math.atan2(l,s),c=Math.sin((1-e)*h)/l,u=Math.sin(e*h)/l;return this._w=a*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}class li{constructor(t=0,e=0,i=0){Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ci.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ci.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,a=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*a,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*a,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,a=t.y,s=t.z,o=t.w,l=o*e+a*n-s*i,h=o*i+s*e-r*n,c=o*n+r*i-a*e,u=-r*e-a*i-s*n;return this.x=l*o+u*-r+h*-s-c*-a,this.y=h*o+u*-a+c*-r-l*-s,this.z=c*o+u*-s+l*-a-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,a=e.x,s=e.y,o=e.z;return this.x=n*o-r*s,this.y=r*a-i*o,this.z=i*s-n*a,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return hi.copy(this).projectOnVector(t),this.sub(hi)}reflect(t){return this.sub(hi.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Ke.clamp(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}const hi=new li,ci=new oi;class ui{constructor(t,e){Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new li(1/0,1/0,1/0),this.max=void 0!==e?e:new li(-1/0,-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],h=t[o+1],c=t[o+2];l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>a&&(a=h),c>s&&(s=c)}return this.min.set(e,i,n),this.max.set(r,a,s),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,a=-1/0,s=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),h=t.getY(o),c=t.getZ(o);l<e&&(e=l),h<i&&(i=h),c<n&&(n=c),l>r&&(r=l),h>a&&(a=h),c>s&&(s=c)}return this.min.set(e,i,n),this.max.set(r,a,s),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=mi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t){return this.makeEmpty(),this.expandByObject(t)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new li),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new li),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t){t.updateWorldMatrix(!1,!1);const e=t.geometry;void 0!==e&&(null===e.boundingBox&&e.computeBoundingBox(),fi.copy(e.boundingBox),fi.applyMatrix4(t.matrixWorld),this.union(fi));const i=t.children;for(let t=0,e=i.length;t<e;t++)this.expandByObject(i[t]);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new li),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,mi),mi.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(_i),Mi.subVectors(this.max,_i),gi.subVectors(t.a,_i),vi.subVectors(t.b,_i),yi.subVectors(t.c,_i),xi.subVectors(vi,gi),bi.subVectors(yi,vi),wi.subVectors(gi,yi);let e=[0,-xi.z,xi.y,0,-bi.z,bi.y,0,-wi.z,wi.y,xi.z,0,-xi.x,bi.z,0,-bi.x,wi.z,0,-wi.x,-xi.y,xi.x,0,-bi.y,bi.x,0,-wi.y,wi.x,0];return!!pi(e,gi,vi,yi,Mi)&&(!!pi(e=[1,0,0,0,1,0,0,0,1],gi,vi,yi,Mi)&&(Si.crossVectors(xi,bi),pi(e=[Si.x,Si.y,Si.z],gi,vi,yi,Mi)))}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new li),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return mi.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(mi).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(di[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),di[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),di[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),di[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),di[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),di[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),di[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),di[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(di),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}function pi(t,e,i,n,r){for(let a=0,s=t.length-3;a<=s;a+=3){Ti.fromArray(t,a);const s=r.x*Math.abs(Ti.x)+r.y*Math.abs(Ti.y)+r.z*Math.abs(Ti.z),o=e.dot(Ti),l=i.dot(Ti),h=n.dot(Ti);if(Math.max(-Math.max(o,l,h),Math.min(o,l,h))>s)return!1}return!0}const di=[new li,new li,new li,new li,new li,new li,new li,new li],mi=new li,fi=new ui,gi=new li,vi=new li,yi=new li,xi=new li,bi=new li,wi=new li,_i=new li,Mi=new li,Si=new li,Ti=new li,Ei=new ui;class Ai{constructor(t,e){this.center=void 0!==t?t:new li,this.radius=void 0!==e?e:-1}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Ei.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new li),e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new ui),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}}const Pi=new li,Li=new li,Oi=new li,Ci=new li,Ri=new li,Ii=new li,Di=new li;class Ni{constructor(t,e){this.origin=void 0!==t?t:new li,this.direction=void 0!==e?e:new li(0,0,-1)}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new li),e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Pi)),this}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new li),e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Pi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Pi.copy(this.direction).multiplyScalar(e).add(this.origin),Pi.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Li.copy(t).add(e).multiplyScalar(.5),Oi.copy(e).sub(t).normalize(),Ci.copy(this.origin).sub(Li);const r=.5*t.distanceTo(e),a=-this.direction.dot(Oi),s=Ci.dot(this.direction),o=-Ci.dot(Oi),l=Ci.lengthSq(),h=Math.abs(1-a*a);let c,u,p,d;if(h>0)if(u=a*s-o,d=r*h,(c=a*o-s)>=0)if(u>=-d)if(u<=d){const t=1/h;p=(c*=t)*(c+a*(u*=t)+2*s)+u*(a*c+u+2*o)+l}else u=r,p=-(c=Math.max(0,-(a*u+s)))*c+u*(u+2*o)+l;else u=-r,p=-(c=Math.max(0,-(a*u+s)))*c+u*(u+2*o)+l;else u<=-d?p=-(c=Math.max(0,-(-a*r+s)))*c+(u=c>0?-r:Math.min(Math.max(-r,-o),r))*(u+2*o)+l:u<=d?(c=0,p=(u=Math.min(Math.max(-r,-o),r))*(u+2*o)+l):p=-(c=Math.max(0,-(a*r+s)))*c+(u=c>0?r:Math.min(Math.max(-r,-o),r))*(u+2*o)+l;else u=a>0?-r:r,p=-(c=Math.max(0,-(a*u+s)))*c+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(c).add(this.origin),n&&n.copy(Oi).multiplyScalar(u).add(Li),p}intersectSphere(t,e){Pi.subVectors(t.center,this.origin);const i=Pi.dot(this.direction),n=Pi.dot(Pi)-i*i,r=t.radius*t.radius;if(n>r)return null;const a=Math.sqrt(r-n),s=i-a,o=i+a;return s<0&&o<0?null:s<0?this.at(o,e):this.at(s,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,a,s,o;const l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),h>=0?(r=(t.min.y-u.y)*h,a=(t.max.y-u.y)*h):(r=(t.max.y-u.y)*h,a=(t.min.y-u.y)*h),i>a||r>n?null:((r>i||i!=i)&&(i=r),(a<n||n!=n)&&(n=a),c>=0?(s=(t.min.z-u.z)*c,o=(t.max.z-u.z)*c):(s=(t.max.z-u.z)*c,o=(t.min.z-u.z)*c),i>o||s>n?null:((s>i||i!=i)&&(i=s),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Pi)}intersectTriangle(t,e,i,n,r){Ri.subVectors(e,t),Ii.subVectors(i,t),Di.crossVectors(Ri,Ii);let a,s=this.direction.dot(Di);if(s>0){if(n)return null;a=1}else{if(!(s<0))return null;a=-1,s=-s}Ci.subVectors(this.origin,t);const o=a*this.direction.dot(Ii.crossVectors(Ci,Ii));if(o<0)return null;const l=a*this.direction.dot(Ri.cross(Ci));if(l<0)return null;if(o+l>s)return null;const h=-a*Ci.dot(Di);return h<0?null:this.at(h/s,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}}class Fi{constructor(){Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,i,n,r,a,s,o,l,h,c,u,p,d,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=a,g[9]=s,g[13]=o,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=p,g[7]=d,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Fi).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/zi.setFromMatrixColumn(t,0).length(),r=1/zi.setFromMatrixColumn(t,1).length(),a=1/zi.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,i=t.x,n=t.y,r=t.z,a=Math.cos(i),s=Math.sin(i),o=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=a*h,i=a*c,n=s*h,r=s*c;e[0]=o*h,e[4]=-o*c,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-s*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=a*o}else if("YXZ"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t+r*s,e[4]=n*s-i,e[8]=a*l,e[1]=a*c,e[5]=a*h,e[9]=-s,e[2]=i*s-n,e[6]=r+t*s,e[10]=a*o}else if("ZXY"===t.order){const t=o*h,i=o*c,n=l*h,r=l*c;e[0]=t-r*s,e[4]=-a*c,e[8]=n+i*s,e[1]=i+n*s,e[5]=a*h,e[9]=r-t*s,e[2]=-a*l,e[6]=s,e[10]=a*o}else if("ZYX"===t.order){const t=a*h,i=a*c,n=s*h,r=s*c;e[0]=o*h,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*c,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=s*o,e[10]=a*o}else if("YZX"===t.order){const t=a*o,i=a*l,n=s*o,r=s*l;e[0]=o*h,e[4]=r-t*c,e[8]=n*c+i,e[1]=c,e[5]=a*h,e[9]=-s*h,e[2]=-l*h,e[6]=i*c+n,e[10]=t-r*c}else if("XZY"===t.order){const t=a*o,i=a*l,n=s*o,r=s*l;e[0]=o*h,e[4]=-c,e[8]=l*h,e[1]=t*c+r,e[5]=a*h,e[9]=i*c-n,e[2]=n*c-i,e[6]=s*h,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Bi,t,Ui)}lookAt(t,e,i){const n=this.elements;return ji.subVectors(t,e),0===ji.lengthSq()&&(ji.z=1),ji.normalize(),Gi.crossVectors(i,ji),0===Gi.lengthSq()&&(1===Math.abs(i.z)?ji.x+=1e-4:ji.z+=1e-4,ji.normalize(),Gi.crossVectors(i,ji)),Gi.normalize(),Hi.crossVectors(ji,Gi),n[0]=Gi.x,n[4]=Hi.x,n[8]=ji.x,n[1]=Gi.y,n[5]=Hi.y,n[9]=ji.y,n[2]=Gi.z,n[6]=Hi.z,n[10]=ji.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,a=i[0],s=i[4],o=i[8],l=i[12],h=i[1],c=i[5],u=i[9],p=i[13],d=i[2],m=i[6],f=i[10],g=i[14],v=i[3],y=i[7],x=i[11],b=i[15],w=n[0],_=n[4],M=n[8],S=n[12],T=n[1],E=n[5],A=n[9],P=n[13],L=n[2],O=n[6],C=n[10],R=n[14],I=n[3],D=n[7],N=n[11],F=n[15];return r[0]=a*w+s*T+o*L+l*I,r[4]=a*_+s*E+o*O+l*D,r[8]=a*M+s*A+o*C+l*N,r[12]=a*S+s*P+o*R+l*F,r[1]=h*w+c*T+u*L+p*I,r[5]=h*_+c*E+u*O+p*D,r[9]=h*M+c*A+u*C+p*N,r[13]=h*S+c*P+u*R+p*F,r[2]=d*w+m*T+f*L+g*I,r[6]=d*_+m*E+f*O+g*D,r[10]=d*M+m*A+f*C+g*N,r[14]=d*S+m*P+f*R+g*F,r[3]=v*w+y*T+x*L+b*I,r[7]=v*_+y*E+x*O+b*D,r[11]=v*M+y*A+x*C+b*N,r[15]=v*S+y*P+x*R+b*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],a=t[1],s=t[5],o=t[9],l=t[13],h=t[2],c=t[6],u=t[10],p=t[14];return t[3]*(+r*o*c-n*l*c-r*s*u+i*l*u+n*s*p-i*o*p)+t[7]*(+e*o*p-e*l*u+r*a*u-n*a*p+n*l*h-r*o*h)+t[11]*(+e*l*c-e*s*p-r*a*c+i*a*p+r*s*h-i*l*h)+t[15]*(-n*s*h-e*o*c+e*s*u+n*a*c-i*a*u+i*o*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}getInverse(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const i=this.elements,n=t.elements,r=n[0],a=n[1],s=n[2],o=n[3],l=n[4],h=n[5],c=n[6],u=n[7],p=n[8],d=n[9],m=n[10],f=n[11],g=n[12],v=n[13],y=n[14],x=n[15],b=d*y*u-v*m*u+v*c*f-h*y*f-d*c*x+h*m*x,w=g*m*u-p*y*u-g*c*f+l*y*f+p*c*x-l*m*x,_=p*v*u-g*d*u+g*h*f-l*v*f-p*h*x+l*d*x,M=g*d*c-p*v*c-g*h*m+l*v*m+p*h*y-l*d*y,S=r*b+a*w+s*_+o*M;if(0===S)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return i[0]=b*T,i[1]=(v*m*o-d*y*o-v*s*f+a*y*f+d*s*x-a*m*x)*T,i[2]=(h*y*o-v*c*o+v*s*u-a*y*u-h*s*x+a*c*x)*T,i[3]=(d*c*o-h*m*o-d*s*u+a*m*u+h*s*f-a*c*f)*T,i[4]=w*T,i[5]=(p*y*o-g*m*o+g*s*f-r*y*f-p*s*x+r*m*x)*T,i[6]=(g*c*o-l*y*o-g*s*u+r*y*u+l*s*x-r*c*x)*T,i[7]=(l*m*o-p*c*o+p*s*u-r*m*u-l*s*f+r*c*f)*T,i[8]=_*T,i[9]=(g*d*o-p*v*o-g*a*f+r*v*f+p*a*x-r*d*x)*T,i[10]=(l*v*o-g*h*o+g*a*u-r*v*u-l*a*x+r*h*x)*T,i[11]=(p*h*o-l*d*o-p*a*u+r*d*u+l*a*f-r*h*f)*T,i[12]=M*T,i[13]=(p*v*s-g*d*s+g*a*m-r*v*m-p*a*y+r*d*y)*T,i[14]=(g*h*s-l*v*s-g*a*c+r*v*c+l*a*y-r*h*y)*T,i[15]=(l*d*s-p*h*s+p*a*c-r*d*c-l*a*m+r*h*m)*T,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,a=t.x,s=t.y,o=t.z,l=r*a,h=r*s;return this.set(l*a+i,l*s-n*o,l*o+n*s,0,l*s+n*o,h*s+i,h*o-n*a,0,l*o-n*s,h*o+n*a,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i){return this.set(1,e,i,0,t,1,i,0,t,e,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,a=e._y,s=e._z,o=e._w,l=r+r,h=a+a,c=s+s,u=r*l,p=r*h,d=r*c,m=a*h,f=a*c,g=s*c,v=o*l,y=o*h,x=o*c,b=i.x,w=i.y,_=i.z;return n[0]=(1-(m+g))*b,n[1]=(p+x)*b,n[2]=(d-y)*b,n[3]=0,n[4]=(p-x)*w,n[5]=(1-(u+g))*w,n[6]=(f+v)*w,n[7]=0,n[8]=(d+y)*_,n[9]=(f-v)*_,n[10]=(1-(u+m))*_,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=zi.set(n[0],n[1],n[2]).length();const a=zi.set(n[4],n[5],n[6]).length(),s=zi.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],ki.copy(this);const o=1/r,l=1/a,h=1/s;return ki.elements[0]*=o,ki.elements[1]*=o,ki.elements[2]*=o,ki.elements[4]*=l,ki.elements[5]*=l,ki.elements[6]*=l,ki.elements[8]*=h,ki.elements[9]*=h,ki.elements[10]*=h,e.setFromRotationMatrix(ki),i.x=r,i.y=a,i.z=s,this}makePerspective(t,e,i,n,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,o=2*r/(e-t),l=2*r/(i-n),h=(e+t)/(e-t),c=(i+n)/(i-n),u=-(a+r)/(a-r),p=-2*a*r/(a-r);return s[0]=o,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(t,e,i,n,r,a){const s=this.elements,o=1/(e-t),l=1/(i-n),h=1/(a-r),c=(e+t)*o,u=(i+n)*l,p=(a+r)*h;return s[0]=2*o,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2*l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*h,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const zi=new li,ki=new Fi,Bi=new li(0,0,0),Ui=new li(1,1,1),Gi=new li,Hi=new li,ji=new li;class Vi{constructor(t=0,e=0,i=0,n=Vi.DefaultOrder){Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._order=n||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e,i){const n=Ke.clamp,r=t.elements,a=r[0],s=r[4],o=r[8],l=r[1],h=r[5],c=r[9],u=r[2],p=r[6],d=r[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(n(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,a)):(this._x=Math.atan2(p,h),this._z=0);break;case"YXZ":this._x=Math.asin(-n(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(l,h)):(this._y=Math.atan2(-u,a),this._z=0);break;case"ZXY":this._x=Math.asin(n(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-n(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(p,d),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-s,h));break;case"YZX":this._z=Math.asin(n(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-u,a)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-n(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(p,h),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Wi.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Wi,e,i)}setFromVector3(t,e){return this.set(t.x,t.y,t.z,e||this._order)}reorder(t){return qi.setFromEuler(this),this.setFromQuaternion(qi,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}toVector3(t){return t?t.set(this._x,this._y,this._z):new li(this._x,this._y,this._z)}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Vi.DefaultOrder="XYZ",Vi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];const Wi=new Fi,qi=new oi;class Xi{constructor(){this.mask=1}set(t){this.mask=1<<t|0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}}let Yi=0;const Zi=new li,Ji=new oi,Ki=new Fi,Qi=new li,$i=new li,tn=new li,en=new oi,nn=new li(1,0,0),rn=new li(0,1,0),an=new li(0,0,1),sn={type:"added"},on={type:"removed"};function ln(){Object.defineProperty(this,"id",{value:Yi++}),this.uuid=Ke.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ln.DefaultUp.clone();const t=new li,e=new Vi,i=new oi,n=new li(1,1,1);e._onChange(function(){i.setFromEuler(e,!1)}),i._onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Fi},normalMatrix:{value:new $e}}),this.matrix=new Fi,this.matrixWorld=new Fi,this.matrixAutoUpdate=ln.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Xi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}ln.DefaultUp=new li(0,1,0),ln.DefaultMatrixAutoUpdate=!0,ln.prototype=Object.assign(Object.create(Ye.prototype),{constructor:ln,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(t){return this.quaternion.premultiply(t),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(t){this.quaternion.copy(t)},rotateOnAxis:function(t,e){return Ji.setFromAxisAngle(t,e),this.quaternion.multiply(Ji),this},rotateOnWorldAxis:function(t,e){return Ji.setFromAxisAngle(t,e),this.quaternion.premultiply(Ji),this},rotateX:function(t){return this.rotateOnAxis(nn,t)},rotateY:function(t){return this.rotateOnAxis(rn,t)},rotateZ:function(t){return this.rotateOnAxis(an,t)},translateOnAxis:function(t,e){return Zi.copy(t).applyQuaternion(this.quaternion),this.position.add(Zi.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(nn,t)},translateY:function(t){return this.translateOnAxis(rn,t)},translateZ:function(t){return this.translateOnAxis(an,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(Ki.getInverse(this.matrixWorld))},lookAt:function(t,e,i){t.isVector3?Qi.copy(t):Qi.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),$i.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ki.lookAt($i,Qi,this.up):Ki.lookAt(Qi,$i,this.up),this.quaternion.setFromRotationMatrix(Ki),n&&(Ki.extractRotation(n.matrixWorld),Ji.setFromRotationMatrix(Ki),this.quaternion.premultiply(Ji.inverse()))},add:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(sn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)},remove:function(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(on)),this},clear:function(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(on)}return this.children.length=0,this},attach:function(t){return this.updateWorldMatrix(!0,!1),Ki.getInverse(this.matrixWorld),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ki.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ki),t.updateWorldMatrix(!1,!1),this.add(t),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new li),this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new oi),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($i,t,tn),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new li),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($i,en,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new li),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const i=this.parent;if(!0===t&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++)t[e].updateWorldMatrix(!1,!0)}},toJSON:function(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(e){const e=a(t.geometries),n=a(t.materials),r=a(t.textures),s=a(t.images),o=a(t.shapes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),s.length>0&&(i.images=s),o.length>0&&(i.shapes=o)}return i.object=n,i;function a(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}});const hn=new li,cn=new li,un=new $e;class pn{constructor(t,e){Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new li(1,0,0),this.constant=void 0!==e?e:0}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=hn.subVectors(i,e).cross(cn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new li),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){void 0===e&&(console.warn("THREE.Plane: .intersectLine() target is now required"),e=new li);const i=t.delta(hn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):void 0;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?void 0:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new li),t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||un.getNormalMatrix(t),n=this.coplanarPoint(hn).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}}const dn=new li,mn=new li,fn=new li,gn=new li,vn=new li,yn=new li,xn=new li,bn=new li,wn=new li,_n=new li;class Mn{constructor(t,e,i){this.a=void 0!==t?t:new li,this.b=void 0!==e?e:new li,this.c=void 0!==i?i:new li}static getNormal(t,e,i,n){void 0===n&&(console.warn("THREE.Triangle: .getNormal() target is now required"),n=new li),n.subVectors(i,e),dn.subVectors(t,e),n.cross(dn);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){dn.subVectors(n,e),mn.subVectors(i,e),fn.subVectors(t,e);const a=dn.dot(dn),s=dn.dot(mn),o=dn.dot(fn),l=mn.dot(mn),h=mn.dot(fn),c=a*l-s*s;if(void 0===r&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),r=new li),0===c)return r.set(-2,-1,-1);const u=1/c,p=(l*o-s*h)*u,d=(a*h-s*o)*u;return r.set(1-p-d,d,p)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,gn),gn.x>=0&&gn.y>=0&&gn.x+gn.y<=1}static getUV(t,e,i,n,r,a,s,o){return this.getBarycoord(t,e,i,n,gn),o.set(0,0),o.addScaledVector(r,gn.x),o.addScaledVector(a,gn.y),o.addScaledVector(s,gn.z),o}static isFrontFacing(t,e,i,n){return dn.subVectors(i,e),mn.subVectors(t,e),dn.cross(mn).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return dn.subVectors(this.c,this.b),mn.subVectors(this.a,this.b),.5*dn.cross(mn).length()}getMidpoint(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new li),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Mn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new pn),t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Mn.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return Mn.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return Mn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Mn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){void 0===e&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),e=new li);const i=this.a,n=this.b,r=this.c;let a,s;vn.subVectors(n,i),yn.subVectors(r,i),bn.subVectors(t,i);const o=vn.dot(bn),l=yn.dot(bn);if(o<=0&&l<=0)return e.copy(i);wn.subVectors(t,n);const h=vn.dot(wn),c=yn.dot(wn);if(h>=0&&c<=h)return e.copy(n);const u=o*c-h*l;if(u<=0&&o>=0&&h<=0)return a=o/(o-h),e.copy(i).addScaledVector(vn,a);_n.subVectors(t,r);const p=vn.dot(_n),d=yn.dot(_n);if(d>=0&&p<=d)return e.copy(r);const m=p*l-o*d;if(m<=0&&l>=0&&d<=0)return s=l/(l-d),e.copy(i).addScaledVector(yn,s);const f=h*d-p*c;if(f<=0&&c-h>=0&&p-d>=0)return xn.subVectors(r,n),s=(c-h)/(c-h+(p-d)),e.copy(n).addScaledVector(xn,s);const g=1/(f+m+u);return a=m*g,s=u*g,e.copy(i).addScaledVector(vn,a).addScaledVector(yn,s)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Sn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Tn={h:0,s:0,l:0},En={h:0,s:0,l:0};function An(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Pn(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ln(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class On{constructor(t,e,i){return Object.defineProperty(this,"isColor",{value:!0}),void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,i){return this.r=t,this.g=e,this.b=i,this}setHSL(t,e,i){if(t=Ke.euclideanModulo(t,1),e=Ke.clamp(e,0,1),i=Ke.clamp(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=An(r,n,t+1/3),this.g=An(r,n,t),this.b=An(r,n,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){let t;const n=i[1],r=i[2];switch(n){case"rgb":case"rgba":if(t=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[5]),this;if(t=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[5]),this;break;case"hsl":case"hsla":if(t=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(r)){const i=parseFloat(t[1])/360,n=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[5]),this.setHSL(i,n,r)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(t)){const t=i[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=Sn[t];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copyGammaToLinear(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this}copyLinearToGamma(t,e){void 0===e&&(e=2);const i=e>0?1/e:1;return this.r=Math.pow(t.r,i),this.g=Math.pow(t.g,i),this.b=Math.pow(t.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.r=Pn(t.r),this.g=Pn(t.g),this.b=Pn(t.b),this}copyLinearToSRGB(t){return this.r=Ln(t.r),this.g=Ln(t.g),this.b=Ln(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),a=Math.min(e,i,n);let s,o;const l=(a+r)/2;if(a===r)s=0,o=0;else{const t=r-a;switch(o=l<=.5?t/(r+a):t/(2-r-a),r){case e:s=(i-n)/t+(i<n?6:0);break;case i:s=(n-e)/t+2;break;case n:s=(e-i)/t+4}s/=6}return t.h=s,t.s=o,t.l=l,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,i){return this.getHSL(Tn),Tn.h+=t,Tn.s+=e,Tn.l+=i,this.setHSL(Tn.h,Tn.s,Tn.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpHSL(t,e){this.getHSL(Tn),t.getHSL(En);const i=Ke.lerp(Tn.h,En.h,e),n=Ke.lerp(Tn.s,En.s,e),r=Ke.lerp(Tn.l,En.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}On.NAMES=Sn,On.prototype.r=1,On.prototype.g=1,On.prototype.b=1;class Cn{constructor(t,e,i,n,r,a){this.a=t,this.b=e,this.c=i,this.normal=n&&n.isVector3?n:new li,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&r.isColor?r:new On,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}clone(){return(new this.constructor).copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}}let Rn=0;function In(){Object.defineProperty(this,"id",{value:Rn++}),this.uuid=Ke.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=u,this.side=o,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=T,this.blendDst=E,this.blendEquation=g,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=N,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Ve,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=je,this.stencilZFail=je,this.stencilZPass=je,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Dn(t){In.call(this),this.type="MeshBasicMaterial",this.color=new On(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=U,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}In.prototype=Object.assign(Object.create(Ye.prototype),{constructor:In,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,void 0!==this.combine&&(i.combine=this.combine),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==u&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),this.side!==o&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.morphNormals&&(i.morphNormals=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatShading=t.flatShading,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(In.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Dn.prototype=Object.create(In.prototype),Dn.prototype.constructor=Dn,Dn.prototype.isMeshBasicMaterial=!0,Dn.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this};const Nn=new li,Fn=new Qe;function zn(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=We,this.updateRange={offset:0,count:-1},this.version=0}function kn(t,e,i){zn.call(this,new Int8Array(t),e,i)}function Bn(t,e,i){zn.call(this,new Uint8Array(t),e,i)}function Un(t,e,i){zn.call(this,new Uint8ClampedArray(t),e,i)}function Gn(t,e,i){zn.call(this,new Int16Array(t),e,i)}function Hn(t,e,i){zn.call(this,new Uint16Array(t),e,i)}function jn(t,e,i){zn.call(this,new Int32Array(t),e,i)}function Vn(t,e,i){zn.call(this,new Uint32Array(t),e,i)}function Wn(t,e,i){zn.call(this,new Float32Array(t),e,i)}function qn(t,e,i){zn.call(this,new Float64Array(t),e,i)}Object.defineProperty(zn.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(zn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),r=new On),e[i++]=r.r,e[i++]=r.g,e[i++]=r.b}return this},copyVector2sArray:function(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),r=new Qe),e[i++]=r.x,e[i++]=r.y}return this},copyVector3sArray:function(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),r=new li),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z}return this},copyVector4sArray:function(t){const e=this.array;let i=0;for(let n=0,r=t.length;n<r;n++){let r=t[n];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),r=new ri),e[i++]=r.x,e[i++]=r.y,e[i++]=r.z,e[i++]=r.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Fn.fromBufferAttribute(this,e),Fn.applyMatrix3(t),this.setXY(e,Fn.x,Fn.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)Nn.fromBufferAttribute(this,e),Nn.applyMatrix3(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this},applyMatrix4:function(t){for(let e=0,i=this.count;e<i;e++)Nn.x=this.getX(e),Nn.y=this.getY(e),Nn.z=this.getZ(e),Nn.applyMatrix4(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this},applyNormalMatrix:function(t){for(let e=0,i=this.count;e<i;e++)Nn.x=this.getX(e),Nn.y=this.getY(e),Nn.z=this.getZ(e),Nn.applyNormalMatrix(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this},transformDirection:function(t){for(let e=0,i=this.count;e<i;e++)Nn.x=this.getX(e),Nn.y=this.getY(e),Nn.z=this.getZ(e),Nn.transformDirection(t),this.setXYZ(e,Nn.x,Nn.y,Nn.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),kn.prototype=Object.create(zn.prototype),kn.prototype.constructor=kn,Bn.prototype=Object.create(zn.prototype),Bn.prototype.constructor=Bn,Un.prototype=Object.create(zn.prototype),Un.prototype.constructor=Un,Gn.prototype=Object.create(zn.prototype),Gn.prototype.constructor=Gn,Hn.prototype=Object.create(zn.prototype),Hn.prototype.constructor=Hn,jn.prototype=Object.create(zn.prototype),jn.prototype.constructor=jn,Vn.prototype=Object.create(zn.prototype),Vn.prototype.constructor=Vn,Wn.prototype=Object.create(zn.prototype),Wn.prototype.constructor=Wn,qn.prototype=Object.create(zn.prototype),qn.prototype.constructor=qn;class Xn{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){const e=[];let i,n,r=void 0;const a=t.faces;for(n=0;n<a.length;n++){const t=a[n];t.materialIndex!==r&&(r=t.materialIndex,void 0!==i&&(i.count=3*n-i.start,e.push(i)),i={start:3*n,materialIndex:r})}void 0!==i&&(i.count=3*n-i.start,e.push(i)),this.groups=e}fromGeometry(t){const e=t.faces,i=t.vertices,n=t.faceVertexUvs,r=n[0]&&n[0].length>0,a=n[1]&&n[1].length>0,s=t.morphTargets,o=s.length;let l;if(o>0){l=[];for(let t=0;t<o;t++)l[t]={name:s[t].name,data:[]};this.morphTargets.position=l}const h=t.morphNormals,c=h.length;let u;if(c>0){u=[];for(let t=0;t<c;t++)u[t]={name:h[t].name,data:[]};this.morphTargets.normal=u}const p=t.skinIndices,d=t.skinWeights,m=p.length===i.length,f=d.length===i.length;i.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let t=0;t<e.length;t++){const g=e[t];this.vertices.push(i[g.a],i[g.b],i[g.c]);const v=g.vertexNormals;if(3===v.length)this.normals.push(v[0],v[1],v[2]);else{const t=g.normal;this.normals.push(t,t,t)}const y=g.vertexColors;if(3===y.length)this.colors.push(y[0],y[1],y[2]);else{const t=g.color;this.colors.push(t,t,t)}if(!0===r){const e=n[0][t];void 0!==e?this.uvs.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",t),this.uvs.push(new Qe,new Qe,new Qe))}if(!0===a){const e=n[1][t];void 0!==e?this.uvs2.push(e[0],e[1],e[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",t),this.uvs2.push(new Qe,new Qe,new Qe))}for(let t=0;t<o;t++){const e=s[t].vertices;l[t].data.push(e[g.a],e[g.b],e[g.c])}for(let e=0;e<c;e++){const i=h[e].vertexNormals[t];u[e].data.push(i.a,i.b,i.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),f&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}}function Yn(t){if(0===t.length)return-1/0;let e=t[0];for(let i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}let Zn=1;const Jn=new Fi,Kn=new ln,Qn=new li,$n=new ui,tr=new ui,er=new li;function ir(){Object.defineProperty(this,"id",{value:Zn+=2}),this.uuid=Ke.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}ir.prototype=Object.assign(Object.create(Ye.prototype),{constructor:ir,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){return Array.isArray(t)?this.index=new(Yn(t)>65535?Vn:Hn)(t,1):this.index=t,this},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,i){this.groups.push({start:t,count:e,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new $e).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Jn.makeRotationX(t),this.applyMatrix4(Jn),this},rotateY:function(t){return Jn.makeRotationY(t),this.applyMatrix4(Jn),this},rotateZ:function(t){return Jn.makeRotationZ(t),this.applyMatrix4(Jn),this},translate:function(t,e,i){return Jn.makeTranslation(t,e,i),this.applyMatrix4(Jn),this},scale:function(t,e,i){return Jn.makeScale(t,e,i),this.applyMatrix4(Jn),this},lookAt:function(t){return Kn.lookAt(t),Kn.updateMatrix(),this.applyMatrix4(Kn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qn).negate(),this.translate(Qn.x,Qn.y,Qn.z),this},setFromObject:function(t){const e=t.geometry;if(t.isPoints||t.isLine){const t=new Wn(3*e.vertices.length,3),i=new Wn(3*e.colors.length,3);if(this.setAttribute("position",t.copyVector3sArray(e.vertices)),this.setAttribute("color",i.copyColorsArray(e.colors)),e.lineDistances&&e.lineDistances.length===e.vertices.length){const t=new Wn(e.lineDistances.length,1);this.setAttribute("lineDistance",t.copyArray(e.lineDistances))}null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone())}else t.isMesh&&e&&e.isGeometry&&this.fromGeometry(e);return this},setFromPoints:function(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Wn(e,3)),this},updateFromObject:function(t){let e=t.geometry;if(t.isMesh){let t=e.__directGeometry;if(!0===e.elementsNeedUpdate&&(t=void 0,e.elementsNeedUpdate=!1),void 0===t)return this.fromGeometry(e);t.verticesNeedUpdate=e.verticesNeedUpdate,t.normalsNeedUpdate=e.normalsNeedUpdate,t.colorsNeedUpdate=e.colorsNeedUpdate,t.uvsNeedUpdate=e.uvsNeedUpdate,t.groupsNeedUpdate=e.groupsNeedUpdate,e.verticesNeedUpdate=!1,e.normalsNeedUpdate=!1,e.colorsNeedUpdate=!1,e.uvsNeedUpdate=!1,e.groupsNeedUpdate=!1,e=t}if(!0===e.verticesNeedUpdate){const t=this.attributes.position;void 0!==t&&(t.copyVector3sArray(e.vertices),t.needsUpdate=!0),e.verticesNeedUpdate=!1}if(!0===e.normalsNeedUpdate){const t=this.attributes.normal;void 0!==t&&(t.copyVector3sArray(e.normals),t.needsUpdate=!0),e.normalsNeedUpdate=!1}if(!0===e.colorsNeedUpdate){const t=this.attributes.color;void 0!==t&&(t.copyColorsArray(e.colors),t.needsUpdate=!0),e.colorsNeedUpdate=!1}if(e.uvsNeedUpdate){const t=this.attributes.uv;void 0!==t&&(t.copyVector2sArray(e.uvs),t.needsUpdate=!0),e.uvsNeedUpdate=!1}if(e.lineDistancesNeedUpdate){const t=this.attributes.lineDistance;void 0!==t&&(t.copyArray(e.lineDistances),t.needsUpdate=!0),e.lineDistancesNeedUpdate=!1}return e.groupsNeedUpdate&&(e.computeGroups(t.geometry),this.groups=e.groups,e.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Xn).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new zn(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new zn(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new zn(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new zn(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new zn(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const i=[],n=t.morphTargets[e];for(let t=0,e=n.length;t<e;t++){const e=n[t],r=new Wn(3*e.data.length,3);r.name=e.name,i.push(r.copyVector3sArray(e.data))}this.morphAttributes[e]=i}if(t.skinIndices.length>0){const e=new Wn(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Wn(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ui);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new li(-1/0,-1/0,-1/0),new li(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];$n.setFromBufferAttribute(i),this.morphTargetsRelative?(er.addVectors(this.boundingBox.min,$n.min),this.boundingBox.expandByPoint(er),er.addVectors(this.boundingBox.max,$n.max),this.boundingBox.expandByPoint(er)):(this.boundingBox.expandByPoint($n.min),this.boundingBox.expandByPoint($n.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ai);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new li,1/0);if(t){const i=this.boundingSphere.center;if($n.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];tr.setFromBufferAttribute(i),this.morphTargetsRelative?(er.addVectors($n.min,tr.min),$n.expandByPoint(er),er.addVectors($n.max,tr.max),$n.expandByPoint(er)):($n.expandByPoint(tr.min),$n.expandByPoint(tr.max))}$n.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)er.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(er));if(e)for(let r=0,a=e.length;r<a;r++){const a=e[r],s=this.morphTargetsRelative;for(let e=0,r=a.count;e<r;e++)er.fromBufferAttribute(a,e),s&&(Qn.fromBufferAttribute(t,e),er.add(Qn)),n=Math.max(n,i.distanceToSquared(er))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new zn(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new li,r=new li,a=new li,s=new li,o=new li,l=new li,h=new li,c=new li;if(t)for(let u=0,p=t.count;u<p;u+=3){const p=t.getX(u+0),d=t.getX(u+1),m=t.getX(u+2);n.fromBufferAttribute(e,p),r.fromBufferAttribute(e,d),a.fromBufferAttribute(e,m),h.subVectors(a,r),c.subVectors(n,r),h.cross(c),s.fromBufferAttribute(i,p),o.fromBufferAttribute(i,d),l.fromBufferAttribute(i,m),s.add(h),o.add(h),l.add(h),i.setXYZ(p,s.x,s.y,s.z),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let t=0,s=e.count;t<s;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),a.fromBufferAttribute(e,t+2),h.subVectors(a,r),c.subVectors(n,r),h.cross(c),i.setXYZ(t+0,h.x,h.y,h.z),i.setXYZ(t+1,h.x,h.y,h.z),i.setXYZ(t+2,h.x,h.y,h.z);this.normalizeNormals(),i.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===t.attributes[n])continue;const r=i[n].array,a=t.attributes[n],s=a.array,o=a.itemSize*e,l=Math.min(s.length,r.length-o);for(let t=0,e=o;t<l;t++,e++)r[e]=s[t]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)er.fromBufferAttribute(t,e),er.normalize(),t.setXYZ(e,er.x,er.y,er.z)},toNonIndexed:function(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,a=new i.constructor(e.length*n);let s=0,o=0;for(let t=0,r=e.length;t<r;t++){s=e[t]*n;for(let t=0;t<n;t++)a[o++]=i[s++]}return new zn(a,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new ir,i=this.index.array,n=this.attributes;for(const r in n){const a=t(n[r],i);e.setAttribute(r,a)}const r=this.morphAttributes;for(const n in r){const a=[],s=r[n];for(let e=0,n=s.length;e<n;e++){const n=t(s[e],i);a.push(n)}e.morphAttributes[n]=a}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let t=0,i=a.length;t<i;t++){const i=a[t];e.addGroup(i.start,i.count,i.materialIndex)}return e},toJSON:function(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e],r=n.toJSON(t.data);""!==n.name&&(r.name=n.name),t.data.attributes[e]=r}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],a=[];for(let e=0,n=i.length;e<n;e++){const n=i[e],r=n.toJSON(t.data);""!==n.name&&(r.name=n.name),a.push(r)}a.length>0&&(n[e]=a,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return null!==s&&(t.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),t},clone:function(){return(new ir).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let t=0,e=a.length;t<e;t++){const e=a[t];this.addGroup(e.start,e.count,e.materialIndex)}const s=t.boundingBox;null!==s&&(this.boundingBox=s.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const nr=new Fi,rr=new Ni,ar=new Ai,sr=new li,or=new li,lr=new li,hr=new li,cr=new li,ur=new li,pr=new li,dr=new li,mr=new li,fr=new Qe,gr=new Qe,vr=new Qe,yr=new li,xr=new li;function br(t,e){ln.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new ir,this.material=void 0!==e?e:new Dn,this.updateMorphTargets()}function wr(t,e,i,n,r,a,s,o){let c;if(null===(c=e.side===l?n.intersectTriangle(s,a,r,!0,o):n.intersectTriangle(r,a,s,e.side!==h,o)))return null;xr.copy(o),xr.applyMatrix4(t.matrixWorld);const u=i.ray.origin.distanceTo(xr);return u<i.near||u>i.far?null:{distance:u,point:xr.clone(),object:t}}function _r(t,e,i,n,r,a,s,o,l,h,c,u){sr.fromBufferAttribute(r,h),or.fromBufferAttribute(r,c),lr.fromBufferAttribute(r,u);const p=t.morphTargetInfluences;if(e.morphTargets&&a&&p){pr.set(0,0,0),dr.set(0,0,0),mr.set(0,0,0);for(let t=0,e=a.length;t<e;t++){const e=p[t],i=a[t];0!==e&&(hr.fromBufferAttribute(i,h),cr.fromBufferAttribute(i,c),ur.fromBufferAttribute(i,u),s?(pr.addScaledVector(hr,e),dr.addScaledVector(cr,e),mr.addScaledVector(ur,e)):(pr.addScaledVector(hr.sub(sr),e),dr.addScaledVector(cr.sub(or),e),mr.addScaledVector(ur.sub(lr),e)))}sr.add(pr),or.add(dr),lr.add(mr)}t.isSkinnedMesh&&(t.boneTransform(h,sr),t.boneTransform(c,or),t.boneTransform(u,lr));const d=wr(t,e,i,n,sr,or,lr,yr);if(d){o&&(fr.fromBufferAttribute(o,h),gr.fromBufferAttribute(o,c),vr.fromBufferAttribute(o,u),d.uv=Mn.getUV(yr,sr,or,lr,fr,gr,vr,new Qe)),l&&(fr.fromBufferAttribute(l,h),gr.fromBufferAttribute(l,c),vr.fromBufferAttribute(l,u),d.uv2=Mn.getUV(yr,sr,or,lr,fr,gr,vr,new Qe));const t=new Cn(h,c,u);Mn.getNormal(sr,or,lr,t.normal),d.face=t}return d}br.prototype=Object.assign(Object.create(ln.prototype),{constructor:br,isMesh:!0,copy:function(t){return ln.prototype.copy.call(this,t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),ar.copy(i.boundingSphere),ar.applyMatrix4(r),!1===t.ray.intersectsSphere(ar))return;if(nr.getInverse(r),rr.copy(t.ray).applyMatrix4(nr),null!==i.boundingBox&&!1===rr.intersectsBox(i.boundingBox))return;let a;if(i.isBufferGeometry){const r=i.index,s=i.attributes.position,o=i.morphAttributes.position,l=i.morphTargetsRelative,h=i.attributes.uv,c=i.attributes.uv2,u=i.groups,p=i.drawRange;if(null!==r)if(Array.isArray(n))for(let i=0,d=u.length;i<d;i++){const d=u[i],m=n[d.materialIndex];for(let i=Math.max(d.start,p.start),n=Math.min(d.start+d.count,p.start+p.count);i<n;i+=3){const n=r.getX(i),u=r.getX(i+1),p=r.getX(i+2);(a=_r(this,m,t,rr,s,o,l,h,c,n,u,p))&&(a.faceIndex=Math.floor(i/3),a.face.materialIndex=d.materialIndex,e.push(a))}}else{for(let i=Math.max(0,p.start),u=Math.min(r.count,p.start+p.count);i<u;i+=3){const u=r.getX(i),p=r.getX(i+1),d=r.getX(i+2);(a=_r(this,n,t,rr,s,o,l,h,c,u,p,d))&&(a.faceIndex=Math.floor(i/3),e.push(a))}}else if(void 0!==s)if(Array.isArray(n))for(let i=0,r=u.length;i<r;i++){const r=u[i],d=n[r.materialIndex];for(let i=Math.max(r.start,p.start),n=Math.min(r.start+r.count,p.start+p.count);i<n;i+=3){(a=_r(this,d,t,rr,s,o,l,h,c,i,i+1,i+2))&&(a.faceIndex=Math.floor(i/3),a.face.materialIndex=r.materialIndex,e.push(a))}}else{for(let i=Math.max(0,p.start),r=Math.min(s.count,p.start+p.count);i<r;i+=3){(a=_r(this,n,t,rr,s,o,l,h,c,i,i+1,i+2))&&(a.faceIndex=Math.floor(i/3),e.push(a))}}}else if(i.isGeometry){const r=Array.isArray(n),s=i.vertices,o=i.faces;let l;const h=i.faceVertexUvs[0];h.length>0&&(l=h);for(let i=0,h=o.length;i<h;i++){const h=o[i],c=r?n[h.materialIndex]:n;if(void 0===c)continue;const u=s[h.a],p=s[h.b],d=s[h.c];if(a=wr(this,c,t,rr,u,p,d,yr)){if(l&&l[i]){const t=l[i];fr.copy(t[0]),gr.copy(t[1]),vr.copy(t[2]),a.uv=Mn.getUV(yr,u,p,d,fr,gr,vr,new Qe)}a.face=h,a.faceIndex=i,e.push(a)}}}}});class Mr extends ir{constructor(t=1,e=1,i=1,n=1,r=1,a=1){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a};const s=this;n=Math.floor(n),r=Math.floor(r),a=Math.floor(a);const o=[],l=[],h=[],c=[];let u=0,p=0;function d(t,e,i,n,r,a,d,m,f,g,v){const y=a/f,x=d/g,b=a/2,w=d/2,_=m/2,M=f+1,S=g+1;let T=0,E=0;const A=new li;for(let a=0;a<S;a++){const s=a*x-w;for(let o=0;o<M;o++){const u=o*y-b;A[t]=u*n,A[e]=s*r,A[i]=_,l.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[i]=m>0?1:-1,h.push(A.x,A.y,A.z),c.push(o/f),c.push(1-a/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<f;e++){const i=u+e+M*t,n=u+e+M*(t+1),r=u+(e+1)+M*(t+1),a=u+(e+1)+M*t;o.push(i,n,a),o.push(n,r,a),E+=6}s.addGroup(p,E,v),p+=E,u+=T}d("z","y","x",-1,-1,i,e,t,a,r,0),d("z","y","x",1,-1,i,e,-t,a,r,1),d("x","z","y",1,1,t,i,e,n,a,2),d("x","z","y",1,-1,t,i,-e,n,a,3),d("x","y","z",1,-1,t,e,i,n,r,4),d("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Wn(l,3)),this.setAttribute("normal",new Wn(h,3)),this.setAttribute("uv",new Wn(c,2))}}function Sr(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function Tr(t){const e={};for(let i=0;i<t.length;i++){const n=Sr(t[i]);for(const t in n)e[t]=n[t]}return e}const Er={clone:Sr,merge:Tr};var Ar="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",Pr="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";function Lr(t){In.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=Ar,this.fragmentShader=Pr,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function Or(){ln.call(this),this.type="Camera",this.matrixWorldInverse=new Fi,this.projectionMatrix=new Fi,this.projectionMatrixInverse=new Fi}function Cr(t,e,i,n){Or.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Lr.prototype=Object.create(In.prototype),Lr.prototype.constructor=Lr,Lr.prototype.isShaderMaterial=!0,Lr.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=Sr(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this},Lr.prototype.toJSON=function(t){const e=In.prototype.toJSON.call(this,t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e},Or.prototype=Object.assign(Object.create(ln.prototype),{constructor:Or,isCamera:!0,copy:function(t,e){return ln.prototype.copy.call(this,t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new li),this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){ln.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){ln.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Cr.prototype=Object.assign(Object.create(Or.prototype),{constructor:Cr,isPerspectiveCamera:!0,copy:function(t,e){return Or.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*Ke.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*Ke.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*Ke.RAD2DEG*Math.atan(Math.tan(.5*Ke.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,i,n,r,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=this.near;let e=t*Math.tan(.5*Ke.DEG2RAD*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const a=this.view;if(null!==this.view&&this.view.enabled){const t=a.fullWidth,s=a.fullHeight;r+=a.offsetX*n/t,e-=a.offsetY*i/s,n*=a.width/t,i*=a.height/s}const s=this.filmOffset;0!==s&&(r+=t*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=ln.prototype.toJSON.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}});const Rr=90,Ir=1;function Dr(t,e,i){if(ln.call(this),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new Cr(Rr,Ir,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new li(1,0,0)),this.add(n);const r=new Cr(Rr,Ir,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new li(-1,0,0)),this.add(r);const a=new Cr(Rr,Ir,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new li(0,1,0)),this.add(a);const s=new Cr(Rr,Ir,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new li(0,-1,0)),this.add(s);const o=new Cr(Rr,Ir,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new li(0,0,1)),this.add(o);const l=new Cr(Rr,Ir,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new li(0,0,-1)),this.add(l),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const h=t.xr.enabled,c=t.getRenderTarget();t.xr.enabled=!1;const u=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,a),t.setRenderTarget(i,3),t.render(e,s),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=u,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.xr.enabled=h}}function Nr(t,e,i,n,r,a,s,o,l,h){t=void 0!==t?t:[],e=void 0!==e?e:Z,s=void 0!==s?s:Mt,ni.call(this,t,e,i,n,r,a,s,o,l,h),this.flipY=!1,this._needsFlipEnvMap=!0}function Fr(t,e,i){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=i),ai.call(this,t,t,e),e=e||{},this.texture=new Nr(void 0,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsFlipEnvMap=!1}function zr(t,e,i,n,r,a,s,o,l,h,c,u){ni.call(this,null,a,s,o,l,h,n,r,c,u),this.image={data:t||null,width:e||1,height:i||1},this.magFilter=void 0!==l?l:rt,this.minFilter=void 0!==h?h:rt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Dr.prototype=Object.create(ln.prototype),Dr.prototype.constructor=Dr,Nr.prototype=Object.create(ni.prototype),Nr.prototype.constructor=Nr,Nr.prototype.isCubeTexture=!0,Object.defineProperty(Nr.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Fr.prototype=Object.create(ai.prototype),Fr.prototype.constructor=Fr,Fr.prototype.isWebGLCubeRenderTarget=!0,Fr.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=St,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",fragmentShader:"\n\n\t\t\tuniform sampler2D tEquirect;\n\n\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t}\n\t\t"},n=new Mr(5,5,5),r=new Lr({name:"CubemapFromEquirect",uniforms:Sr(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:l,blending:c});r.uniforms.tEquirect.value=e;const a=new br(n,r),s=e.minFilter;return e.minFilter===ht&&(e.minFilter=ot),new Dr(1,10,this).update(t,a),e.minFilter=s,a.geometry.dispose(),a.material.dispose(),this},Fr.prototype.clear=function(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)},zr.prototype=Object.create(ni.prototype),zr.prototype.constructor=zr,zr.prototype.isDataTexture=!0;const kr=new Ai,Br=new li;class Ur{constructor(t,e,i,n,r,a){this.planes=[void 0!==t?t:new pn,void 0!==e?e:new pn,void 0!==i?i:new pn,void 0!==n?n:new pn,void 0!==r?r:new pn,void 0!==a?a:new pn]}set(t,e,i,n,r,a){const s=this.planes;return s[0].copy(t),s[1].copy(e),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(a),this}clone(){return(new this.constructor).copy(this)}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=i[7],u=i[8],p=i[9],d=i[10],m=i[11],f=i[12],g=i[13],v=i[14],y=i[15];return e[0].setComponents(s-n,c-o,m-u,y-f).normalize(),e[1].setComponents(s+n,c+o,m+u,y+f).normalize(),e[2].setComponents(s+r,c+l,m+p,y+g).normalize(),e[3].setComponents(s-r,c-l,m-p,y-g).normalize(),e[4].setComponents(s-a,c-h,m-d,y-v).normalize(),e[5].setComponents(s+a,c+h,m+d,y+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),kr.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(kr)}intersectsSprite(t){return kr.center.set(0,0,0),kr.radius=.7071067811865476,kr.applyMatrix4(t.matrixWorld),this.intersectsSphere(kr)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Br.x=n.normal.x>0?t.max.x:t.min.x,Br.y=n.normal.y>0?t.max.y:t.min.y,Br.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Br)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}}function Gr(){let t=null,e=!1,i=null,n=null;function r(e,a){i(e,a),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function Hr(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){var a=n.get(e);return void((!a||a.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,i){const n=e.array,r=e.usage,a=t.createBuffer();t.bindBuffer(i,a),t.bufferData(i,n,r),e.onUploadCallback();let s=5126;return n instanceof Float32Array?s=5126:n instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):n instanceof Uint16Array?s=5123:n instanceof Int16Array?s=5122:n instanceof Uint32Array?s=5125:n instanceof Int32Array?s=5124:n instanceof Int8Array?s=5120:n instanceof Uint8Array&&(s=5121),{buffer:a,type:s,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(function(e,n,r){const a=n.array,s=n.updateRange;t.bindBuffer(r,e),-1===s.count?t.bufferSubData(r,0,a):(i?t.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a,s.offset,s.count):t.bufferSubData(r,s.offset*a.BYTES_PER_ELEMENT,a.subarray(s.offset,s.offset+s.count)),s.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class jr extends ir{constructor(t,e,i,n){super(),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=(t=t||1)/2,a=(e=e||1)/2,s=Math.floor(i)||1,o=Math.floor(n)||1,l=s+1,h=o+1,c=t/s,u=e/o,p=[],d=[],m=[],f=[];for(let t=0;t<h;t++){const e=t*u-a;for(let i=0;i<l;i++){const n=i*c-r;d.push(n,-e,0),m.push(0,0,1),f.push(i/s),f.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<s;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),a=e+1+l*t;p.push(i,n,a),p.push(n,r,a)}this.setIndex(p),this.setAttribute("position",new Wn(d,3)),this.setAttribute("normal",new Wn(m,3)),this.setAttribute("uv",new Wn(f,2))}}const Vr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},Wr={common:{diffuse:{value:new On(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new $e},uv2Transform:{value:new $e},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Qe(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new On(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new On(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $e}},sprite:{diffuse:{value:new On(15658734)},opacity:{value:1},center:{value:new Qe(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new $e}}},qr={basic:{uniforms:Tr([Wr.common,Wr.specularmap,Wr.envmap,Wr.aomap,Wr.lightmap,Wr.fog]),vertexShader:Vr.meshbasic_vert,fragmentShader:Vr.meshbasic_frag},lambert:{uniforms:Tr([Wr.common,Wr.specularmap,Wr.envmap,Wr.aomap,Wr.lightmap,Wr.emissivemap,Wr.fog,Wr.lights,{emissive:{value:new On(0)}}]),vertexShader:Vr.meshlambert_vert,fragmentShader:Vr.meshlambert_frag},phong:{uniforms:Tr([Wr.common,Wr.specularmap,Wr.envmap,Wr.aomap,Wr.lightmap,Wr.emissivemap,Wr.bumpmap,Wr.normalmap,Wr.displacementmap,Wr.fog,Wr.lights,{emissive:{value:new On(0)},specular:{value:new On(1118481)},shininess:{value:30}}]),vertexShader:Vr.meshphong_vert,fragmentShader:Vr.meshphong_frag},standard:{uniforms:Tr([Wr.common,Wr.envmap,Wr.aomap,Wr.lightmap,Wr.emissivemap,Wr.bumpmap,Wr.normalmap,Wr.displacementmap,Wr.roughnessmap,Wr.metalnessmap,Wr.fog,Wr.lights,{emissive:{value:new On(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vr.meshphysical_vert,fragmentShader:Vr.meshphysical_frag},toon:{uniforms:Tr([Wr.common,Wr.aomap,Wr.lightmap,Wr.emissivemap,Wr.bumpmap,Wr.normalmap,Wr.displacementmap,Wr.gradientmap,Wr.fog,Wr.lights,{emissive:{value:new On(0)}}]),vertexShader:Vr.meshtoon_vert,fragmentShader:Vr.meshtoon_frag},matcap:{uniforms:Tr([Wr.common,Wr.bumpmap,Wr.normalmap,Wr.displacementmap,Wr.fog,{matcap:{value:null}}]),vertexShader:Vr.meshmatcap_vert,fragmentShader:Vr.meshmatcap_frag},points:{uniforms:Tr([Wr.points,Wr.fog]),vertexShader:Vr.points_vert,fragmentShader:Vr.points_frag},dashed:{uniforms:Tr([Wr.common,Wr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vr.linedashed_vert,fragmentShader:Vr.linedashed_frag},depth:{uniforms:Tr([Wr.common,Wr.displacementmap]),vertexShader:Vr.depth_vert,fragmentShader:Vr.depth_frag},normal:{uniforms:Tr([Wr.common,Wr.bumpmap,Wr.normalmap,Wr.displacementmap,{opacity:{value:1}}]),vertexShader:Vr.normal_vert,fragmentShader:Vr.normal_frag},sprite:{uniforms:Tr([Wr.sprite,Wr.fog]),vertexShader:Vr.sprite_vert,fragmentShader:Vr.sprite_frag},background:{uniforms:{uvTransform:{value:new $e},t2D:{value:null}},vertexShader:Vr.background_vert,fragmentShader:Vr.background_frag},cube:{uniforms:Tr([Wr.envmap,{opacity:{value:1}}]),vertexShader:Vr.cube_vert,fragmentShader:Vr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vr.equirect_vert,fragmentShader:Vr.equirect_frag},distanceRGBA:{uniforms:Tr([Wr.common,Wr.displacementmap,{referencePosition:{value:new li},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vr.distanceRGBA_vert,fragmentShader:Vr.distanceRGBA_frag},shadow:{uniforms:Tr([Wr.lights,Wr.fog,{color:{value:new On(0)},opacity:{value:1}}]),vertexShader:Vr.shadow_vert,fragmentShader:Vr.shadow_frag}};function Xr(t,e,i,n,r){const a=new On(0);let s,h,c=0,u=null,p=0,d=null;function m(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,r)}return{getClearColor:function(){return a},setClearColor:function(t,e){a.set(t),m(a,c=void 0!==e?e:1)},getClearAlpha:function(){return c},setClearAlpha:function(t){m(a,c=t)},render:function(i,r,f,g){let v=!0===r.isScene?r.background:null;v&&v.isTexture&&(v=e.get(v));const y=t.xr,x=y.getSession&&y.getSession();x&&"additive"===x.environmentBlendMode&&(v=null),null===v?m(a,c):v&&v.isColor&&(m(v,1),g=!0),(t.autoClear||g)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.isWebGLCubeRenderTarget||v.mapping===$)?(void 0===h&&((h=new br(new Mr(1,1,1),new Lr({name:"BackgroundCubeMaterial",uniforms:Sr(qr.cube.uniforms),vertexShader:qr.cube.vertexShader,fragmentShader:qr.cube.fragmentShader,side:l,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h)),v.isWebGLCubeRenderTarget&&(v=v.texture),h.material.uniforms.envMap.value=v,h.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v._needsFlipEnvMap?-1:1,u===v&&p===v.version&&d===t.toneMapping||(h.material.needsUpdate=!0,u=v,p=v.version,d=t.toneMapping),i.unshift(h,h.geometry,h.material,0,0,null)):v&&v.isTexture&&(void 0===s&&((s=new br(new jr(2,2),new Lr({name:"BackgroundMaterial",uniforms:Sr(qr.background.uniforms),vertexShader:qr.background.vertexShader,fragmentShader:qr.background.fragmentShader,side:o,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(s.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(s)),s.material.uniforms.t2D.value=v,!0===v.matrixAutoUpdate&&v.updateMatrix(),s.material.uniforms.uvTransform.value.copy(v.matrix),u===v&&p===v.version&&d===t.toneMapping||(s.material.needsUpdate=!0,u=v,p=v.version,d=t.toneMapping),i.unshift(s,s.geometry,s.material,0,0,null))}}}function Yr(t,e,i,n){const r=t.getParameter(34921),a=n.isWebGL2?null:e.get("OES_vertex_array_object"),s=n.isWebGL2||null!==a,o={},l=p(null);let h=l;function c(e){return n.isWebGL2?t.bindVertexArray(e):a.bindVertexArrayOES(e)}function u(e){return n.isWebGL2?t.deleteVertexArray(e):a.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function d(){const t=h.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function m(t){f(t,0)}function f(i,r){const a=h.newAttributes,s=h.enabledAttributes,o=h.attributeDivisors;if(a[i]=1,0===s[i]&&(t.enableVertexAttribArray(i),s[i]=1),o[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r}}function g(){const e=h.newAttributes,i=h.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function v(e,i,r,a,s,o){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,a,s,o):t.vertexAttribIPointer(e,i,r,s,o)}function y(){x(),h!==l&&c((h=l).object)}function x(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,u,y,x){let b=!1;if(s){const e=function(e,i,r){const s=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let h=l[i.id];void 0===h&&(h={},l[i.id]=h);let c=h[s];return void 0===c&&(c=p(n.isWebGL2?t.createVertexArray():a.createVertexArrayOES()),h[s]=c),c}(y,u,l);h!==e&&c((h=e).object),(b=function(t,e){const i=h.attributes,n=t.attributes;if(Object.keys(i).length!==Object.keys(n).length)return!0;for(const t in n){const e=i[t],r=n[t];if(void 0===e)return!0;if(e.attribute!==r)return!0;if(e.data!==r.data)return!0}return h.index!==e}(y,x))&&function(t,e){const i={},n=t.attributes;for(const t in n){const e=n[t],r={};r.attribute=e,e.data&&(r.data=e.data),i[t]=r}h.attributes=i,h.index=e}(y,x)}else{const t=!0===l.wireframe;h.geometry===y.id&&h.program===u.id&&h.wireframe===t||(h.geometry=y.id,h.program=u.id,h.wireframe=t,b=!0)}!0===r.isInstancedMesh&&(b=!0),null!==x&&i.update(x,34963),b&&(function(r,a,s,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;d();const l=o.attributes,h=s.getAttributes(),c=a.defaultAttributeValues;for(const e in h){const n=h[e];if(n>=0){const a=l[e];if(void 0!==a){const e=a.normalized,r=a.itemSize,s=i.get(a);if(void 0===s)continue;const l=s.buffer,h=s.type,c=s.bytesPerElement;if(a.isInterleavedBufferAttribute){const i=a.data,s=i.stride,u=a.offset;i&&i.isInstancedInterleavedBuffer?(f(n,i.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)):m(n),t.bindBuffer(34962,l),v(n,r,h,e,s*c,u*c)}else a.isInstancedBufferAttribute?(f(n,a.meshPerAttribute),void 0===o._maxInstanceCount&&(o._maxInstanceCount=a.meshPerAttribute*a.count)):m(n),t.bindBuffer(34962,l),v(n,r,h,e,0,0)}else if("instanceMatrix"===e){const e=i.get(r.instanceMatrix);if(void 0===e)continue;const a=e.buffer,s=e.type;f(n+0,1),f(n+1,1),f(n+2,1),f(n+3,1),t.bindBuffer(34962,a),t.vertexAttribPointer(n+0,4,s,!1,64,0),t.vertexAttribPointer(n+1,4,s,!1,64,16),t.vertexAttribPointer(n+2,4,s,!1,64,32),t.vertexAttribPointer(n+3,4,s,!1,64,48)}else if("instanceColor"===e){const e=i.get(r.instanceColor);if(void 0===e)continue;const a=e.buffer,s=e.type;f(n,1),t.bindBuffer(34962,a),t.vertexAttribPointer(n,3,s,!1,12,0)}else if(void 0!==c){const i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n,i);break;case 3:t.vertexAttrib3fv(n,i);break;case 4:t.vertexAttrib4fv(n,i);break;default:t.vertexAttrib1fv(n,i)}}}}g()}(r,l,u,y),null!==x&&t.bindBuffer(34963,i.get(x).buffer))},reset:y,resetDefaultState:x,dispose:function(){y();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)u(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)u(n[t].object),delete n[t];delete i[t.id]}},initAttributes:d,enableAttribute:m,disableUnusedAttributes:g}}function Zr(t,e,i,n){const r=n.isWebGL2;let a;this.setMode=function(t){a=t},this.render=function(e,n){t.drawArrays(a,e,n),i.update(n,a,1)},this.renderInstances=function(n,s,o){if(0===o)return;let l,h;if(r)l=t,h="drawArraysInstanced";else if(h="drawArraysInstancedANGLE",null===(l=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](a,n,s,o),i.update(s,a,o)}}function Jr(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const a="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let s=void 0!==i.precision?i.precision:"highp";const o=r(s);o!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",o,"instead."),s=o);const l=!0===i.logarithmicDepthBuffer,h=t.getParameter(34930),c=t.getParameter(35660),u=t.getParameter(3379),p=t.getParameter(34076),d=t.getParameter(34921),m=t.getParameter(36347),f=t.getParameter(36348),g=t.getParameter(36349),v=c>0,y=a||!!e.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==n)return n;const i=e.get("EXT_texture_filter_anisotropic");return n=null!==i?t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:r,precision:s,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:c,maxTextureSize:u,maxCubemapSize:p,maxAttributes:d,maxVertexUniforms:m,maxVaryings:f,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:a?t.getParameter(36183):0}}function Kr(t){const e=this;let i=null,n=0,r=!1,a=!1;const s=new pn,o=new $e,l={value:null,needsUpdate:!1};function h(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(t,i,n,r){const a=null!==t?t.length:0;let h=null;if(0!==a){if(h=l.value,!0!==r||null===h){const e=n+4*a,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===h||h.length<e)&&(h=new Float32Array(e));for(let e=0,i=n;e!==a;++e,i+=4)s.copy(t[e]).applyMatrix4(r,o),s.normal.toArray(h,i),h[i+3]=s.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=a,e.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,a){const s=0!==t.length||e||0!==n||r;return r=e,i=c(t,a,0),n=t.length,s},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,h()},this.setState=function(e,s,o){const u=e.clippingPlanes,p=e.clipIntersection,d=e.clipShadows,m=t.get(e);if(!r||null===u||0===u.length||a&&!d)a?c(null):h();else{const t=a?0:n,e=4*t;let r=m.clippingState||null;l.value=r,r=c(u,s,e,o);for(let t=0;t!==e;++t)r[t]=i[t];m.clippingState=r,this.numIntersection=p?this.numPlanes:0,this.numPlanes+=t}}}function Qr(t){let e=new WeakMap;function i(t,e){return e===K?t.mapping=Z:e===Q&&(t.mapping=J),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture){const a=r.mapping;if(a===K||a===Q){if(e.has(r))return i(e.get(r).texture,r.mapping);{const a=r.image;if(a&&a.height>0){const s=t.getRenderList(),o=t.getRenderTarget(),l=t.getRenderState(),h=new Fr(a.height/2);return h.fromEquirectangularTexture(t,r),e.set(r,h),t.setRenderTarget(o),t.setRenderList(s),t.setRenderState(l),r.addEventListener("dispose",n),i(h.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}function $r(t){const e={};return{has:function(i){if(void 0!==e[i])return null!==e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,null!==n},get:function(t){return this.has(t)||console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e[t]}}}function ta(t,e,i,n){const r=new WeakMap,a=new WeakMap;function s(t){const o=t.target,l=r.get(o);null!==l.index&&e.remove(l.index);for(const t in l.attributes)e.remove(l.attributes[t]);o.removeEventListener("dispose",s),r.delete(o);const h=a.get(l);h&&(e.remove(h),a.delete(l)),n.releaseStatesOfGeometry(l),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--,i.memory.vertices-=l.attributes.position.count,o.faces&&(i.memory.faces-=o.faces.length)}function o(t){const i=[],n=t.index,r=t.attributes.position;let s=0;if(null!==n){const t=n.array;s=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],a=t[e+2];i.push(n,r,r,a,a,n)}}else{const t=r.array;s=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const o=new(Yn(i)>65535?Vn:Hn)(i,1);o.version=s;const l=a.get(t);l&&e.remove(l),a.set(t,o)}return{get:function(t,e){let n=r.get(e);return n||(e.addEventListener("dispose",s),e.isBufferGeometry?n=e:e.isGeometry&&(void 0===e._bufferGeometry&&(e._bufferGeometry=(new ir).setFromObject(t)),n=e._bufferGeometry),r.set(e,n),i.memory.geometries++,i.memory.vertices+=n.attributes.position.count,e.faces&&(i.memory.faces+=e.faces.length),n)},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=a.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return a.get(t)}}}function ea(t,e,i,n){const r=n.isWebGL2;let a,s,o;this.setMode=function(t){a=t},this.setIndex=function(t){s=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(a,n,s,e*o),i.update(n,a,1)},this.renderInstances=function(n,l,h){if(0===h)return;let c,u;if(r)c=t,u="drawElementsInstanced";else if(u="drawElementsInstancedANGLE",null===(c=e.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](a,l,s,n*o,h),i.update(l,a,h)}}function ia(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0,programSwitch:0};return{memory:{geometries:0,textures:0,vertices:0,faces:0,textureSz:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0,e.programSwitch=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function na(t,e){return t[0]-e[0]}function ra(t,e){return Math.abs(e[1])-Math.abs(t[1])}function aa(t){const e={},i=new Float32Array(8),n=[];for(let t=0;t<8;t++)n[t]=[t,0];return{update:function(r,a,s,o){const l=r.morphTargetInfluences,h=void 0===l?0:l.length;let c=e[a.id];if(void 0===c){c=[];for(let t=0;t<h;t++)c[t]=[t,0];e[a.id]=c}for(let t=0;t<h;t++){const e=c[t];e[0]=t,e[1]=l[t]}c.sort(ra);for(let t=0;t<8;t++)t<h&&c[t][1]?(n[t][0]=c[t][0],n[t][1]=c[t][1]):(n[t][0]=Number.MAX_SAFE_INTEGER,n[t][1]=0);n.sort(na);const u=s.morphTargets&&a.morphAttributes.position,p=s.morphNormals&&a.morphAttributes.normal;let d=0;for(let t=0;t<8;t++){const e=n[t],r=e[0],s=e[1];r!==Number.MAX_SAFE_INTEGER&&s?(u&&a.getAttribute("morphTarget"+t)!==u[r]&&a.setAttribute("morphTarget"+t,u[r]),p&&a.getAttribute("morphNormal"+t)!==p[r]&&a.setAttribute("morphNormal"+t,p[r]),i[t]=s,d+=s):(u&&void 0!==a.getAttribute("morphTarget"+t)&&a.deleteAttribute("morphTarget"+t),p&&void 0!==a.getAttribute("morphNormal"+t)&&a.deleteAttribute("morphNormal"+t),i[t]=0)}const m=a.morphTargetsRelative?1:1-d;o.getUniforms().setValue(t,"morphTargetBaseInfluence",m),o.getUniforms().setValue(t,"morphTargetInfluences",i)}}}function sa(t,e,i,n){let r=new WeakMap;return{update:function(t){const a=n.render.frame,s=t.geometry,o=e.get(t,s);return r.get(o)!==a&&(s.isGeometry&&o.updateFromObject(t),e.update(o),r.set(o,a)),t.isInstancedMesh&&(i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),o},dispose:function(){r=new WeakMap}}}function oa(t,e,i,n){ni.call(this,null),this.image={data:t||null,width:e||1,height:i||1,depth:n||1},this.magFilter=rt,this.minFilter=rt,this.wrapR=it,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function la(t,e,i,n){ni.call(this,null),this.image={data:t||null,width:e||1,height:i||1,depth:n||1},this.magFilter=rt,this.minFilter=rt,this.wrapR=it,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}qr.physical={uniforms:Tr([qr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Qe(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new On(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:Vr.meshphysical_vert,fragmentShader:Vr.meshphysical_frag},oa.prototype=Object.create(ni.prototype),oa.prototype.constructor=oa,oa.prototype.isDataTexture2DArray=!0,la.prototype=Object.create(ni.prototype),la.prototype.constructor=la,la.prototype.isDataTexture3D=!0;const ha=new ni,ca=new oa,ua=new la,pa=new Nr,da=[],ma=[],fa=new Float32Array(16),ga=new Float32Array(9),va=new Float32Array(4);function ya(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let a=da[r];if(void 0===a&&(a=new Float32Array(r),da[r]=a),0!==e){n.toArray(a,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(a,r)}return a}function xa(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function ba(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function wa(t,e){let i=ma[e];void 0===i&&(i=new Int32Array(e),ma[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function _a(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function Ma(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(xa(i,e))return;t.uniform2fv(this.addr,e),ba(i,e)}}function Sa(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(xa(i,e))return;t.uniform3fv(this.addr,e),ba(i,e)}}function Ta(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(xa(i,e))return;t.uniform4fv(this.addr,e),ba(i,e)}}function Ea(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(xa(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),ba(i,e)}else{if(xa(i,n))return;va.set(n),t.uniformMatrix2fv(this.addr,!1,va),ba(i,n)}}function Aa(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(xa(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),ba(i,e)}else{if(xa(i,n))return;ga.set(n),t.uniformMatrix3fv(this.addr,!1,ga),ba(i,n)}}function Pa(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(xa(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),ba(i,e)}else{if(xa(i,n))return;fa.set(n),t.uniformMatrix4fv(this.addr,!1,fa),ba(i,n)}}function La(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTexture2D(e||ha,r)}function Oa(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||ca,r)}function Ca(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||ua,r)}function Ra(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.safeSetTextureCube(e||pa,r)}function Ia(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Da(t,e){const i=this.cache;xa(i,e)||(t.uniform2iv(this.addr,e),ba(i,e))}function Na(t,e){const i=this.cache;xa(i,e)||(t.uniform3iv(this.addr,e),ba(i,e))}function Fa(t,e){const i=this.cache;xa(i,e)||(t.uniform4iv(this.addr,e),ba(i,e))}function za(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function ka(t,e){t.uniform1fv(this.addr,e)}function Ba(t,e){t.uniform1iv(this.addr,e)}function Ua(t,e){t.uniform2iv(this.addr,e)}function Ga(t,e){t.uniform3iv(this.addr,e)}function Ha(t,e){t.uniform4iv(this.addr,e)}function ja(t,e){const i=ya(e,this.size,2);t.uniform2fv(this.addr,i)}function Va(t,e){const i=ya(e,this.size,3);t.uniform3fv(this.addr,i)}function Wa(t,e){const i=ya(e,this.size,4);t.uniform4fv(this.addr,i)}function qa(t,e){const i=ya(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Xa(t,e){const i=ya(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Ya(t,e){const i=ya(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Za(t,e,i){const n=e.length,r=wa(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTexture2D(e[t]||ha,r[t])}function Ja(t,e,i){const n=e.length,r=wa(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.safeSetTextureCube(e[t]||pa,r[t])}function Ka(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return _a;case 35664:return Ma;case 35665:return Sa;case 35666:return Ta;case 35674:return Ea;case 35675:return Aa;case 35676:return Pa;case 5124:case 35670:return Ia;case 35667:case 35671:return Da;case 35668:case 35672:return Na;case 35669:case 35673:return Fa;case 5125:return za;case 35678:case 36198:case 36298:case 36306:case 35682:return La;case 35679:case 36299:case 36307:return Ca;case 35680:case 36300:case 36308:case 36293:return Ra;case 36289:case 36303:case 36311:case 36292:return Oa}}(e.type)}function Qa(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return ka;case 35664:return ja;case 35665:return Va;case 35666:return Wa;case 35674:return qa;case 35675:return Xa;case 35676:return Ya;case 5124:case 35670:return Ba;case 35667:case 35671:return Ua;case 35668:case 35672:return Ga;case 35669:case 35673:return Ha;case 35678:case 36198:case 36298:case 36306:case 35682:return Za;case 35680:case 36300:case 36308:case 36293:return Ja}}(e.type)}function $a(t){this.id=t,this.seq=[],this.map={}}Qa.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),ba(e,t)},$a.prototype.setValue=function(t,e,i){const n=this.seq;for(let r=0,a=n.length;r!==a;++r){const a=n[r];a.setValue(t,e[a.id],i)}};const ts=/([\w\d_]+)(\])?(\[|\.)?/g;function es(t,e){t.seq.push(e),t.map[e.id]=e}function is(t,e,i){const n=t.name,r=n.length;for(ts.lastIndex=0;;){const a=ts.exec(n),s=ts.lastIndex;let o=a[1];const l="]"===a[2],h=a[3];if(l&&(o|=0),void 0===h||"["===h&&s+2===r){es(i,void 0===h?new Ka(o,t,e):new Qa(o,t,e));break}{let t=i.map[o];void 0===t&&es(i,t=new $a(o)),i=t}}}function ns(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);is(i,t.getUniformLocation(e,i.name),this)}}function rs(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}ns.prototype.setValue=function(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)},ns.prototype.setOptional=function(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)},ns.upload=function(t,e,i,n){for(let r=0,a=e.length;r!==a;++r){const a=e[r],s=i[a.id];!1!==s.needsUpdate&&a.setValue(t,s.value,n)}},ns.seqWithValue=function(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i};let as=0;function ss(t){switch(t){case Ce:return["Linear","( value )"];case Re:return["sRGB","( value )"];case De:return["RGBE","( value )"];case Fe:return["RGBM","( value, 7.0 )"];case ze:return["RGBM","( value, 16.0 )"];case ke:return["RGBD","( value, 256.0 )"];case Ie:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Ne:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function os(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return n&&""===r?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+i+"\n"+r+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function ls(t,e){const i=ss(e);return"vec4 "+t+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function hs(t,e){const i=ss(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function cs(t,e){let i;switch(e){case V:i="Linear";break;case W:i="Reinhard";break;case q:i="OptimizedCineon";break;case X:i="ACESFilmic";break;case Y:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function us(t){return""!==t}function ps(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ds(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ms=/^[ \t]*#include +<([\w\d.\/]+)>/gm;function fs(t){return t.replace(ms,gs)}function gs(t,e){const i=Vr[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return fs(i)}const vs=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,ys=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function xs(t){return t.replace(ys,ws).replace(vs,bs)}function bs(t,e,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),ws(t,e,i,n)}function ws(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function _s(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Ms(t,e,i,n){const o=t.getContext(),l=i.defines;let h=i.vertexShader,c=i.fragmentShader;const u=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===r?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===a?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===s&&(e="SHADOWMAP_TYPE_VSM"),e}(i),p=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Z:case J:e="ENVMAP_TYPE_CUBE";break;case $:case tt:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),d=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case J:case tt:e="ENVMAP_MODE_REFRACTION"}return e}(i),m=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case U:e="ENVMAP_BLENDING_MULTIPLY";break;case G:e="ENVMAP_BLENDING_MIX";break;case H:e="ENVMAP_BLENDING_ADD"}return e}(i),f=t.gammaFactor>0?t.gammaFactor:1,g=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(us).join("\n")}(i),v=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(l),y=o.createProgram();let x,b,w=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?((x=[v].filter(us).join("\n")).length>0&&(x+="\n"),(b=[g,v].filter(us).join("\n")).length>0&&(b+="\n")):(x=[_s(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(us).join("\n"),b=[g,_s(i),"#define SHADER_NAME "+i.shaderName,v,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.envMap?"#define "+d:"",i.envMap?"#define "+m:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==j?"#define TONE_MAPPING":"",i.toneMapping!==j?Vr.tonemapping_pars_fragment:"",i.toneMapping!==j?cs("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",Vr.encodings_pars_fragment,i.map?ls("mapTexelToLinear",i.mapEncoding):"",i.matcap?ls("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?ls("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?ls("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMap?ls("lightMapTexelToLinear",i.lightMapEncoding):"",hs("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(us).join("\n")),h=ds(h=ps(h=fs(h),i),i),c=ds(c=ps(c=fs(c),i),i),h=xs(h),c=xs(c),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(w="#version 300 es\n",x=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+x,b=["#define varying in",i.glslVersion===Xe?"":"out highp vec4 pc_fragColor;",i.glslVersion===Xe?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const _=w+b+c,M=rs(o,35633,w+x+h),S=rs(o,35632,_);if(o.attachShader(y,M),o.attachShader(y,S),void 0!==i.index0AttributeName?o.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&o.bindAttribLocation(y,0,"position"),o.linkProgram(y),t.debug.checkShaderErrors){const t=o.getProgramInfoLog(y).trim(),e=o.getShaderInfoLog(M).trim(),i=o.getShaderInfoLog(S).trim();let n=!0,r=!0;if(!1===o.getProgramParameter(y,35714)){n=!1;const e=os(o,M,"vertex"),i=os(o,S,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(y,35715),"gl.getProgramInfoLog",t,e,i)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==i||(r=!1);r&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:x},fragmentShader:{log:i,prefix:b}})}let T,E;return o.deleteShader(M),o.deleteShader(S),this.getUniforms=function(){return void 0===T&&(T=new ns(o,y)),T},this.getAttributes=function(){return void 0===E&&(E=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r).name;i[n]=t.getAttribLocation(e,n)}return i}(o,y)),E},this.destroy=function(){n.releaseStatesOfProgram(this),o.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=as++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=M,this.fragmentShader=S,this}function Ss(t,e,i,n,r,a){const s=[],o=n.isWebGL2,c=n.logarithmicDepthBuffer,u=n.floatVertexTextures,p=n.maxVertexUniforms,d=n.vertexTextures;let m=n.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},g=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function v(t){let e;return t?t.isTexture?e=t.encoding:t.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),e=t.texture.encoding):e=Ce,e}return{getParameters:function(r,s,g,y,x){const b=y.fog,w=r.isMeshStandardMaterial?y.environment:null,_=e.get(r.envMap||w),M=f[r.type],S=x.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(u)return 1024;{const t=p,i=Math.floor((t-20)/4),n=Math.min(i,e.length);return n<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+n+"."),0):n}}(x):0;let T,E;if(null!==r.precision&&(m=n.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",m,"instead."),M){const t=qr[M];T=t.vertexShader,E=t.fragmentShader}else T=r.vertexShader,E=r.fragmentShader;const A=t.getRenderTarget();return{isWebGL2:o,shaderID:M,shaderName:r.type,vertexShader:T,fragmentShader:E,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:m,instancing:!0===x.isInstancedMesh,instancingColor:!0===x.isInstancedMesh&&null!==x.instanceColor,supportsVertexTextures:d,outputEncoding:null!==A?v(A.texture):t.outputEncoding,map:!!r.map,mapEncoding:v(r.map),matcap:!!r.matcap,matcapEncoding:v(r.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:v(_),envMapCubeUV:!!_&&(_.mapping===$||_.mapping===tt),lightMap:!!r.lightMap,lightMapEncoding:v(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:v(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===He,tangentSpaceNormalMap:r.normalMapType===Ge,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,transmissionMap:!!r.transmissionMap,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap||r.transmissionMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmissionMap||!r.displacementMap),fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:c,skinning:r.skinning&&S>0,maxBones:S,useVertexTexture:u,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&g.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:j,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===h,flipSided:r.side===l,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:o||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:o||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:o||i.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.fragmentShader),i.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);if(!1===e.isRawShaderMaterial){for(let t=0;t<g.length;t++)i.push(e[g[t]]);i.push(t.outputEncoding),i.push(t.gammaFactor)}return i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=f[t.type];let i;if(e){const t=qr[e];i=Er.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=s.length;t<e;t++){const e=s[t];if(e.cacheKey===i){++(n=e).usedTimes;break}}return void 0===n&&(n=new Ms(t,i,e,r),s.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=s.indexOf(t);s[e]=s[s.length-1],s.pop(),t.destroy()}},programs:s}}function Ts(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Es(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function As(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ps(t){const e=[];let i=0;const n=[],r=[],a={id:-1};function s(n,r,s,o,l,h){let c=e[i];const u=t.get(s);return void 0===c?(c={id:n.id,object:n,geometry:r,material:s,program:u.program||a,groupOrder:o,renderOrder:n.renderOrder,z:l,group:h},e[i]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=s,c.program=u.program||a,c.groupOrder=o,c.renderOrder=n.renderOrder,c.z=l,c.group=h),i++,c}return{opaque:n,transparent:r,init:function(){i=0,n.length=0,r.length=0},push:function(t,e,i,a,o,l){const h=s(t,e,i,a,o,l);(!0===i.transparent?r:n).push(h)},unshift:function(t,e,i,a,o,l){const h=s(t,e,i,a,o,l);(!0===i.transparent?r:n).unshift(h)},finish:function(){for(let t=i,n=e.length;t<n;t++){const i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Es),r.length>1&&r.sort(e||As)}}}function Ls(t){let e=new WeakMap;return{get:function(i,n){const r=e.get(i);let a;return void 0===r?(a=new Ps(t),e.set(i,new WeakMap),e.get(i).set(n,a)):void 0===(a=r.get(n))&&(a=new Ps(t),r.set(n,a)),a},dispose:function(){e=new WeakMap}}}function Os(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new li,color:new On};break;case"SpotLight":i={position:new li,direction:new li,color:new On,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new li,color:new On,distance:0,decay:0};break;case"HemisphereLight":i={direction:new li,skyColor:new On,groundColor:new On};break;case"RectAreaLight":i={color:new On,position:new li,halfWidth:new li,halfHeight:new li}}return t[e.id]=i,i}}}let Cs=0;function Rs(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Is(t,e){const i=new Os,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Qe,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new li);const a=new li,s=new Fi,o=new Fi;return{setup:function(l,h,c){let u=0,p=0,d=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let m=0,f=0,g=0,v=0,y=0,x=0,b=0,w=0;const _=c.matrixWorldInverse;l.sort(Rs);for(let t=0,e=l.length;t<e;t++){const e=l[t],h=e.color,c=e.intensity,M=e.distance,S=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)u+=h.r*c,p+=h.g*c,d+=h.b*c;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],c);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity),t.direction.setFromMatrixPosition(e.matrixWorld),a.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(a),t.direction.transformDirection(_),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[m]=i,r.directionalShadowMap[m]=S,r.directionalShadowMatrix[m]=e.shadow.matrix,x++}r.directional[m]=t,m++}else if(e.isSpotLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(_),t.color.copy(h).multiplyScalar(c),t.distance=M,t.direction.setFromMatrixPosition(e.matrixWorld),a.setFromMatrixPosition(e.target.matrixWorld),t.direction.sub(a),t.direction.transformDirection(_),t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.spotShadow[g]=i,r.spotShadowMap[g]=S,r.spotShadowMatrix[g]=e.shadow.matrix,w++}r.spot[g]=t,g++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(h).multiplyScalar(c),t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(_),o.identity(),s.copy(e.matrixWorld),s.premultiply(_),o.extractRotation(s),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),r.rectArea[v]=t,v++}else if(e.isPointLight){const t=i.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.position.applyMatrix4(_),t.color.copy(e.color).multiplyScalar(e.intensity),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[f]=i,r.pointShadowMap[f]=S,r.pointShadowMatrix[f]=e.shadow.matrix,b++}r.point[f]=t,f++}else if(e.isHemisphereLight){const t=i.get(e);t.direction.setFromMatrixPosition(e.matrixWorld),t.direction.transformDirection(_),t.direction.normalize(),t.skyColor.copy(e.color).multiplyScalar(c),t.groundColor.copy(e.groundColor).multiplyScalar(c),r.hemi[y]=t,y++}}v>0&&(e.isWebGL2?(r.rectAreaLTC1=Wr.LTC_FLOAT_1,r.rectAreaLTC2=Wr.LTC_FLOAT_2):!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Wr.LTC_FLOAT_1,r.rectAreaLTC2=Wr.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Wr.LTC_HALF_1,r.rectAreaLTC2=Wr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=u,r.ambient[1]=p,r.ambient[2]=d;const M=r.hash;M.directionalLength===m&&M.pointLength===f&&M.spotLength===g&&M.rectAreaLength===v&&M.hemiLength===y&&M.numDirectionalShadows===x&&M.numPointShadows===b&&M.numSpotShadows===w||(r.directional.length=m,r.spot.length=g,r.rectArea.length=v,r.point.length=f,r.hemi.length=y,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=b,r.pointShadowMap.length=b,r.spotShadow.length=w,r.spotShadowMap.length=w,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=b,r.spotShadowMatrix.length=w,M.directionalLength=m,M.pointLength=f,M.spotLength=g,M.rectAreaLength=v,M.hemiLength=y,M.numDirectionalShadows=x,M.numPointShadows=b,M.numSpotShadows=w,r.version=Cs++)},state:r}}function Ds(t,e){const i=new Is(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,r,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function Ns(t,e){let i=new WeakMap;return{get:function(n,r){let a;return!1===i.has(n)?(a=new Ds(t,e),i.set(n,new WeakMap),i.get(n).set(r,a)):!1===i.get(n).has(r)?(a=new Ds(t,e),i.get(n).set(r,a)):a=i.get(n).get(r),a},dispose:function(){i=new WeakMap}}}function Fs(t){In.call(this),this.type="MeshDepthMaterial",this.depthPacking=Be,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function zs(t){In.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new li,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Fs.prototype=Object.create(In.prototype),Fs.prototype.constructor=Fs,Fs.prototype.isMeshDepthMaterial=!0,Fs.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.depthPacking=t.depthPacking,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this},zs.prototype=Object.create(In.prototype),zs.prototype.constructor=zs,zs.prototype.isMeshDistanceMaterial=!0,zs.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this};var ks="uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}",Bs="void main() {\n\tgl_Position = vec4( position, 1.0 );\n}";function Us(t,e,i){let n=new Ur;const a=new Qe,u=new Qe,p=new ri,d=[],m=[],f={},g={0:l,1:o,2:h},v=new Lr({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Qe},radius:{value:4}},vertexShader:Bs,fragmentShader:ks}),y=v.clone();y.defines.HORIZONAL_PASS=1;const x=new ir;x.setAttribute("position",new zn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new br(x,v),w=this;function _(i,n){const r=e.update(b);v.uniforms.shadow_pass.value=i.map.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,v,b,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,y,b,null)}function M(t,e,i){const n=t<<0|e<<1|i<<2;let r=d[n];return void 0===r&&(r=new Fs({depthPacking:Ue,morphTargets:t,skinning:e}),d[n]=r),r}function S(t,e,i){const n=t<<0|e<<1|i<<2;let r=m[n];return void 0===r&&(r=new zs({morphTargets:t,skinning:e}),m[n]=r),r}function T(e,i,n,r,a,o,l){let h=null,c=M,u=e.customDepthMaterial;if(!0===r.isPointLight&&(c=S,u=e.customDistanceMaterial),void 0===u){let t=!1;!0===n.morphTargets&&(t=i.morphAttributes&&i.morphAttributes.position&&i.morphAttributes.position.length>0);let r=!1;!0===e.isSkinnedMesh&&(!0===n.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",e)),h=c(t,r,!0===e.isInstancedMesh)}else h=u;if(t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const t=h.uuid,e=n.uuid;let i=f[t];void 0===i&&(i={},f[t]=i);let r=i[e];void 0===r&&(r=h.clone(),i[e]=r),h=r}return h.visible=n.visible,h.wireframe=n.wireframe,h.side=l===s?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:g[n.side],h.clipShadows=n.clipShadows,h.clippingPlanes=n.clippingPlanes,h.clipIntersection=n.clipIntersection,h.wireframeLinewidth=n.wireframeLinewidth,h.linewidth=n.linewidth,!0===r.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(r.matrixWorld),h.nearDistance=a,h.farDistance=o),h}function E(i,r,a,o,l){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&l===s)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let s=0,h=e.length;s<h;s++){const h=e[s],c=r[h.materialIndex];if(c&&c.visible){const e=T(i,n,c,o,a.near,a.far,l);t.renderBufferDirect(a,null,n,e,i,h)}}}else if(r.visible){const e=T(i,n,r,o,a.near,a.far,l);t.renderBufferDirect(a,null,n,e,i,null)}}const h=i.children;for(let t=0,e=h.length;t<e;t++)E(h[t],r,a,o,l)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=r,this.render=function(e,r,o){if(!1===w.enabled)return;if(!1===w.autoUpdate&&!1===w.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),m=t.state;m.setBlending(c),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(let l=0,h=e.length;l<h;l++){const h=e[l],c=h.shadow;if(void 0===c){console.warn("THREE.WebGLShadowMap:",h,"has no shadow.");continue}if(!1===c.autoUpdate&&!1===c.needsUpdate)continue;a.copy(c.mapSize);const d=c.getFrameExtents();if(a.multiply(d),u.copy(c.mapSize),(a.x>i||a.y>i)&&(a.x>i&&(u.x=Math.floor(i/d.x),a.x=u.x*d.x,c.mapSize.x=u.x),a.y>i&&(u.y=Math.floor(i/d.y),a.y=u.y*d.y,c.mapSize.y=u.y)),null===c.map&&!c.isPointLightShadow&&this.type===s){const t={minFilter:ot,magFilter:ot,format:St};c.map=new ai(a.x,a.y,t),c.map.texture.name=h.name+".shadowMap",c.mapPass=new ai(a.x,a.y,t),c.camera.updateProjectionMatrix()}if(null===c.map){const t={minFilter:rt,magFilter:rt,format:St};c.map=new ai(a.x,a.y,t),c.map.texture.name=h.name+".shadowMap",c.camera.updateProjectionMatrix()}t.setRenderTarget(c.map),t.clear();const f=c.getViewportCount();for(let t=0;t<f;t++){const e=c.getViewport(t);p.set(u.x*e.x,u.y*e.y,u.x*e.z,u.y*e.w),m.viewport(p),c.updateMatrices(h,t),n=c.getFrustum(),E(r,o,c.camera,h,this.type)}c.isPointLightShadow||this.type!==s||_(c,o),c.needsUpdate=!1}w.needsUpdate=!1,t.setRenderTarget(l,h,d)}}function Gs(t,r,a){const s=a.isWebGL2;const o=new function(){let e=!1;const i=new ri;let n=null;const r=new ri(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,a,s,o){!0===o&&(e*=s,n*=s,a*=s),i.set(e,n,a,s),!1===r.equals(i)&&(t.clearColor(e,n,a,s),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},U=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?mt(2929):ft(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case R:t.depthFunc(512);break;case I:t.depthFunc(519);break;case D:t.depthFunc(513);break;case N:t.depthFunc(515);break;case F:t.depthFunc(514);break;case z:t.depthFunc(518);break;case k:t.depthFunc(516);break;case B:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},G=new function(){let e=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,h=null;return{setTest:function(t){e||(t?mt(2960):ft(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,s){n===e&&r===i&&a===s||(t.stencilFunc(e,i,s),n=e,r=i,a=s)},setOp:function(e,i,n){s===e&&o===i&&l===n||(t.stencilOp(e,i,n),s=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){h!==e&&(t.clearStencil(e),h=e)},reset:function(){e=!1,i=null,n=null,r=null,a=null,s=null,o=null,l=null,h=null}}};let H={},j=null,V=null,W=null,q=null,X=null,Y=null,Z=null,J=null,K=null,Q=!1,$=null,tt=null,et=null,it=null,nt=null;const rt=t.getParameter(35661);let at=!1,st=0;const ot=t.getParameter(7938);-1!==ot.indexOf("WebGL")?(st=parseFloat(/^WebGL\ ([0-9])/.exec(ot)[1]),at=st>=1):-1!==ot.indexOf("OpenGL ES")&&(st=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(ot)[1]),at=st>=2);let lt=null,ht={};const ct=new ri,ut=new ri;function pt(e,i,n){const r=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return a}const dt={};function mt(e){!0!==H[e]&&(t.enable(e),H[e]=!0)}function ft(e){!1!==H[e]&&(t.disable(e),H[e]=!1)}dt[3553]=pt(3553,3553,1),dt[34067]=pt(34067,34069,6),o.setClear(0,0,0,1),U.setClear(1),G.setClear(0),mt(2929),U.setFunc(N),xt(!1),bt(i),mt(2884),yt(c);const gt={[g]:32774,[v]:32778,[y]:32779};if(s)gt[x]=32775,gt[b]=32776;else{const t=r.get("EXT_blend_minmax");null!==t&&(gt[x]=t.MIN_EXT,gt[b]=t.MAX_EXT)}const vt={[w]:0,[_]:1,[M]:768,[T]:770,[C]:776,[L]:774,[A]:772,[S]:769,[E]:771,[O]:775,[P]:773};function yt(e,i,n,r,a,s,o,l){if(e!==c){if(V||(mt(3042),V=!0),e===f)a=a||i,s=s||n,o=o||r,i===q&&a===Z||(t.blendEquationSeparate(gt[i],gt[a]),q=i,Z=a),n===X&&r===Y&&s===J&&o===K||(t.blendFuncSeparate(vt[n],vt[r],vt[s],vt[o]),X=n,Y=r,J=s,K=o),W=e,Q=null;else if(e!==W||l!==Q){if(q===g&&Z===g||(t.blendEquation(32774),q=g,Z=g),l)switch(e){case u:t.blendFuncSeparate(1,771,1,771);break;case p:t.blendFunc(1,1);break;case d:t.blendFuncSeparate(0,0,769,771);break;case m:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case u:t.blendFuncSeparate(770,771,1,771);break;case p:t.blendFunc(770,1);break;case d:t.blendFunc(0,769);break;case m:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}X=null,Y=null,J=null,K=null,W=e,Q=l}}else V&&(ft(3042),V=!1)}function xt(e){$!==e&&(e?t.frontFace(2304):t.frontFace(2305),$=e)}function bt(r){r!==e?(mt(2884),r!==tt&&(r===i?t.cullFace(1029):r===n?t.cullFace(1028):t.cullFace(1032))):ft(2884),tt=r}function wt(e,i,n){e?(mt(32823),it===i&&nt===n||(t.polygonOffset(i,n),it=i,nt=n)):ft(32823)}function _t(e){void 0===e&&(e=33984+rt-1),lt!==e&&(t.activeTexture(e),lt=e)}return{buffers:{color:o,depth:U,stencil:G},enable:mt,disable:ft,useProgram:function(e){return j!==e&&(t.useProgram(e),j=e,!0)},setBlending:yt,setMaterial:function(t,e){t.side===h?ft(2884):mt(2884);let i=t.side===l;e&&(i=!i),xt(i),t.blending===u&&!1===t.transparent?yt(c):yt(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),U.setFunc(t.depthFunc),U.setTest(t.depthTest),U.setMask(t.depthWrite),o.setMask(t.colorWrite);const n=t.stencilWrite;G.setTest(n),n&&(G.setMask(t.stencilWriteMask),G.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),G.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),wt(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:xt,setCullFace:bt,setLineWidth:function(e){e!==et&&(at&&t.lineWidth(e),et=e)},setPolygonOffset:wt,setScissorTest:function(t){t?mt(3089):ft(3089)},activeTexture:_t,bindTexture:function(e,i){null===lt&&_t();let n=ht[lt];void 0===n&&(n={type:void 0,texture:void 0},ht[lt]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||dt[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=ht[lt];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===ct.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),ct.copy(e))},viewport:function(e){!1===ut.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),ut.copy(e))},reset:function(){H={},lt=null,ht={},j=null,W=null,$=null,tt=null,o.reset(),U.reset(),G.reset()}}}function Hs(t,e,i,n,r,a,s){const o=r.isWebGL2,l=r.maxTextures,h=r.maxCubemapSize,c=r.maxTextureSize,u=r.maxSamples,p=new WeakMap;let d,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return m?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Ke.floorPowerOfTwo:Math.floor,a=n(r*t.width),s=n(r*t.height);void 0===d&&(d=f(a,s));const o=i?f(a,s):d;return o.width=a,o.height=s,o.getContext("2d").drawImage(t,0,0,a,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+a+"x"+s+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function v(t){return Ke.isPowerOfTwo(t.width)&&Ke.isPowerOfTwo(t.height)}function y(t,e){return t.generateMipmaps&&e&&t.minFilter!==rt&&t.minFilter!==ot}function x(e,i,r,a){t.generateMipmap(e),n.get(i).__maxMipLevel=Math.log(Math.max(r,a))*Math.LOG2E}function b(i,n,r){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let a=n;return 6403===n&&(5126===r&&(a=33326),5131===r&&(a=33325),5121===r&&(a=33321)),6407===n&&(5126===r&&(a=34837),5131===r&&(a=34843),5121===r&&(a=32849)),6408===n&&(5126===r&&(a=34836),5131===r&&(a=34842),5121===r&&(a=32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||e.get("EXT_color_buffer_float"),a}function w(t){return t===rt||t===at||t===st?9728:9729}function _(e){const i=e.target;i.removeEventListener("dispose",_),function(e){const i=n.get(e);if(void 0===i.__webglInit)return;t.deleteTexture(i.__webglTexture),n.remove(e)}(i),i.isVideoTexture&&p.delete(i),s.memory.textures--,s.memory.textureSz-=i.textureSz}function M(e){const i=e.target;i.removeEventListener("dispose",M),function(e){const i=n.get(e),r=n.get(e.texture);if(!e)return;void 0!==r.__webglTexture&&t.deleteTexture(r.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&t.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer);n.remove(e.texture),n.remove(e)}(i),s.memory.textures--}let S=0;function T(t,e){const r=n.get(t);if(t.isVideoTexture&&function(t){const e=s.render.frame;p.get(t)!==e&&(p.set(t,e),t.update())}(t),t.version>0&&r.__version!==t.version){const i=t.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void C(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}function E(e,r){const l=n.get(e);e.version>0&&l.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;O(e,n),i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),t.pixelStorei(37440,n.flipY);const l=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),c=n.image[0]&&n.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=l||c?c?n.image[t].image:n.image[t]:g(n.image[t],!1,!0,h);const p=u[0],d=v(p)||o,m=a.convert(n.format),f=a.convert(n.type),w=b(n.internalFormat,m,f);let _;if(L(34067,n,d),l){for(let t=0;t<6;t++){_=u[t].mipmaps;for(let e=0;e<_.length;e++){const r=_[e];n.format!==St&&n.format!==Mt?null!==m?i.compressedTexImage2D(34069+t,e,w,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+t,e,w,r.width,r.height,0,m,f,r.data),n.textureSz+=r.width*r.height*(n.format===St?4:3)}}e.__maxMipLevel=_.length-1}else{_=n.mipmaps;for(let t=0;t<6;t++){if(c){i.texImage2D(34069+t,0,w,u[t].width,u[t].height,0,m,f,u[t].data);for(let e=0;e<_.length;e++){const n=_[e],r=n.image[t].image;i.texImage2D(34069+t,e+1,w,r.width,r.height,0,m,f,r.data)}}else{i.texImage2D(34069+t,0,w,m,f,u[t]);for(let e=0;e<_.length;e++){const n=_[e];i.texImage2D(34069+t,e+1,w,m,f,n.image[t])}}n.textureSz+=u[t].width*u[t].height*(n.format===St?4:3)}e.__maxMipLevel=_.length}y(n,d)&&x(34067,n,p.width,p.height);e.__version=n.version,n.onUpdate&&n.onUpdate(n);s.memory.textureSz+=n.textureSz}(l,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,l.__webglTexture))}const A={[et]:10497,[it]:33071,[nt]:33648},P={[rt]:9728,[at]:9984,[st]:9986,[ot]:9729,[lt]:9985,[ht]:9987};function L(i,a,s){s?(t.texParameteri(i,10242,A[a.wrapS]),t.texParameteri(i,10243,A[a.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,A[a.wrapR]),t.texParameteri(i,10240,P[a.magFilter]),t.texParameteri(i,10241,P[a.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),a.wrapS===it&&a.wrapT===it||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,w(a.magFilter)),t.texParameteri(i,10241,w(a.minFilter)),a.minFilter!==rt&&a.minFilter!==ot&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const l=e.get("EXT_texture_filter_anisotropic");if(l){if(a.type===gt&&null===e.get("OES_texture_float_linear"))return;if(a.type===vt&&null===(o||e.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||n.get(a).__currentAnisotropy)&&(t.texParameterf(i,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,r.getMaxAnisotropy())),n.get(a).__currentAnisotropy=a.anisotropy)}}function O(e,i){void 0===e.__webglInit?(e.__webglInit=!0,i.addEventListener("dispose",_),e.__webglTexture=t.createTexture(),s.memory.textures++,i.textureSz=0):(s.memory.textureSz-=i.textureSz,i.textureSz=0)}function C(e,n,r){let l=3553;n.isDataTexture2DArray&&(l=35866),n.isDataTexture3D&&(l=32879),O(e,n),i.activeTexture(33984+r),i.bindTexture(l,e.__webglTexture),t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment);const h=function(t){return!o&&(t.wrapS!==it||t.wrapT!==it||t.minFilter!==rt&&t.minFilter!==ot)}(n)&&!1===v(n.image),u=g(n.image,h,!1,c),p=v(u)||o,d=a.convert(n.format);let m,f=a.convert(n.type),w=b(n.internalFormat,d,f);L(l,n,p);const _=n.mipmaps;if(n.isDepthTexture)w=6402,o?w=n.type===gt?36012:n.type===ft?33190:n.type===wt?35056:33189:n.type===gt&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===Pt&&6402===w&&n.type!==dt&&n.type!==ft&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=dt,f=a.convert(n.type)),n.format===Lt&&6402===w&&(w=34041,n.type!==wt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=wt,f=a.convert(n.type))),i.texImage2D(3553,0,w,u.width,u.height,0,d,f,null);else if(n.isDataTexture)if(_.length>0&&p){for(let t=0,e=_.length;t<e;t++)m=_[t],i.texImage2D(3553,t,w,m.width,m.height,0,d,f,m.data);n.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else i.texImage2D(3553,0,w,u.width,u.height,0,d,f,u.data),e.__maxMipLevel=0;else if(n.isCompressedTexture){for(let t=0,e=_.length;t<e;t++)m=_[t],n.format!==St&&n.format!==Mt?null!==d?i.compressedTexImage2D(3553,t,w,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,t,w,m.width,m.height,0,d,f,m.data);e.__maxMipLevel=_.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,w,u.width,u.height,u.depth,0,d,f,u.data),e.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,w,u.width,u.height,u.depth,0,d,f,u.data),e.__maxMipLevel=0;else if(_.length>0&&p){for(let t=0,e=_.length;t<e;t++)m=_[t],i.texImage2D(3553,t,w,d,f,m),n.textureSz+=m.image.width*m.image.height*(m.format===St?4:3);n.generateMipmaps=!1,e.__maxMipLevel=_.length-1}else i.texImage2D(3553,0,w,d,f,u),e.__maxMipLevel=0,n.textureSz+=n.image.width*n.image.height*(n.format===St?4:3);y(n,p)&&x(l,n,u.width,u.height),e.__version=n.version,n.onUpdate&&n.onUpdate(n),s.memory.textureSz+=n.textureSz}function R(e,r,s,o){const l=a.convert(r.texture.format),h=a.convert(r.texture.type),c=b(r.texture.internalFormat,l,h);i.texImage2D(o,0,c,r.width,r.height,0,l,h,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,s,o,n.get(r.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function I(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===gt?r=36012:e.type===ft&&(r=33190));const n=N(i);t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const e=N(i);t.renderbufferStorageMultisample(36161,e,35056,i.width,i.height)}else t.renderbufferStorage(36161,34041,i.width,i.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=a.convert(i.texture.format),r=a.convert(i.texture.type),s=b(i.texture.internalFormat,e,r);if(n){const e=N(i);t.renderbufferStorageMultisample(36161,e,s,i.width,i.height)}else t.renderbufferStorage(36161,s,i.width,i.height)}t.bindRenderbuffer(36161,null)}function D(e){const i=n.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),T(i.depthTexture,0);const r=n.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===Pt)t.framebufferTexture2D(36160,36096,3553,r,0);else{if(i.depthTexture.format!==Lt)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,r,0)}}(i.__webglFramebuffer,e)}else if(r){i.__webglDepthbuffer=[];for(let n=0;n<6;n++)t.bindFramebuffer(36160,i.__webglFramebuffer[n]),i.__webglDepthbuffer[n]=t.createRenderbuffer(),I(i.__webglDepthbuffer[n],e,!1)}else t.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=t.createRenderbuffer(),I(i.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function N(t){return o&&t.isWebGLMultisampleRenderTarget?Math.min(u,t.samples):0}let F=!1,z=!1;this.allocateTextureUnit=function(){const t=S;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),S+=1,t},this.resetTextureUnits=function(){S=0},this.setTexture2D=T,this.setTexture2DArray=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?C(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?C(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=E,this.setupRenderTarget=function(e){const r=n.get(e),l=n.get(e.texture);e.addEventListener("dispose",M),l.__webglTexture=t.createTexture(),s.memory.textures++;const h=!0===e.isWebGLCubeRenderTarget,c=!0===e.isWebGLMultisampleRenderTarget,u=v(e)||o;if(!o||e.texture.format!==Mt||e.texture.type!==gt&&e.texture.type!==vt||(e.texture.format=St,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){r.__webglFramebuffer=[];for(let e=0;e<6;e++)r.__webglFramebuffer[e]=t.createFramebuffer()}else if(r.__webglFramebuffer=t.createFramebuffer(),c)if(o){r.__webglMultisampledFramebuffer=t.createFramebuffer(),r.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,r.__webglColorRenderbuffer);const i=a.convert(e.texture.format),n=a.convert(e.texture.type),s=b(e.texture.internalFormat,i,n),o=N(e);t.renderbufferStorageMultisample(36161,o,s,e.width,e.height),t.bindFramebuffer(36160,r.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,r.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(r.__webglDepthRenderbuffer=t.createRenderbuffer(),I(r.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){i.bindTexture(34067,l.__webglTexture),L(34067,e.texture,u);for(let t=0;t<6;t++)R(r.__webglFramebuffer[t],e,36064,34069+t);y(e.texture,u)&&x(34067,e.texture,e.width,e.height),i.bindTexture(34067,null)}else i.bindTexture(3553,l.__webglTexture),L(3553,e.texture,u),R(r.__webglFramebuffer,e,36064,3553),y(e.texture,u)&&x(3553,e.texture,e.width,e.height),i.bindTexture(3553,null);e.depthBuffer&&D(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(y(e,v(t)||o)){const r=t.isWebGLCubeRenderTarget?34067:3553,a=n.get(e).__webglTexture;i.bindTexture(r,a),x(r,e,t.width,t.height),i.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(o){const i=n.get(e);t.bindFramebuffer(36008,i.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,i.__webglFramebuffer);const r=e.width,a=e.height;let s=16384;e.depthBuffer&&(s|=256),e.stencilBuffer&&(s|=1024),t.blitFramebuffer(0,0,r,a,0,0,r,a,s,9728),t.bindFramebuffer(36160,i.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,e){t&&t.isWebGLRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),F=!0),t=t.texture),T(t,e)},this.safeSetTextureCube=function(t,e){t&&t.isWebGLCubeRenderTarget&&(!1===z&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),z=!0),t=t.texture),E(t,e)}}function js(t,e,i){const n=i.isWebGL2;return{convert:function(t){let i;if(t===ct)return 5121;if(t===yt)return 32819;if(t===xt)return 32820;if(t===bt)return 33635;if(t===ut)return 5120;if(t===pt)return 5122;if(t===dt)return 5123;if(t===mt)return 5124;if(t===ft)return 5125;if(t===gt)return 5126;if(t===vt)return n?5131:null!==(i=e.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(t===_t)return 6406;if(t===Mt)return 6407;if(t===St)return 6408;if(t===Tt)return 6409;if(t===Et)return 6410;if(t===Pt)return 6402;if(t===Lt)return 34041;if(t===Ot)return 6403;if(t===Ct)return 36244;if(t===Rt)return 33319;if(t===It)return 33320;if(t===Dt)return 36248;if(t===Nt)return 36249;if(t===Ft||t===zt||t===kt||t===Bt){if(null===(i=e.get("WEBGL_compressed_texture_s3tc")))return null;if(t===Ft)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===zt)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===kt)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Bt)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===Ut||t===Gt||t===Ht||t===jt){if(null===(i=e.get("WEBGL_compressed_texture_pvrtc")))return null;if(t===Ut)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Gt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Ht)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===jt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(t===Vt)return null!==(i=e.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((t===Wt||t===qt)&&null!==(i=e.get("WEBGL_compressed_texture_etc"))){if(t===Wt)return i.COMPRESSED_RGB8_ETC2;if(t===qt)return i.COMPRESSED_RGBA8_ETC2_EAC}return t===Xt||t===Yt||t===Zt||t===Jt||t===Kt||t===Qt||t===$t||t===te||t===ee||t===ie||t===ne||t===re||t===ae||t===se||t===le||t===he||t===ce||t===ue||t===pe||t===de||t===me||t===fe||t===ge||t===ve||t===ye||t===xe||t===be||t===we?null!==(i=e.get("WEBGL_compressed_texture_astc"))?t:null:t===oe?null!==(i=e.get("EXT_texture_compression_bptc"))?t:null:t===wt?n?34042:null!==(i=e.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function Vs(t){Cr.call(this),this.cameras=t||[]}function Ws(){ln.call(this),this.type="Group"}function qs(){this._targetRay=null,this._grip=null,this._hand=null}function Xs(t,e){const i=this;let n=null,r=1,a=null,s="local-floor",o=null;const l=[],h=new Map,c=new Cr;c.layers.enable(1),c.viewport=new ri;const u=new Cr;u.layers.enable(2),u.viewport=new ri;const p=[c,u],d=new Vs;d.layers.enable(1),d.layers.enable(2);let m=null,f=null;function g(t){const e=h.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function v(){h.forEach(function(t,e){t.disconnect(e)}),h.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),S.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function y(t){a=t,S.setContext(n),S.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}function x(t){const e=n.inputSources;for(let t=0;t<l.length;t++)h.set(e[t],l[t]);for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=h.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),h.delete(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e],n=h.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=l[t];return void 0===e&&(e=new qs,l[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=l[t];return void 0===e&&(e=new qs,l[t]=e),e.getGripSpace()},this.getHand=function(t){let e=l[t];return void 0===e&&(e=new qs,l[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){s=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return n},this.setSession=function(t){if(null!==(n=t)){n.addEventListener("select",g),n.addEventListener("selectstart",g),n.addEventListener("selectend",g),n.addEventListener("squeeze",g),n.addEventListener("squeezestart",g),n.addEventListener("squeezeend",g),n.addEventListener("end",v);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const i={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:r},a=new XRWebGLLayer(n,e,i);n.updateRenderState({baseLayer:a}),n.requestReferenceSpace(s).then(y),n.addEventListener("inputsourceschange",x)}};const b=new li,w=new li;function _(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){d.near=u.near=c.near=t.near,d.far=u.far=c.far=t.far,m===d.near&&f===d.far||(n.updateRenderState({depthNear:d.near,depthFar:d.far}),m=d.near,f=d.far);const e=t.parent,i=d.cameras;_(d,e);for(let t=0;t<i.length;t++)_(i[t],e);t.matrixWorld.copy(d.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);return 2===i.length?function(t,e,i){b.setFromMatrixPosition(e.matrixWorld),w.setFromMatrixPosition(i.matrixWorld);const n=b.distanceTo(w),r=e.projectionMatrix.elements,a=i.projectionMatrix.elements,s=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],h=(r[9]-1)/r[5],c=(r[8]-1)/r[0],u=(a[8]+1)/a[0],p=s*c,d=s*u,m=n/(-c+u),f=m*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);const g=s+m,v=o+m,y=p-f,x=d+(n-f),_=l*o/v*g,M=h*o/v*g;t.projectionMatrix.makePerspective(y,x,_,M,g,v)}(d,c,u):d.projectionMatrix.copy(c.projectionMatrix),d};let M=null;const S=new Gr;S.setAnimationLoop(function(e,i){if(null!==(o=i.getViewerPose(a))){const e=o.views,i=n.renderState.baseLayer;t.setFramebuffer(i.framebuffer);let r=!1;e.length!==d.cameras.length&&(d.cameras.length=0,r=!0);for(let t=0;t<e.length;t++){const n=e[t],a=i.getViewport(n),s=p[t];s.matrix.fromArray(n.transform.matrix),s.projectionMatrix.fromArray(n.projectionMatrix),s.viewport.set(a.x,a.y,a.width,a.height),0===t&&d.matrix.copy(s.matrix),!0===r&&d.cameras.push(s)}}const r=n.inputSources;for(let t=0;t<l.length;t++){const e=l[t],n=r[t];e.update(n,i,a)}M&&M(e,i)}),this.setAnimationLoop=function(t){M=t},this.dispose=function(){}}function Ys(t){function e(e,i){e.opacity.value=i.opacity,i.color&&e.diffuse.value.copy(i.color),i.emissive&&e.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(e.map.value=i.map),i.alphaMap&&(e.alphaMap.value=i.alphaMap),i.specularMap&&(e.specularMap.value=i.specularMap);const n=t.get(i).envMap;if(n){e.envMap.value=n,e.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,e.reflectivity.value=i.reflectivity,e.refractionRatio.value=i.refractionRatio;const r=t.get(n).__maxMipLevel;void 0!==r&&(e.maxMipLevel.value=r)}let r,a;i.lightMap&&(e.lightMap.value=i.lightMap,e.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(e.aoMap.value=i.aoMap,e.aoMapIntensity.value=i.aoMapIntensity),i.map?r=i.map:i.specularMap?r=i.specularMap:i.displacementMap?r=i.displacementMap:i.normalMap?r=i.normalMap:i.bumpMap?r=i.bumpMap:i.roughnessMap?r=i.roughnessMap:i.metalnessMap?r=i.metalnessMap:i.alphaMap?r=i.alphaMap:i.emissiveMap?r=i.emissiveMap:i.clearcoatMap?r=i.clearcoatMap:i.clearcoatNormalMap?r=i.clearcoatNormalMap:i.clearcoatRoughnessMap&&(r=i.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),i.aoMap?a=i.aoMap:i.lightMap&&(a=i.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),e.uv2Transform.value.copy(a.matrix))}function i(e,i){e.roughness.value=i.roughness,e.metalness.value=i.metalness,i.roughnessMap&&(e.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(e.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(e.emissiveMap.value=i.emissiveMap),i.bumpMap&&(e.bumpMap.value=i.bumpMap,e.bumpScale.value=i.bumpScale,i.side===l&&(e.bumpScale.value*=-1)),i.normalMap&&(e.normalMap.value=i.normalMap,e.normalScale.value.copy(i.normalScale),i.side===l&&e.normalScale.value.negate()),i.displacementMap&&(e.displacementMap.value=i.displacementMap,e.displacementScale.value=i.displacementScale,e.displacementBias.value=i.displacementBias),t.get(i).envMap&&(e.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,a){n.isMeshBasicMaterial?e(t,n):n.isMeshLambertMaterial?(e(t,n),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,n)):n.isMeshToonMaterial?(e(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===l&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===l&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshPhongMaterial?(e(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===l&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===l&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshStandardMaterial?(e(t,n),n.isMeshPhysicalMaterial?function(t,e){i(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen),e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,e.side===l&&t.clearcoatNormalScale.value.negate()),t.transmission.value=e.transmission,e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap)}(t,n):i(t,n)):n.isMeshMatcapMaterial?(e(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===l&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===l&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDepthMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isMeshDistanceMaterial?(e(t,n),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?(e(t,n),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,e.side===l&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),e.side===l&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,n)):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){let r;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?r=e.map:e.alphaMap&&(r=e.alphaMap),void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,a):n.isSpriteMaterial?function(t,e){let i;t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map),e.alphaMap&&(t.alphaMap.value=e.alphaMap),e.map?i=e.map:e.alphaMap&&(i=e.alphaMap),void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Zs(t){const e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==t.context?t.context:null,n=void 0!==t.alpha&&t.alpha,r=void 0===t.depth||t.depth,a=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,l=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,h=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u=null,p=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ce,this.physicallyCorrectLights=!1,this.toneMapping=j,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const d=this;let m=!1,f=null,g=0,v=0,y=null,x=null,b=-1,w=null,_=null;const M=new ri,S=new ri;let T=null,E=e.width,A=e.height,P=1,L=null,O=null;const C=new ri(0,0,E,A),R=new ri(0,0,E,A);let I=!1;const D=new Ur;let N=!1,F=!1;const z=new Fi,k=new li,B={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function U(){return null===y?P:1}let G,H,V,W,q,X,Y,Z,J,K,Q,$,tt,et,it,nt,rt,at,st,ot,lt,ht=i;function ut(t,i){for(let n=0;n<t.length;n++){const r=t[n],a=e.getContext(r,i);if(null!==a)return a}return null}try{const t={alpha:n,depth:r,stencil:a,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:c};if(e.addEventListener("webglcontextlost",ft,!1),e.addEventListener("webglcontextrestored",yt,!1),null===ht){const e=["webgl2","webgl","experimental-webgl"];if(!0===d.isWebGL1Renderer&&e.shift(),null===(ht=ut(e,t)))throw ut(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ht.getShaderPrecisionFormat&&(ht.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function pt(){G=new $r(ht),!1===(H=new Jr(ht,G,t)).isWebGL2&&(G.get("WEBGL_depth_texture"),G.get("OES_texture_float"),G.get("OES_texture_half_float"),G.get("OES_texture_half_float_linear"),G.get("OES_standard_derivatives"),G.get("OES_element_index_uint"),G.get("OES_vertex_array_object"),G.get("ANGLE_instanced_arrays")),G.get("OES_texture_float_linear"),ot=new js(ht,G,H),(V=new Gs(ht,G,H)).scissor(S.copy(R).multiplyScalar(P).floor()),V.viewport(M.copy(C).multiplyScalar(P).floor()),W=new ia(ht),q=new Ts,X=new Hs(ht,G,V,q,H,ot,W),Y=new Qr(d),Z=new Hr(ht,H),lt=new Yr(ht,G,Z,H),J=new ta(ht,Z,W,lt),K=new sa(ht,J,Z,W),rt=new aa(ht),it=new Kr(q),Q=new Ss(d,Y,G,H,lt,it),$=new Ys(q),tt=new Ls(q),et=new Ns(G,H),nt=new Xr(d,Y,V,K,o),at=new Zr(ht,G,W,H),st=new ea(ht,G,W,H),W.programs=Q.programs,d.capabilities=H,d.extensions=G,d.properties=q,d.renderLists=tt,d.state=V,d.info=W}pt();const dt=new Xs(d,ht);this.xr=dt;const mt=new Us(d,K,H.maxTextureSize);function ft(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function yt(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,pt()}function xt(t){const e=t.target;e.removeEventListener("dispose",xt),function(t){bt(t),q.remove(t)}(e)}function bt(t){const e=q.get(t).program;void 0!==e&&Q.releaseProgram(e)}this.shadowMap=mt,this.getContext=function(){return ht},this.getContextAttributes=function(){return ht.getContextAttributes()},this.forceContextLoss=function(){const t=G.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=G.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(t){void 0!==t&&(P=t,this.setSize(E,A,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new Qe),t.set(E,A)},this.setSize=function(t,i,n){dt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=t,A=i,e.width=Math.floor(t*P),e.height=Math.floor(i*P),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new Qe),t.set(E*P,A*P).floor()},this.setDrawingBufferSize=function(t,i,n){E=t,A=i,P=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new ri),t.copy(M)},this.getViewport=function(t){return t.copy(C)},this.setViewport=function(t,e,i,n){t.isVector4?C.set(t.x,t.y,t.z,t.w):C.set(t,e,i,n),V.viewport(M.copy(C).multiplyScalar(P).floor())},this.getScissor=function(t){return t.copy(R)},this.setScissor=function(t,e,i,n){t.isVector4?R.set(t.x,t.y,t.z,t.w):R.set(t,e,i,n),V.scissor(S.copy(R).multiplyScalar(P).floor())},this.getScissorTest=function(){return I},this.setScissorTest=function(t){V.setScissorTest(I=t)},this.setOpaqueSort=function(t){L=t},this.setTransparentSort=function(t){O=t},this.getClearColor=function(){return nt.getClearColor()},this.setClearColor=function(){nt.setClearColor.apply(nt,arguments)},this.getClearAlpha=function(){return nt.getClearAlpha()},this.setClearAlpha=function(){nt.setClearAlpha.apply(nt,arguments)},this.clear=function(t,e,i){let n=0;(void 0===t||t)&&(n|=16384),(void 0===e||e)&&(n|=256),(void 0===i||i)&&(n|=1024),ht.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",ft,!1),e.removeEventListener("webglcontextrestored",yt,!1),tt.dispose(),et.dispose(),q.dispose(),Y.dispose(),K.dispose(),lt.dispose(),dt.dispose(),_t.stop()},this.renderBufferImmediate=function(t,e){lt.initAttributes();const i=q.get(t);t.hasPositions&&!i.position&&(i.position=ht.createBuffer()),t.hasNormals&&!i.normal&&(i.normal=ht.createBuffer()),t.hasUvs&&!i.uv&&(i.uv=ht.createBuffer()),t.hasColors&&!i.color&&(i.color=ht.createBuffer());const n=e.getAttributes();t.hasPositions&&(ht.bindBuffer(34962,i.position),ht.bufferData(34962,t.positionArray,35048),lt.enableAttribute(n.position),ht.vertexAttribPointer(n.position,3,5126,!1,0,0)),t.hasNormals&&(ht.bindBuffer(34962,i.normal),ht.bufferData(34962,t.normalArray,35048),lt.enableAttribute(n.normal),ht.vertexAttribPointer(n.normal,3,5126,!1,0,0)),t.hasUvs&&(ht.bindBuffer(34962,i.uv),ht.bufferData(34962,t.uvArray,35048),lt.enableAttribute(n.uv),ht.vertexAttribPointer(n.uv,2,5126,!1,0,0)),t.hasColors&&(ht.bindBuffer(34962,i.color),ht.bufferData(34962,t.colorArray,35048),lt.enableAttribute(n.color),ht.vertexAttribPointer(n.color,3,5126,!1,0,0)),lt.disableUnusedAttributes(),ht.drawArrays(4,0,t.count),t.count=0},this.renderBufferDirect=function(t,e,i,n,r,a){null===e&&(e=B);const s=r.isMesh&&r.matrixWorld.determinant()<0,o=At(t,e,n,r);V.setMaterial(n,s);let l=i.index;const h=i.attributes.position;if(null===l){if(void 0===h||0===h.count)return}else if(0===l.count)return;let c,u=1;!0===n.wireframe&&(l=J.getWireframeAttribute(i),u=2),(n.morphTargets||n.morphNormals)&&rt.update(r,i,n,o),lt.setup(r,n,o,i,l);let p=at;null!==l&&(c=Z.get(l),(p=st).setIndex(c));const d=null!==l?l.count:h.count,m=i.drawRange.start*u,f=i.drawRange.count*u,g=null!==a?a.start*u:0,v=null!==a?a.count*u:1/0,y=Math.max(m,g),x=Math.min(d,m+f,g+v)-1,b=Math.max(0,x-y+1);if(0!==b){if(r.isMesh)!0===n.wireframe?(V.setLineWidth(n.wireframeLinewidth*U()),p.setMode(1)):p.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),V.setLineWidth(t*U()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(y,b,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(y,b,t)}else p.render(y,b)}},this.compile=function(t,e){(p=et.get(t,e)).init(),t.traverseVisible(function(t){t.isLight&&t.layers.test(e.layers)&&(p.pushLight(t),t.castShadow&&p.pushShadow(t))}),p.setupLights(e);const i=new WeakMap;t.traverse(function(e){const n=e.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){const a=n[r];!1===i.has(a)&&(Et(a,t,e),i.set(a))}else!1===i.has(n)&&(Et(n,t,e),i.set(n))})};let wt=null;const _t=new Gr;function Mt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,a=t.length;r<a;r++){const a=t[r],s=a.object,o=a.geometry,l=null===n?a.material:n,h=a.group;if(i.isArrayCamera){_=i;const t=i.cameras;for(let i=0,n=t.length;i<n;i++){const n=t[i];s.layers.test(n.layers)&&(V.viewport(M.copy(n.viewport)),p.setupLights(n),Tt(s,e,n,o,l,h))}}else _=null,Tt(s,e,i,o,l,h)}}function Tt(t,e,i,n,r,a){if(t.onBeforeRender(d,e,i,n,r,a),p=et.get(e,_||i),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),t.isImmediateRenderObject){const n=At(i,e,r,t);V.setMaterial(r),lt.reset(),function(t,e){t.render(function(t){d.renderBufferImmediate(t,e)})}(t,n)}else d.renderBufferDirect(i,e,n,r,t,a);t.onAfterRender(d,e,i,n,r,a),p=et.get(e,_||i)}function Et(t,e,i){!0!==e.isScene&&(e=B);const n=q.get(t),r=p.state.lights,a=p.state.shadowsArray,s=r.state.version,o=Q.getParameters(t,r.state,a,e,i),l=Q.getProgramCacheKey(o);let h=n.program,c=!0;if(void 0===h)t.addEventListener("dispose",xt);else if(h.cacheKey!==l)bt(t);else if(n.lightsStateVersion!==s)c=!1;else{if(void 0!==o.shaderID){const i=t.isMeshStandardMaterial?e.environment:null;return void(n.envMap=Y.get(t.envMap||i))}c=!1}c&&(o.uniforms=Q.getUniforms(t),t.onBeforeCompile(o,d),h=Q.acquireProgram(o,l),n.program=h,n.uniforms=o.uniforms,n.outputEncoding=o.outputEncoding);const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=it.numPlanes,n.numIntersection=it.numIntersection,u.clippingPlanes=it.uniform),n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=Y.get(t.envMap||n.environment),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=s,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotShadowMatrix.value=r.state.spotShadowMatrix,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const m=n.program.getUniforms(),f=ns.seqWithValue(m.seq,u);n.uniformsList=f}function At(t,e,i,n){!0!==e.isScene&&(e=B),X.resetTextureUnits();const r=e.fog,a=i.isMeshStandardMaterial?e.environment:null,s=null===y?d.outputEncoding:y.texture.encoding,o=Y.get(i.envMap||a),l=q.get(i),h=p.state.lights;if(!0===N&&(!0===F||t!==w)){const e=t===w&&i.id===b;it.setState(i,t,e)}i.version===l.__version?i.fog&&l.fog!==r?Et(i,e,n):l.environment!==a?Et(i,e,n):l.needsLights&&l.lightsStateVersion!==h.state.version?Et(i,e,n):void 0===l.numClippingPlanes||l.numClippingPlanes===it.numPlanes&&l.numIntersection===it.numIntersection?l.outputEncoding!==s?Et(i,e,n):l.envMap!==o&&Et(i,e,n):Et(i,e,n):(Et(i,e,n),l.__version=i.version);let c=!1,u=!1,m=!1;const f=l.program,g=f.getUniforms(),v=l.uniforms;if(V.useProgram(f.program)&&(c=!0,u=!0,m=!0,W.render.programSwitch++),i.id!==b&&(b=i.id,u=!0),c||w!==t){if(g.setValue(ht,"projectionMatrix",t.projectionMatrix),H.logarithmicDepthBuffer&&g.setValue(ht,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),w!==t&&(w=t,u=!0,m=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=g.map.cameraPosition;void 0!==e&&e.setValue(ht,k.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&g.setValue(ht,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||i.skinning)&&g.setValue(ht,"viewMatrix",t.matrixWorldInverse)}if(i.skinning){g.setOptional(ht,n,"bindMatrix"),g.setOptional(ht,n,"bindMatrixInverse");const t=n.skeleton;if(t){const e=t.bones;if(H.floatVertexTextures){if(void 0===t.boneTexture){let i=Math.sqrt(4*e.length);i=Ke.ceilPowerOfTwo(i),i=Math.max(i,4);const n=new Float32Array(i*i*4);n.set(t.boneMatrices);const r=new zr(n,i,i,St,gt);t.boneMatrices=n,t.boneTexture=r,t.boneTextureSize=i}g.setValue(ht,"boneTexture",t.boneTexture,X),g.setValue(ht,"boneTextureSize",t.boneTextureSize)}else g.setOptional(ht,t,"boneMatrices")}}var x,_;return(u||l.receiveShadow!==n.receiveShadow)&&(l.receiveShadow=n.receiveShadow,g.setValue(ht,"receiveShadow",n.receiveShadow)),u&&(g.setValue(ht,"toneMappingExposure",d.toneMappingExposure),l.needsLights&&(_=m,(x=v).ambientLightColor.needsUpdate=_,x.lightProbe.needsUpdate=_,x.directionalLights.needsUpdate=_,x.directionalLightShadows.needsUpdate=_,x.pointLights.needsUpdate=_,x.pointLightShadows.needsUpdate=_,x.spotLights.needsUpdate=_,x.spotLightShadows.needsUpdate=_,x.rectAreaLights.needsUpdate=_,x.hemisphereLights.needsUpdate=_),r&&i.fog&&$.refreshFogUniforms(v,r),$.refreshMaterialUniforms(v,i,P,A),ns.upload(ht,l.uniformsList,v,X)),i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(ns.upload(ht,l.uniformsList,v,X),i.uniformsNeedUpdate=!1),i.isSpriteMaterial&&g.setValue(ht,"center",n.center),g.setValue(ht,"modelViewMatrix",n.modelViewMatrix),g.setValue(ht,"normalMatrix",n.normalMatrix),g.setValue(ht,"modelMatrix",n.matrixWorld),f}_t.setAnimationLoop(function(t){dt.isPresenting||wt&&wt(t)}),"undefined"!=typeof window&&_t.setContext(window),this.setAnimationLoop=function(t){wt=t,dt.setAnimationLoop(t),null===t?_t.stop():_t.start()},this.render=function(t,e){let i,n;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),i=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),n=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;lt.resetDefaultState(),b=-1,w=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===dt.enabled&&!0===dt.isPresenting&&(e=dt.getCamera(e)),!0===t.isScene&&t.onBeforeRender(d,t,e,i||y),(p=et.get(t,e)).init(),z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(z),F=this.localClippingEnabled,N=it.init(this.clippingPlanes,F,e),(u=tt.get(t,e)).init(),function t(e,i,n,r){if(!1===e.visible)return;const a=e.layers.test(i.layers);if(a)if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(i);else if(e.isLight)p.pushLight(e),e.castShadow&&p.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||D.intersectsSprite(e)){r&&k.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);const t=K.update(e),i=e.material;i.visible&&u.push(e,t,i,n,k.z,null)}}else if(e.isImmediateRenderObject)r&&k.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z),u.push(e,null,e.material,n,k.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==W.render.frame&&(e.skeleton.update(),e.skeleton.frame=W.render.frame),!e.frustumCulled||D.intersectsObject(e))){r&&k.setFromMatrixPosition(e.matrixWorld).applyMatrix4(z);const t=K.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let a=0,s=r.length;a<s;a++){const s=r[a],o=i[s.materialIndex];o&&o.visible&&u.push(e,t,o,n,k.z,s)}}else i.visible&&u.push(e,t,i,n,k.z,null)}const s=e.children;for(let e=0,a=s.length;e<a;e++)t(s[e],i,n,r)}(t,e,0,d.sortObjects),u.finish(),!0===d.sortObjects&&u.sort(L,O),!0===N&&it.beginShadows();const r=p.state.shadowsArray;mt.render(r,t,e),p.setupLights(e),!0===N&&it.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==i&&this.setRenderTarget(i),nt.render(u,t,e,n);const a=u.opaque,s=u.transparent;a.length>0&&Mt(a,t,e),s.length>0&&Mt(s,t,e),!0===t.isScene&&t.onAfterRender(d,t,e),null!==y&&(X.updateRenderTargetMipmap(y),X.updateMultisampleRenderTarget(y)),V.buffers.depth.setTest(!0),V.buffers.depth.setMask(!0),V.buffers.color.setMask(!0),V.setPolygonOffset(!1),u=null,p=null},this.setFramebuffer=function(t){f!==t&&null===y&&ht.bindFramebuffer(36160,t),f=t},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return v},this.getRenderList=function(){return u},this.setRenderList=function(t){u=t},this.getRenderState=function(){return p},this.setRenderState=function(t){p=t},this.getRenderTarget=function(){return y},this.setRenderTarget=function(t,e=0,i=0){y=t,g=e,v=i,t&&void 0===q.get(t).__webglFramebuffer&&X.setupRenderTarget(t);let n=f,r=!1;if(t){const i=q.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(n=i[e],r=!0):n=t.isWebGLMultisampleRenderTarget?q.get(t).__webglMultisampledFramebuffer:i,M.copy(t.viewport),S.copy(t.scissor),T=t.scissorTest}else M.copy(C).multiplyScalar(P).floor(),S.copy(R).multiplyScalar(P).floor(),T=I;if(x!==n&&(ht.bindFramebuffer(36160,n),x=n),V.viewport(M),V.scissor(S),V.setScissorTest(T),r){const n=q.get(t.texture);ht.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}},this.readRenderTargetPixels=function(t,e,i,n,r,a,s){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=q.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==s&&(o=o[s]),o){let s=!1;o!==x&&(ht.bindFramebuffer(36160,o),s=!0);try{const o=t.texture,l=o.format,h=o.type;if(l!==St&&ot.convert(l)!==ht.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(h===ct||ot.convert(h)===ht.getParameter(35738)||h===gt&&(H.isWebGL2||G.get("OES_texture_float")||G.get("WEBGL_color_buffer_float"))||h===vt&&(H.isWebGL2?G.get("EXT_color_buffer_float"):G.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ht.checkFramebufferStatus(36160)?e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&ht.readPixels(e,i,n,r,ot.convert(l),ot.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&ht.bindFramebuffer(36160,x)}}},this.copyFramebufferToTexture=function(t,e,i){void 0===i&&(i=0);const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),a=Math.floor(e.image.height*n),s=ot.convert(e.format);X.setTexture2D(e,0),ht.copyTexImage2D(3553,i,s,t.x,t.y,r,a,0),V.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n){void 0===n&&(n=0);const r=e.image.width,a=e.image.height,s=ot.convert(i.format),o=ot.convert(i.type);X.setTexture2D(i,0),ht.pixelStorei(37440,i.flipY),ht.pixelStorei(37441,i.premultiplyAlpha),ht.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?ht.texSubImage2D(3553,n,t.x,t.y,r,a,s,o,e.image.data):e.isCompressedTexture?ht.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,s,e.mipmaps[0].data):ht.texSubImage2D(3553,n,t.x,t.y,s,o,e.image),0===n&&i.generateMipmaps&&ht.generateMipmap(3553),V.unbindTexture()},this.initTexture=function(t){X.setTexture2D(t,0),V.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Js(t){Zs.call(this,t)}Vs.prototype=Object.assign(Object.create(Cr.prototype),{constructor:Vs,isArrayCamera:!0}),Ws.prototype=Object.assign(Object.create(ln.prototype),{constructor:Ws,isGroup:!0}),Object.assign(qs.prototype,{constructor:qs,getHandSpace:function(){if(null===this._hand&&(this._hand=new Ws,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputState={pinching:!1},window.XRHand))for(let t=0;t<=window.XRHand.LITTLE_PHALANX_TIP;t++){const t=new Ws;t.matrixAutoUpdate=!1,t.visible=!1,this._hand.joints.push(t),this._hand.add(t)}return this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Ws,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Ws,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,i){let n=null,r=null,a=null;const s=this._targetRay,o=this._grip,l=this._hand;if(t)if(l&&t.hand){a=!0;for(let n=0;n<=window.XRHand.LITTLE_PHALANX_TIP;n++)if(t.hand[n]){const r=e.getJointPose(t.hand[n],i),a=l.joints[n];null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.jointRadius=r.radius),a.visible=null!==r;const s=l.joints[window.XRHand.INDEX_PHALANX_TIP],o=l.joints[window.XRHand.THUMB_PHALANX_TIP],h=s.position.distanceTo(o.position),c=.02,u=.005;l.inputState.pinching&&h>c+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&h<=c-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==s&&null!==(n=e.getPose(t.targetRaySpace,i))&&(s.matrix.fromArray(n.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale)),null!==o&&t.gripSpace&&null!==(r=e.getPose(t.gripSpace,i))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale));return null!==s&&(s.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==a),this}}),Object.assign(Xs.prototype,Ye.prototype),Js.prototype=Object.assign(Object.create(Zs.prototype),{constructor:Js,isWebGL1Renderer:!0});class Ks{constructor(t,e){Object.defineProperty(this,"isFogExp2",{value:!0}),this.name="",this.color=new On(t),this.density=void 0!==e?e:25e-5}clone(){return new Ks(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Qs{constructor(t,e,i){Object.defineProperty(this,"isFog",{value:!0}),this.name="",this.color=new On(t),this.near=void 0!==e?e:1,this.far=void 0!==i?i:1e3}clone(){return new Qs(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class $s extends ln{constructor(){super(),Object.defineProperty(this,"isScene",{value:!0}),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.background&&(e.object.background=this.background.toJSON(t)),null!==this.environment&&(e.object.environment=this.environment.toJSON(t)),null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}function to(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=We,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ke.generateUUID()}Object.defineProperty(to.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(to.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyAt:function(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ke.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new to(new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),this.stride);return e.setUsage(this.usage),e},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Ke.generateUUID()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const eo=new li;function io(t,e,i,n){this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}function no(t){In.call(this),this.type="SpriteMaterial",this.color=new On(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let ro;Object.defineProperties(io.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(t){this.data.needsUpdate=t}}}),Object.assign(io.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let e=0,i=this.data.count;e<i;e++)eo.x=this.getX(e),eo.y=this.getY(e),eo.z=this.getZ(e),eo.applyMatrix4(t),this.setXYZ(e,eo.x,eo.y,eo.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this},setXYZ:function(t,e,i,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this},setXYZW:function(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this},clone:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new zn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new io(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),no.prototype=Object.create(In.prototype),no.prototype.constructor=no,no.prototype.isSpriteMaterial=!0,no.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this};const ao=new li,so=new li,oo=new li,lo=new Qe,ho=new Qe,co=new Fi,uo=new li,po=new li,mo=new li,fo=new Qe,go=new Qe,vo=new Qe;function yo(t){if(ln.call(this),this.type="Sprite",void 0===ro){ro=new ir;const t=new to(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);ro.setIndex([0,1,2,0,2,3]),ro.setAttribute("position",new io(t,3,0,!1)),ro.setAttribute("uv",new io(t,2,3,!1))}this.geometry=ro,this.material=void 0!==t?t:new no,this.center=new Qe(.5,.5)}function xo(t,e,i,n,r,a){lo.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(ho.x=a*lo.x-r*lo.y,ho.y=r*lo.x+a*lo.y):ho.copy(lo),t.copy(e),t.x+=ho.x,t.y+=ho.y,t.applyMatrix4(co)}yo.prototype=Object.assign(Object.create(ln.prototype),{constructor:yo,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),so.setFromMatrixScale(this.matrixWorld),co.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),oo.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&so.multiplyScalar(-oo.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const a=this.center;xo(uo.set(-.5,-.5,0),oo,a,so,n,r),xo(po.set(.5,-.5,0),oo,a,so,n,r),xo(mo.set(.5,.5,0),oo,a,so,n,r),fo.set(0,0),go.set(1,0),vo.set(1,1);let s=t.ray.intersectTriangle(uo,po,mo,!1,ao);if(null===s&&(xo(po.set(-.5,.5,0),oo,a,so,n,r),go.set(0,1),null===(s=t.ray.intersectTriangle(uo,mo,po,!1,ao))))return;const o=t.ray.origin.distanceTo(ao);o<t.near||o>t.far||e.push({distance:o,point:ao.clone(),uv:Mn.getUV(ao,uo,po,mo,fo,go,vo,new Qe),face:null,object:this})},copy:function(t){return ln.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});const bo=new li,wo=new li;function _o(){ln.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function Mo(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),br.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Fi,this.bindMatrixInverse=new Fi}_o.prototype=Object.assign(Object.create(ln.prototype),{constructor:_o,isLOD:!0,copy:function(t){ln.prototype.copy.call(this,t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this},addLevel:function(t,e){void 0===e&&(e=0),e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null},raycast:function(t,e){if(this.levels.length>0){bo.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(bo);this.getObjectForDistance(i).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){bo.setFromMatrixPosition(t.matrixWorld),wo.setFromMatrixPosition(this.matrixWorld);const i=bo.distanceTo(wo)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}},toJSON:function(t){const e=ln.prototype.toJSON.call(this,t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}),Mo.prototype=Object.assign(Object.create(br.prototype),{constructor:Mo,isSkinnedMesh:!0,copy:function(t){return br.prototype.copy.call(this,t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new ri,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){br.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const t=new li,e=new ri,i=new ri,n=new li,r=new Fi;return function(a,s){const o=this.skeleton,l=this.geometry;e.fromBufferAttribute(l.attributes.skinIndex,a),i.fromBufferAttribute(l.attributes.skinWeight,a),t.fromBufferAttribute(l.attributes.position,a).applyMatrix4(this.bindMatrix),s.set(0,0,0);for(let a=0;a<4;a++){const l=i.getComponent(a);if(0!==l){const i=e.getComponent(a);r.multiplyMatrices(o.bones[i].matrixWorld,o.boneInverses[i]),s.addScaledVector(n.copy(t).applyMatrix4(r),l)}}return s.applyMatrix4(this.bindMatrixInverse)}}()});const So=new Fi,To=new Fi;function Eo(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Fi)}}function Ao(){ln.call(this),this.type="Bone"}Object.assign(Eo.prototype,{calculateInverses:function(){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++){const e=new Fi;this.bones[t]&&e.getInverse(this.bones[t].matrixWorld),this.boneInverses.push(e)}},pose:function(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.getInverse(this.boneInverses[t])}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}},update:function(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:To;So.multiplyMatrices(r,e[n]),So.toArray(i,16*n)}void 0!==n&&(n.needsUpdate=!0)},clone:function(){return new Eo(this.bones,this.boneInverses)},getBoneByName:function(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),Ao.prototype=Object.assign(Object.create(ln.prototype),{constructor:Ao,isBone:!0});const Po=new Fi,Lo=new Fi,Oo=[],Co=new br;function Ro(t,e,i){br.call(this,t,e),this.instanceMatrix=new zn(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}function Io(t){In.call(this),this.type="LineBasicMaterial",this.color=new On(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}Ro.prototype=Object.assign(Object.create(br.prototype),{constructor:Ro,isInstancedMesh:!0,copy:function(t){return br.prototype.copy.call(this,t),this.instanceMatrix.copy(t.instanceMatrix),this.count=t.count,this},setColorAt:function(t,e){null===this.instanceColor&&(this.instanceColor=new zn(new Float32Array(3*this.count),3)),e.toArray(this.instanceColor.array,3*t)},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const i=this.matrixWorld,n=this.count;if(Co.geometry=this.geometry,Co.material=this.material,void 0!==Co.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Po),Lo.multiplyMatrices(i,Po),Co.matrixWorld=Lo,Co.raycast(t,Oo);for(let t=0,i=Oo.length;t<i;t++){const i=Oo[t];i.instanceId=r,i.object=this,e.push(i)}Oo.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),Io.prototype=Object.create(In.prototype),Io.prototype.constructor=Io,Io.prototype.isLineBasicMaterial=!0,Io.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphTargets=t.morphTargets,this};const Do=new li,No=new li,Fo=new Fi,zo=new Ni,ko=new Ai;function Bo(t,e,i){1===i&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),ln.call(this),this.type="Line",this.geometry=void 0!==t?t:new ir,this.material=void 0!==e?e:new Io,this.updateMorphTargets()}Bo.prototype=Object.assign(Object.create(ln.prototype),{constructor:Bo,isLine:!0,copy:function(t){return ln.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Do.fromBufferAttribute(e,t-1),No.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Do.distanceTo(No);t.setAttribute("lineDistance",new Wn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,i=t.lineDistances;i[0]=0;for(let t=1,n=e.length;t<n;t++)i[t]=i[t-1],i[t]+=e[t-1].distanceTo(e[t])}return this},raycast:function(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),ko.copy(i.boundingSphere),ko.applyMatrix4(n),ko.radius+=r,!1===t.ray.intersectsSphere(ko))return;Fo.getInverse(n),zo.copy(t.ray).applyMatrix4(Fo);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a,o=new li,l=new li,h=new li,c=new li,u=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,r=i.attributes.position;if(null!==n){const i=n.array;for(let n=0,a=i.length-1;n<a;n+=u){const a=i[n],u=i[n+1];if(o.fromBufferAttribute(r,a),l.fromBufferAttribute(r,u),zo.distanceSqToSegment(o,l,c,h)>s)continue;c.applyMatrix4(this.matrixWorld);const p=t.ray.origin.distanceTo(c);p<t.near||p>t.far||e.push({distance:p,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else for(let i=0,n=r.count-1;i<n;i+=u){if(o.fromBufferAttribute(r,i),l.fromBufferAttribute(r,i+1),zo.distanceSqToSegment(o,l,c,h)>s)continue;c.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(c);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(i.isGeometry){const n=i.vertices,r=n.length;for(let i=0;i<r-1;i+=u){if(zo.distanceSqToSegment(n[i],n[i+1],c,h)>s)continue;c.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(c);r<t.near||r>t.far||e.push({distance:r,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Uo=new li,Go=new li;function Ho(t,e){Bo.call(this,t,e),this.type="LineSegments"}function jo(t,e){Bo.call(this,t,e),this.type="LineLoop"}function Vo(t){In.call(this),this.type="PointsMaterial",this.color=new On(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Ho.prototype=Object.assign(Object.create(Bo.prototype),{constructor:Ho,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)Uo.fromBufferAttribute(e,t),Go.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Uo.distanceTo(Go);t.setAttribute("lineDistance",new Wn(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,i=t.lineDistances;for(let t=0,n=e.length;t<n;t+=2)Uo.copy(e[t]),Go.copy(e[t+1]),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Uo.distanceTo(Go)}return this}}),jo.prototype=Object.assign(Object.create(Bo.prototype),{constructor:jo,isLineLoop:!0}),Vo.prototype=Object.create(In.prototype),Vo.prototype.constructor=Vo,Vo.prototype.isPointsMaterial=!0,Vo.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.morphTargets=t.morphTargets,this};const Wo=new Fi,qo=new Ni,Xo=new Ai,Yo=new li;function Zo(t,e){ln.call(this),this.type="Points",this.geometry=void 0!==t?t:new ir,this.material=void 0!==e?e:new Vo,this.updateMorphTargets()}function Jo(t,e,i,n,r,a,s){const o=qo.distanceSqToPoint(t);if(o<i){const i=new li;qo.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;a.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:s})}}function Ko(t,e,i,n,r,a,s,o,l){ni.call(this,t,e,i,n,r,a,s,o,l),this.format=void 0!==s?s:Mt,this.minFilter=void 0!==a?a:ot,this.magFilter=void 0!==r?r:ot,this.generateMipmaps=!1;const h=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(function e(){h.needsUpdate=!0,t.requestVideoFrameCallback(e)})}function Qo(t,e,i,n,r,a,s,o,l,h,c,u){ni.call(this,null,a,s,o,l,h,n,r,c,u),this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function $o(t,e,i,n,r,a,s,o,l){ni.call(this,t,e,i,n,r,a,s,o,l),this.needsUpdate=!0}function tl(t,e,i,n,r,a,s,o,l,h){if((h=void 0!==h?h:Pt)!==Pt&&h!==Lt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===Pt&&(i=dt),void 0===i&&h===Lt&&(i=wt),ni.call(this,null,n,r,a,s,o,h,i,l),this.image={width:t,height:e},this.magFilter=void 0!==s?s:rt,this.minFilter=void 0!==o?o:rt,this.flipY=!1,this.generateMipmaps=!1}Zo.prototype=Object.assign(Object.create(ln.prototype),{constructor:Zo,isPoints:!0,copy:function(t){return ln.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),Xo.copy(i.boundingSphere),Xo.applyMatrix4(n),Xo.radius+=r,!1===t.ray.intersectsSphere(Xo))return;Wo.getInverse(n),qo.copy(t.ray).applyMatrix4(Wo);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),s=a*a;if(i.isBufferGeometry){const r=i.index,a=i.attributes.position;if(null!==r){const i=r.array;for(let r=0,o=i.length;r<o;r++){const o=i[r];Yo.fromBufferAttribute(a,o),Jo(Yo,o,s,n,t,e,this)}}else for(let i=0,r=a.count;i<r;i++)Yo.fromBufferAttribute(a,i),Jo(Yo,i,s,n,t,e,this)}else{const r=i.vertices;for(let i=0,a=r.length;i<a;i++)Jo(r[i],i,s,n,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,i=Object.keys(e);if(i.length>0){const t=e[i[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,i=t.length;e<i;e++){const i=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),Ko.prototype=Object.assign(Object.create(ni.prototype),{constructor:Ko,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),Qo.prototype=Object.create(ni.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isCompressedTexture=!0,$o.prototype=Object.create(ni.prototype),$o.prototype.constructor=$o,$o.prototype.isCanvasTexture=!0,tl.prototype=Object.create(ni.prototype),tl.prototype.constructor=tl,tl.prototype.isDepthTexture=!0;let el=0;const il=new Fi,nl=new ln,rl=new li;function al(){Object.defineProperty(this,"id",{value:el+=2}),this.uuid=Ke.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}al.prototype=Object.assign(Object.create(Ye.prototype),{constructor:al,isGeometry:!0,applyMatrix4:function(t){const e=(new $e).getNormalMatrix(t);for(let e=0,i=this.vertices.length;e<i;e++){this.vertices[e].applyMatrix4(t)}for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t];i.normal.applyMatrix3(e).normalize();for(let t=0,n=i.vertexNormals.length;t<n;t++)i.vertexNormals[t].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return il.makeRotationX(t),this.applyMatrix4(il),this},rotateY:function(t){return il.makeRotationY(t),this.applyMatrix4(il),this},rotateZ:function(t){return il.makeRotationZ(t),this.applyMatrix4(il),this},translate:function(t,e,i){return il.makeTranslation(t,e,i),this.applyMatrix4(il),this},scale:function(t,e,i){return il.makeScale(t,e,i),this.applyMatrix4(il),this},lookAt:function(t){return nl.lookAt(t),nl.updateMatrix(),this.applyMatrix4(nl.matrix),this},fromBufferGeometry:function(t){const e=this,i=null!==t.index?t.index:void 0,n=t.attributes;if(void 0===n.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const r=n.position,a=n.normal,s=n.color,o=n.uv,l=n.uv2;void 0!==l&&(this.faceVertexUvs[1]=[]);for(let t=0;t<r.count;t++)e.vertices.push((new li).fromBufferAttribute(r,t)),void 0!==s&&e.colors.push((new On).fromBufferAttribute(s,t));function h(t,i,n,r){const h=void 0===s?[]:[e.colors[t].clone(),e.colors[i].clone(),e.colors[n].clone()],c=void 0===a?[]:[(new li).fromBufferAttribute(a,t),(new li).fromBufferAttribute(a,i),(new li).fromBufferAttribute(a,n)],u=new Cn(t,i,n,c,h,r);e.faces.push(u),void 0!==o&&e.faceVertexUvs[0].push([(new Qe).fromBufferAttribute(o,t),(new Qe).fromBufferAttribute(o,i),(new Qe).fromBufferAttribute(o,n)]),void 0!==l&&e.faceVertexUvs[1].push([(new Qe).fromBufferAttribute(l,t),(new Qe).fromBufferAttribute(l,i),(new Qe).fromBufferAttribute(l,n)])}const c=t.groups;if(c.length>0)for(let t=0;t<c.length;t++){const e=c[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)void 0!==i?h(i.getX(t),i.getX(t+1),i.getX(t+2),e.materialIndex):h(t,t+1,t+2,e.materialIndex)}else if(void 0!==i)for(let t=0;t<i.count;t+=3)h(i.getX(t),i.getX(t+1),i.getX(t+2));else for(let t=0;t<r.count;t+=3)h(t,t+1,t+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(rl).negate(),this.translate(rl.x,rl.y,rl.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,i=0===e?1:1/e,n=new Fi;return n.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){const t=new li,e=new li;for(let i=0,n=this.faces.length;i<n;i++){const n=this.faces[i],r=this.vertices[n.a],a=this.vertices[n.b],s=this.vertices[n.c];t.subVectors(s,a),e.subVectors(r,a),t.cross(e),t.normalize(),n.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);const e=new Array(this.vertices.length);for(let t=0,i=this.vertices.length;t<i;t++)e[t]=new li;if(t){const t=new li,i=new li;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],a=this.vertices[r.a],s=this.vertices[r.b],o=this.vertices[r.c];t.subVectors(o,s),i.subVectors(a,s),t.cross(i),e[r.a].add(t),e[r.b].add(t),e[r.c].add(t)}}else{this.computeFaceNormals();for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t];e[i.a].add(i.normal),e[i.b].add(i.normal),e[i.c].add(i.normal)}}for(let t=0,i=this.vertices.length;t<i;t++)e[t].normalize();for(let t=0,i=this.faces.length;t<i;t++){const i=this.faces[t],n=i.vertexNormals;3===n.length?(n[0].copy(e[i.a]),n[1].copy(e[i.b]),n[2].copy(e[i.c])):(n[0]=e[i.a].clone(),n[1]=e[i.b].clone(),n[2]=e[i.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],i=e.vertexNormals;3===i.length?(i[0].copy(e.normal),i[1].copy(e.normal),i[2].copy(e.normal)):(i[0]=e.normal.clone(),i[1]=e.normal.clone(),i[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let t=0,i=e.vertexNormals.length;t<i;t++)e.__originalVertexNormals[t]?e.__originalVertexNormals[t].copy(e.vertexNormals[t]):e.__originalVertexNormals[t]=e.vertexNormals[t].clone()}const t=new al;t.faces=this.faces;for(let e=0,i=this.morphTargets.length;e<i;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];const t=this.morphNormals[e].faceNormals,i=this.morphNormals[e].vertexNormals;for(let e=0,n=this.faces.length;e<n;e++){const e=new li,n={a:new li,b:new li,c:new li};t.push(e),i.push(n)}}const i=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=i.faceNormals[t],r=i.vertexNormals[t];n.copy(e.normal),r.a.copy(e.vertexNormals[0]),r.b.copy(e.vertexNormals[1]),r.c.copy(e.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new ui),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ai),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,i){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let n;const r=this.vertices.length,a=this.vertices,s=t.vertices,o=this.faces,l=t.faces,h=this.colors,c=t.colors;void 0===i&&(i=0),void 0!==e&&(n=(new $e).getNormalMatrix(e));for(let t=0,i=s.length;t<i;t++){const i=s[t].clone();void 0!==e&&i.applyMatrix4(e),a.push(i)}for(let t=0,e=c.length;t<e;t++)h.push(c[t].clone());for(let t=0,e=l.length;t<e;t++){const e=l[t];let a,s;const h=e.vertexNormals,c=e.vertexColors,u=new Cn(e.a+r,e.b+r,e.c+r);u.normal.copy(e.normal),void 0!==n&&u.normal.applyMatrix3(n).normalize();for(let t=0,e=h.length;t<e;t++)a=h[t].clone(),void 0!==n&&a.applyMatrix3(n).normalize(),u.vertexNormals.push(a);u.color.copy(e.color);for(let t=0,e=c.length;t<e;t++)s=c[t],u.vertexColors.push(s.clone());u.materialIndex=e.materialIndex+i,o.push(u)}for(let e=0,i=t.faceVertexUvs.length;e<i;e++){const i=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,n=i.length;t<n;t++){const n=i[t],r=[];for(let t=0,e=n.length;t<e;t++)r.push(n[t].clone());this.faceVertexUvs[e].push(r)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){const t={},e=[],i=[],n=Math.pow(10,4);for(let r=0,a=this.vertices.length;r<a;r++){const a=this.vertices[r],s=Math.round(a.x*n)+"_"+Math.round(a.y*n)+"_"+Math.round(a.z*n);void 0===t[s]?(t[s]=r,e.push(this.vertices[r]),i[r]=e.length-1):i[r]=i[t[s]]}const r=[];for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.a=i[e.a],e.b=i[e.b],e.c=i[e.c];const n=[e.a,e.b,e.c];for(let e=0;e<3;e++)if(n[e]===n[(e+1)%3]){r.push(t);break}}for(let t=r.length-1;t>=0;t--){const e=r[t];this.faces.splice(e,1);for(let t=0,i=this.faceVertexUvs.length;t<i;t++)this.faceVertexUvs[t].splice(e,1)}const a=this.vertices.length-e.length;return this.vertices=e,a},setFromPoints:function(t){this.vertices=[];for(let e=0,i=t.length;e<i;e++){const i=t[e];this.vertices.push(new li(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let i=0;i<e;i++)t[i]._id=i;t.sort(function(t,e){return t.materialIndex-e.materialIndex});const i=this.faceVertexUvs[0],n=this.faceVertexUvs[1];let r,a;i&&i.length===e&&(r=[]),n&&n.length===e&&(a=[]);for(let s=0;s<e;s++){const e=t[s]._id;r&&r.push(i[e]),a&&a.push(n[e])}r&&(this.faceVertexUvs[0]=r),a&&(this.faceVertexUvs[1]=a)},toJSON:function(){const t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}const e=[];for(let t=0;t<this.vertices.length;t++){const i=this.vertices[t];e.push(i.x,i.y,i.z)}const i=[],n=[],r={},a=[],s={},o=[],l={};for(let t=0;t<this.faces.length;t++){const e=this.faces[t],n=!0,r=!1,a=void 0!==this.faceVertexUvs[0][t],s=e.normal.length()>0,o=e.vertexNormals.length>0,l=1!==e.color.r||1!==e.color.g||1!==e.color.b,d=e.vertexColors.length>0;let m=0;if(m=h(m,0,0),m=h(m,1,n),m=h(m,2,r),m=h(m,3,a),m=h(m,4,s),m=h(m,5,o),m=h(m,6,l),m=h(m,7,d),i.push(m),i.push(e.a,e.b,e.c),i.push(e.materialIndex),a){const e=this.faceVertexUvs[0][t];i.push(p(e[0]),p(e[1]),p(e[2]))}if(s&&i.push(c(e.normal)),o){const t=e.vertexNormals;i.push(c(t[0]),c(t[1]),c(t[2]))}if(l&&i.push(u(e.color)),d){const t=e.vertexColors;i.push(u(t[0]),u(t[1]),u(t[2]))}}function h(t,e,i){return i?t|1<<e:t&~(1<<e)}function c(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]?r[e]:(r[e]=n.length/3,n.push(t.x,t.y,t.z),r[e])}function u(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==s[e]?s[e]:(s[e]=a.length,a.push(t.getHex()),s[e])}function p(t){const e=t.x.toString()+t.y.toString();return void 0!==l[e]?l[e]:(l[e]=o.length/2,o.push(t.x,t.y),l[e])}return t.data={},t.data.vertices=e,t.data.normals=n,a.length>0&&(t.data.colors=a),o.length>0&&(t.data.uvs=[o]),t.data.faces=i,t},clone:function(){return(new al).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;const e=t.vertices;for(let t=0,i=e.length;t<i;t++)this.vertices.push(e[t].clone());const i=t.colors;for(let t=0,e=i.length;t<e;t++)this.colors.push(i[t].clone());const n=t.faces;for(let t=0,e=n.length;t<e;t++)this.faces.push(n[t].clone());for(let e=0,i=t.faceVertexUvs.length;e<i;e++){const i=t.faceVertexUvs[e];void 0===this.faceVertexUvs[e]&&(this.faceVertexUvs[e]=[]);for(let t=0,n=i.length;t<n;t++){const n=i[t],r=[];for(let t=0,e=n.length;t<e;t++){const e=n[t];r.push(e.clone())}this.faceVertexUvs[e].push(r)}}const r=t.morphTargets;for(let t=0,e=r.length;t<e;t++){const e={};if(e.name=r[t].name,void 0!==r[t].vertices){e.vertices=[];for(let i=0,n=r[t].vertices.length;i<n;i++)e.vertices.push(r[t].vertices[i].clone())}if(void 0!==r[t].normals){e.normals=[];for(let i=0,n=r[t].normals.length;i<n;i++)e.normals.push(r[t].normals[i].clone())}this.morphTargets.push(e)}const a=t.morphNormals;for(let t=0,e=a.length;t<e;t++){const e={};if(void 0!==a[t].vertexNormals){e.vertexNormals=[];for(let i=0,n=a[t].vertexNormals.length;i<n;i++){const n=a[t].vertexNormals[i],r={};r.a=n.a.clone(),r.b=n.b.clone(),r.c=n.c.clone(),e.vertexNormals.push(r)}}if(void 0!==a[t].faceNormals){e.faceNormals=[];for(let i=0,n=a[t].faceNormals.length;i<n;i++)e.faceNormals.push(a[t].faceNormals[i].clone())}this.morphNormals.push(e)}const s=t.skinWeights;for(let t=0,e=s.length;t<e;t++)this.skinWeights.push(s[t].clone());const o=t.skinIndices;for(let t=0,e=o.length;t<e;t++)this.skinIndices.push(o[t].clone());const l=t.lineDistances;for(let t=0,e=l.length;t<e;t++)this.lineDistances.push(l[t]);const h=t.boundingBox;null!==h&&(this.boundingBox=h.clone());const c=t.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class sl extends al{constructor(t,e,i,n,r,a){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:a},this.fromBufferGeometry(new Mr(t,e,i,n,r,a)),this.mergeVertices()}}class ol extends ir{constructor(t,e,i,n){super(),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},t=t||1,e=void 0!==e?Math.max(3,e):8,i=void 0!==i?i:0,n=void 0!==n?n:2*Math.PI;const r=[],a=[],s=[],o=[],l=new li,h=new Qe;a.push(0,0,0),s.push(0,0,1),o.push(.5,.5);for(let r=0,c=3;r<=e;r++,c+=3){const u=i+r/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),a.push(l.x,l.y,l.z),s.push(0,0,1),h.x=(a[c]/t+1)/2,h.y=(a[c+1]/t+1)/2,o.push(h.x,h.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Wn(a,3)),this.setAttribute("normal",new Wn(s,3)),this.setAttribute("uv",new Wn(o,2))}}class ll extends al{constructor(t,e,i,n){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},this.fromBufferGeometry(new ol(t,e,i,n)),this.mergeVertices()}}class hl extends ir{constructor(t,e,i,n,r,a,s,o){super(),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o};const l=this;t=void 0!==t?t:1,e=void 0!==e?e:1,i=i||1,n=Math.floor(n)||8,r=Math.floor(r)||1,a=void 0!==a&&a,s=void 0!==s?s:0,o=void 0!==o?o:2*Math.PI;const h=[],c=[],u=[],p=[];let d=0;const m=[],f=i/2;let g=0;function v(i){const r=d,a=new Qe,m=new li;let v=0;const y=!0===i?t:e,x=!0===i?1:-1;for(let t=1;t<=n;t++)c.push(0,f*x,0),u.push(0,x,0),p.push(.5,.5),d++;const b=d;for(let t=0;t<=n;t++){const e=t/n*o+s,i=Math.cos(e),r=Math.sin(e);m.x=y*r,m.y=f*x,m.z=y*i,c.push(m.x,m.y,m.z),u.push(0,x,0),a.x=.5*i+.5,a.y=.5*r*x+.5,p.push(a.x,a.y),d++}for(let t=0;t<n;t++){const e=r+t,n=b+t;!0===i?h.push(n,n+1,e):h.push(n+1,n,e),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const a=new li,v=new li;let y=0;const x=(e-t)/i;for(let l=0;l<=r;l++){const h=[],g=l/r,y=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*o+s,l=Math.sin(r),m=Math.cos(r);v.x=y*l,v.y=-g*i+f,v.z=y*m,c.push(v.x,v.y,v.z),a.set(l,x,m).normalize(),u.push(a.x,a.y,a.z),p.push(e,1-g),h.push(d++)}m.push(h)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=m[e][t],n=m[e+1][t],r=m[e+1][t+1],a=m[e][t+1];h.push(i,n,a),h.push(n,r,a),y+=6}l.addGroup(g,y,0),g+=y}(),!1===a&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(h),this.setAttribute("position",new Wn(c,3)),this.setAttribute("normal",new Wn(u,3)),this.setAttribute("uv",new Wn(p,2))}}class cl extends al{constructor(t,e,i,n,r,a,s,o){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:a,thetaStart:s,thetaLength:o},this.fromBufferGeometry(new hl(t,e,i,n,r,a,s,o)),this.mergeVertices()}}class ul extends cl{constructor(t,e,i,n,r,a,s){super(0,t,e,i,n,r,a,s),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}}class pl extends hl{constructor(t,e,i,n,r,a,s){super(0,t,e,i,n,r,a,s),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:s}}}class dl extends ir{constructor(t,e,i,n){super(),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},i=i||1;const r=[],a=[];function s(t,e,i,n){const r=n+1,a=[];for(let n=0;n<=r;n++){a[n]=[];const s=t.clone().lerp(i,n/r),o=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)a[n][t]=0===t&&n===r?s:s.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(a[t][i+1]),o(a[t+1][i]),o(a[t][i])):(o(a[t][i+1]),o(a[t+1][i+1]),o(a[t+1][i]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function h(t,e,i,n){n<0&&1===t.x&&(a[e]=t.x-1),0===i.x&&0===i.z&&(a[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new li,n=new li,r=new li;for(let a=0;a<e.length;a+=3)l(e[a+0],i),l(e[a+1],n),l(e[a+2],r),s(i,n,r,t)}(n=n||0),function(t){const e=new li;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new li;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=c(t)/2/Math.PI+.5,s=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);a.push(n,1-s)}var e;(function(){const t=new li,e=new li,i=new li,n=new li,s=new Qe,o=new Qe,l=new Qe;for(let u=0,p=0;u<r.length;u+=9,p+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),s.set(a[p+0],a[p+1]),o.set(a[p+2],a[p+3]),l.set(a[p+4],a[p+5]),n.copy(t).add(e).add(i).divideScalar(3);const d=c(n);h(s,p+0,t,d),h(o,p+2,e,d),h(l,p+4,i,d)}})(),function(){for(let t=0;t<a.length;t+=6){const e=a[t+0],i=a[t+2],n=a[t+4],r=Math.max(e,i,n),s=Math.min(e,i,n);r>.9&&s<.1&&(e<.2&&(a[t+0]+=1),i<.2&&(a[t+2]+=1),n<.2&&(a[t+4]+=1))}}()}(),this.setAttribute("position",new Wn(r,3)),this.setAttribute("normal",new Wn(r.slice(),3)),this.setAttribute("uv",new Wn(a,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}}class ml extends dl{constructor(t,e){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class fl extends al{constructor(t,e){super(),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ml(t,e)),this.mergeVertices()}}const gl=new li,vl=new li,yl=new li,xl=new Mn;class bl extends ir{constructor(t,e){super(),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1,t.isGeometry&&(t=(new ir).fromGeometry(t));const i=Math.pow(10,4),n=Math.cos(Ke.DEG2RAD*e),r=t.getIndex(),a=t.getAttribute("position"),s=r?r.count:a.count,o=[0,0,0],l=["a","b","c"],h=new Array(3),c={},u=[];for(let t=0;t<s;t+=3){r?(o[0]=r.getX(t),o[1]=r.getX(t+1),o[2]=r.getX(t+2)):(o[0]=t,o[1]=t+1,o[2]=t+2);const{a:e,b:s,c:p}=xl;if(e.fromBufferAttribute(a,o[0]),s.fromBufferAttribute(a,o[1]),p.fromBufferAttribute(a,o[2]),xl.getNormal(yl),h[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,h[1]=`${Math.round(s.x*i)},${Math.round(s.y*i)},${Math.round(s.z*i)}`,h[2]=`${Math.round(p.x*i)},${Math.round(p.y*i)},${Math.round(p.z*i)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],r=h[e],a=xl[l[t]],s=xl[l[e]],p=`${i}_${r}`,d=`${r}_${i}`;d in c&&c[d]?(yl.dot(c[d].normal)<=n&&(u.push(a.x,a.y,a.z),u.push(s.x,s.y,s.z)),c[d]=null):p in c||(c[p]={index0:o[t],index1:o[e],normal:yl.clone()})}}for(const t in c)if(c[t]){const{index0:e,index1:i}=c[t];gl.fromBufferAttribute(a,e),vl.fromBufferAttribute(a,i),u.push(gl.x,gl.y,gl.z),u.push(vl.x,vl.y,vl.z)}this.setAttribute("position",new Wn(u,3))}}const wl=function(t,e,i){i=i||2;const n=e&&e.length,r=n?e[0]*i:t.length;let a=_l(t,0,r,i,!0);const s=[];if(!a||a.next===a.prev)return s;let o,l,h,c,u,p,d;if(n&&(a=function(t,e,i,n){const r=[];let a,s,o,l,h;for(a=0,s=e.length;a<s;a++)o=e[a]*n,l=a<s-1?e[a+1]*n:t.length,(h=_l(t,o,l,n,!1))===h.next&&(h.steiner=!0),r.push(Il(h));for(r.sort(Ll),a=0;a<r.length;a++)Ol(r[a],i),i=Ml(i,i.next);return i}(t,e,a,i)),t.length>80*i){o=h=t[0],l=c=t[1];for(let e=i;e<r;e+=i)(u=t[e])<o&&(o=u),(p=t[e+1])<l&&(l=p),u>h&&(h=u),p>c&&(c=p);d=0!==(d=Math.max(h-o,c-l))?1/d:0}return Sl(a,s,i,o,l,d),s};function _l(t,e,i,n,r){let a,s;if(r===function(t,e,i,n){let r=0;for(let a=e,s=i-n;a<i;a+=n)r+=(t[s]-t[a])*(t[a+1]+t[s+1]),s=a;return r}(t,e,i,n)>0)for(a=e;a<i;a+=n)s=jl(a,t[a],t[a+1],s);else for(a=i-n;a>=e;a-=n)s=jl(a,t[a],t[a+1],s);return s&&zl(s,s.next)&&(Vl(s),s=s.next),s}function Ml(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!zl(n,n.next)&&0!==Fl(n.prev,n,n.next))n=n.next;else{if(Vl(n),(n=e=n.prev)===n.next)break;i=!0}}while(i||n!==e);return e}function Sl(t,e,i,n,r,a,s){if(!t)return;!s&&a&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=Rl(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,a,s,o,l,h=1;do{for(i=t,t=null,a=null,s=0;i;){for(s++,n=i,o=0,e=0;e<h&&(o++,n=n.nextZ);e++);for(l=h;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,h*=2}while(s>1)}(r)}(t,n,r,a);let o,l,h=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,a?El(t,n,r,a):Tl(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),Vl(t),t=l.next,h=l.next;else if((t=l)===h){s?1===s?Sl(t=Al(Ml(t),e,i),e,i,n,r,a,2):2===s&&Pl(t,e,i,n,r,a):Sl(Ml(t),e,i,n,r,a,1);break}}function Tl(t){const e=t.prev,i=t,n=t.next;if(Fl(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Dl(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&Fl(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function El(t,e,i,n){const r=t.prev,a=t,s=t.next;if(Fl(r,a,s)>=0)return!1;const o=r.x<a.x?r.x<s.x?r.x:s.x:a.x<s.x?a.x:s.x,l=r.y<a.y?r.y<s.y?r.y:s.y:a.y<s.y?a.y:s.y,h=r.x>a.x?r.x>s.x?r.x:s.x:a.x>s.x?a.x:s.x,c=r.y>a.y?r.y>s.y?r.y:s.y:a.y>s.y?a.y:s.y,u=Rl(o,l,e,i,n),p=Rl(h,c,e,i,n);let d=t.prevZ,m=t.nextZ;for(;d&&d.z>=u&&m&&m.z<=p;){if(d!==t.prev&&d!==t.next&&Dl(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Fl(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==t.prev&&m!==t.next&&Dl(r.x,r.y,a.x,a.y,s.x,s.y,m.x,m.y)&&Fl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&Dl(r.x,r.y,a.x,a.y,s.x,s.y,d.x,d.y)&&Fl(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=p;){if(m!==t.prev&&m!==t.next&&Dl(r.x,r.y,a.x,a.y,s.x,s.y,m.x,m.y)&&Fl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Al(t,e,i){let n=t;do{const r=n.prev,a=n.next.next;!zl(r,a)&&kl(r,n,n.next,a)&&Gl(r,a)&&Gl(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),Vl(n),Vl(n.next),n=t=a),n=n.next}while(n!==t);return Ml(n)}function Pl(t,e,i,n,r,a){let s=t;do{let t=s.next.next;for(;t!==s.prev;){if(s.i!==t.i&&Nl(s,t)){let o=Hl(s,t);return s=Ml(s,s.next),o=Ml(o,o.next),Sl(s,e,i,n,r,a),void Sl(o,e,i,n,r,a)}t=t.next}s=s.next}while(s!==t)}function Ll(t,e){return t.x-e.x}function Ol(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let a,s=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>s){if(s=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(n===s)return a;const o=a,l=a.x,h=a.y;let c,u=1/0;i=a;do{n>=i.x&&i.x>=l&&n!==i.x&&Dl(r<h?n:s,r,l,h,r<h?s:n,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(n-i.x),Gl(i,t)&&(c<u||c===u&&(i.x>a.x||i.x===a.x&&Cl(a,i)))&&(a=i,u=c)),i=i.next}while(i!==o);return a}(t,e)){const i=Hl(e,t);Ml(e,e.next),Ml(i,i.next)}}function Cl(t,e){return Fl(t.prev,t,e.prev)<0&&Fl(e.next,t,t.next)<0}function Rl(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Il(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Dl(t,e,i,n,r,a,s,o){return(r-s)*(e-o)-(t-s)*(a-o)>=0&&(t-s)*(n-o)-(i-s)*(e-o)>=0&&(i-s)*(a-o)-(r-s)*(n-o)>=0}function Nl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&kl(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Gl(t,e)&&Gl(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Fl(t.prev,t,e.prev)||Fl(t,e.prev,e))||zl(t,e)&&Fl(t.prev,t,t.next)>0&&Fl(e.prev,e,e.next)>0)}function Fl(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function zl(t,e){return t.x===e.x&&t.y===e.y}function kl(t,e,i,n){const r=Ul(Fl(t,e,i)),a=Ul(Fl(t,e,n)),s=Ul(Fl(i,n,t)),o=Ul(Fl(i,n,e));return r!==a&&s!==o||(!(0!==r||!Bl(t,i,e))||(!(0!==a||!Bl(t,n,e))||(!(0!==s||!Bl(i,t,n))||!(0!==o||!Bl(i,e,n)))))}function Bl(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Ul(t){return t>0?1:t<0?-1:0}function Gl(t,e){return Fl(t.prev,t,t.next)<0?Fl(t,e,t.next)>=0&&Fl(t,t.prev,e)>=0:Fl(t,e,t.prev)<0||Fl(t,t.next,e)<0}function Hl(t,e){const i=new Wl(t.i,t.x,t.y),n=new Wl(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function jl(t,e,i,n){const r=new Wl(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function Vl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Wl(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const ql={area:function(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i},isClockWise:function(t){return ql.area(t)<0},triangulateShape:function(t,e){const i=[],n=[],r=[];Xl(t),Yl(i,t);let a=t.length;e.forEach(Xl);for(let t=0;t<e.length;t++)n.push(a),a+=e[t].length,Yl(i,e[t]);const s=wl(i,n);for(let t=0;t<s.length;t+=3)r.push(s.slice(t,t+3));return r}};function Xl(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Yl(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class Zl extends ir{constructor(t,e){super(),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){a(t[e])}function a(t){const a=[],s=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1;let l=void 0!==e.depth?e.depth:100,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:c-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3;const m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:Jl;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);let g,v,y,x,b,w=!1;m&&(g=m.getSpacedPoints(o),w=!0,h=!1,v=m.computeFrenetFrames(o,!1),y=new li,x=new li,b=new li),h||(d=0,c=0,u=0,p=0);const _=t.extractPoints(s);let M=_.shape;const S=_.holes;if(!ql.isClockWise(M)){M=M.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];ql.isClockWise(e)&&(S[t]=e.reverse())}}const T=ql.triangulateShape(M,S),E=M;for(let t=0,e=S.length;t<e;t++){const e=S[t];M=M.concat(e)}function A(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const P=M.length,L=T.length;function O(t,e,i){let n,r,a;const s=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=s*s+o*o,u=s*h-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(c),p=Math.sqrt(l*l+h*h),d=e.x-o/u,m=e.y+s/u,f=((i.x-h/p-d)*h-(i.y+l/p-m)*l)/(s*h-o*l),g=(n=d+s*f-t.x)*n+(r=m+o*f-t.y)*r;if(g<=2)return new Qe(n,r);a=Math.sqrt(g/2)}else{let t=!1;s>Number.EPSILON?l>Number.EPSILON&&(t=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(h)&&(t=!0),t?(n=-o,r=s,a=Math.sqrt(c)):(n=s,r=o,a=Math.sqrt(c/2))}return new Qe(n/a,r/a)}const C=[];for(let t=0,e=E.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),C[t]=O(E[t],E[i],E[n]);const R=[];let I,D=C.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];I=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),I[t]=O(e[t],e[n],e[r]);R.push(I),D=D.concat(I)}for(let t=0;t<d;t++){const e=t/d,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],C[t],n);z(e.x,e.y,-i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];I=R[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],I[t],n);z(r.x,r.y,-i)}}}const N=u+p;for(let t=0;t<P;t++){const e=h?A(M[t],D[t],N):M[t];w?(x.copy(v.normals[0]).multiplyScalar(e.x),y.copy(v.binormals[0]).multiplyScalar(e.y),b.copy(g[0]).add(x).add(y),z(b.x,b.y,b.z)):z(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<P;e++){const i=h?A(M[e],D[e],N):M[e];w?(x.copy(v.normals[t]).multiplyScalar(i.x),y.copy(v.binormals[t]).multiplyScalar(i.y),b.copy(g[t]).add(x).add(y),z(b.x,b.y,b.z)):z(i.x,i.y,l/o*t)}for(let t=d-1;t>=0;t--){const e=t/d,i=c*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+p;for(let t=0,e=E.length;t<e;t++){const e=A(E[t],C[t],n);z(e.x,e.y,l+i)}for(let t=0,e=S.length;t<e;t++){const e=S[t];I=R[t];for(let t=0,r=e.length;t<r;t++){const r=A(e[t],I[t],n);w?z(r.x,r.y+g[o-1].y,g[o-1].x+i):z(r.x,r.y,l+i)}}}function F(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*d;t<i;t++){const i=P*t,a=P*(t+1);B(e+n+i,e+r+i,e+r+a,e+n+a)}}}function z(t,e,i){a.push(t),a.push(e),a.push(i)}function k(t,e,r){U(t),U(e),U(r);const a=n.length/3,s=f.generateTopUV(i,n,a-3,a-2,a-1);G(s[0]),G(s[1]),G(s[2])}function B(t,e,r,a){U(t),U(e),U(a),U(e),U(r),U(a);const s=n.length/3,o=f.generateSideWallUV(i,n,s-6,s-3,s-2,s-1);G(o[0]),G(o[1]),G(o[3]),G(o[1]),G(o[2]),G(o[3])}function U(t){n.push(a[3*t+0]),n.push(a[3*t+1]),n.push(a[3*t+2])}function G(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(h){let t=0,e=P*t;for(let t=0;t<L;t++){const i=T[t];k(i[2]+e,i[1]+e,i[0]+e)}e=P*(t=o+2*d);for(let t=0;t<L;t++){const i=T[t];k(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<L;t++){const e=T[t];k(e[2],e[1],e[0])}for(let t=0;t<L;t++){const e=T[t];k(e[0]+P*o,e[1]+P*o,e[2]+P*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;F(E,e),e+=E.length;for(let t=0,i=S.length;t<i;t++){const i=S[t];F(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Wn(n,3)),this.setAttribute("uv",new Wn(r,2)),this.computeVertexNormals()}toJSON(){const t=ir.prototype.toJSON.call(this);return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}}const Jl={generateTopUV:function(t,e,i,n,r){const a=e[3*i],s=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*r],c=e[3*r+1];return[new Qe(a,s),new Qe(o,l),new Qe(h,c)]},generateSideWallUV:function(t,e,i,n,r,a){const s=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],u=e[3*n+2],p=e[3*r],d=e[3*r+1],m=e[3*r+2],f=e[3*a],g=e[3*a+1],v=e[3*a+2];return Math.abs(o-c)<.01?[new Qe(s,1-l),new Qe(h,1-u),new Qe(p,1-m),new Qe(f,1-v)]:[new Qe(o,1-l),new Qe(c,1-u),new Qe(d,1-m),new Qe(g,1-v)]}};class Kl extends al{constructor(t,e){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new Zl(t,e)),this.mergeVertices()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}}class Ql extends dl{constructor(t,e){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class $l extends al{constructor(t,e){super(),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Ql(t,e)),this.mergeVertices()}}class th extends ir{constructor(t,e,i,n){super(),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e)||12,i=i||0,n=n||2*Math.PI,n=Ke.clamp(n,0,2*Math.PI);const r=[],a=[],s=[],o=1/e,l=new li,h=new Qe;for(let r=0;r<=e;r++){const c=i+r*o*n,u=Math.sin(c),p=Math.cos(c);for(let i=0;i<=t.length-1;i++)l.x=t[i].x*u,l.y=t[i].y,l.z=t[i].x*p,a.push(l.x,l.y,l.z),h.x=r/e,h.y=i/(t.length-1),s.push(h.x,h.y)}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,a=n,s=n+t.length,o=n+t.length+1,l=n+1;r.push(a,s,l),r.push(s,o,l)}if(this.setIndex(r),this.setAttribute("position",new Wn(a,3)),this.setAttribute("uv",new Wn(s,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new li,r=new li,a=new li,s=e*t.length*3;for(let e=0,o=0;e<t.length;e++,o+=3)n.x=i[o+0],n.y=i[o+1],n.z=i[o+2],r.x=i[s+o+0],r.y=i[s+o+1],r.z=i[s+o+2],a.addVectors(n,r).normalize(),i[o+0]=i[s+o+0]=a.x,i[o+1]=i[s+o+1]=a.y,i[o+2]=i[s+o+2]=a.z}}}class eh extends al{constructor(t,e,i,n){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},this.fromBufferGeometry(new th(t,e,i,n)),this.mergeVertices()}}class ih extends dl{constructor(t,e){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class nh extends al{constructor(t,e){super(),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ih(t,e)),this.mergeVertices()}}function rh(t,e,i){ir.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:i};const n=[],r=[],a=[],s=[],o=new li,l=new li,h=new li,c=new li,u=new li;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const p=e+1;for(let n=0;n<=i;n++){const p=n/i;for(let i=0;i<=e;i++){const n=i/e;t(n,p,l),r.push(l.x,l.y,l.z),n-1e-5>=0?(t(n-1e-5,p,h),c.subVectors(l,h)):(t(n+1e-5,p,h),c.subVectors(h,l)),p-1e-5>=0?(t(n,p-1e-5,h),u.subVectors(l,h)):(t(n,p+1e-5,h),u.subVectors(h,l)),o.crossVectors(c,u).normalize(),a.push(o.x,o.y,o.z),s.push(n,p)}}for(let t=0;t<i;t++)for(let i=0;i<e;i++){const e=t*p+i,r=t*p+i+1,a=(t+1)*p+i+1,s=(t+1)*p+i;n.push(e,r,s),n.push(r,a,s)}this.setIndex(n),this.setAttribute("position",new Wn(r,3)),this.setAttribute("normal",new Wn(a,3)),this.setAttribute("uv",new Wn(s,2))}function ah(t,e,i){al.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:i},this.fromBufferGeometry(new rh(t,e,i)),this.mergeVertices()}rh.prototype=Object.create(ir.prototype),rh.prototype.constructor=rh,ah.prototype=Object.create(al.prototype),ah.prototype.constructor=ah;class sh extends al{constructor(t,e,i,n){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n},this.fromBufferGeometry(new jr(t,e,i,n)),this.mergeVertices()}}class oh extends al{constructor(t,e,i,n){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n},this.fromBufferGeometry(new dl(t,e,i,n)),this.mergeVertices()}}class lh extends ir{constructor(t,e,i,n,r,a){super(),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},t=t||.5,e=e||1,r=void 0!==r?r:0,a=void 0!==a?a:2*Math.PI,i=void 0!==i?Math.max(3,i):8;const s=[],o=[],l=[],h=[];let c=t;const u=(e-t)/(n=void 0!==n?Math.max(1,n):1),p=new li,d=new Qe;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*a;p.x=c*Math.cos(n),p.y=c*Math.sin(n),o.push(p.x,p.y,p.z),l.push(0,0,1),d.x=(p.x/e+1)/2,d.y=(p.y/e+1)/2,h.push(d.x,d.y)}c+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,a=n+i+1,o=n+i+2,l=n+1;s.push(r,a,l),s.push(a,o,l)}}this.setIndex(s),this.setAttribute("position",new Wn(o,3)),this.setAttribute("normal",new Wn(l,3)),this.setAttribute("uv",new Wn(h,2))}}class hh extends al{constructor(t,e,i,n,r,a){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new lh(t,e,i,n,r,a)),this.mergeVertices()}}class ch extends ir{constructor(t,e){super(),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;const i=[],n=[],r=[],a=[];let s=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(s,o,e),s+=o,o=0;function l(t){const s=n.length/3,l=t.extractPoints(e);let h=l.shape;const c=l.holes;!1===ql.isClockWise(h)&&(h=h.reverse());for(let t=0,e=c.length;t<e;t++){const e=c[t];!0===ql.isClockWise(e)&&(c[t]=e.reverse())}const u=ql.triangulateShape(h,c);for(let t=0,e=c.length;t<e;t++){const e=c[t];h=h.concat(e)}for(let t=0,e=h.length;t<e;t++){const e=h[t];n.push(e.x,e.y,0),r.push(0,0,1),a.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+s,r=e[1]+s,a=e[2]+s;i.push(n,r,a),o+=3}}this.setIndex(i),this.setAttribute("position",new Wn(n,3)),this.setAttribute("normal",new Wn(r,3)),this.setAttribute("uv",new Wn(a,2))}toJSON(){const t=ir.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}class uh extends al{constructor(t,e){super(),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new ch(t,e)),this.mergeVertices()}toJSON(){const t=al.prototype.toJSON.call(this);return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}}class ph extends ir{constructor(t,e,i,n,r,a,s){super(),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},t=t||1,e=Math.max(3,Math.floor(e)||8),i=Math.max(2,Math.floor(i)||6),n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI,a=void 0!==a?a:0,s=void 0!==s?s:Math.PI;const o=Math.min(a+s,Math.PI);let l=0;const h=[],c=new li,u=new li,p=[],d=[],m=[],f=[];for(let p=0;p<=i;p++){const g=[],v=p/i;let y=0;0==p&&0==a?y=.5/e:p==i&&o==Math.PI&&(y=-.5/e);for(let i=0;i<=e;i++){const o=i/e;c.x=-t*Math.cos(n+o*r)*Math.sin(a+v*s),c.y=t*Math.cos(a+v*s),c.z=t*Math.sin(n+o*r)*Math.sin(a+v*s),d.push(c.x,c.y,c.z),u.copy(c).normalize(),m.push(u.x,u.y,u.z),f.push(o+y,1-v),g.push(l++)}h.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=h[t][n+1],r=h[t][n],s=h[t+1][n],l=h[t+1][n+1];(0!==t||a>0)&&p.push(e,r,l),(t!==i-1||o<Math.PI)&&p.push(r,s,l)}this.setIndex(p),this.setAttribute("position",new Wn(d,3)),this.setAttribute("normal",new Wn(m,3)),this.setAttribute("uv",new Wn(f,2))}}class dh extends al{constructor(t,e,i,n,r,a,s){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:a,thetaLength:s},this.fromBufferGeometry(new ph(t,e,i,n,r,a,s)),this.mergeVertices()}}class mh extends dl{constructor(t,e){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}}class fh extends al{constructor(t,e){super(),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new mh(t,e)),this.mergeVertices()}}class gh extends Zl{constructor(t,e){const i=(e=e||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new ir;const n=i.generateShapes(t,e.size);e.depth=void 0!==e.height?e.height:50,void 0===e.bevelThickness&&(e.bevelThickness=10),void 0===e.bevelSize&&(e.bevelSize=8),void 0===e.bevelEnabled&&(e.bevelEnabled=!1),super(n,e),this.type="TextBufferGeometry"}}class vh extends al{constructor(t,e){super(),this.type="TextGeometry",this.parameters={text:t,parameters:e},this.fromBufferGeometry(new gh(t,e)),this.mergeVertices()}}class yh extends ir{constructor(t,e,i,n,r){super(),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},t=t||1,e=e||.4,i=Math.floor(i)||8,n=Math.floor(n)||6,r=r||2*Math.PI;const a=[],s=[],o=[],l=[],h=new li,c=new li,u=new li;for(let a=0;a<=i;a++)for(let p=0;p<=n;p++){const d=p/n*r,m=a/i*Math.PI*2;c.x=(t+e*Math.cos(m))*Math.cos(d),c.y=(t+e*Math.cos(m))*Math.sin(d),c.z=e*Math.sin(m),s.push(c.x,c.y,c.z),h.x=t*Math.cos(d),h.y=t*Math.sin(d),u.subVectors(c,h).normalize(),o.push(u.x,u.y,u.z),l.push(p/n),l.push(a/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,s=(n+1)*(t-1)+e,o=(n+1)*t+e;a.push(i,r,o),a.push(r,s,o)}this.setIndex(a),this.setAttribute("position",new Wn(s,3)),this.setAttribute("normal",new Wn(o,3)),this.setAttribute("uv",new Wn(l,2))}}class xh extends al{constructor(t,e,i,n,r){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},this.fromBufferGeometry(new yh(t,e,i,n,r)),this.mergeVertices()}}class bh extends ir{constructor(t,e,i,n,r,a){super(),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:a},t=t||1,e=e||.4,i=Math.floor(i)||64,n=Math.floor(n)||8,r=r||2,a=a||3;const s=[],o=[],l=[],h=[],c=new li,u=new li,p=new li,d=new li,m=new li,f=new li,g=new li;for(let s=0;s<=i;++s){const y=s/i*r*Math.PI*2;v(y,r,a,t,p),v(y+.01,r,a,t,d),f.subVectors(d,p),g.addVectors(d,p),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,a=-e*Math.cos(r),d=e*Math.sin(r);c.x=p.x+(a*g.x+d*m.x),c.y=p.y+(a*g.y+d*m.y),c.z=p.z+(a*g.z+d*m.z),o.push(c.x,c.y,c.z),u.subVectors(c,p).normalize(),l.push(u.x,u.y,u.z),h.push(s/i),h.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),a=(n+1)*t+e,o=(n+1)*(t-1)+e;s.push(i,r,o),s.push(r,a,o)}function v(t,e,i,n,r){const a=Math.cos(t),s=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*a,r.y=n*(2+l)*s*.5,r.z=n*Math.sin(o)*.5}this.setIndex(s),this.setAttribute("position",new Wn(o,3)),this.setAttribute("normal",new Wn(l,3)),this.setAttribute("uv",new Wn(h,2))}}class wh extends al{constructor(t,e,i,n,r,a,s){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:a},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new bh(t,e,i,n,r,a)),this.mergeVertices()}}class _h extends ir{constructor(t,e,i,n,r){super(),this.type="TubeBufferGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},e=e||64,i=i||1,n=n||8,r=r||!1;const a=t.computeFrenetFrames(e,r);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const s=new li,o=new li,l=new Qe;let h=new li;const c=[],u=[],p=[],d=[];function m(r){h=t.getPointAt(r/e,h);const l=a.normals[r],p=a.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),a=-Math.cos(e);o.x=a*l.x+r*p.x,o.y=a*l.y+r*p.y,o.z=a*l.z+r*p.z,o.normalize(),u.push(o.x,o.y,o.z),s.x=h.x+i*o.x,s.y=h.y+i*o.y,s.z=h.z+i*o.z,c.push(s.x,s.y,s.z)}}!function(){for(let t=0;t<e;t++)m(t);m(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,p.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),a=(n+1)*t+e,s=(n+1)*(t-1)+e;d.push(i,r,s),d.push(r,a,s)}}()}(),this.setIndex(d),this.setAttribute("position",new Wn(c,3)),this.setAttribute("normal",new Wn(u,3)),this.setAttribute("uv",new Wn(p,2))}toJSON(){const t=ir.prototype.toJSON.call(this);return t.path=this.parameters.path.toJSON(),t}}class Mh extends al{constructor(t,e,i,n,r,a){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");const s=new _h(t,e,i,n,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}}class Sh extends ir{constructor(t){super(),this.type="WireframeGeometry";const e=[],i=[0,0],n={},r=["a","b","c"];if(t&&t.isGeometry){const a=t.faces;for(let t=0,e=a.length;t<e;t++){const e=a[t];for(let t=0;t<3;t++){const a=e[r[t]],s=e[r[(t+1)%3]];i[0]=Math.min(a,s),i[1]=Math.max(a,s);const o=i[0]+","+i[1];void 0===n[o]&&(n[o]={index1:i[0],index2:i[1]})}}for(const i in n){const r=n[i];let a=t.vertices[r.index1];e.push(a.x,a.y,a.z),a=t.vertices[r.index2],e.push(a.x,a.y,a.z)}}else if(t&&t.isBufferGeometry){const r=new li;if(null!==t.index){const a=t.attributes.position,s=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:s.count,materialIndex:0}]);for(let t=0,e=o.length;t<e;++t){const e=o[t],r=e.start;for(let t=r,a=r+e.count;t<a;t+=3)for(let e=0;e<3;e++){const r=s.getX(t+e),a=s.getX(t+(e+1)%3);i[0]=Math.min(r,a),i[1]=Math.max(r,a);const o=i[0]+","+i[1];void 0===n[o]&&(n[o]={index1:i[0],index2:i[1]})}}for(const t in n){const i=n[t];r.fromBufferAttribute(a,i.index1),e.push(r.x,r.y,r.z),r.fromBufferAttribute(a,i.index2),e.push(r.x,r.y,r.z)}}else{const i=t.attributes.position;for(let t=0,n=i.count/3;t<n;t++)for(let n=0;n<3;n++){const a=3*t+n;r.fromBufferAttribute(i,a),e.push(r.x,r.y,r.z);const s=3*t+(n+1)%3;r.fromBufferAttribute(i,s),e.push(r.x,r.y,r.z)}}}this.setAttribute("position",new Wn(e,3))}}var Th=Object.freeze({__proto__:null,BoxGeometry:sl,BoxBufferGeometry:Mr,CircleGeometry:ll,CircleBufferGeometry:ol,ConeGeometry:ul,ConeBufferGeometry:pl,CylinderGeometry:cl,CylinderBufferGeometry:hl,DodecahedronGeometry:fl,DodecahedronBufferGeometry:ml,EdgesGeometry:bl,ExtrudeGeometry:Kl,ExtrudeBufferGeometry:Zl,IcosahedronGeometry:$l,IcosahedronBufferGeometry:Ql,LatheGeometry:eh,LatheBufferGeometry:th,OctahedronGeometry:nh,OctahedronBufferGeometry:ih,ParametricGeometry:ah,ParametricBufferGeometry:rh,PlaneGeometry:sh,PlaneBufferGeometry:jr,PolyhedronGeometry:oh,PolyhedronBufferGeometry:dl,RingGeometry:hh,RingBufferGeometry:lh,ShapeGeometry:uh,ShapeBufferGeometry:ch,SphereGeometry:dh,SphereBufferGeometry:ph,TetrahedronGeometry:fh,TetrahedronBufferGeometry:mh,TextGeometry:vh,TextBufferGeometry:gh,TorusGeometry:xh,TorusBufferGeometry:yh,TorusKnotGeometry:wh,TorusKnotBufferGeometry:bh,TubeGeometry:Mh,TubeBufferGeometry:_h,WireframeGeometry:Sh});function Eh(t){In.call(this),this.type="ShadowMaterial",this.color=new On(0),this.transparent=!0,this.setValues(t)}function Ah(t){Lr.call(this,t),this.type="RawShaderMaterial"}function Ph(t){In.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new On(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ge,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function Lh(t){Ph.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Qe(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=Ke.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(t)}function Oh(t){In.call(this),this.type="MeshPhongMaterial",this.color=new On(16777215),this.specular=new On(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ge,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=U,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ch(t){In.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new On(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ge,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Rh(t){In.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ge,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Ih(t){In.call(this),this.type="MeshLambertMaterial",this.color=new On(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new On(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=U,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Dh(t){In.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new On(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ge,this.normalScale=new Qe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function Nh(t){Io.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}Eh.prototype=Object.create(In.prototype),Eh.prototype.constructor=Eh,Eh.prototype.isShadowMaterial=!0,Eh.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this},Ah.prototype=Object.create(Lr.prototype),Ah.prototype.constructor=Ah,Ah.prototype.isRawShaderMaterial=!0,Ph.prototype=Object.create(In.prototype),Ph.prototype.constructor=Ph,Ph.prototype.isMeshStandardMaterial=!0,Ph.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this.vertexTangents=t.vertexTangents,this},Lh.prototype=Object.create(Ph.prototype),Lh.prototype.constructor=Lh,Lh.prototype.isMeshPhysicalMaterial=!0,Lh.prototype.copy=function(t){return Ph.prototype.copy.call(this,t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new On).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this},Oh.prototype=Object.create(In.prototype),Oh.prototype.constructor=Oh,Oh.prototype.isMeshPhongMaterial=!0,Oh.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Ch.prototype=Object.create(In.prototype),Ch.prototype.constructor=Ch,Ch.prototype.isMeshToonMaterial=!0,Ch.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Rh.prototype=Object.create(In.prototype),Rh.prototype.constructor=Rh,Rh.prototype.isMeshNormalMaterial=!0,Rh.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Ih.prototype=Object.create(In.prototype),Ih.prototype.constructor=Ih,Ih.prototype.isMeshLambertMaterial=!0,Ih.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Dh.prototype=Object.create(In.prototype),Dh.prototype.constructor=Dh,Dh.prototype.isMeshMatcapMaterial=!0,Dh.prototype.copy=function(t){return In.prototype.copy.call(this,t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.skinning=t.skinning,this.morphTargets=t.morphTargets,this.morphNormals=t.morphNormals,this},Nh.prototype=Object.create(Io.prototype),Nh.prototype.constructor=Nh,Nh.prototype.isLineDashedMaterial=!0,Nh.prototype.copy=function(t){return Io.prototype.copy.call(this,t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this};var Fh=Object.freeze({__proto__:null,ShadowMaterial:Eh,SpriteMaterial:no,RawShaderMaterial:Ah,ShaderMaterial:Lr,PointsMaterial:Vo,MeshPhysicalMaterial:Lh,MeshStandardMaterial:Ph,MeshPhongMaterial:Oh,MeshToonMaterial:Ch,MeshNormalMaterial:Rh,MeshLambertMaterial:Ih,MeshDepthMaterial:Fs,MeshDistanceMaterial:zs,MeshBasicMaterial:Dn,MeshMatcapMaterial:Dh,LineDashedMaterial:Nh,LineBasicMaterial:Io,Material:In});const zh={arraySlice:function(t,e,i){return zh.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)},convertArray:function(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort(function(e,i){return t[e]-t[i]}),i},sortedArray:function(t,e,i){const n=t.length,r=new t.constructor(n);for(let a=0,s=0;s!==n;++a){const n=i[a]*e;for(let i=0;i!==e;++i)r[s++]=t[n+i]}return r},flattenJSON:function(t,e,i,n){let r=1,a=t[0];for(;void 0!==a&&void 0===a[n];)a=t[r++];if(void 0===a)return;let s=a[n];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=a[n])&&(e.push(a.time),i.push.apply(i,s)),a=t[r++]}while(void 0!==a);else if(void 0!==s.toArray)do{void 0!==(s=a[n])&&(e.push(a.time),s.toArray(i,i.length)),a=t[r++]}while(void 0!==a);else do{void 0!==(s=a[n])&&(e.push(a.time),i.push(s)),a=t[r++]}while(void 0!==a)},subclip:function(t,e,i,n,r){r=r||30;const a=t.clone();a.name=e;const s=[];for(let t=0;t<a.tracks.length;++t){const e=a.tracks[t],o=e.getValueSize(),l=[],h=[];for(let t=0;t<e.times.length;++t){const a=e.times[t]*r;if(!(a<i||a>=n)){l.push(e.times[t]);for(let i=0;i<o;++i)h.push(e.values[t*o+i])}}0!==l.length&&(e.times=zh.convertArray(l,e.times.constructor),e.values=zh.convertArray(h,e.values.constructor),s.push(e))}a.tracks=s;let o=1/0;for(let t=0;t<a.tracks.length;++t)o>a.tracks[t].times[0]&&(o=a.tracks[t].times[0]);for(let t=0;t<a.tracks.length;++t)a.tracks[t].shift(-1*o);return a.resetDuration(),a},makeClipAdditive:function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=t),(void 0===n||n<=0)&&(n=30);const r=i.tracks.length,a=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const s=t.tracks.find(function(t){return t.name===n.name&&t.ValueTypeName===r});if(void 0===s)continue;let o=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let h=0;const c=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=c/3);const u=n.times.length-1;let p;if(a<=n.times[0]){const t=o,e=l-o;p=zh.arraySlice(n.values,t,e)}else if(a>=n.times[u]){const t=u*l+o,e=t+l-o;p=zh.arraySlice(n.values,t,e)}else{const t=n.createInterpolant(),e=o,i=l-o;t.evaluate(a),p=zh.arraySlice(t.resultBuffer,e,i)}if("quaternion"===r){(new oi).fromArray(p).normalize().conjugate().toArray(p)}const d=s.times.length;for(let t=0;t<d;++t){const e=t*c+h;if("quaternion"===r)oi.multiplyQuaternionsFlat(s.values,e,p,0,s.values,e);else{const t=c-2*h;for(let i=0;i<t;++i)s.values[e+i]-=p[i]}}}return t.blendMode=Le,t}};function kh(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i}function Bh(t,e,i,n){kh.call(this,t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Uh(t,e,i,n){kh.call(this,t,e,i,n)}function Gh(t,e,i,n){kh.call(this,t,e,i,n)}function Hh(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=zh.convertArray(e,this.TimeBufferType),this.values=zh.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}function jh(t,e,i){Hh.call(this,t,e,i)}function Vh(t,e,i,n){Hh.call(this,t,e,i,n)}function Wh(t,e,i,n){Hh.call(this,t,e,i,n)}function qh(t,e,i,n){kh.call(this,t,e,i,n)}function Xh(t,e,i,n){Hh.call(this,t,e,i,n)}function Yh(t,e,i,n){Hh.call(this,t,e,i,n)}function Zh(t,e,i,n){Hh.call(this,t,e,i,n)}function Jh(t,e,i,n){this.name=t,this.tracks=i,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==n?n:Pe,this.uuid=Ke.generateUUID(),this.duration<0&&this.resetDuration()}function Kh(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Wh;case"vector":case"vector2":case"vector3":case"vector4":return Zh;case"color":return Vh;case"quaternion":return Xh;case"bool":case"boolean":return jh;case"string":return Yh}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];zh.flattenJSON(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(kh.prototype,{evaluate:function(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let a;i:{n:if(!(t<n)){for(let a=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,t,r)}if(i===a)break;if(r=n,t<(n=e[++i]))break e}a=e.length;break i}if(t>=r)break t;{const s=e[1];t<s&&(i=2,r=s);for(let a=i-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,n);if(i===a)break;if(n=r,t>=(r=e[--i-1]))break e}a=i,i=0}}for(;i<a;){const n=i+a>>>1;t<e[n]?a=n:i=n+1}if(n=e[i],void 0===(r=e[i-1]))return this._cachedIndex=0,this.beforeStart_(0,t,n);if(void 0===n)return i=e.length,this._cachedIndex=i,this.afterEnd_(i-1,r,t)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(kh.prototype,{beforeStart_:kh.prototype.copySampleValue_,afterEnd_:kh.prototype.copySampleValue_}),Bh.prototype=Object.assign(Object.create(kh.prototype),{constructor:Bh,DefaultSettings_:{endingStart:Te,endingEnd:Te},intervalChanged_:function(t,e,i){const n=this.parameterPositions;let r=t-2,a=t+1,s=n[r],o=n[a];if(void 0===s)switch(this.getSettings_().endingStart){case Ee:r=t,s=2*e-i;break;case Ae:s=e+n[r=n.length-2]-n[r+1];break;default:r=t,s=i}if(void 0===o)switch(this.getSettings_().endingEnd){case Ee:a=t,o=2*i-e;break;case Ae:a=1,o=i+n[1]-n[0];break;default:a=t-1,o=e}const l=.5*(i-e),h=this.valueSize;this._weightPrev=l/(e-s),this._weightNext=l/(o-i),this._offsetPrev=r*h,this._offsetNext=a*h},interpolate_:function(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,l=o-s,h=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,p=this._weightNext,d=(i-e)/(n-e),m=d*d,f=m*d,g=-u*f+2*u*m-u*d,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*d+1,y=(-1-p)*f+(1.5+p)*m+.5*d,x=p*f-p*m;for(let t=0;t!==s;++t)r[t]=g*a[h+t]+v*a[l+t]+y*a[o+t]+x*a[c+t];return r}}),Uh.prototype=Object.assign(Object.create(kh.prototype),{constructor:Uh,interpolate_:function(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=t*s,l=o-s,h=(i-e)/(n-e),c=1-h;for(let t=0;t!==s;++t)r[t]=a[l+t]*c+a[o+t]*h;return r}}),Gh.prototype=Object.assign(Object.create(kh.prototype),{constructor:Gh,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(Hh,{toJSON:function(t){const e=t.constructor;let i;if(void 0!==e.toJSON)i=e.toJSON(t);else{i={name:t.name,times:zh.convertArray(t.times,Array),values:zh.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}}),Object.assign(Hh.prototype,{constructor:Hh,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:2301,InterpolantFactoryMethodDiscrete:function(t){return new Gh(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new Uh(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new Bh(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this},trim:function(t,e){const i=this.times,n=i.length;let r=0,a=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==a&&i[a]>e;)--a;if(++a,0!==r||a!==n){r>=a&&(r=(a=Math.max(a,1))-1);const t=this.getValueSize();this.times=zh.arraySlice(i,r,a),this.values=zh.arraySlice(this.values,r*t,a*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==a&&a>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,a),t=!1;break}a=n}if(void 0!==n&&zh.isTypedArray(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t},optimize:function(){const t=zh.arraySlice(this.times),e=zh.arraySlice(this.values),i=this.getValueSize(),n=2302===this.getInterpolation(),r=t.length-1;let a=1;for(let s=1;s<r;++s){let r=!1;const o=t[s];if(o!==t[s+1]&&(1!==s||o!==o[0]))if(n)r=!0;else{const t=s*i,n=t-i,a=t+i;for(let s=0;s!==i;++s){const i=e[t+s];if(i!==e[n+s]||i!==e[a+s]){r=!0;break}}}if(r){if(s!==a){t[a]=t[s];const n=s*i,r=a*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++a}}if(r>0){t[a]=t[r];for(let t=r*i,n=a*i,s=0;s!==i;++s)e[n+s]=e[t+s];++a}return a!==t.length?(this.times=zh.arraySlice(t,0,a),this.values=zh.arraySlice(e,0,a*i)):(this.times=t,this.values=e),this},clone:function(){const t=zh.arraySlice(this.times,0),e=zh.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}),jh.prototype=Object.assign(Object.create(Hh.prototype),{constructor:jh,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Vh.prototype=Object.assign(Object.create(Hh.prototype),{constructor:Vh,ValueTypeName:"color"}),Wh.prototype=Object.assign(Object.create(Hh.prototype),{constructor:Wh,ValueTypeName:"number"}),qh.prototype=Object.assign(Object.create(kh.prototype),{constructor:qh,interpolate_:function(t,e,i,n){const r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=(i-e)/(n-e);let l=t*s;for(let t=l+s;l!==t;l+=4)oi.slerpFlat(r,0,a,l-s,a,l,o);return r}}),Xh.prototype=Object.assign(Object.create(Hh.prototype),{constructor:Xh,ValueTypeName:"quaternion",DefaultInterpolation:2301,InterpolantFactoryMethodLinear:function(t){return new qh(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Yh.prototype=Object.assign(Object.create(Hh.prototype),{constructor:Yh,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:2300,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Zh.prototype=Object.assign(Object.create(Hh.prototype),{constructor:Zh,ValueTypeName:"vector"}),Object.assign(Jh,{parse:function(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(Kh(i[t]).scale(n));return new Jh(t.name,t.duration,e,t.blendMode)},toJSON:function(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(Hh.toJSON(i[t]));return n},CreateFromMorphTargetSequence:function(t,e,i,n){const r=e.length,a=[];for(let t=0;t<r;t++){let s=[],o=[];s.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=zh.getKeyframeOrder(s);s=zh.sortedArray(s,1,l),o=zh.sortedArray(o,1,l),n||0!==s[0]||(s.push(r),o.push(o[0])),a.push(new Wh(".morphTargetInfluences["+e[t].name+"]",s,o).scale(1/i))}return new Jh(t,-1,a)},findByName:function(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null},CreateClipsFromMorphTargetSequences:function(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],a=i.name.match(r);if(a&&a.length>1){const t=a[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const a=[];for(const t in n)a.push(Jh.CreateFromMorphTargetSequence(t,n[t],e,i));return a},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const a=[],s=[];zh.flattenJSON(i,a,s,n),0!==a.length&&r.push(new t(e,a,s))}},n=[],r=t.name||"default",a=t.fps||30,s=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],a=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),a.push(n.morphTarget===i?1:0)}n.push(new Wh(".morphTargetInfluence["+i+"]",t,a))}o=t.length*(a||1)}else{const a=".bones["+e[t].name+"]";i(Zh,a+".position",r,"pos",n),i(Xh,a+".quaternion",r,"rot",n),i(Zh,a+".scale",r,"scl",n)}}return 0===n.length?null:new Jh(r,o,n,s)}}),Object.assign(Jh.prototype,{resetDuration:function(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this},trim:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new Jh(this.name,this.duration,t,this.blendMode)}});const Qh={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function $h(t,e,i){const n=this;let r=!1,a=0,s=0,o=void 0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){s++,!1===r&&void 0!==n.onStart&&n.onStart(t,a,s),r=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,s),a===s&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return o?o(t):t},this.setURLModifier=function(t){return o=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}const tc=new $h;function ec(t){this.manager=void 0!==t?t:tc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(ec.prototype,{load:function(){},loadAsync:function(t,e){const i=this;return new Promise(function(n,r){i.load(t,n,e,r)})},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const ic={};function nc(t){ec.call(this,t)}function rc(t){ec.call(this,t)}function ac(t){ec.call(this,t)}function sc(t){ec.call(this,t)}function oc(t){ec.call(this,t)}function lc(t){ec.call(this,t)}function hc(t){ec.call(this,t)}function cc(){this.type="Curve",this.arcLengthDivisions=200}function uc(t,e,i,n,r,a,s,o){cc.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=i||1,this.yRadius=n||1,this.aStartAngle=r||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=s||!1,this.aRotation=o||0}function pc(t,e,i,n,r,a){uc.call(this,t,e,i,i,n,r,a),this.type="ArcCurve"}function dc(){let t=0,e=0,i=0,n=0;function r(r,a,s,o){t=r,e=s,i=-3*r+3*a-2*s-o,n=2*r-2*a+s+o}return{initCatmullRom:function(t,e,i,n,a){r(e,i,a*(i-t),a*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,a,s,o){let l=(e-t)/a-(i-t)/(a+s)+(i-e)/s,h=(i-e)/s-(n-e)/(s+o)+(n-i)/o;r(e,i,l*=s,h*=s)},calc:function(r){const a=r*r;return t+e*r+i*a+n*(a*r)}}}nc.prototype=Object.assign(Object.create(ec.prototype),{constructor:nc,load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=Qh.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;if(void 0!==ic[t])return void ic[t].push({onLoad:e,onProgress:i,onError:n});const s=t.match(/^data:(.*?)(;base64)?,(.*)$/);let o;if(s){const i=s[1],a=!!s[2];let o=s[3];o=decodeURIComponent(o),a&&(o=atob(o));try{let a;const s=(this.responseType||"").toLowerCase();switch(s){case"arraybuffer":case"blob":const t=new Uint8Array(o.length);for(let e=0;e<o.length;e++)t[e]=o.charCodeAt(e);a="blob"===s?new Blob([t.buffer],{type:i}):t.buffer;break;case"document":const e=new DOMParser;a=e.parseFromString(o,i);break;case"json":a=JSON.parse(o);break;default:a=o}setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0)}catch(e){setTimeout(function(){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)},0)}}else{ic[t]=[],ic[t].push({onLoad:e,onProgress:i,onError:n}),(o=new XMLHttpRequest).open("GET",t,!0),o.addEventListener("load",function(e){const i=this.response,n=ic[t];if(delete ic[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Qh.add(t,i);for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onLoad&&e.onLoad(i)}r.manager.itemEnd(t)}else{for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)}},!1),o.addEventListener("progress",function(e){const i=ic[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onProgress&&n.onProgress(e)}},!1),o.addEventListener("error",function(e){const i=ic[t];delete ic[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),o.addEventListener("abort",function(e){const i=ic[t];delete ic[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}r.manager.itemError(t),r.manager.itemEnd(t)},!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const t in this.requestHeader)o.setRequestHeader(t,this.requestHeader[t]);o.send(null)}return r.manager.itemStart(t),o},setResponseType:function(t){return this.responseType=t,this},setMimeType:function(t){return this.mimeType=t,this}}),rc.prototype=Object.assign(Object.create(ec.prototype),{constructor:rc,load:function(t,e,i,n){const r=this,a=new nc(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)},parse:function(t){const e=[];for(let i=0;i<t.length;i++){const n=Jh.parse(t[i]);e.push(n)}return e}}),ac.prototype=Object.assign(Object.create(ec.prototype),{constructor:ac,load:function(t,e,i,n){const r=this,a=[],s=new Qo;s.image=a;const o=new nc(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function h(h){o.load(t[h],function(t){const i=r.parse(t,!0);a[h]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(l+=1)&&(1===i.mipmapCount&&(s.minFilter=ot),s.format=i.format,s.needsUpdate=!0,e&&e(s))},i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)h(e);else o.load(t,function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){a[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)a[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),a[e].format=i.format,a[e].width=i.width,a[e].height=i.height}}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=ot),s.format=i.format,s.needsUpdate=!0,e&&e(s)},i,n);return s}}),sc.prototype=Object.assign(Object.create(ec.prototype),{constructor:sc,load:function(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=Qh.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;const s=document.createElementNS("http://www.w3.org/1999/xhtml","img");function o(){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1),Qh.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){s.removeEventListener("load",o,!1),s.removeEventListener("error",l,!1),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}return s.addEventListener("load",o,!1),s.addEventListener("error",l,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),r.manager.itemStart(t),s.src=t,s}}),oc.prototype=Object.assign(Object.create(ec.prototype),{constructor:oc,load:function(t,e,i,n){const r=new Nr,a=new sc(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let s=0;function o(i){a.load(t[i],function(t){r.images[i]=t,6===++s&&(r.needsUpdate=!0,e&&e(r))},void 0,n)}for(let e=0;e<t.length;++e)o(e);return r}}),lc.prototype=Object.assign(Object.create(ec.prototype),{constructor:lc,load:function(t,e,i,n){const r=this,a=new zr,s=new nc(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(r.withCredentials),s.load(t,function(t){const i=r.parse(t);i&&(void 0!==i.image?a.image=i.image:void 0!==i.data&&(a.image.width=i.width,a.image.height=i.height,a.image.data=i.data),a.wrapS=void 0!==i.wrapS?i.wrapS:it,a.wrapT=void 0!==i.wrapT?i.wrapT:it,a.magFilter=void 0!==i.magFilter?i.magFilter:ot,a.minFilter=void 0!==i.minFilter?i.minFilter:ot,a.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(a.format=i.format),void 0!==i.type&&(a.type=i.type),void 0!==i.mipmaps&&(a.mipmaps=i.mipmaps,a.minFilter=ht),1===i.mipmapCount&&(a.minFilter=ot),a.needsUpdate=!0,e&&e(a,i))},i,n),a}}),hc.prototype=Object.assign(Object.create(ec.prototype),{constructor:hc,load:function(t,e,i,n){const r=new ni,a=new sc(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(i){r.image=i;const n=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);r.format=n?Mt:St,r.needsUpdate=!0,void 0!==e&&e(r)},i,n),r}}),Object.assign(cc.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)},getPoints:function(t){void 0===t&&(t=5);const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let a=1;a<=t;a++)r+=(i=this.getPoint(a/t)).distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(t,e){const i=this.getLengths();let n=0;const r=i.length;let a;a=e||t*i[r-1];let s,o=0,l=r-1;for(;o<=l;)if((s=i[n=Math.floor(o+(l-o)/2)]-a)<0)o=n+1;else{if(!(s>0)){l=n;break}l=n-1}if(i[n=l]===a)return n/(r-1);const h=i[n];return(n+(a-h)/(i[n+1]-h))/(r-1)},getTangent:function(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);const r=this.getPoint(i),a=this.getPoint(n),s=e||(r.isVector2?new Qe:new li);return s.copy(a).sub(r).normalize(),s},getTangentAt:function(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)},computeFrenetFrames:function(t,e){const i=new li,n=[],r=[],a=[],s=new li,o=new Fi;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new li),n[e].normalize()}r[0]=new li,a[0]=new li;let l=Number.MAX_VALUE;const h=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);h<=l&&(l=h,i.set(1,0,0)),c<=l&&(l=c,i.set(0,1,0)),u<=l&&i.set(0,0,1),s.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],s),a[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),a[e]=a[e-1].clone(),s.crossVectors(n[e-1],n[e]),s.length()>Number.EPSILON){s.normalize();const t=Math.acos(Ke.clamp(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(s,t))}a[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(Ke.clamp(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(s.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),a[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this},toJSON:function(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),uc.prototype=Object.create(cc.prototype),uc.prototype.constructor=uc,uc.prototype.isEllipseCurve=!0,uc.prototype.getPoint=function(t,e){const i=e||new Qe,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const a=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=a?0:n),!0!==this.aClockwise||a||(r===n?r=-n:r-=n);const s=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(s),l=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)},uc.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},uc.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t},uc.prototype.fromJSON=function(t){return cc.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},pc.prototype=Object.create(uc.prototype),pc.prototype.constructor=pc,pc.prototype.isArcCurve=!0;const mc=new li,fc=new dc,gc=new dc,vc=new dc;function yc(t,e,i,n){cc.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=i||"centripetal",this.tension=void 0!==n?n:.5}function xc(t,e,i,n,r){const a=.5*(n-e),s=.5*(r-i),o=t*t;return(2*i-2*n+a+s)*(t*o)+(-3*i+3*n-2*a-s)*o+a*t+i}function bc(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function wc(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}function _c(t,e,i,n){cc.call(this),this.type="CubicBezierCurve",this.v0=t||new Qe,this.v1=e||new Qe,this.v2=i||new Qe,this.v3=n||new Qe}function Mc(t,e,i,n){cc.call(this),this.type="CubicBezierCurve3",this.v0=t||new li,this.v1=e||new li,this.v2=i||new li,this.v3=n||new li}function Sc(t,e){cc.call(this),this.type="LineCurve",this.v1=t||new Qe,this.v2=e||new Qe}function Tc(t,e){cc.call(this),this.type="LineCurve3",this.v1=t||new li,this.v2=e||new li}function Ec(t,e,i){cc.call(this),this.type="QuadraticBezierCurve",this.v0=t||new Qe,this.v1=e||new Qe,this.v2=i||new Qe}function Ac(t,e,i){cc.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new li,this.v1=e||new li,this.v2=i||new li}function Pc(t){cc.call(this),this.type="SplineCurve",this.points=t||[]}yc.prototype=Object.create(cc.prototype),yc.prototype.constructor=yc,yc.prototype.isCatmullRomCurve3=!0,yc.prototype.getPoint=function(t,e){const i=e||new li,n=this.points,r=n.length,a=(r-(this.closed?0:1))*t;let s,o,l=Math.floor(a),h=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===h&&l===r-1&&(l=r-2,h=1),this.closed||l>0?s=n[(l-1)%r]:(mc.subVectors(n[0],n[1]).add(n[0]),s=mc);const c=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(mc.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=mc),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(s.distanceToSquared(c),t),i=Math.pow(c.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),fc.initNonuniformCatmullRom(s.x,c.x,u.x,o.x,e,i,n),gc.initNonuniformCatmullRom(s.y,c.y,u.y,o.y,e,i,n),vc.initNonuniformCatmullRom(s.z,c.z,u.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(fc.initCatmullRom(s.x,c.x,u.x,o.x,this.tension),gc.initCatmullRom(s.y,c.y,u.y,o.y,this.tension),vc.initCatmullRom(s.z,c.z,u.z,o.z,this.tension));return i.set(fc.calc(h),gc.calc(h),vc.calc(h)),i},yc.prototype.copy=function(t){cc.prototype.copy.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},yc.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t},yc.prototype.fromJSON=function(t){cc.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new li).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},_c.prototype=Object.create(cc.prototype),_c.prototype.constructor=_c,_c.prototype.isCubicBezierCurve=!0,_c.prototype.getPoint=function(t,e){const i=e||new Qe,n=this.v0,r=this.v1,a=this.v2,s=this.v3;return i.set(wc(t,n.x,r.x,a.x,s.x),wc(t,n.y,r.y,a.y,s.y)),i},_c.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},_c.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},_c.prototype.fromJSON=function(t){return cc.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Mc.prototype=Object.create(cc.prototype),Mc.prototype.constructor=Mc,Mc.prototype.isCubicBezierCurve3=!0,Mc.prototype.getPoint=function(t,e){const i=e||new li,n=this.v0,r=this.v1,a=this.v2,s=this.v3;return i.set(wc(t,n.x,r.x,a.x,s.x),wc(t,n.y,r.y,a.y,s.y),wc(t,n.z,r.z,a.z,s.z)),i},Mc.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},Mc.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t},Mc.prototype.fromJSON=function(t){return cc.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},Sc.prototype=Object.create(cc.prototype),Sc.prototype.constructor=Sc,Sc.prototype.isLineCurve=!0,Sc.prototype.getPoint=function(t,e){const i=e||new Qe;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},Sc.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Sc.prototype.getTangent=function(t,e){const i=e||new Qe;return i.copy(this.v2).sub(this.v1).normalize(),i},Sc.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Sc.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Sc.prototype.fromJSON=function(t){return cc.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Tc.prototype=Object.create(cc.prototype),Tc.prototype.constructor=Tc,Tc.prototype.isLineCurve3=!0,Tc.prototype.getPoint=function(t,e){const i=e||new li;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i},Tc.prototype.getPointAt=function(t,e){return this.getPoint(t,e)},Tc.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Tc.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Tc.prototype.fromJSON=function(t){return cc.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ec.prototype=Object.create(cc.prototype),Ec.prototype.constructor=Ec,Ec.prototype.isQuadraticBezierCurve=!0,Ec.prototype.getPoint=function(t,e){const i=e||new Qe,n=this.v0,r=this.v1,a=this.v2;return i.set(bc(t,n.x,r.x,a.x),bc(t,n.y,r.y,a.y)),i},Ec.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ec.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ec.prototype.fromJSON=function(t){return cc.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Ac.prototype=Object.create(cc.prototype),Ac.prototype.constructor=Ac,Ac.prototype.isQuadraticBezierCurve3=!0,Ac.prototype.getPoint=function(t,e){const i=e||new li,n=this.v0,r=this.v1,a=this.v2;return i.set(bc(t,n.x,r.x,a.x),bc(t,n.y,r.y,a.y),bc(t,n.z,r.z,a.z)),i},Ac.prototype.copy=function(t){return cc.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},Ac.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t},Ac.prototype.fromJSON=function(t){return cc.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},Pc.prototype=Object.create(cc.prototype),Pc.prototype.constructor=Pc,Pc.prototype.isSplineCurve=!0,Pc.prototype.getPoint=function(t,e){const i=e||new Qe,n=this.points,r=(n.length-1)*t,a=Math.floor(r),s=r-a,o=n[0===a?a:a-1],l=n[a],h=n[a>n.length-2?n.length-1:a+1],c=n[a>n.length-3?n.length-1:a+2];return i.set(xc(s,o.x,l.x,h.x,c.x),xc(s,o.y,l.y,h.y,c.y)),i},Pc.prototype.copy=function(t){cc.prototype.copy.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this},Pc.prototype.toJSON=function(){const t=cc.prototype.toJSON.call(this);t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t},Pc.prototype.fromJSON=function(t){cc.prototype.fromJSON.call(this,t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Qe).fromArray(i))}return this};var Lc=Object.freeze({__proto__:null,ArcCurve:pc,CatmullRomCurve3:yc,CubicBezierCurve:_c,CubicBezierCurve3:Mc,EllipseCurve:uc,LineCurve:Sc,LineCurve3:Tc,QuadraticBezierCurve:Ec,QuadraticBezierCurve3:Ac,SplineCurve:Pc});function Oc(){cc.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Cc(t){Oc.call(this),this.type="Path",this.currentPoint=new Qe,t&&this.setFromPoints(t)}function Rc(t){Cc.call(this,t),this.uuid=Ke.generateUUID(),this.type="Shape",this.holes=[]}function Ic(t,e){ln.call(this),this.type="Light",this.color=new On(t),this.intensity=void 0!==e?e:1}function Dc(t,e,i){Ic.call(this,t,i),this.type="HemisphereLight",this.position.copy(ln.DefaultUp),this.updateMatrix(),this.groundColor=new On(e)}function Nc(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new Qe(512,512),this.map=null,this.mapPass=null,this.matrix=new Fi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ur,this._frameExtents=new Qe(1,1),this._viewportCount=1,this._viewports=[new ri(0,0,1,1)]}function Fc(){Nc.call(this,new Cr(50,1,.5,500)),this.focus=1}function zc(t,e,i,n,r,a){Ic.call(this,t,e),this.type="SpotLight",this.position.copy(ln.DefaultUp),this.updateMatrix(),this.target=new ln,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==a?a:1,this.shadow=new Fc}function kc(){Nc.call(this,new Cr(90,1,.5,500)),this._frameExtents=new Qe(4,2),this._viewportCount=6,this._viewports=[new ri(2,1,1,1),new ri(0,1,1,1),new ri(3,1,1,1),new ri(1,1,1,1),new ri(3,0,1,1),new ri(1,0,1,1)],this._cubeDirections=[new li(1,0,0),new li(-1,0,0),new li(0,0,1),new li(0,0,-1),new li(0,1,0),new li(0,-1,0)],this._cubeUps=[new li(0,1,0),new li(0,1,0),new li(0,1,0),new li(0,1,0),new li(0,0,1),new li(0,0,-1)]}function Bc(t,e,i,n){Ic.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==n?n:1,this.shadow=new kc}function Uc(t,e,i,n,r,a){Or.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==i?i:1,this.bottom=void 0!==n?n:-1,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function Gc(){Nc.call(this,new Uc(-5,5,5,-5,.5,500))}function Hc(t,e){Ic.call(this,t,e),this.type="DirectionalLight",this.position.copy(ln.DefaultUp),this.updateMatrix(),this.target=new ln,this.shadow=new Gc}function jc(t,e){Ic.call(this,t,e),this.type="AmbientLight"}function Vc(t,e,i,n){Ic.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==i?i:10,this.height=void 0!==n?n:10}Oc.prototype=Object.assign(Object.create(cc.prototype),{constructor:Oc,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Sc(e,t))},getPoint:function(t){const e=t*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=e){const t=i[n]-e,r=this.curves[n],a=r.getLength(),s=0===a?0:1-t/a;return r.getPointAt(s)}n++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const a=r[n],s=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,o=a.getPoints(s);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(t){cc.prototype.copy.call(this,t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this},toJSON:function(){const t=cc.prototype.toJSON.call(this);t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t},fromJSON:function(t){cc.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new Lc[i.type]).fromJSON(i))}return this}}),Cc.prototype=Object.assign(Object.create(Oc.prototype),{constructor:Cc,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const i=new Sc(this.currentPoint.clone(),new Qe(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,i,n){const r=new Ec(this.currentPoint.clone(),new Qe(t,e),new Qe(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this},bezierCurveTo:function(t,e,i,n,r,a){const s=new _c(this.currentPoint.clone(),new Qe(t,e),new Qe(i,n),new Qe(r,a));return this.curves.push(s),this.currentPoint.set(r,a),this},splineThru:function(t){const e=new Pc([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,i,n,r,a){const s=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+s,e+o,i,n,r,a),this},absarc:function(t,e,i,n,r,a){return this.absellipse(t,e,i,i,n,r,a),this},ellipse:function(t,e,i,n,r,a,s,o){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,i,n,r,a,s,o),this},absellipse:function(t,e,i,n,r,a,s,o){const l=new uc(t,e,i,n,r,a,s,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this},copy:function(t){return Oc.prototype.copy.call(this,t),this.currentPoint.copy(t.currentPoint),this},toJSON:function(){const t=Oc.prototype.toJSON.call(this);return t.currentPoint=this.currentPoint.toArray(),t},fromJSON:function(t){return Oc.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),Rc.prototype=Object.assign(Object.create(Cc.prototype),{constructor:Rc,getPointsHoles:function(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(t){Cc.prototype.copy.call(this,t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this},toJSON:function(){const t=Cc.prototype.toJSON.call(this);t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t},fromJSON:function(t){Cc.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Cc).fromJSON(i))}return this}}),Ic.prototype=Object.assign(Object.create(ln.prototype),{constructor:Ic,isLight:!0,copy:function(t){return ln.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},toJSON:function(t){const e=ln.prototype.toJSON.call(this,t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}),Dc.prototype=Object.assign(Object.create(Ic.prototype),{constructor:Dc,isHemisphereLight:!0,copy:function(t){return Ic.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}),Object.assign(Nc.prototype,{_projScreenMatrix:new Fi,_lightPositionWorld:new li,_lookTarget:new li,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,i=this.matrix,n=this._projScreenMatrix,r=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(t.matrixWorld),e.position.copy(a),r.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r),e.updateMatrixWorld(),n.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(n),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}),Fc.prototype=Object.assign(Object.create(Nc.prototype),{constructor:Fc,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,i=2*Ke.RAD2DEG*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),Nc.prototype.updateMatrices.call(this,t)}}),zc.prototype=Object.assign(Object.create(Ic.prototype),{constructor:zc,isSpotLight:!0,copy:function(t){return Ic.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),kc.prototype=Object.assign(Object.create(Nc.prototype),{constructor:kc,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);const i=this.camera,n=this.matrix,r=this._lightPositionWorld,a=this._lookTarget,s=this._projScreenMatrix;r.setFromMatrixPosition(t.matrixWorld),i.position.copy(r),a.copy(i.position),a.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(a),i.updateMatrixWorld(),n.makeTranslation(-r.x,-r.y,-r.z),s.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(s)}}),Bc.prototype=Object.assign(Object.create(Ic.prototype),{constructor:Bc,isPointLight:!0,copy:function(t){return Ic.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),Uc.prototype=Object.assign(Object.create(Or.prototype),{constructor:Uc,isOrthographicCamera:!0,copy:function(t,e){return Or.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this},setViewOffset:function(t,e,i,n,r,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,a=i+t,s=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(r+=t*this.view.offsetX)+t*this.view.width,o=(s-=e*this.view.offsetY)-e*this.view.height}this.projectionMatrix.makeOrthographic(r,a,s,o,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(t){const e=ln.prototype.toJSON.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}),Gc.prototype=Object.assign(Object.create(Nc.prototype),{constructor:Gc,isDirectionalLightShadow:!0,updateMatrices:function(t){Nc.prototype.updateMatrices.call(this,t)}}),Hc.prototype=Object.assign(Object.create(Ic.prototype),{constructor:Hc,isDirectionalLight:!0,copy:function(t){return Ic.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),jc.prototype=Object.assign(Object.create(Ic.prototype),{constructor:jc,isAmbientLight:!0}),Vc.prototype=Object.assign(Object.create(Ic.prototype),{constructor:Vc,isRectAreaLight:!0,copy:function(t){return Ic.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},toJSON:function(t){const e=Ic.prototype.toJSON.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});class Wc{constructor(){Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new li)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*n),e.addScaledVector(a[2],.488603*r),e.addScaledVector(a[3],.488603*i),e.addScaledVector(a[4],i*n*1.092548),e.addScaledVector(a[5],n*r*1.092548),e.addScaledVector(a[6],.315392*(3*r*r-1)),e.addScaledVector(a[7],i*r*1.092548),e.addScaledVector(a[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],1.023328*n),e.addScaledVector(a[2],1.023328*r),e.addScaledVector(a[3],1.023328*i),e.addScaledVector(a[4],.858086*i*n),e.addScaledVector(a[5],.858086*n*r),e.addScaledVector(a[6],.743125*r*r-.247708),e.addScaledVector(a[7],.858086*i*r),e.addScaledVector(a[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}function qc(t,e){Ic.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new Wc}function Xc(t){ec.call(this,t),this.textures={}}qc.prototype=Object.assign(Object.create(Ic.prototype),{constructor:qc,isLightProbe:!0,copy:function(t){return Ic.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(t){const e=Ic.prototype.toJSON.call(this,t);return e.object.sh=this.sh.toArray(),e}}),Xc.prototype=Object.assign(Object.create(ec.prototype),{constructor:Xc,load:function(t,e,i,n){const r=this,a=new nc(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)},parse:function(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=new Fh[t.type];if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=(new On).setHex(t.sheen)),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(n.skinning=t.skinning),void 0!==t.morphTargets&&(n.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(n.morphNormals=t.morphNormals),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.vertexTangents&&(n.vertexTangents=t.vertexTangents),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(n.uniforms[e]={},r.type){case"t":n.uniforms[e].value=i(r.value);break;case"c":n.uniforms[e].value=(new On).setHex(r.value);break;case"v2":n.uniforms[e].value=(new Qe).fromArray(r.value);break;case"v3":n.uniforms[e].value=(new li).fromArray(r.value);break;case"v4":n.uniforms[e].value=(new ri).fromArray(r.value);break;case"m3":n.uniforms[e].value=(new $e).fromArray(r.value);break;case"m4":n.uniforms[e].value=(new Fi).fromArray(r.value);break;default:n.uniforms[e].value=r.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(n.flatShading=1===t.shading),void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Qe).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Qe).fromArray(t.clearcoatNormalScale)),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),n},setTextures:function(t){return this.textures=t,this}});const Yc={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function Zc(){ir.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Jc(t,e,i,n){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),zn.call(this,t,e,i),this.meshPerAttribute=n||1}function Kc(t){ec.call(this,t)}Zc.prototype=Object.assign(Object.create(ir.prototype),{constructor:Zc,isInstancedBufferGeometry:!0,copy:function(t){return ir.prototype.copy.call(this,t),this.instanceCount=t.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const t=ir.prototype.toJSON.call(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}),Jc.prototype=Object.assign(Object.create(zn.prototype),{constructor:Jc,isInstancedBufferAttribute:!0,copy:function(t){return zn.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},toJSON:function(){const t=zn.prototype.toJSON.call(this);return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}),Kc.prototype=Object.assign(Object.create(ec.prototype),{constructor:Kc,load:function(t,e,i,n){const r=this,a=new nc(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)},parse:function(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],a=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),s=new to(new Qc[r.type](a),r.stride);return s.uuid=r.uuid,e[n]=s,s}const r=t.isInstancedBufferGeometry?new Zc:new ir,a=t.data.index;if(void 0!==a){const t=new Qc[a.type](a.array);r.setIndex(new zn(t,1))}const s=t.data.attributes;for(const e in s){const i=s[e];let a;if(i.isInterleavedBufferAttribute){a=new io(n(t.data,i.data),i.itemSize,i.offset,i.normalized)}else{const t=new Qc[i.type](i.array);a=new(i.isInstancedBufferAttribute?Jc:zn)(t,i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),r.setAttribute(e,a)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],a=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let s;if(r.isInterleavedBufferAttribute){s=new io(n(t.data,r.data),r.itemSize,r.offset,r.normalized)}else{s=new zn(new Qc[r.type](r.array),r.itemSize,r.normalized)}void 0!==r.name&&(s.name=r.name),a.push(s)}r.morphAttributes[e]=a}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const h=t.data.boundingSphere;if(void 0!==h){const t=new li;void 0!==h.center&&t.fromArray(h.center),r.boundingSphere=new Ai(t,h.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}});const Qc={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};class $c extends ec{constructor(t){super(t)}load(t,e,i,n){const r=this,a=""===this.path?Yc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||a;const s=new nc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,function(i){let a=null;try{a=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const s=a.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?r.parse(a,e):console.error("THREE.ObjectLoader: Can't load "+t)},i,n)}parse(t,e){const i=this.parseShape(t.shapes),n=this.parseGeometries(t.geometries,i),r=this.parseImages(t.images,function(){void 0!==e&&e(o)}),a=this.parseTextures(t.textures,r),s=this.parseMaterials(t.materials,a),o=this.parseObject(t.object,n,s);return t.animations&&(o.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(o),o}parseShape(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Rc).fromJSON(t[i]);e[n.uuid]=n}return e}parseGeometries(t,e){const i={};let n;if(void 0!==t){const r=new Kc;for(let a=0,s=t.length;a<s;a++){let s;const o=t[a];switch(o.type){case"PlaneGeometry":case"PlaneBufferGeometry":s=new Th[o.type](o.width,o.height,o.widthSegments,o.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":s=new Th[o.type](o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":s=new Th[o.type](o.radius,o.segments,o.thetaStart,o.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":s=new Th[o.type](o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":s=new Th[o.type](o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":s=new Th[o.type](o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":s=new Th[o.type](o.radius,o.detail);break;case"RingGeometry":case"RingBufferGeometry":s=new Th[o.type](o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":s=new Th[o.type](o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":s=new Th[o.type](o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q);break;case"TubeGeometry":case"TubeBufferGeometry":s=new Th[o.type]((new Lc[o.path.type]).fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed);break;case"LatheGeometry":case"LatheBufferGeometry":s=new Th[o.type](o.points,o.segments,o.phiStart,o.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":s=new Th[o.type](o.vertices,o.indices,o.radius,o.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":n=[];for(let t=0,i=o.shapes.length;t<i;t++){const i=e[o.shapes[t]];n.push(i)}s=new Th[o.type](n,o.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":n=[];for(let t=0,i=o.shapes.length;t<i;t++){const i=e[o.shapes[t]];n.push(i)}const t=o.options.extrudePath;void 0!==t&&(o.options.extrudePath=(new Lc[t.type]).fromJSON(t)),s=new Th[o.type](n,o.options);break;case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(o);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+o.type+'"');continue}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),i[o.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new Xc;r.setTextures(e);for(let e=0,a=t.length;e<a;e++){const a=t[e];if("MultiMaterial"===a.type){const t=[];for(let e=0;e<a.materials.length;e++){const n=a.materials[e];void 0===i[n.uuid]&&(i[n.uuid]=r.parse(n)),t.push(i[n.uuid])}n[a.uuid]=t}else void 0===i[a.uuid]&&(i[a.uuid]=r.parse(a)),n[a.uuid]=i[a.uuid]}}return n}parseAnimations(t){const e=[];for(let i=0;i<t.length;i++){const n=t[i],r=Jh.parse(n);void 0!==n.uuid&&(r.uuid=n.uuid),e.push(r)}return e}parseImages(t,e){const i=this,n={};let r;function a(t){return i.manager.itemStart(t),r.load(t,function(){i.manager.itemEnd(t)},void 0,function(){i.manager.itemError(t),i.manager.itemEnd(t)})}if(void 0!==t&&t.length>0){const s=new $h(e);(r=new sc(s)).setCrossOrigin(this.crossOrigin);for(let e=0,r=t.length;e<r;e++){const r=t[e],s=r.url;if(Array.isArray(s)){n[r.uuid]=[];for(let t=0,e=s.length;t<e;t++){const e=s[t],o=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e;n[r.uuid].push(a(o))}}else{const t=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r.url)?r.url:i.resourcePath+r.url;n[r.uuid]=a(t)}}}return n}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let r=0,a=t.length;r<a;r++){const a=t[r];let s;void 0===a.image&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),void 0===e[a.image]&&console.warn("THREE.ObjectLoader: Undefined image",a.image),(s=Array.isArray(e[a.image])?new Nr(e[a.image]):new ni(e[a.image])).needsUpdate=!0,s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.mapping&&(s.mapping=i(a.mapping,tu)),void 0!==a.offset&&s.offset.fromArray(a.offset),void 0!==a.repeat&&s.repeat.fromArray(a.repeat),void 0!==a.center&&s.center.fromArray(a.center),void 0!==a.rotation&&(s.rotation=a.rotation),void 0!==a.wrap&&(s.wrapS=i(a.wrap[0],eu),s.wrapT=i(a.wrap[1],eu)),void 0!==a.format&&(s.format=a.format),void 0!==a.type&&(s.type=a.type),void 0!==a.encoding&&(s.encoding=a.encoding),void 0!==a.minFilter&&(s.minFilter=i(a.minFilter,iu)),void 0!==a.magFilter&&(s.magFilter=i(a.magFilter,iu)),void 0!==a.anisotropy&&(s.anisotropy=a.anisotropy),void 0!==a.flipY&&(s.flipY=a.flipY),void 0!==a.premultiplyAlpha&&(s.premultiplyAlpha=a.premultiplyAlpha),void 0!==a.unpackAlignment&&(s.unpackAlignment=a.unpackAlignment),n[a.uuid]=s}return n}parseObject(t,e,i){let n,r,a;function s(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function o(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}switch(t.type){case"Scene":n=new $s,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new On(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new Qs(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new Ks(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new Cr(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new Uc(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"AmbientLight":n=new jc(t.color,t.intensity);break;case"DirectionalLight":n=new Hc(t.color,t.intensity);break;case"PointLight":n=new Bc(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new Vc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new zc(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new Dc(t.color,t.groundColor,t.intensity);break;case"LightProbe":n=(new qc).fromJSON(t);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":n=new br(r=s(t.geometry),a=o(t.material));break;case"InstancedMesh":r=s(t.geometry),a=o(t.material);const e=t.count,i=t.instanceMatrix;(n=new Ro(r,a,e)).instanceMatrix=new zn(new Float32Array(i.array),16);break;case"LOD":n=new _o;break;case"Line":n=new Bo(s(t.geometry),o(t.material),t.mode);break;case"LineLoop":n=new jo(s(t.geometry),o(t.material));break;case"LineSegments":n=new Ho(s(t.geometry),o(t.material));break;case"PointCloud":case"Points":n=new Zo(s(t.geometry),o(t.material));break;case"Sprite":n=new yo(o(t.material));break;case"Group":n=new Ws;break;default:n=new ln}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(n.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(n.matrixAutoUpdate=t.matrixAutoUpdate),n.matrixAutoUpdate&&n.matrix.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(n.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.frustumCulled&&(n.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(n.renderOrder=t.renderOrder),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.layers&&(n.layers.mask=t.layers),void 0!==t.children){const r=t.children;for(let t=0;t<r.length;t++)n.add(this.parseObject(r[t],e,i))}if("LOD"===t.type){void 0!==t.autoUpdate&&(n.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],r=n.getObjectByProperty("uuid",i.object);void 0!==r&&n.addLevel(r,i.distance)}}return n}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}const tu={UVMapping:300,CubeReflectionMapping:Z,CubeRefractionMapping:J,EquirectangularReflectionMapping:K,EquirectangularRefractionMapping:Q,CubeUVReflectionMapping:$,CubeUVRefractionMapping:tt},eu={RepeatWrapping:et,ClampToEdgeWrapping:it,MirroredRepeatWrapping:nt},iu={NearestFilter:rt,NearestMipmapNearestFilter:at,NearestMipmapLinearFilter:st,LinearFilter:ot,LinearMipmapNearestFilter:lt,LinearMipmapLinearFilter:ht};function nu(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ec.call(this,t),this.options={premultiplyAlpha:"none"}}function ru(){this.type="ShapePath",this.color=new On,this.subPaths=[],this.currentPath=null}function au(t){this.type="Font",this.data=t}function su(t,e,i,n,r){const a=r.glyphs[t]||r.glyphs["?"];if(!a)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+r.familyName+".");const s=new ru;let o,l,h,c,u,p,d,m;if(a.o){const t=a._cachedOutline||(a._cachedOutline=a.o.split(" "));for(let r=0,a=t.length;r<a;){switch(t[r++]){case"m":o=t[r++]*e+i,l=t[r++]*e+n,s.moveTo(o,l);break;case"l":o=t[r++]*e+i,l=t[r++]*e+n,s.lineTo(o,l);break;case"q":h=t[r++]*e+i,c=t[r++]*e+n,u=t[r++]*e+i,p=t[r++]*e+n,s.quadraticCurveTo(u,p,h,c);break;case"b":h=t[r++]*e+i,c=t[r++]*e+n,u=t[r++]*e+i,p=t[r++]*e+n,d=t[r++]*e+i,m=t[r++]*e+n,s.bezierCurveTo(u,p,d,m,h,c)}}}return{offsetX:a.ha*e,path:s}}function ou(t){ec.call(this,t)}let lu;nu.prototype=Object.assign(Object.create(ec.prototype),{constructor:nu,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,a=Qh.get(t);if(void 0!==a)return r.manager.itemStart(t),setTimeout(function(){e&&e(a),r.manager.itemEnd(t)},0),a;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(t,s).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,r.options)}).then(function(i){Qh.add(t,i),e&&e(i),r.manager.itemEnd(t)}).catch(function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}),Object.assign(ru.prototype,{moveTo:function(t,e){return this.currentPath=new Cc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this},bezierCurveTo:function(t,e,i,n,r,a){return this.currentPath.bezierCurveTo(t,e,i,n,r,a),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function i(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new Rc;r.curves=n.curves,e.push(r)}return e}function n(t,e){const i=e.length;let n=!1;for(let r=i-1,a=0;a<i;r=a++){let i=e[r],s=e[a],o=s.x-i.x,l=s.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[a],o=-o,s=e[r],l=-l),t.y<i.y||t.y>s.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(s.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=s.x)return!0}}return n}const r=ql.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===e)return i(a);let s,o,l;const h=[];if(1===a.length)return o=a[0],(l=new Rc).curves=o.curves,h.push(l),h;let c=!r(a[0].getPoints());c=t?!c:c;const u=[],p=[];let d,m,f=[],g=0;p[g]=void 0,f[g]=[];for(let e=0,i=a.length;e<i;e++)s=r(d=(o=a[e]).getPoints()),(s=t?!s:s)?(!c&&p[g]&&g++,p[g]={s:new Rc,p:d},p[g].s.curves=o.curves,c&&g++,f[g]=[]):f[g].push({h:o,p:d[0]});if(!p[0])return i(a);if(p.length>1){let t=!1;const e=[];for(let t=0,e=p.length;t<e;t++)u[t]=[];for(let i=0,r=p.length;i<r;i++){const r=f[i];for(let a=0;a<r.length;a++){const s=r[a];let o=!0;for(let r=0;r<p.length;r++)n(s.p,p[r].p)&&(i!==r&&e.push({froms:i,tos:r,hole:a}),o?(o=!1,u[r].push(s)):t=!0);o&&u[i].push(s)}}e.length>0&&(t||(f=u))}for(let t=0,e=p.length;t<e;t++){l=p[t].s,h.push(l);for(let e=0,i=(m=f[t]).length;e<i;e++)l.holes.push(m[e].h)}return h}}),Object.assign(au.prototype,{isFont:!0,generateShapes:function(t,e){void 0===e&&(e=100);const i=[],n=function(t,e,i){const n=Array.from?Array.from(t):String(t).split(""),r=e/i.resolution,a=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*r,s=[];let o=0,l=0;for(let t=0;t<n.length;t++){const e=n[t];if("\n"===e)o=0,l-=a;else{const t=su(e,r,o,l,i);o+=t.offsetX,s.push(t.path)}}return s}(t,e,this.data);for(let t=0,e=n.length;t<e;t++)Array.prototype.push.apply(i,n[t].toShapes());return i}}),ou.prototype=Object.assign(Object.create(ec.prototype),{constructor:ou,load:function(t,e,i,n){const r=this,a=new nc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(t){let i;try{i=JSON.parse(t)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(t.substring(65,t.length-2))}const n=r.parse(i);e&&e(n)},i,n)},parse:function(t){return new au(t)}});const hu={getContext:function(){return void 0===lu&&(lu=new(window.AudioContext||window.webkitAudioContext)),lu},setContext:function(t){lu=t}};function cu(t){ec.call(this,t)}function uu(t,e,i){qc.call(this,void 0,i);const n=(new On).set(t),r=(new On).set(e),a=new li(n.r,n.g,n.b),s=new li(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(s).multiplyScalar(o),this.sh.coefficients[1].copy(a).sub(s).multiplyScalar(l)}function pu(t,e){qc.call(this,void 0,e);const i=(new On).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}cu.prototype=Object.assign(Object.create(ec.prototype),{constructor:cu,load:function(t,e,i,n){const r=this,a=new nc(r.manager);a.setResponseType("arraybuffer"),a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,function(i){try{const a=i.slice(0);hu.getContext().decodeAudioData(a,function(t){e(t)})}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}},i,n)}}),uu.prototype=Object.assign(Object.create(qc.prototype),{constructor:uu,isHemisphereLightProbe:!0,copy:function(t){return qc.prototype.copy.call(this,t),this},toJSON:function(t){return qc.prototype.toJSON.call(this,t)}}),pu.prototype=Object.assign(Object.create(qc.prototype),{constructor:pu,isAmbientLightProbe:!0,copy:function(t){return qc.prototype.copy.call(this,t),this},toJSON:function(t){return qc.prototype.toJSON.call(this,t)}});const du=new Fi,mu=new Fi;function fu(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Cr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Cr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(fu.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const i=t.projectionMatrix.clone(),n=e.eyeSep/2,r=n*e.near/e.focus,a=e.near*Math.tan(Ke.DEG2RAD*e.fov*.5)/e.zoom;let s,o;mu.elements[12]=-n,du.elements[12]=n,s=-a*e.aspect+r,o=a*e.aspect+r,i.elements[0]=2*e.near/(o-s),i.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(i),s=-a*e.aspect-r,o=a*e.aspect-r,i.elements[0]=2*e.near/(o-s),i.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(mu),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(du)}});class gu{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}const vu=new li,yu=new oi,xu=new li,bu=new li;class wu extends ln{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t){if(void 0===t&&(t=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const _u=new li,Mu=new oi,Su=new li,Tu=new li;class Eu{constructor(t,e){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=void 0!==e?e:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}}function Au(t,e,i){let n,r,a;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(Au.prototype,{accumulate:function(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let a=this.cumulativeWeight;if(0===a){for(let t=0;t!==n;++t)i[r+t]=i[t];a=e}else{const t=e/(a+=e);this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=a},accumulateAdditive:function(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,a=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}a>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){s.setValue(i,n);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]},_select:function(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]},_slerp:function(t,e,i,n){oi.slerpFlat(t,e,t,e,t,i,n)},_slerpAdditive:function(t,e,i,n,r){const a=this._workIndex*r;oi.multiplyQuaternionsFlat(t,a,t,e,t,i),oi.slerpFlat(t,e,t,e,t,a,n)},_lerp:function(t,e,i,n,r){const a=1-n;for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]*a+t[i+s]*n}},_lerpAdditive:function(t,e,i,n,r){for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]+t[i+a]*n}}});const Pu=new RegExp("[\\[\\]\\.:\\/]","g"),Lu="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Ou=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Cu=/(WCOD+)?/.source.replace("WCOD",Lu),Ru=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Iu=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Du=new RegExp("^"+Ou+Cu+Ru+Iu+"$"),Nu=["material","materials","bones"];function Fu(t,e,i){const n=i||zu.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}function zu(t,e,i){this.path=e,this.parsedPath=i||zu.parseTrackName(e),this.node=zu.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function ku(){this.uuid=Ke.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}Object.assign(Fu.prototype,{getValue:function(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)},setValue:function(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)},bind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()},unbind:function(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}}),Object.assign(zu,{Composite:Fu,create:function(t,e,i){return t&&t.isAnimationObjectGroup?new zu.Composite(t,e,i):new zu(t,e,i)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(Pu,"")},parseTrackName:function(t){const e=Du.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==Nu.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const a=i(r.children);if(a)return a}return null},n=i(t.children);if(n)return n}return null}}),Object.assign(zu.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]},function(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=zu.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const a=t[n];if(void 0===a){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let s=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=r}else void 0!==a.fromArray&&void 0!==a.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(o=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][s]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(zu.prototype,{_getValue_unbound:zu.prototype.getValue,_setValue_unbound:zu.prototype.setValue}),Object.assign(ku.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,a=r.length;let s=void 0,o=t.length,l=this.nCachedObjects_;for(let h=0,c=arguments.length;h!==c;++h){const c=arguments[h],u=c.uuid;let p=e[u];if(void 0===p){p=o++,e[u]=p,t.push(c);for(let t=0,e=a;t!==e;++t)r[t].push(new zu(c,i[t],n[t]))}else if(p<l){s=t[p];const o=--l,h=t[o];e[h.uuid]=p,t[p]=h,e[u]=o,t[o]=c;for(let t=0,e=a;t!==e;++t){const e=r[t],a=e[o];let s=e[p];e[p]=a,void 0===s&&(s=new zu(c,i[t],n[t])),e[o]=s}}else t[p]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let a=0,s=arguments.length;a!==s;++a){const s=arguments[a],o=s.uuid,l=e[o];if(void 0!==l&&l>=r){const a=r++,h=t[a];e[h.uuid]=l,t[l]=h,e[o]=a,t[a]=s;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[a],r=e[l];e[l]=n,e[a]=r}}}this.nCachedObjects_=r},uncache:function(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,a=t.length;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const s=--r,o=t[s],h=--a,c=t[h];e[o.uuid]=l,t[l]=o,e[c.uuid]=s,t[s]=c,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[h];e[l]=n,e[s]=r,e.pop()}}else{const r=--a,s=t[r];r>0&&(e[s.uuid]=l),t[l]=s,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r},subscribe_:function(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const a=this._paths,s=this._parsedPaths,o=this._objects,l=o.length,h=this.nCachedObjects_,c=new Array(l);n=r.length,i[t]=n,a.push(t),s.push(e),r.push(c);for(let i=h,n=o.length;i!==n;++i){const n=o[i];c[i]=new zu(n,t,e)}return c},unsubscribe_:function(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,a=this._bindings,s=a.length-1,o=a[s];e[t[s]]=i,a[i]=o,a.pop(),r[i]=r[s],r.pop(),n[i]=n[s],n.pop()}}});class Bu{constructor(t,e,i,n){this._mixer=t,this._clip=e,this._localRoot=i||null,this.blendMode=n||e.blendMode;const r=e.tracks,a=r.length,s=new Array(a),o={endingStart:Te,endingEnd:Te};for(let t=0;t!==a;++t){const e=r[t].createInterpolant(null);s[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=s,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Me,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,a=i/n;t.warp(1,r,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,a=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=n._lendControlInterpolant(),this._timeScaleInterpolant=s);const o=s.parameterPositions,l=s.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/a,l[1]=e/a,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;if(n<0||0===i)return;this._startTime=null,e=i*n}e*=this._updateTimeScale(t);const a=this._updateTime(e),s=this._updateWeight(t);if(s>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case Le:for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(a),e[i].accumulateAdditive(s);break;case Pe:default:for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(a),e[i].accumulate(n,s)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const a=i===Se;if(0===t)return-1===r?n:a&&1==(1&r)?e-n:n;if(i===_e){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const s=this.repetitions-r;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){const e=t<0;this._setEndings(e,!e,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(a&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=Ee,n.endingEnd=Ee):(n.endingStart=t?this.zeroSlopeAtStart?Ee:Te:Ae,n.endingEnd=e?this.zeroSlopeAtEnd?Ee:Te:Ae)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let a=this._weightInterpolant;null===a&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const s=a.parameterPositions,o=a.sampleValues;return s[0]=r,o[0]=e,s[1]=r+t,o[1]=i,this}}function Uu(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Uu.prototype=Object.assign(Object.create(Ye.prototype),{constructor:Uu,_bindAction:function(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,a=t._propertyBindings,s=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let h=l[o];void 0===h&&(h={},l[o]=h);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let c=h[l];if(void 0!==c)a[t]=c;else{if(void 0!==(c=a[t])){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;++(c=new Au(zu.create(i,l,n),r.ValueTypeName,r.getValueSize())).referenceCount,this._addInactiveBinding(c,o,l),a[t]=c}s[t].resultBuffer=c.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,i){const n=this._actions,r=this._actionsByClip;let a=r[e];if(void 0===a)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=a;else{const e=a.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),a.actionByRoot[i]=t},_removeInactiveAction:function(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,a=this._actionsByClip,s=a[r],o=s.knownActions,l=o[o.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,o[h]=l,o.pop(),t._byClipCacheIndex=null,delete s.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete a[r],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackAction:function(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_addInactiveBinding:function(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let a=n[e];void 0===a&&(a={},n[e]=a),a[i]=t,t._cacheIndex=r.length,r.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,a=this._bindingsByRootAndName,s=a[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete s[r],0===Object.keys(s).length&&delete a[n]},_lendBinding:function(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_takeBackBinding:function(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&((i=new Uh(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=e,t[e]=i),i},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,i){const n=e||this._root,r=n.uuid;let a="string"==typeof t?Jh.findByName(n,t):t;const s=null!==a?a.uuid:t,o=this._actionsByClip[s];let l=null;if(void 0===i&&(i=null!==a?a.blendMode:Pe),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;const h=new Bu(this,a,e,i);return this._bindAction(h,l),this._addInactiveAction(h,s,r),h},existingAction:function(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?Jh.findByName(i,t):t,a=r?r.uuid:t,s=this._actionsByClip[a];return void 0!==s&&s.actionByRoot[n]||null},stopAllAction:function(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),a=this._accuIndex^=1;for(let s=0;s!==i;++s){e[s]._update(n,t,r,a)}const s=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)s[t].apply(a);return this},setTime:function(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,a=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,a._cacheIndex=r,e[r]=a,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}},uncacheRoot:function(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}});class Gu{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Gu(void 0===this.value.clone?this.value:this.value.clone())}}function Hu(t,e,i){to.call(this,t,e),this.meshPerAttribute=i||1}function ju(t,e,i,n,r){this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}function Vu(t,e,i,n){this.ray=new Ni(t,e),this.near=i||0,this.far=n||1/0,this.camera=null,this.layers=new Xi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Wu(t,e){return t.distance-e.distance}function qu(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)qu(n[t],e,i,!0)}}Hu.prototype=Object.assign(Object.create(to.prototype),{constructor:Hu,isInstancedInterleavedBuffer:!0,copy:function(t){return to.prototype.copy.call(this,t),this.meshPerAttribute=t.meshPerAttribute,this},clone:function(t){const e=to.prototype.clone.call(this,t);return e.meshPerAttribute=this.meshPerAttribute,e},toJSON:function(t){const e=to.prototype.toJSON.call(this,t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}),Object.defineProperty(ju.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(ju.prototype,{isGLBufferAttribute:!0,setBuffer:function(t){return this.buffer=t,this},setType:function(t,e){return this.type=t,this.elementSize=e,this},setItemSize:function(t){return this.itemSize=t,this},setCount:function(t){return this.count=t,this}}),Object.assign(Vu.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(t,e,i){const n=i||[];return qu(t,this,n,e),n.sort(Wu),n},intersectObjects:function(t,e,i){const n=i||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(let i=0,r=t.length;i<r;i++)qu(t[i],this,n,e);return n.sort(Wu),n}});const Xu=new Qe;class Yu{constructor(t,e){Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new Qe(1/0,1/0),this.max=void 0!==e?e:new Qe(-1/0,-1/0)}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Xu.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new Qe),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new Qe),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new Qe),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new Qe),e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Xu.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Zu=new li,Ju=new li;class Ku{constructor(t,e){this.start=void 0!==t?t:new li,this.end=void 0!==e?e:new li}set(t,e){return this.start.copy(t),this.end.copy(e),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new li),t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new li),t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new li),this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Zu.subVectors(t,this.start),Ju.subVectors(this.end,this.start);const i=Ju.dot(Ju);let n=Ju.dot(Zu)/i;return e&&(n=Ke.clamp(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return void 0===i&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new li),this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}}function Qu(t){ln.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Qu.prototype=Object.create(ln.prototype),Qu.prototype.constructor=Qu,Qu.prototype.isImmediateRenderObject=!0;const $u=new li;const tp=new li,ep=new Fi,ip=new Fi;class np extends Ho{constructor(t){const e=function t(e){const i=[];e&&e.isBone&&i.push(e);for(let n=0;n<e.children.length;n++)i.push.apply(i,t(e.children[n]));return i}(t),i=new ir,n=[],r=[],a=new On(0,0,1),s=new On(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(a.r,a.g,a.b),r.push(s.r,s.g,s.b))}i.setAttribute("position",new Wn(n,3)),i.setAttribute("color",new Wn(r,3)),super(i,new Io({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");ip.getInverse(this.root.matrixWorld);for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(ep.multiplyMatrices(ip,r.matrixWorld),tp.setFromMatrixPosition(ep),n.setXYZ(i,tp.x,tp.y,tp.z),ep.multiplyMatrices(ip,r.parent.matrixWorld),tp.setFromMatrixPosition(ep),n.setXYZ(i+1,tp.x,tp.y,tp.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}const rp=new li,ap=new On,sp=new On;class op extends Ho{constructor(t,e,i,n){t=t||10,e=e||10,i=new On(void 0!==i?i:4473924),n=new On(void 0!==n?n:8947848);const r=e/2,a=t/e,s=t/2,o=[],l=[];for(let t=0,h=0,c=-s;t<=e;t++,c+=a){o.push(-s,0,c,s,0,c),o.push(c,0,-s,c,0,s);const e=t===r?i:n;e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3,e.toArray(l,h),h+=3}const h=new ir;h.setAttribute("position",new Wn(o,3)),h.setAttribute("color",new Wn(l,3)),super(h,new Io({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const lp=new li,hp=new li,cp=new li;const up=new li,pp=new Or;function dp(t,e,i,n,r,a,s){up.set(r,a,s).unproject(n);const o=e[t];if(void 0!==o){const t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],up.x,up.y,up.z)}}const mp=new ui;class fp extends Ho{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new ir;r.setIndex(new zn(i,1)),r.setAttribute("position",new zn(n,3)),super(r,new Io({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&mp.setFromObject(this.object),mp.isEmpty())return;const e=mp.min,i=mp.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return Ho.prototype.copy.call(this,t),this.object=t.object,this}}const gp=new li;let vp,yp;class xp extends ln{constructor(t,e,i,n,r,a){super(),this.type="ArrowHelper",void 0===t&&(t=new li(0,0,1)),void 0===e&&(e=new li(0,0,0)),void 0===i&&(i=1),void 0===n&&(n=16776960),void 0===r&&(r=.2*i),void 0===a&&(a=.2*r),void 0===vp&&((vp=new ir).setAttribute("position",new Wn([0,0,0,0,1,0],3)),(yp=new hl(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(e),this.line=new Bo(vp,new Io({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new br(yp,new Dn({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,a)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{gp.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(gp,e)}}setLength(t,e,i){void 0===e&&(e=.2*t),void 0===i&&(i=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}}class bp extends Ho{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new ir;i.setAttribute("position",new Wn(e,3)),i.setAttribute("color",new Wn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(i,new Io({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}}const wp=4,_p=8,Mp=Math.pow(2,_p),Sp=[.125,.215,.35,.446,.526,.582],Tp=_p-wp+1+Sp.length,Ep=20,Ap={[Ce]:0,[Re]:1,[De]:2,[Fe]:3,[ze]:4,[ke]:5,[Ie]:6},Pp=new Uc,{_lodPlanes:Lp,_sizeLods:Op,_sigmas:Cp}=zp();let Rp=null;const Ip=(1+Math.sqrt(5))/2,Dp=1/Ip,Np=[new li(1,1,1),new li(-1,1,1),new li(1,1,-1),new li(-1,1,-1),new li(0,Ip,Dp),new li(0,Ip,-Dp),new li(Dp,0,Ip),new li(-Dp,0,Ip),new li(Ip,Dp,0),new li(-Ip,Dp,0)];function Fp(t){return void 0!==t&&t.type===ct&&(t.encoding===Ce||t.encoding===Re||t.encoding===Ie)}function zp(){const t=[],e=[],i=[];let n=_p;for(let r=0;r<Tp;r++){const a=Math.pow(2,n);e.push(a);let s=1/a;r>_p-wp?s=Sp[r-_p+wp-1]:0==r&&(s=0),i.push(s);const o=1/(a-1),l=-o/2,h=1+o/2,c=[l,l,h,l,h,h,l,l,h,h,l,h],u=6,p=6,d=3,m=2,f=1,g=new Float32Array(d*p*u),v=new Float32Array(m*p*u),y=new Float32Array(f*p*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];g.set(n,d*p*t),v.set(c,m*p*t);const r=[t,t,t,t,t,t];y.set(r,f*p*t)}const x=new ir;x.setAttribute("position",new zn(g,d)),x.setAttribute("uv",new zn(v,m)),x.setAttribute("faceIndex",new zn(y,f)),t.push(x),n>wp&&n--}return{_lodPlanes:t,_sizeLods:e,_sigmas:i}}function kp(t){const e=new ai(3*Mp,3*Mp,t);return e.texture.mapping=$,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Bp(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Up(){return new Ah({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new Qe(1,1)},inputEncoding:{value:Ap[Ce]},outputEncoding:{value:Ap[Ce]}},vertexShader:Hp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${jp()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:c,depthTest:!1,depthWrite:!1})}function Gp(){return new Ah({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:Ap[Ce]},outputEncoding:{value:Ap[Ce]}},vertexShader:Hp(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${jp()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:c,depthTest:!1,depthWrite:!1})}function Hp(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function jp(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}const Vp=1,Wp=2;function qp(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t}function Xp(t){return void 0===t&&(t=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t}function Yp(t){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),yc.call(this,t),this.type="catmullrom",this.closed=!0}function Zp(t){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),yc.call(this,t),this.type="catmullrom"}function Jp(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),yc.call(this,t),this.type="catmullrom"}function Kp(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new nc(t)}cc.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(cc.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(Oc.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new al;for(let i=0,n=t.length;i<n;i++){const n=t[i];e.vertices.push(new li(n.x,n.y,n.z||0))}return e}}),Object.assign(Cc.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Yp.prototype=Object.create(yc.prototype),Zp.prototype=Object.create(yc.prototype),Jp.prototype=Object.create(yc.prototype),Object.assign(Jp.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),op.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},np.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ec.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Yc.extractUrlBase(t)}}),ec.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Yu.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(ui.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Ai.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),Ur.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Ku.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(Ke,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Ke.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Ke.ceilPowerOfTwo(t)}}),Object.assign($e.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Fi.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new li).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,i,n,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,n,i,r,a)}}),pn.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},oi.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(Ni.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(Mn.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(Mn,{barycoordFromPoint:function(t,e,i,n,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Mn.getBarycoord(t,e,i,n,r)},normal:function(t,e,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Mn.getNormal(t,e,i,n)}}),Object.assign(Rc.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Kl(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new uh(this,t)}}),Object.assign(Qe.prototype,{fromAttribute:function(t,e,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(li.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ri.prototype,{fromAttribute:function(t,e,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(al.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(ln.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(ln.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(br.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(br.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(_o.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Eo.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Mo.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(cc.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),Cr.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(Ic.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(zn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===qe},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(qe)}}}),Object.assign(zn.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?qe:We),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ir.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new zn(arguments[1],arguments[2])))},addDrawCall:function(t,e,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(ir.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Zc.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(Vu.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(to.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===qe},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(to.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?qe:We),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Zl.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.assign($s.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties(Gu.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(In.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new On}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(Oh.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Lh.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),Object.defineProperties(Lr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Zs.prototype,{clearTarget:function(t,e,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,i,n)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Zs.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?Re:Ce}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Us.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ai.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(wu.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new cu).load(t,function(t){e.setBuffer(t)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),Eu.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Dr.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},Dr.prototype.clear=function(t,e,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,i,n)};const Qp={merge:function(t,e,i){let n;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),e.isMesh&&(e.matrixAutoUpdate&&e.updateMatrix(),n=e.matrix,e=e.geometry),t.merge(e,n,i)},center:function(t){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),t.center()}};ei.crossOrigin=void 0,ei.loadTexture=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new hc;r.setCrossOrigin(this.crossOrigin);const a=r.load(t,i,void 0,n);return e&&(a.mapping=e),a},ei.loadTextureCube=function(t,e,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new oc;r.setCrossOrigin(this.crossOrigin);const a=r.load(t,i,void 0,n);return e&&(a.mapping=e),a},ei.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ei.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const $p={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"122"}}));var td=Object.freeze({ACESFilmicToneMapping:X,AddEquation:g,AddOperation:H,AdditiveAnimationBlendMode:Le,AdditiveBlending:p,AlphaFormat:_t,AlwaysDepth:I,AlwaysStencilFunc:Ve,AmbientLight:jc,AmbientLightProbe:pu,AnimationClip:Jh,AnimationLoader:rc,AnimationMixer:Uu,AnimationObjectGroup:ku,AnimationUtils:zh,ArcCurve:pc,ArrayCamera:Vs,ArrowHelper:xp,Audio:wu,AudioAnalyser:Eu,AudioContext:hu,AudioListener:class extends ln{constructor(){super(),this.type="AudioListener",this.context=hu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new gu}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(vu,yu,xu),bu.set(0,0,-1).applyQuaternion(yu),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(vu.x,t),e.positionY.linearRampToValueAtTime(vu.y,t),e.positionZ.linearRampToValueAtTime(vu.z,t),e.forwardX.linearRampToValueAtTime(bu.x,t),e.forwardY.linearRampToValueAtTime(bu.y,t),e.forwardZ.linearRampToValueAtTime(bu.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(vu.x,vu.y,vu.z),e.setOrientation(bu.x,bu.y,bu.z,i.x,i.y,i.z)}},AudioLoader:cu,AxesHelper:bp,AxisHelper:function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new bp(t)},BackSide:l,BasicDepthPacking:Be,BasicShadowMap:0,BinaryTextureLoader:function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new lc(t)},Bone:Ao,BooleanKeyframeTrack:jh,BoundingBoxHelper:function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new fp(t,e)},Box2:Yu,Box3:ui,Box3Helper:class extends Ho{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new ir;n.setIndex(new zn(i,1)),n.setAttribute("position",new Wn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Io({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},BoxBufferGeometry:Mr,BoxGeometry:sl,BoxHelper:fp,BufferAttribute:zn,BufferGeometry:ir,BufferGeometryLoader:Kc,ByteType:ut,Cache:Qh,Camera:Or,CameraHelper:class extends Ho{constructor(t){const e=new ir,i=new Io({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],a={},s=new On(16755200),o=new On(16711680),l=new On(43775),h=new On(16777215),c=new On(3355443);function u(t,e,i){p(t,i),p(e,i)}function p(t,e){n.push(0,0,0),r.push(e.r,e.g,e.b),void 0===a[t]&&(a[t]=[]),a[t].push(n.length/3-1)}u("n1","n2",s),u("n2","n4",s),u("n4","n3",s),u("n3","n1",s),u("f1","f2",s),u("f2","f4",s),u("f4","f3",s),u("f3","f1",s),u("n1","f1",s),u("n2","f2",s),u("n3","f3",s),u("n4","f4",s),u("p","n1",o),u("p","n2",o),u("p","n3",o),u("p","n4",o),u("u1","u2",l),u("u2","u3",l),u("u3","u1",l),u("c","t",h),u("p","c",c),u("cn1","cn2",c),u("cn3","cn4",c),u("cf1","cf2",c),u("cf3","cf4",c),e.setAttribute("position",new Wn(n,3)),e.setAttribute("color",new Wn(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}update(){const t=this.geometry,e=this.pointMap;pp.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),dp("c",e,t,pp,0,0,-1),dp("t",e,t,pp,0,0,1),dp("n1",e,t,pp,-1,-1,-1),dp("n2",e,t,pp,1,-1,-1),dp("n3",e,t,pp,-1,1,-1),dp("n4",e,t,pp,1,1,-1),dp("f1",e,t,pp,-1,-1,1),dp("f2",e,t,pp,1,-1,1),dp("f3",e,t,pp,-1,1,1),dp("f4",e,t,pp,1,1,1),dp("u1",e,t,pp,.7,1.1,-1),dp("u2",e,t,pp,-.7,1.1,-1),dp("u3",e,t,pp,0,2,-1),dp("cf1",e,t,pp,-1,0,1),dp("cf2",e,t,pp,1,0,1),dp("cf3",e,t,pp,0,-1,1),dp("cf4",e,t,pp,0,1,1),dp("cn1",e,t,pp,-1,0,-1),dp("cn2",e,t,pp,1,0,-1),dp("cn3",e,t,pp,0,-1,-1),dp("cn4",e,t,pp,0,1,-1),t.getAttribute("position").needsUpdate=!0}},CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been removed")},CanvasTexture:$o,CatmullRomCurve3:yc,CineonToneMapping:q,CircleBufferGeometry:ol,CircleGeometry:ll,ClampToEdgeWrapping:it,Clock:gu,ClosedSplineCurve3:Yp,Color:On,ColorKeyframeTrack:Vh,CompressedTexture:Qo,CompressedTextureLoader:ac,ConeBufferGeometry:pl,ConeGeometry:ul,CubeCamera:Dr,CubeGeometry:sl,CubeReflectionMapping:Z,CubeRefractionMapping:J,CubeTexture:Nr,CubeTextureLoader:oc,CubeUVReflectionMapping:$,CubeUVRefractionMapping:tt,CubicBezierCurve:_c,CubicBezierCurve3:Mc,CubicInterpolant:Bh,CullFaceBack:i,CullFaceFront:n,CullFaceFrontBack:3,CullFaceNone:e,Curve:cc,CurvePath:Oc,CustomBlending:f,CustomToneMapping:Y,CylinderBufferGeometry:hl,CylinderGeometry:cl,Cylindrical:class{constructor(t,e,i){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==i?i:0,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}},DataTexture:zr,DataTexture2DArray:oa,DataTexture3D:la,DataTextureLoader:lc,DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:tc,DepthFormat:Pt,DepthStencilFormat:Lt,DepthTexture:tl,DirectionalLight:Hc,DirectionalLightHelper:class extends ln{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new ir;n.setAttribute("position",new Wn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Io({fog:!1,toneMapped:!1});this.lightPlane=new Bo(n,r),this.add(this.lightPlane),(n=new ir).setAttribute("position",new Wn([0,0,0,0,0,1],3)),this.targetLine=new Bo(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){lp.setFromMatrixPosition(this.light.matrixWorld),hp.setFromMatrixPosition(this.light.target.matrixWorld),cp.subVectors(hp,lp),this.lightPlane.lookAt(hp),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(hp),this.targetLine.scale.z=cp.length()}},DiscreteInterpolant:Gh,DodecahedronBufferGeometry:ml,DodecahedronGeometry:fl,DoubleSide:h,DstAlphaFactor:A,DstColorFactor:L,DynamicBufferAttribute:function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new zn(t,e).setUsage(qe)},DynamicCopyUsage:35050,DynamicDrawUsage:qe,DynamicReadUsage:35049,EdgesGeometry:bl,EdgesHelper:function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Ho(new bl(t.geometry),new Io({color:void 0!==e?e:16777215}))},EllipseCurve:uc,EqualDepth:F,EqualStencilFunc:514,EquirectangularReflectionMapping:K,EquirectangularRefractionMapping:Q,Euler:Vi,EventDispatcher:Ye,ExtrudeBufferGeometry:Zl,ExtrudeGeometry:Kl,Face3:Cn,Face4:function(t,e,i,n,r,a,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Cn(t,e,i,r,a,s)},FaceColors:Vp,FileLoader:nc,FlatShading:1,Float32Attribute:function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Wn(t,e)},Float32BufferAttribute:Wn,Float64Attribute:function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new qn(t,e)},Float64BufferAttribute:qn,FloatType:gt,Fog:Qs,FogExp2:Ks,Font:au,FontLoader:ou,FrontSide:o,Frustum:Ur,GLBufferAttribute:ju,GLSL1:"100",GLSL3:Xe,GammaEncoding:Ie,Geometry:al,GeometryUtils:Qp,GreaterDepth:k,GreaterEqualDepth:z,GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:op,Group:Ws,HalfFloatType:vt,HemisphereLight:Dc,HemisphereLightHelper:class extends ln{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new ih(e);n.rotateY(.5*Math.PI),this.material=new Dn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),a=new Float32Array(3*r.count);n.setAttribute("color",new zn(a,3)),this.add(new br(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");ap.copy(this.light.color),sp.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?ap:sp;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(rp.setFromMatrixPosition(this.light.matrixWorld).negate())}},HemisphereLightProbe:uu,IcosahedronBufferGeometry:Ql,IcosahedronGeometry:$l,ImageBitmapLoader:nu,ImageLoader:sc,ImageUtils:ei,ImmediateRenderObject:Qu,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Jc,InstancedBufferGeometry:Zc,InstancedInterleavedBuffer:Hu,InstancedMesh:Ro,Int16Attribute:function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Gn(t,e)},Int16BufferAttribute:Gn,Int32Attribute:function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new jn(t,e)},Int32BufferAttribute:jn,Int8Attribute:function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new kn(t,e)},Int8BufferAttribute:kn,IntType:mt,InterleavedBuffer:to,InterleavedBufferAttribute:io,Interpolant:kh,InterpolateDiscrete:2300,InterpolateLinear:2301,InterpolateSmooth:2302,InvertStencilOp:5386,JSONLoader:function(){console.error("THREE.JSONLoader has been removed.")},KeepStencilOp:je,KeyframeTrack:Hh,LOD:_o,LatheBufferGeometry:th,LatheGeometry:eh,Layers:Xi,LensFlare:function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},LessDepth:D,LessEqualDepth:N,LessEqualStencilFunc:515,LessStencilFunc:513,Light:Ic,LightProbe:qc,Line:Bo,Line3:Ku,LineBasicMaterial:Io,LineCurve:Sc,LineCurve3:Tc,LineDashedMaterial:Nh,LineLoop:jo,LinePieces:1,LineSegments:Ho,LineStrip:0,LinearEncoding:Ce,LinearFilter:ot,LinearInterpolant:Uh,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,LinearMipmapLinearFilter:ht,LinearMipmapNearestFilter:lt,LinearToneMapping:V,Loader:ec,LoaderUtils:Yc,LoadingManager:$h,LogLuvEncoding:Ne,LoopOnce:_e,LoopPingPong:Se,LoopRepeat:Me,LuminanceAlphaFormat:Et,LuminanceFormat:Tt,MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Material:In,MaterialLoader:Xc,Math:Ke,MathUtils:Ke,Matrix3:$e,Matrix4:Fi,MaxEquation:b,Mesh:br,MeshBasicMaterial:Dn,MeshDepthMaterial:Fs,MeshDistanceMaterial:zs,MeshFaceMaterial:qp,MeshLambertMaterial:Ih,MeshMatcapMaterial:Dh,MeshNormalMaterial:Rh,MeshPhongMaterial:Oh,MeshPhysicalMaterial:Lh,MeshStandardMaterial:Ph,MeshToonMaterial:Ch,MinEquation:x,MirroredRepeatWrapping:nt,MixOperation:G,MultiMaterial:Xp,MultiplyBlending:m,MultiplyOperation:U,NearestFilter:rt,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NearestMipmapLinearFilter:st,NearestMipmapNearestFilter:at,NeverDepth:R,NeverStencilFunc:512,NoBlending:c,NoColors:0,NoToneMapping:j,NormalAnimationBlendMode:Pe,NormalBlending:u,NotEqualDepth:B,NotEqualStencilFunc:517,NumberKeyframeTrack:Wh,Object3D:ln,ObjectLoader:$c,ObjectSpaceNormalMap:He,OctahedronBufferGeometry:ih,OctahedronGeometry:nh,OneFactor:_,OneMinusDstAlphaFactor:P,OneMinusDstColorFactor:O,OneMinusSrcAlphaFactor:E,OneMinusSrcColorFactor:S,OrthographicCamera:Uc,PCFShadowMap:r,PCFSoftShadowMap:a,PMREMGenerator:class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),i=new li(0,1,0);return new Ah({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:Ap[Ce]},outputEncoding:{value:Ap[Ce]}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t",blending:c,depthTest:!1,depthWrite:!1})}(Ep),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Rp=this._renderer.getRenderTarget();const r=this._allocateTargets();return this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t){return this._fromTexture(t)}fromCubemap(t){return this._fromTexture(t)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Gp(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Up(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let t=0;t<Lp.length;t++)Lp[t].dispose()}_cleanup(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(Rp),t.scissorTest=!1,Bp(t,0,0,t.width,t.height)}_fromTexture(t){Rp=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e}_allocateTargets(t){const e={magFilter:rt,minFilter:rt,generateMipmaps:!1,type:ct,format:At,encoding:Fp(t)?t.encoding:De,depthBuffer:!1},i=kp(e);return i.depthBuffer=!t,this._pingPongRenderTarget=kp(e),i}_compileMaterial(t){const e=new br(Lp[0],t);this._renderer.compile(e,Pp)}_sceneToCubeUV(t,e,i,n){const r=new Cr(90,1,e,i),a=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],o=this._renderer,l=o.outputEncoding,h=o.toneMapping,c=o.getClearColor(),u=o.getClearAlpha();o.toneMapping=j,o.outputEncoding=Ce;let p=t.background;if(p&&p.isColor){p.convertSRGBToLinear();const e=Math.max(p.r,p.g,p.b),i=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);p=p.multiplyScalar(Math.pow(2,-i));const n=(i+128)/255;o.setClearColor(p,n),t.background=null}for(let e=0;e<6;e++){const i=e%3;0==i?(r.up.set(0,a[e],0),r.lookAt(s[e],0,0)):1==i?(r.up.set(0,0,a[e]),r.lookAt(0,s[e],0)):(r.up.set(0,a[e],0),r.lookAt(0,0,s[e])),Bp(n,i*Mp,e>2?Mp:0,Mp,Mp),o.setRenderTarget(n),o.render(t,r)}o.toneMapping=h,o.outputEncoding=l,o.setClearColor(c,u)}_textureToCubeUV(t,e){const i=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=Gp()):null==this._equirectShader&&(this._equirectShader=Up());const n=t.isCubeTexture?this._cubemapShader:this._equirectShader,r=new br(Lp[0],n),a=n.uniforms;a.envMap.value=t,t.isCubeTexture||a.texelSize.value.set(1/t.image.width,1/t.image.height),a.inputEncoding.value=Ap[t.encoding],a.outputEncoding.value=Ap[e.texture.encoding],Bp(e,0,0,3*Mp,2*Mp),i.setRenderTarget(e),i.render(r,Pp)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<Tp;e++){const i=Math.sqrt(Cp[e]*Cp[e]-Cp[e-1]*Cp[e-1]),n=Np[(e-1)%Np.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,i,n,"latitudinal",r),this._halfBlur(a,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,a,s){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");const h=new br(Lp[n],l),c=l.uniforms,u=Op[i]-1,p=isFinite(r)?Math.PI/(2*u):2*Math.PI/(2*Ep-1),d=r/p,m=isFinite(r)?1+Math.floor(3*d):Ep;m>Ep&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Ep}`);const f=[];let g=0;for(let t=0;t<Ep;++t){const e=t/d,i=Math.exp(-e*e/2);f.push(i),0==t?g+=i:t<m&&(g+=2*i)}for(let t=0;t<f.length;t++)f[t]=f[t]/g;c.envMap.value=t.texture,c.samples.value=m,c.weights.value=f,c.latitudinal.value="latitudinal"===a,s&&(c.poleAxis.value=s),c.dTheta.value=p,c.mipInt.value=_p-i,c.inputEncoding.value=Ap[t.texture.encoding],c.outputEncoding.value=Ap[t.texture.encoding];const v=Op[n];Bp(e,3*Math.max(0,Mp-2*v),(0===n?0:2*Mp)+2*v*(n>_p-wp?n-_p+wp:0),3*v,2*v),o.setRenderTarget(e),o.render(h,Pp)}},ParametricBufferGeometry:rh,ParametricGeometry:ah,Particle:function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new yo(t)},ParticleBasicMaterial:function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Vo(t)},ParticleSystem:function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Zo(t,e)},ParticleSystemMaterial:function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Vo(t)},Path:Cc,PerspectiveCamera:Cr,Plane:pn,PlaneBufferGeometry:jr,PlaneGeometry:sh,PlaneHelper:class extends Bo{constructor(t,e,i){const n=void 0!==i?i:16776960,r=new ir;r.setAttribute("position",new Wn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Io({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=void 0===e?1:e;const a=new ir;a.setAttribute("position",new Wn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new br(a,new Dn({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?l:o,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},PointCloud:function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Zo(t,e)},PointCloudMaterial:function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Vo(t)},PointLight:Bc,PointLightHelper:class extends br{constructor(t,e,i){super(new ph(e,4,2),new Dn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:Zo,PointsMaterial:Vo,PolarGridHelper:class extends Ho{constructor(t,e,i,n,r,a){t=t||10,e=e||16,i=i||8,n=n||64,r=new On(void 0!==r?r:4473924),a=new On(void 0!==a?a:8947848);const s=[],o=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,h=Math.cos(n)*t;s.push(0,0,0),s.push(l,0,h);const c=1&i?r:a;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let e=0;e<=i;e++){const l=1&e?r:a,h=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*h,r=Math.cos(e)*h;s.push(i,0,r),o.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*h,r=Math.cos(e)*h,s.push(i,0,r),o.push(l.r,l.g,l.b)}}const l=new ir;l.setAttribute("position",new Wn(s,3)),l.setAttribute("color",new Wn(o,3)),super(l,new Io({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},PolyhedronBufferGeometry:dl,PolyhedronGeometry:oh,PositionalAudio:class extends wu{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(_u,Mu,Su),Tu.set(0,0,1).applyQuaternion(Mu);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(_u.x,t),e.positionY.linearRampToValueAtTime(_u.y,t),e.positionZ.linearRampToValueAtTime(_u.z,t),e.orientationX.linearRampToValueAtTime(Tu.x,t),e.orientationY.linearRampToValueAtTime(Tu.y,t),e.orientationZ.linearRampToValueAtTime(Tu.z,t)}else e.setPosition(_u.x,_u.y,_u.z),e.setOrientation(Tu.x,Tu.y,Tu.z)}},PropertyBinding:zu,PropertyMixer:Au,QuadraticBezierCurve:Ec,QuadraticBezierCurve3:Ac,Quaternion:oi,QuaternionKeyframeTrack:Xh,QuaternionLinearInterpolant:qh,REVISION:"122",RGBADepthPacking:Ue,RGBAFormat:St,RGBAIntegerFormat:Nt,RGBA_ASTC_10x10_Format:re,RGBA_ASTC_10x5_Format:ee,RGBA_ASTC_10x6_Format:ie,RGBA_ASTC_10x8_Format:ne,RGBA_ASTC_12x10_Format:ae,RGBA_ASTC_12x12_Format:se,RGBA_ASTC_4x4_Format:Xt,RGBA_ASTC_5x4_Format:Yt,RGBA_ASTC_5x5_Format:Zt,RGBA_ASTC_6x5_Format:Jt,RGBA_ASTC_6x6_Format:Kt,RGBA_ASTC_8x5_Format:Qt,RGBA_ASTC_8x6_Format:$t,RGBA_ASTC_8x8_Format:te,RGBA_BPTC_Format:oe,RGBA_ETC2_EAC_Format:qt,RGBA_PVRTC_2BPPV1_Format:jt,RGBA_PVRTC_4BPPV1_Format:Ht,RGBA_S3TC_DXT1_Format:zt,RGBA_S3TC_DXT3_Format:kt,RGBA_S3TC_DXT5_Format:Bt,RGBDEncoding:ke,RGBEEncoding:De,RGBEFormat:At,RGBFormat:Mt,RGBIntegerFormat:Dt,RGBM16Encoding:ze,RGBM7Encoding:Fe,RGB_ETC1_Format:Vt,RGB_ETC2_Format:Wt,RGB_PVRTC_2BPPV1_Format:Gt,RGB_PVRTC_4BPPV1_Format:Ut,RGB_S3TC_DXT1_Format:Ft,RGFormat:Rt,RGIntegerFormat:It,RawShaderMaterial:Ah,Ray:Ni,Raycaster:Vu,RectAreaLight:Vc,RedFormat:Ot,RedIntegerFormat:Ct,ReinhardToneMapping:W,RepeatWrapping:et,ReplaceStencilOp:7681,ReverseSubtractEquation:y,RingBufferGeometry:lh,RingGeometry:hh,SRGB8_ALPHA8_ASTC_10x10_Format:xe,SRGB8_ALPHA8_ASTC_10x5_Format:ge,SRGB8_ALPHA8_ASTC_10x6_Format:ve,SRGB8_ALPHA8_ASTC_10x8_Format:ye,SRGB8_ALPHA8_ASTC_12x10_Format:be,SRGB8_ALPHA8_ASTC_12x12_Format:we,SRGB8_ALPHA8_ASTC_4x4_Format:le,SRGB8_ALPHA8_ASTC_5x4_Format:he,SRGB8_ALPHA8_ASTC_5x5_Format:ce,SRGB8_ALPHA8_ASTC_6x5_Format:ue,SRGB8_ALPHA8_ASTC_6x6_Format:pe,SRGB8_ALPHA8_ASTC_8x5_Format:de,SRGB8_ALPHA8_ASTC_8x6_Format:me,SRGB8_ALPHA8_ASTC_8x8_Format:fe,Scene:$s,SceneUtils:$p,ShaderChunk:Vr,ShaderLib:qr,ShaderMaterial:Lr,ShadowMaterial:Eh,Shape:Rc,ShapeBufferGeometry:ch,ShapeGeometry:uh,ShapePath:ru,ShapeUtils:ql,ShortType:pt,Skeleton:Eo,SkeletonHelper:np,SkinnedMesh:Mo,SmoothShading:2,Sphere:Ai,SphereBufferGeometry:ph,SphereGeometry:dh,Spherical:class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}clone(){return(new this.constructor).copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Ke.clamp(e/this.radius,-1,1))),this}},SphericalHarmonics3:Wc,Spline:Jp,SplineCurve:Pc,SplineCurve3:Zp,SpotLight:zc,SpotLightHelper:class extends ln{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new ir,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,a=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(a),Math.sin(a),1)}i.setAttribute("position",new Wn(n,3));const r=new Io({fog:!1,toneMapped:!1});this.cone=new Ho(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),$u.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt($u),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:yo,SpriteMaterial:no,SrcAlphaFactor:T,SrcAlphaSaturateFactor:C,SrcColorFactor:M,StaticCopyUsage:35046,StaticDrawUsage:We,StaticReadUsage:35045,StereoCamera:fu,StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:Yh,SubtractEquation:v,SubtractiveBlending:d,TOUCH:{ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},TangentSpaceNormalMap:Ge,TetrahedronBufferGeometry:mh,TetrahedronGeometry:fh,TextBufferGeometry:gh,TextGeometry:vh,Texture:ni,TextureLoader:hc,TorusBufferGeometry:yh,TorusGeometry:xh,TorusKnotBufferGeometry:bh,TorusKnotGeometry:wh,Triangle:Mn,TriangleFanDrawMode:Oe,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeBufferGeometry:_h,TubeGeometry:Mh,UVMapping:300,Uint16Attribute:function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Hn(t,e)},Uint16BufferAttribute:Hn,Uint32Attribute:function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Vn(t,e)},Uint32BufferAttribute:Vn,Uint8Attribute:function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Bn(t,e)},Uint8BufferAttribute:Bn,Uint8ClampedAttribute:function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Un(t,e)},Uint8ClampedBufferAttribute:Un,Uniform:Gu,UniformsLib:Wr,UniformsUtils:Er,UnsignedByteType:ct,UnsignedInt248Type:wt,UnsignedIntType:ft,UnsignedShort4444Type:yt,UnsignedShort5551Type:xt,UnsignedShort565Type:bt,UnsignedShortType:dt,VSMShadowMap:s,Vector2:Qe,Vector3:li,Vector4:ri,VectorKeyframeTrack:Zh,Vertex:function(t,e,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new li(t,e,i)},VertexColors:Wp,VideoTexture:Ko,WebGL1Renderer:Js,WebGLCubeRenderTarget:Fr,WebGLMultisampleRenderTarget:si,WebGLRenderTarget:ai,WebGLRenderTargetCube:function(t,e,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Fr(t,i)},WebGLRenderer:Zs,WebGLUtils:js,WireframeGeometry:Sh,WireframeHelper:function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Ho(new Sh(t.geometry),new Io({color:void 0!==e?e:16777215}))},WrapAroundEnding:Ae,XHRLoader:Kp,ZeroCurvatureEnding:Te,ZeroFactor:w,ZeroSlopeEnding:Ee,ZeroStencilOp:0,sRGBEncoding:Re});function ed(t,e,i,n){var r,a;return void 0===i&&(i=!0),void 0===t.textures[e]?(a={loaded:!1,postFunctions:[],debugURL:e},t.textures[e]=a,n&&a.postFunctions.push(n),i||((r=new ni).vg={nbRefs:1},a.pending=[r]),t.loaderStatistics.textures++,a.texture=t.textureLoader.load(e,function(e){t.loaderStatistics.textures--,i||Object.keys(a.pending).forEach(function(t){a.pending[t].image=e.image,a.pending[t].needsUpdate=!0}),a.loaded=!0,Object.keys(a.postFunctions).forEach(function(t){a.postFunctions[t](a)}),a.postFunctions=null,t.requestRedraw()},void 0,function(){t.loaderStatistics.textures--}),a.texture.needsUpdate=!0,i&&((r=a.texture).vg={nbRefs:1})):(a=t.textures[e],i||((r=new ni).vg={nbRefs:1}),i?(void 0!==(r=a.texture).vg&&void 0!==r.vg.nbRefs&&r.vg.nbRefs++,n&&(a.loaded?(n(a),n=null):a.postFunctions.push(n))):a.loaded?(r.image=a.texture.image,r.needsUpdate=!0):a.pending.push(r)),r}function nd(){}function rd(t,e){al.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new ad(t,e)),this.mergeVertices()}function ad(t,e){ir.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];for(var i=this,n=[],r=[],a=0,s=t.length;a<s;a++){o(t[a])}function o(t){var a=[],s=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:100,h=void 0===e.bevelEnabled||e.bevelEnabled,c=void 0!==e.bevelThickness?e.bevelThickness:6,u=void 0!==e.bevelSize?e.bevelSize:c-2,p=void 0!==e.bevelOffset?e.bevelOffset:0,d=void 0!==e.bevelSegments?e.bevelSegments:3,m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:sd;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=e.amount);var g,v,y,x,b,w,_,M,S=void 0===e.generateTop||e.generateTop,T=void 0===e.generateBottom||e.generateBottom,E=void 0===e.generateSides||e.generateSides,A=!1;m&&(g=m.getSpacedPoints(o),A=!0,h=!1,v=m.computeFrenetFrames(o,!1),y=new li,x=new li,b=new li),h||(d=0,c=0,u=0,p=0);var P=t.extractPoints(s),L=P.shape,O=P.holes;if(!ql.isClockWise(L))for(L=L.reverse(),_=0,M=O.length;_<M;_++)w=O[_],ql.isClockWise(w)&&(O[_]=w.reverse());var C=ql.triangulateShape(L,O),R=L;for(_=0,M=O.length;_<M;_++)w=O[_],L=L.concat(w);function I(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}var D,N,F,z,k,B,U=L.length,G=C.length;function H(t,e,i){var n,r,a,s=t.x-e.x,o=t.y-e.y,l=i.x-t.x,h=i.y-t.y,c=s*s+o*o,u=s*h-o*l;if(Math.abs(u)>Number.EPSILON){var p=Math.sqrt(c),d=Math.sqrt(l*l+h*h),m=e.x-o/p,f=e.y+s/p,g=((i.x-h/d-m)*h-(i.y+l/d-f)*l)/(s*h-o*l),v=(n=m+s*g-t.x)*n+(r=f+o*g-t.y)*r;if(v<=2)return new Qe(n,r);a=Math.sqrt(v/2)}else{var y=!1;s>Number.EPSILON?l>Number.EPSILON&&(y=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(y=!0):nd.sign(o)===nd.sign(h)&&(y=!0),y?(n=-o,r=s,a=Math.sqrt(c)):(n=s,r=o,a=Math.sqrt(c/2))}return new Qe(n/a,r/a)}for(var j=[],V=0,W=R.length,q=W-1,X=V+1;V<W;V++,q++,X++)q===W&&(q=0),X===W&&(X=0),j[V]=H(R[V],R[q],R[X]);var Y,Z,J=[],K=j.concat();for(_=0,M=O.length;_<M;_++){for(w=O[_],Y=[],V=0,q=(W=w.length)-1,X=V+1;V<W;V++,q++,X++)q===W&&(q=0),X===W&&(X=0),Y[V]=H(w[V],w[q],w[X]);J.push(Y),K=K.concat(Y)}for(D=0;D<d;D++){for(F=D/d,z=c*Math.cos(F*Math.PI/2),N=u*Math.sin(F*Math.PI/2)+p,V=0,W=R.length;V<W;V++)$((k=I(R[V],j[V],N)).x,k.y,-z);for(_=0,M=O.length;_<M;_++)for(w=O[_],Y=J[_],V=0,W=w.length;V<W;V++)$((k=I(w[V],Y[V],N)).x,k.y,-z)}for(N=u+p,V=0;V<U;V++)k=h?I(L[V],K[V],N):L[V],A?(x.copy(v.normals[0]).multiplyScalar(k.x),y.copy(v.binormals[0]).multiplyScalar(k.y),b.copy(g[0]).add(x).add(y),$(b.x,b.y,b.z)):$(k.x,k.y,0);for(Z=1;Z<=o;Z++)for(V=0;V<U;V++)k=h?I(L[V],K[V],N):L[V],A?(x.copy(v.normals[Z]).multiplyScalar(k.x),y.copy(v.binormals[Z]).multiplyScalar(k.y),b.copy(g[Z]).add(x).add(y),$(b.x,b.y,b.z)):$(k.x,k.y,l/o*Z);for(D=d-1;D>=0;D--){for(F=D/d,z=c*Math.cos(F*Math.PI/2),N=u*Math.sin(F*Math.PI/2)+p,V=0,W=R.length;V<W;V++)$((k=I(R[V],j[V],N)).x,k.y,l+z);for(_=0,M=O.length;_<M;_++)for(w=O[_],Y=J[_],V=0,W=w.length;V<W;V++)k=I(w[V],Y[V],N),A?$(k.x,k.y+g[o-1].y,g[o-1].x+z):$(k.x,k.y,l+z)}function Q(t,e){var i,n;for(V=t.length;--V>=0;){i=V,(n=V-1)<0&&(n=t.length-1);var r=0,a=o+2*d;for(r=0;r<a;r++){var s=U*r,l=U*(r+1);et(e+i+s,e+n+s,e+n+l,e+i+l)}}}function $(t,e,i){a.push(t),a.push(e),a.push(i)}function tt(t,e,r){it(t),it(e),it(r);var a=n.length/3,s=f.generateTopUV(i,n,a-3,a-2,a-1);nt(s[0]),nt(s[1]),nt(s[2])}function et(t,e,r,a){it(t),it(e),it(a),it(e),it(r),it(a);var s=n.length/3,o=f.generateSideWallUV(i,n,s-6,s-3,s-2,s-1);nt(o[0]),nt(o[1]),nt(o[3]),nt(o[1]),nt(o[2]),nt(o[3])}function it(t){n.push(a[3*t+0]),n.push(a[3*t+1]),n.push(a[3*t+2])}function nt(t){r.push(t.x),r.push(t.y)}!function(){var t=n.length/3;if(h){var e=0,r=U*e;if(T)for(V=0;V<G;V++)tt((B=C[V])[2]+r,B[1]+r,B[0]+r);if(r=U*(e=o+2*d),S)for(V=0;V<G;V++)tt((B=C[V])[0]+r,B[1]+r,B[2]+r)}else{if(T)for(V=0;V<G;V++)tt((B=C[V])[2],B[1],B[0]);if(S)for(V=0;V<G;V++)tt((B=C[V])[0]+U*o,B[1]+U*o,B[2]+U*o)}i.addGroup(t,n.length/3-t,0)}(),E&&function(){var t=n.length/3,e=0;for(Q(R,e),e+=R.length,_=0,M=O.length;_<M;_++)Q(w=O[_],e),e+=w.length;i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Wn(n,3)),this.setAttribute("uv",new Wn(r,2)),this.computeVertexNormals()}nd.sign=function(t){return 0===t?0:t>0?1:-1},nd.easeIn=function(t){return t>1?1:t<0?0:1-Math.sin(Math.sqrt(1-t)*nd.PI_2)},nd.easeOut=function(t){return t>1?1:t<0?0:Math.sin(Math.sqrt(t)*nd.PI_2)},nd.easeInOut=function(t){if(t>1)return 1;if(t<0)return 0;var e=Math.sin(t*nd.PI_2);return e*e},nd.isInside2D=function(t,e){for(var i=t.x,n=t.y,r=!1,a=e,s=0,o=a.length-1;s<a.length;o=s++){var l=a[s].x,h=a[s].y,c=a[o].x,u=a[o].y;h>n!=u>n&&i<(c-l)*(n-h)/(u-h)+l&&(r=!r)}return r},nd.dot=function(t,e){return t.x*e.x+t.y*e.y},nd.squareDistanceToSegment=function(t,e){var i={x:e.end.x-e.start.x,y:e.end.y-e.start.y},n={x:t.x-e.start.x,y:t.y-e.start.y},r=nd.dot(n,i);if(r<=0)return{squareDistance:nd.dot(n,n),closestPoint:e.start};var a=nd.dot(i,i);if(r>=a){var s={x:t.x-e.end.x,y:t.y-e.end.y};return{squareDistance:nd.dot(s,s),closestPoint:e.end}}var o=Math.sqrt(a),l=i.x/o,h=i.y/o,c=r/o;return{squareDistance:nd.dot(n,n)-c*c,closestPoint:{x:e.start.x+c*l,y:e.start.y+c*h}}},nd.projectPointToPolygon=function(t,e){if(e.length<3)return t;if(nd.isInside2D(t,e))return t;for(var i=1e9,n=e[0],r=0;r<e.length-1;r++){var a=e[r],s=e[r+1],o={x:a.x-t.x,y:a.y-t.y},l={x:s.x-t.x,y:s.y-t.y};if(!(o.x*o.x>=i&&l.x*l.x>=i&&o.x*l.x>0)&&!(o.y*o.y>=i&&l.y*l.y>=i&&o.y*l.y>0)){var h=nd.squareDistanceToSegment(t,{start:a,end:s});h.squareDistance<i&&(i=h.squareDistance,n=h.closestPoint)}}return n},nd.DEG2RAD=Math.PI/180,nd.RAD2DEG=180/Math.PI,nd.TWOPI=2*Math.PI,nd.PI_2=Math.PI/2,rd.prototype=Object.create(Kl.prototype),rd.prototype.constructor=rd,ad.prototype=Object.create(Zl.prototype),ad.prototype.constructor=ad;var sd={generateTopUV:function(t,e,i,n,r){var a=e[3*i],s=e[3*i+1],o=e[3*n],l=e[3*n+1],h=e[3*r],c=e[3*r+1];return[new Qe(a,s),new Qe(o,l),new Qe(h,c)]},generateSideWallUV:function(t,e,i,n,r,a){var s=e[3*i],o=e[3*i+1],l=e[3*i+2],h=e[3*n],c=e[3*n+1],u=e[3*n+2],p=e[3*r],d=e[3*r+1],m=e[3*r+2],f=e[3*a],g=e[3*a+1],v=e[3*a+2];return Math.abs(o-c)<.01?[new Qe(s,1-l),new Qe(h,1-u),new Qe(p,1-m),new Qe(f,1-v)]:[new Qe(o,1-l),new Qe(c,1-u),new Qe(d,1-m),new Qe(g,1-v)]}},od="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ld(t,e){return t(e={exports:{}},e.exports),e.exports}var hd=ld(function(t,e){!function(e){function i(t,e,i){var n,r,a,s,p,d,m,f,g=0,v=[],y=0,x=!1,b=!1,w=[],S=[],T=!1;if(n=(i=i||{}).encoding||"UTF8",f=i.numRounds||1,a=u(e,n),f!==parseInt(f,10)||1>f)throw Error("numRounds must a integer >= 1");if(d=function(e,i){return M(e,i,t)},m=function(e,i,n,r){var a,s;if("SHA-224"!==t&&"SHA-256"!==t)throw Error("Unexpected error in SHA-2 implementation");for(a=15+(i+65>>>9<<4),s=16;e.length<=a;)e.push(0);for(e[i>>>5]|=128<<24-i%32,e[a]=i+n,n=e.length,i=0;i<n;i+=s)r=M(e.slice(i,i+s),r,t);if("SHA-224"===t)e=[r[0],r[1],r[2],r[3],r[4],r[5],r[6]];else{if("SHA-256"!==t)throw Error("Unexpected error in SHA-2 implementation");e=r}return e},"SHA-224"===t)p=512,s=224;else{if("SHA-256"!==t)throw Error("Chosen SHA variant is not supported");p=512,s=256}r=_(t),this.setHMACKey=function(e,i,a){var s;if(!0===b)throw Error("HMAC key already set");if(!0===x)throw Error("Cannot set HMAC key after finalizing hash");if(!0===T)throw Error("Cannot set HMAC key after calling update");if(e=(i=u(i,n=(a||{}).encoding||"UTF8")(e)).binLen,i=i.value,a=(s=p>>>3)/4-1,s<e/8){for(i=m(i,e,0,_(t));i.length<=a;)i.push(0);i[a]&=4294967040}else if(s>e/8){for(;i.length<=a;)i.push(0);i[a]&=4294967040}for(e=0;e<=a;e+=1)w[e]=909522486^i[e],S[e]=1549556828^i[e];r=d(w,r),g=p,b=!0},this.update=function(t){var e,i,n,s=0,o=p>>>5;for(t=(e=a(t,v,y)).binLen,i=e.value,e=t>>>5,n=0;n<e;n+=o)s+p<=t&&(r=d(i.slice(n,n+o),r),s+=p);g+=s,v=i.slice(s>>>5),y=t%p,T=!0},this.getHash=function(e,i){var n,a,u;if(!0===b)throw Error("Cannot call getHash after setting HMAC key");switch(u=c(i),e){case"HEX":n=function(t){return o(t,u)};break;case"B64":n=function(t){return l(t,u)};break;case"BYTES":n=h;break;default:throw Error("format must be HEX, B64, or BYTES")}if(!1===x)for(r=m(v,y,g,r),a=1;a<f;a+=1)r=m(r,s,0,_(t));return x=!0,n(r)},this.getHMAC=function(e,i){var n,a,u;if(!1===b)throw Error("Cannot call getHMAC without first setting HMAC key");switch(u=c(i),e){case"HEX":n=function(t){return o(t,u)};break;case"B64":n=function(t){return l(t,u)};break;case"BYTES":n=h;break;default:throw Error("outputFormat must be HEX, B64, or BYTES")}return!1===x&&(a=m(v,y,g,r),r=d(S,_(t)),r=m(a,s,p,r)),x=!0,n(r)}}function n(){}function r(t,e,i){var n,r,a,s,o,l=t.length;if(e=e||[0],o=(i=i||0)>>>3,0!=l%2)throw Error("String of HEX type must be in byte increments");for(n=0;n<l;n+=2){if(r=parseInt(t.substr(n,2),16),isNaN(r))throw Error("String of HEX type contains invalid characters");for(a=(s=(n>>>1)+o)>>>2;e.length<=a;)e.push(0);e[a]|=r<<8*(3-s%4)}return{value:e,binLen:4*l+i}}function a(t,e,i){var n,r,a,s,o=[];o=e||[0];for(r=(i=i||0)>>>3,n=0;n<t.length;n+=1)e=t.charCodeAt(n),a=(s=n+r)>>>2,o.length<=a&&o.push(0),o[a]|=e<<8*(3-s%4);return{value:o,binLen:8*t.length+i}}function s(t,e,i){var n,r,a,s,o,l,h=[],c=0;h=e||[0];if(e=(i=i||0)>>>3,-1===t.search(/^[a-zA-Z0-9=+\/]+$/))throw Error("Invalid character in base-64 string");if(r=t.indexOf("="),t=t.replace(/\=/g,""),-1!==r&&r<t.length)throw Error("Invalid '=' found in base-64 string");for(r=0;r<t.length;r+=4){for(o=t.substr(r,4),a=s=0;a<o.length;a+=1)s|=(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(o[a]))<<18-6*a;for(a=0;a<o.length-1;a+=1){for(n=(l=c+e)>>>2;h.length<=n;)h.push(0);h[n]|=(s>>>16-8*a&255)<<8*(3-l%4),c+=1}}return{value:h,binLen:8*c+i}}function o(t,e){var i,n,r="",a=4*t.length;for(i=0;i<a;i+=1)n=t[i>>>2]>>>8*(3-i%4),r+="0123456789abcdef".charAt(n>>>4&15)+"0123456789abcdef".charAt(15&n);return e.outputUpper?r.toUpperCase():r}function l(t,e){var i,n,r,a="",s=4*t.length;for(i=0;i<s;i+=3)for(r=i+1>>>2,n=t.length<=r?0:t[r],r=i+2>>>2,r=t.length<=r?0:t[r],r=(t[i>>>2]>>>8*(3-i%4)&255)<<16|(n>>>8*(3-(i+1)%4)&255)<<8|r>>>8*(3-(i+2)%4)&255,n=0;4>n;n+=1)8*i+6*n<=32*t.length?a+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>>6*(3-n)&63):a+=e.b64Pad;return a}function h(t){var e,i,n="",r=4*t.length;for(e=0;e<r;e+=1)i=t[e>>>2]>>>8*(3-e%4)&255,n+=String.fromCharCode(i);return n}function c(t){var e={outputUpper:!1,b64Pad:"="};if(t=t||{},e.outputUpper=t.outputUpper||!1,!0===t.hasOwnProperty("b64Pad")&&(e.b64Pad=t.b64Pad),"boolean"!=typeof e.outputUpper)throw Error("Invalid outputUpper formatting option");if("string"!=typeof e.b64Pad)throw Error("Invalid b64Pad formatting option");return e}function u(t,e){var i;switch(e){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(t){case"HEX":i=r;break;case"TEXT":i=function(t,i,n){var r,a,s,o,l,h=[],c=[],u=0;h=i||[0];if(s=(i=n||0)>>>3,"UTF8"===e)for(r=0;r<t.length;r+=1)for(c=[],128>(n=t.charCodeAt(r))?c.push(n):2048>n?(c.push(192|n>>>6),c.push(128|63&n)):55296>n||57344<=n?c.push(224|n>>>12,128|n>>>6&63,128|63&n):(r+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(r)),c.push(240|n>>>18,128|n>>>12&63,128|n>>>6&63,128|63&n)),a=0;a<c.length;a+=1){for(o=(l=u+s)>>>2;h.length<=o;)h.push(0);h[o]|=c[a]<<8*(3-l%4),u+=1}else if("UTF16BE"===e||"UTF16LE"===e)for(r=0;r<t.length;r+=1){for(n=t.charCodeAt(r),"UTF16LE"===e&&(n=(a=255&n)<<8|n>>>8),o=(l=u+s)>>>2;h.length<=o;)h.push(0);h[o]|=n<<8*(2-l%4),u+=2}return{value:h,binLen:8*u+i}};break;case"B64":i=s;break;case"BYTES":i=a;break;default:throw Error("format must be HEX, TEXT, B64, or BYTES")}return i}function p(t,e){return t>>>e|t<<32-e}function d(t,e,i){return t&e^~t&i}function m(t,e,i){return t&e^t&i^e&i}function f(t){return p(t,2)^p(t,13)^p(t,22)}function g(t){return p(t,6)^p(t,11)^p(t,25)}function v(t){return p(t,7)^p(t,18)^t>>>3}function y(t){return p(t,17)^p(t,19)^t>>>10}function x(t,e){var i=(65535&t)+(65535&e);return((t>>>16)+(e>>>16)+(i>>>16)&65535)<<16|65535&i}function b(t,e,i,n){var r=(65535&t)+(65535&e)+(65535&i)+(65535&n);return((t>>>16)+(e>>>16)+(i>>>16)+(n>>>16)+(r>>>16)&65535)<<16|65535&r}function w(t,e,i,n,r){var a=(65535&t)+(65535&e)+(65535&i)+(65535&n)+(65535&r);return((t>>>16)+(e>>>16)+(i>>>16)+(n>>>16)+(r>>>16)+(a>>>16)&65535)<<16|65535&a}function _(t){var e,i;switch(e=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],i=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],t){case"SHA-224":t=e;break;case"SHA-256":t=i;break;case"SHA-384":case"SHA-512":t=[new n,new n,new n,new n,new n,new n,new n,new n];break;default:throw Error("Unknown SHA variant")}return t}function M(t,e,i){var n,r,a,s,o,l,h,c,u,p,_,M,T,E,A,P,L,O,C,R,I,D,N,F=[];if("SHA-224"!==i&&"SHA-256"!==i)throw Error("Unexpected error in SHA-2 implementation");for(p=64,M=1,D=Number,T=x,E=b,A=w,P=v,L=y,O=f,C=g,I=m,R=d,N=S,i=e[0],n=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=e[6],h=e[7],_=0;_<p;_+=1)16>_?(u=_*M,c=t.length<=u?0:t[u],u=t.length<=u+1?0:t[u+1],F[_]=new D(c,u)):F[_]=E(L(F[_-2]),F[_-7],P(F[_-15]),F[_-16]),c=A(h,C(s),R(s,o,l),N[_],F[_]),u=T(O(i),I(i,n,r)),h=l,l=o,o=s,s=T(a,c),a=r,r=n,n=i,i=T(c,u);return e[0]=T(i,e[0]),e[1]=T(n,e[1]),e[2]=T(r,e[2]),e[3]=T(a,e[3]),e[4]=T(s,e[4]),e[5]=T(o,e[5]),e[6]=T(l,e[6]),e[7]=T(h,e[7]),e}var S;S=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],t.exports?t.exports=i:i}()}),cd={check:function(t,e,i){if(i=i||{},void 0===t||void 0===t.pois||void 0===t.pois.hedVersion)return!0;var n=JSON.stringify({expiration:t.expiration,nbRoutingNodes:t.routing?t.routing.nodes.length:0,nbRoutingEdges:t.routing?t.routing.edges.length:0}),r=new hd("SHA-256","TEXT");if(r.update(e+n),r.getHash("HEX")!==t.credentials)return i.message="map integrity failure",!1;if("never"===t.expiration)return!0;var a=new Date,s=new Date(t.expiration);return!(a>s)||(i.message="map expired on "+s,!1)}};function ud(t,e){this.segments=e.segments||64,this.decimationThreshold=void 0!==e.decimationThreshold?e.decimationThreshold:0,this.radius=e.radius||1,this.segmentsRadius=e.segmentsRadius||8,this.closed=e.closed||!1,this.interpolationStart=e.interpolationStart||0,this.interpolationEnd=e.interpolationEnd||1,this.interpolationTextureLikeWindow=void 0===e.interpolationTextureLikeWindow||e.interpolationTextureLikeWindow,this.zOffset=e.zOffset||0,e.debug&&(this.debug=new ln),this.updatePath(t)}ud.prototype.updatePath=function(t){this.path=t,this.frames=t.computeFrenetFrames(this.segments,this.closed),this.recalculate()},ud.prototype.recalculate=function(t){t=t||{},this.geometry=new al,this.grid=[];var e,i,n,r,a,s,o,l,h,c,u,p,d,m,f,g,v,y,x,b,w,_=this.frames,M=_.tangents,S=_.normals,T=_.binormals,E=1/this.segments,A=t.binormal,P=0;if(0!=this.interpolationStart){var L=this.interpolationStart/E;P=Math.floor(L)}var O=this.segments-1;if(1!=this.interpolationEnd){var C=this.interpolationEnd/E;C===(O=Math.floor(C))&&O--}var R=1/(this.segmentsRadius-1),I=this.path,D=this.zOffset;for(l=P,c=O+2;l<c;l++)for(r=l*E,l===P&&0!=this.interpolationStart&&(r=this.interpolationStart),l===O+1&&1!=this.interpolationEnd&&(r=this.interpolationEnd),this.grid[l]=[],o=I.getPointAt(r),i=S[l],n=A||T[l],this.debug&&(e=M[l],this.debug.add(new xp(e,o,this.radius,255)),this.debug.add(new xp(i,o,this.radius,16711680)),this.debug.add(new xp(n,o,this.radius,65280))),h=0,u=this.segmentsRadius;h<u;h++)a=h*R-.5,s=this.radius*a,this.grid[l][h]=this.geometry.vertices.push(new li(o.x+s*n.x,o.y+s*n.y,o.z+s*n.z+D))-1;var N=this.interpolationTextureLikeWindow?0:this.interpolationStart,F=1/(this.segmentsRadius-1),z=P;for(l=P,c=O+1;l<c;l++)if(l>P&&l<O&&void 0!==e&&e.angleTo(M[l])<this.decimationThreshold)e.add(M[l]);else{p=this.closed?(l+1)%this.segments:l+1;var k=z*E-N,B=k+(l-z+1)*E;for(z===P&&0!=this.interpolationStart&&(k=this.interpolationStart-N),l===O&&1!=this.interpolationEnd&&(B=this.interpolationEnd-N),h=0;h<this.segmentsRadius-1;h++){d=(h+1)%this.segmentsRadius,m=this.grid[z][h],f=this.grid[p][h],g=this.grid[p][d],v=this.grid[z][d];var U=h*F,G=U+F;y=new Qe(k,U),x=new Qe(B,U),b=new Qe(B,G),w=new Qe(k,G),this.geometry.faces.push(new Cn(m,f,v)),this.geometry.faceVertexUvs[0].push([y,x,w]),this.geometry.faces.push(new Cn(f,g,v)),this.geometry.faceVertexUvs[0].push([x.clone(),b,w.clone()])}e=M[l],z=l+1}this.geometry.computeFaceNormals(),this.geometry.computeVertexNormals()},ud.prototype.constructor=ud,ud.prototype.getGeometry=function(){return this.geometry};var pd={};!function(t){var e=Math.PI/180,i=48,n=57,r=44,a=32,s=46,o=45,l=101,h=69;t.transformSVGPath=function(t){var c,u,p,d,m=new ru,f=1,g=t.length,v=0,y=0,x=0,b=0,w=null,_=null,M=0,S=0,T=0,E=0,A=0,P=0,L=0,O=0,C=0;function R(){for(var e,c,u,p=!1;f<g&&((c=t.charCodeAt(f))===r||c===a);)f++;for(e=c===o?f++:f;f<g;)if(c=t.charCodeAt(f),i<=c&&c<=n)f++;else{if(c!==s&&c!==l&&c!==h&&c!==o)return u=t.substring(e,f),p?parseFloat(u):parseInt(u);f++,p=!0}return u=t.substring(e),p?parseFloat(u):parseInt(u)}function I(){for(var e;f<g&&((e=t.charCodeAt(f))===r||e===a);)f++;return(e=t.charCodeAt(f))===o||i<=e&&e<=n}for(c=t[0];f<=g;){switch(d=!0,c){case"M":v=R(),y=R(),m.moveTo(v,y),c="L",w=v,_=y;break;case"m":v+=R(),y+=R(),m.moveTo(v,y),c="l",w=v,_=y;break;case"Z":case"z":d=!1,v===w&&y===_||m.lineTo(w,_);break;case"L":case"H":case"V":x="V"===c?v:R(),b="H"===c?y:R(),m.lineTo(x,b),v=x,y=b;break;case"l":case"h":case"v":x="v"===c?v:v+R(),b="h"===c?y:y+R(),m.lineTo(x,b),v=x,y=b;break;case"C":M=R(),T=R();case"S":"S"===c&&(M=2*v-S,T=2*y-E),S=R(),E=R(),x=R(),b=R(),m.bezierCurveTo(M,T,S,E,x,b),v=x,y=b;break;case"c":M=v+R(),T=y+R();case"s":"s"===c&&(M=2*v-S,T=2*y-E),S=v+R(),E=y+R(),x=v+R(),b=y+R(),m.bezierCurveTo(M,T,S,E,x,b),v=x,y=b;break;case"Q":M=R(),T=R();case"T":"T"===c&&(M=2*v-M,T=2*y-T),x=R(),b=R(),m.quadraticCurveTo(M,T,x,b),v=x,y=b;break;case"q":M=v+R(),T=y+R();case"t":"t"===c&&(M=2*v-M,T=2*y-T),x=v+R(),b=y+R(),m.quadraticCurveTo(M,T,x,b),v=x,y=b;break;case"A":A=R(),P=R(),L=R()*e,O=R(),C=R(),x=R(),b=R(),A!==P&&console.warn("Forcing elliptical arc to be a circular one :(",A,P),M=Math.cos(L)*(v-x)/2+Math.sin(L)*(y-b)/2,T=-Math.sin(L)*(v-x)/2+Math.cos(L)*(y-b)/2;var D=Math.sqrt((A*A*P*P-A*A*T*T-P*P*M*M)/(A*A*T*T+P*P*M*M));O===C&&(D=-D),S=D*A*T/P,E=D*-P*M/A,u=Math.cos(L)*S-Math.sin(L)*E+(v+x)/2,p=Math.sin(L)*S+Math.cos(L)*E+(y+b)/2;var N=new Qe(1,0),F=new Qe((M-S)/A,(T-E)/P),z=Math.acos(N.dot(F)/N.length()/F.length());N.x*F.y-N.y*F.x<0&&(z=-z),N.x=(-M-S)/A,N.y=(-T-E)/P;var k=Math.acos(F.dot(N)/F.length()/N.length());F.x*N.y-F.y*N.x<0&&(k=-k),!C&&k>0&&(k-=2*Math.PI),C&&k<0&&(k+=2*Math.PI),m.absarc(u,p,A,z,z+k,C),v=x,y=b;break;case" ":break;default:throw new Error("weird path command: '"+c+"'")}d&&I()||(c=t[f++])}return m}}(pd);function dd(t){this.mapviewer=t,this.camera=new Cr(this.mapviewer.camera.fov,this.mapviewer.camera.aspect,.1,2),this.scene=new $s,this.scene.autoUpdate=!1,this.textureCube=null,this.rotateCameraX=!1}function md(){}function fd(){}function gd(){}function vd(){}dd.prototype.constructor=dd,dd.prototype.initializeWithFaces=function(t){void 0!==t&&Array.isArray(t.images)&&6===t.images.length&&(this.mapviewer.loaderStatistics.textures++,this.textureCube=(new oc).load(t.images,function(){this.mapviewer.loaderStatistics.textures--,this.mapviewer.requestRedraw()}.bind(this),void 0,function(){this.mapviewer.loaderStatistics.textures--}.bind(this)),this.textureCube.format=Mt,this.textureCube.mapping=Z,this.scene.background=this.textureCube,this.rotateCameraX=!0)},dd.prototype.initializeWithStrip=function(t){if(void 0!==t&&"string"==typeof t.image){this.mapviewer.loaderStatistics.texture++;var e=new Image;e.crossOrigin="anonymous",e.onload=function(){var i,n;this.mapviewer.loaderStatistics.texture--,this.textureCube=new Nr,this.textureCube.format=Mt,this.textureCube.mapping=Z;var r=e.height;if(e.width<e.height)r=e.width;for(var a=t.rhs?[5,4,2,3,1,0]:[0,1,2,3,4,5],s=0;s<6;s++){n=(i=document.createElement("canvas")).getContext("2d"),i.height=r,i.width=r;var o=a[s];e.width<e.height?n.drawImage(e,0,r*o,r,r,0,0,r,r):n.drawImage(e,r*o,0,r,r,0,0,r,r),this.textureCube.images[s]=i}this.textureCube.needsUpdate=!0,this.scene.background=this.textureCube,this.rotateCameraX=!0,this.mapviewer.requestRedraw()}.bind(this),e.onerror=function(){this.mapviewer.loaderStatistics.textures--}.bind(this),e.src=t.image}},dd.prototype.initializeWithGradient=function(t){void 0!==t&&Array.isArray(t.colors)&&2===t.colors.length||(t={colors:[30719,7864319]});var e=new Lr({fragmentShader:"uniform vec3 topColor;uniform vec3 bottomColor;uniform float offset;uniform float exponent;varying vec3 vWorldPosition;void main(){float h=normalize(vWorldPosition.yzx+offset).y;gl_FragColor=vec4(mix(bottomColor,topColor,max(pow(max(h,0.0),exponent),0.0)),1.0);}",vertexShader:"varying vec3 vWorldPosition;void main(){vec4 worldPosition=modelMatrix*vec4(position,1.0);vWorldPosition=worldPosition.xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",uniforms:{topColor:{type:"c",value:new On(t.colors[0])},bottomColor:{type:"c",value:new On(t.colors[1])},offset:{type:"f",value:t.offset||.033},exponent:{type:"f",value:t.exponent||.55}},depthWrite:!1,side:l}),i=new dh(1,32,15);this.mesh=new br(i,e),this.scene.add(this.mesh),this.mapviewer.requestRedraw()},dd.prototype.setFov=function(t){this.fov=t,this.camera.fov=this.fov,this.camera.updateProjectionMatrix()},dd.prototype.dispose=function(){this.mesh&&this.geometry&&(this.mesh.geometry.dispose(),this.mesh=null),null!==this.textureCube&&(this.textureCube.dispose(),this.textureCube.images.forEach(function(t){null}),this.textureCube=null),this.scene=null},dd.prototype.update=function(t,e){null===this.fov&&(this.camera.fov=t),this.camera.aspect=e,this.camera.updateProjectionMatrix()},dd.prototype.render=function(){this.camera.rotation.copy(this.mapviewer.camera.rotation),this.rotateCameraX&&(this.camera.rotation.x-=Math.PI/2),this.mapviewer.renderer.render(this.scene,this.camera)},md.count=0,md.isNumeric=function(t){var e=new RegExp("-?\\d+(\\.{1}\\d+)?(e{1}-?\\d+)?").exec(t);return null!==e&&e[0].length===(t+"").length},md.isColorHex=function(t){var e=new RegExp("#(?:[0-9a-fA-F]{3}){1,2}$").exec(t);return null!==e&&e[0].length===t.length},md.getLanguageMatch=function(t,e){if(0===e.length)return"default";var i=function(t){if(void 0===t||"default"===t)return"default";if(-1!==e.indexOf(t))return t;if(-1!==e.indexOf(t.slice(0,2)))return t.slice(0,2);var i=e.findIndex(function(e){var i=e.slice(0,2);return i===t||0===t.indexOf(i)});return-1!==i?e[i]:"default"};if(Array.isArray(t)){for(var n="default",r=0;r<t.length&&"default"===n;)n=i(t[r]),r++;return n}return i(t)},md.getURLParameters=function(t){var e,i=function(t,e,i){var n,r=new RegExp("([^\\[\\]]+)((\\[([^\\[\\]])\\])*)","g"),a=t,s=[];do{null===(n=r.exec(e))||void 0===n[1]||n[1].toLowerCase().includes("__proto__")||s.push(decodeURIComponent(n[1]))}while(n);for(var o=0;o<s.length-1;o++)void 0===a[s[o]]&&(a[s[o]]={}),a=a[s[o]];a[s[s.length-1]]=i},n=void 0===t?window.location.search:t,r=new RegExp("[?|&]?([^=&#]+)=?([^&#]+)?","g"),a={};do{if(null!==(e=r.exec(n))){var s=decodeURIComponent(e[1]);if(!s.toLowerCase().includes("__proto__")){var o=void 0===e[2]||decodeURIComponent(e[2].replace(/\+/g," "));md.isNumeric(o)&&(o=parseFloat(o)),i(a,s,o)}}}while(e);return void 0!==a.params64&&(a=JSON.parse(atob(a.params64))),a},md.toURLParameters=function(t){var e=function(t,i,n){switch(typeof t){case"object":Object.keys(t).forEach(function(r){e(t[r],i+"["+r+"]",n)});break;case"boolean":t&&n.push(i);break;default:n.push(i+"="+encodeURIComponent(t).replace(/%20/g,"+"))}},i=[];Object.keys(t).forEach(function(n){e(t[n],n,i)});var n="";return i.forEach(function(t,e,i){n+=t,e<i.length-1&&(n+="&")}),n},md.extendDeep=function(t){if("object"!=typeof t)return t;for(var e,i,n=1,r=arguments.length;n<r;n++)for(i in e=arguments[n])hasOwnProperty.call(e,i)&&("object"==typeof e[i]&&e[i]?t[i]=md.extendDeep({},e[i]):t[i]=e[i]);return t},md.queryChildren=function(t,e){var i=t.id,n="#"+(t.id=i||"query_children_"+this.count++)+" > ",r=(e=n+(e+"").replace(",",","+n,"g"),t.parentNode.querySelectorAll(e));return i||t.removeAttribute("id"),r},md.getElementWidth=function(t){return""!==t.style.width?parseInt(t.style.width,10):parseInt(getComputedStyle(t).width,10)-t.offsetLeft},md.getElementHeight=function(t){return""!==t.style.height?parseInt(t.style.height,10):parseInt(getComputedStyle(t).height,10)-t.offsetTop},md.getXDomainRequest=function(){var t=null;return window.XDomainRequest?t=new XDomainRequest:window.XMLHttpRequest?t=new XMLHttpRequest:console.log("Your browser lacks AJAX cross domain support"),t},md.request=function(t,e,i,n){return new Promise(function(r,a){var s=new XMLHttpRequest;void 0!==n.crossDomain&&n.crossDomain&&(s=md.getXDomainRequest()),void 0!==n.contentType&&n.contentType&&s.setRequestHeader("Content-Type",n.contentType),void 0!==n.responseType&&(s.responseType=n.responseType),s.onload=function(){s.status>=200&&s.status<400||-1!==s.responseURL.indexOf("file:///")&&0===s.status?r({response:s.response,status:s.status,request:s}):a(new Error(s.status))},s.onerror=function(){a(new Error(s.status))},"function"==typeof n.progressCallBack&&(s.onprogress=function(t){n.progressCallBack(t)});var o=!0;void 0===n.async||n.async||(o=!1),null!==i&&"GET"===e?s.open(e,t+"?"+i,o):s.open(e,t,o),"POST"===e?s.send(i):s.send()})},md.now=function(){return Math.round((new Date).getTime()/1e3)},md.getCookie=function(t){var e=document.cookie.match(RegExp("(?:^|;\\s*)"+t.replace(/([.*+?\^${}()|\[\]\/\\])/g,"\\$1")+"=([^;]*)"));return e?e[1]:null},md.setCookie=function(t,e,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);var r="expires="+n.toUTCString();document.cookie=t+"="+e+";"+r+";path=/"},md.sha1=function(t){var e,i,n,r,a,s,o,l,h,c=function(t,e){return t<<e|t>>>32-e},u=function(t){var e,i="";for(e=7;e>=0;e--)i+=(t>>>4*e&15).toString(16);return i},p=new Array(80),d=1732584193,m=4023233417,f=2562383102,g=271733878,v=3285377520,y=(t=unescape(encodeURIComponent(t))).length,x=[];for(i=0;i<y-3;i+=4)n=t.charCodeAt(i)<<24|t.charCodeAt(i+1)<<16|t.charCodeAt(i+2)<<8|t.charCodeAt(i+3),x.push(n);switch(y%4){case 0:i=2147483648;break;case 1:i=t.charCodeAt(y-1)<<24|8388608;break;case 2:i=t.charCodeAt(y-2)<<24|t.charCodeAt(y-1)<<16|32768;break;case 3:i=t.charCodeAt(y-3)<<24|t.charCodeAt(y-2)<<16|t.charCodeAt(y-1)<<8|128}for(x.push(i);x.length%16!=14;)x.push(0);for(x.push(y>>>29),x.push(y<<3&4294967295),e=0;e<x.length;e+=16){for(i=0;i<16;i++)p[i]=x[e+i];for(i=16;i<=79;i++)p[i]=c(p[i-3]^p[i-8]^p[i-14]^p[i-16],1);for(r=d,a=m,s=f,o=g,l=v,i=0;i<=19;i++)h=c(r,5)+(a&s|~a&o)+l+p[i]+1518500249&4294967295,l=o,o=s,s=c(a,30),a=r,r=h;for(i=20;i<=39;i++)h=c(r,5)+(a^s^o)+l+p[i]+1859775393&4294967295,l=o,o=s,s=c(a,30),a=r,r=h;for(i=40;i<=59;i++)h=c(r,5)+(a&s|a&o|s&o)+l+p[i]+2400959708&4294967295,l=o,o=s,s=c(a,30),a=r,r=h;for(i=60;i<=79;i++)h=c(r,5)+(a^s^o)+l+p[i]+3395469782&4294967295,l=o,o=s,s=c(a,30),a=r,r=h;d=d+r&4294967295,m=m+a&4294967295,f=f+s&4294967295,g=g+o&4294967295,v=v+l&4294967295}return(h=u(d)+u(m)+u(f)+u(g)+u(v)).toLowerCase()},md.LZWCompress=function(t){var e,i,n,r={},a="",s=[],o=256;for(e=0;e<256;e+=1)r[String.fromCharCode(e)]=e;for(e=0;e<t.length;e+=1)n=a+(i=t.charAt(e)),r.hasOwnProperty(n)?a=n:(s.push(r[a]),r[n]=o++,a=String(i));return""!==a&&s.push(r[a]),s},md.LZWDecompress=function(t){var e,i,n,r,a=[],s="",o=256;for(e=0;e<256;e+=1)a[e]=String.fromCharCode(e);for(n=i=String.fromCharCode(t[0]),e=1;e<t.length;e+=1){if(a[r=t[e]])s=a[r];else{if(r!==o)return null;s=i+i.charAt(0)}n+=s,a[o++]=i+s.charAt(0),i=s}return n},md.getConvexHull=function(t){var e=function(t,e){var i=e[1].x-e[0].x,n=e[1].y-e[0].y;return i*(t.y-e[0].y)-n*(t.x-e[0].x)},i=function(t,n){var r=function(t,i){for(var n=new Array(i.length),r=0,a=0,s=null,o=0;o<i.length;++o){var l=i[o],h=e(l,t);h>0&&(n[r++]=l,h>a&&(a=h,s=l))}return n.splice(r),{point:s,points:n}}(t,n);return r.point?[].concat(i([t[0],r.point],r.points),i([r.point,t[1]],r.points)):[t[0]]};if(t.length<4)return t;for(var n={x:1/0,y:1/0},r={x:-1/0,y:-1/0},a={minX:0,minY:0,maxX:0,maxY:0},s=0;s<t.length;++s){var o=t[s];o.x<n.x&&(n.x=o.x,a.minX=s),o.y<n.y&&(n.y=o.y,a.minY=s),o.x>r.x&&(r.x=o.x,a.maxX=s),o.y>r.y&&(r.y=o.y,a.maxY=s)}var l=null,h=null;return r.x-n.x>r.y-n.y?(l=t[a.minX],h=t[a.maxX]):(l=t[a.minY],h=t[a.maxY]),[].concat(i([l,h],t),i([h,l],t))},md.distinct=function(t){return t.filter(function(t,e,i){return i.indexOf(t)===e})},fd.compareVersions=function(t,e){for(var i,n=t.split(/\./),r=e.split(/\./),a=n.length,s=r.length;s<a;)r.push("0"),s++;for(;a<s;)n.push("0"),a++;for(i=0;i<a;i++){var o=parseInt(n[i],10),l=parseInt(r[i],10);if(o<l)return-1;if(o>l)return 1}return 0},fd.checkSlotDescription=function(t,e,i){return new Promise(function(n,r){var a="string"==typeof i.sdkType?[i.sdkType]:i.sdkType,s=i.sdkVersion,o=i.minimumDataSDKVersion||i.sdkVersion,l=new Date;if(void 0!==t.version&&1==t.version||r(new Error("missing overall version or not equal to 1")),Array.isArray(t.maps)&&t.maps.length>0){var h=t.maps[0];if("string"==typeof h.sdk_type&&-1!==a.indexOf(h.sdk_type)||r(new Error("missing or wrong slot sdk_type: "+h.sdk_type)),void 0===h.sdk_version&&r(new Error("missing slot attribute sdk_version")),void 0===h.sdk_min_version&&(h.sdk_min_version=h.sdk_version),1==fd.compareVersions(h.sdk_min_version,s)&&r(new Error("data's minimum sdk_version "+h.sdk_min_version+" is higher than this SDK's version "+s+" Data too new, update SDK, or get different data")),-1==fd.compareVersions(h.sdk_version,o)&&r(new Error("data's sdk_version "+h["sdk.version"]+" is smaller than this SDK's minimumDataSDKVersion "+o+" Data is too old, update data")),void 0!==h.expiry_date){var c=new Date(h.expiry_date+" UTC");isNaN(c.getTime())&&r(new Error("Bad slot expiry_date: "+h.expiry_date)),c<l&&r(new Error("map has expired on: "+h.expiry_date))}if("string"==typeof h.path){var u,p=md.extendDeep({},e),d=e.path.replace(/\/[^\/]+$/,"/");/\//.test(d)||(d="");if(h.base_url){var m=h.base_url;u=/http|https|\/\//i.test(m)||/^\/[^\/]/.test(m)?m+"/"+h.path:d+m+"/"+h.path}else u=d+h.path;h.name&&(p.mapName=h.name),h.layout&&(p.bundleLayout=h.layout),p.path=u+"?"+h.timestamp,p.timestamp=h.timestamp,n(p)}else r(new Error("invalid slot.description: maps missing .path"))}else r(new Error("invalid slot.description: missing maps, or not array or length == 0"));t=null})},gd.ucfirst=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},gd.isRTL=function(t){return new RegExp("^[^A-Za-z--------]*[---]").test(t)},vd.trim=function(t){return t.replace(/^\s+|\s+$/g,"")},vd.compressSpaces=function(t){return t.replace(/[\s\r\t\n]+/gm," ")},vd.Point=function(t,e){this.x=t,this.y=e,this.clone=function(){return new vd.Point(this.x,this.y)},this.angleTo=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},this.equals=function(t,e){return e=e||.01,Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e}},vd.equalsPoints=function(t,e,i){return i=i||.01,Math.abs(e.x-t.x)<i&&Math.abs(e.y-t.y)<i},vd.Parser={},vd.Parser.color=function(t){if(void 0===t)return 0;var e,i=parseInt;if(t=t.replace(/\s\s*/g,""),e=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(t))e=[i(e[1],16),i(e[2],16),i(e[3],16)];else{if(!(e=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(t)))return 0;e=[17*i(e[1],16),17*i(e[2],16),17*i(e[3],16)]}return 256*e[0]*256+256*e[1]+e[2]};var yd=function(t){this.tokens=t.split(" ")};yd.prototype.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new vd.Point(0,0),this.control=new vd.Point(0,0),this.current=new vd.Point(0,0),this.points=[],this.angles=[]},yd.prototype.isEnd=function(){return this.i>=this.tokens.length-1},yd.prototype.isCommandOrEnd=function(){return!!this.isEnd()||null!==this.tokens[this.i+1].match(/^[A-Za-z]$/)},yd.prototype.isRelativeCommand=function(){return this.command===this.command.toLowerCase()},yd.prototype.getToken=function(){return this.i=this.i+1,this.tokens[this.i]},yd.prototype.getScalar=function(){return parseFloat(this.getToken())},yd.prototype.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},yd.prototype.getPoint=function(){var t=new vd.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(t)},yd.prototype.getAsControlPoint=function(){var t=this.getPoint();return this.control=t,t},yd.prototype.getAsCurrentPoint=function(){var t=this.getPoint();return this.current=t,t},yd.prototype.getReflectedControlPoint=function(){return"c"!==this.previousCommand.toLowerCase()&&"s"!==this.previousCommand.toLowerCase()?this.current:new vd.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y)},yd.prototype.makeAbsolute=function(t){return this.isRelativeCommand()&&(t.x=this.current.x+t.x,t.y=this.current.y+t.y),t},yd.prototype.addMarker=function(t,e,i){null!==i&&this.angles.length>0&&null===this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(i)),this.addMarkerAngle(t,null===e?null:e.angleTo(t))},yd.prototype.addMarkerAngle=function(t,e){this.points.push(t),this.angles.push(e)},yd.prototype.getMarkerPoints=function(){return this.points},yd.prototype.getMarkerAngles=function(){for(var t=0;t<this.angles.length;t++)if(null===this.angles[t])for(var e=t+1;e<this.angles.length;e++)if(null!==this.angles[e]){this.angles[t]=this.angles[e];break}return this.angles},vd.Parser.path=function(t){return t=t.replace(/,/gm," ").replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2").replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2").replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2").replace(/([0-9])([+\-])/gm,"$1 $2").replace(/(\.[0-9]*)(\.)/gm,"$1 $2").replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),t=vd.compressSpaces(t),t=vd.trim(t),this.PathParser=yd,new this.PathParser(t)},vd.convertRectToPath=function(t){var e=t.getAttribute("x")||0,i=t.getAttribute("y")||0,n=t.getAttribute("width"),r=t.getAttribute("height"),a="";a+="m"+e+","+i,a+="l0,"+r,a+="l"+n+",0",a+="l0,"+-r,a+="l"+-n+",0",a+="z",t.setAttribute("d",a)},vd.convertCircleToPath=function(t,e){for(var i,n,r,a,s=parseFloat(t.getAttribute("cx")),o=parseFloat(t.getAttribute("cy")),l=parseFloat(t.getAttribute("r")),h="",c=e||24,u=0;u<c;++u)if(i=s+l*Math.cos(2*u*Math.PI/(c-1)),n=o+l*Math.sin(2*u*Math.PI/(c-1)),0===u)h+="m"+i+","+n,r=i,a=n;else{var p=i-r,d=n-a;r=i,a=n,h+="l"+p+","+d}h+="z",t.setAttribute("d",h)},vd.convertEllipseToPath=function(t,e){for(var i,n,r,a,s=parseFloat(t.getAttribute("cx")),o=parseFloat(t.getAttribute("cy")),l=parseFloat(t.getAttribute("rx")),h=parseFloat(t.getAttribute("ry")),c="",u=e||24,p=0;p<u;++p)if(i=s+l*Math.cos(2*p*Math.PI/(u-1)),n=o+h*Math.sin(2*p*Math.PI/(u-1)),0===p)c+="m"+i+","+n,r=i,a=n;else{var d=i-r,m=n-a;r=i,a=n,c+="l"+d+","+m}c+="z",t.setAttribute("d",c)},vd.convertPolygonToPath=function(t){for(var e,i,n="",r=t.getAttribute("points").split(/[, ]/).filter(function(t){return""!==t}).map(function(t){return""===t?null:parseFloat(t)}),a=0,s=r.length/2;a<s;++a){var o=r[2*a+0],l=r[2*a+1];if(0===a)n+="m"+o+","+l,e=o,i=l;else{var h=o-e,c=l-i;e=o,i=l,n+="l"+h+","+c}}n+="z",t.setAttribute("d",n)},vd.deg2rad=function(t){return t*nd.DEG2RAD},vd.Transform=function(t){this.matrix=t||[1,0,0,1,0,0]},vd.Transform.prototype.multiply=function(t,e){var i=t.matrix[0],n=t.matrix[1],r=t.matrix[2],a=t.matrix[3],s=t.matrix[4],o=t.matrix[5],l=e.matrix[0],h=e.matrix[1],c=e.matrix[2],u=e.matrix[3],p=e.matrix[4],d=e.matrix[5];this.matrix[0]=i*l+n*c,this.matrix[1]=i*h+n*u,this.matrix[2]=r*l+a*c,this.matrix[3]=r*h+a*u,this.matrix[4]=s*l+o*c+1*p,this.matrix[5]=s*h+o*u+1*d},vd.Transform.prototype.multiplyVector=function(t){var e=t.x,i=t.y;t.x=this.matrix[0]*e+this.matrix[2]*i+this.matrix[4],t.y=this.matrix[1]*e+this.matrix[3]*i+this.matrix[5]},vd.Transform.prototype.decompose=function(){var t={},e=nd.sign(this.matrix[0]);0===e&&(e=1);var i=nd.sign(this.matrix[3]);return 0===i&&(i=1),t.sx=e*Math.sqrt(this.matrix[0]*this.matrix[0]+this.matrix[2]*this.matrix[2]),t.sy=i*Math.sqrt(this.matrix[1]*this.matrix[1]+this.matrix[3]*this.matrix[3]),t.angle=180*Math.atan2(-this.matrix[2],this.matrix[0])/Math.PI,t.tx=this.matrix[4]/t.sx,t.ty=this.matrix[5]/t.sy,t};var xd=/((translate|rotate|matrix|scale|skewX|skewY)(\([0-9eE\-\. ,]*\)))/g;function bd(){this.id=bd.count++,this.plane_geometry=new jr(1,1),this.plane_geometry.vg={permanent:!0},this.atlasList=[]}vd.Transform.parse=function(t){var e=new vd.Transform([1,0,0,1,0,0]);if(null==t)return e;var i=t.match(xd);return Object.keys(i).forEach(function(t){var n,r=i[t],a=r.substring(0,r.indexOf("(")),s=function(t){var e=t.indexOf("("),i=t.indexOf(")");if(-1===e||-1===i)return[];t=(t=(t=t.substring(e+1,i)).replace(/[ ,]/g," ")).split(" ");for(var n=0;n<t.length;++n)""===t[n]&&(t.splice(n,1),--n);return t=t.map(function(t){return parseFloat(t)})}(r);switch(a){case"matrix":if(6!==s.length)return null;e.multiply(new vd.Transform(s),e);break;case"translate":if(s.length<1)return null;1===s.length&&s.push(0),n=[1,0,0,1,s[0],s[1]],e.multiply(new vd.Transform(n),e);break;case"scale":if(s.length<1)return null;1===s.length&&s.push(s[0]),n=[s[0],0,0,s[1],0,0],e.multiply(new vd.Transform(n),e);break;case"rotate":if(s.length<1)return null;var o=Math.cos(vd.deg2rad(s[0])),l=Math.sin(vd.deg2rad(s[0]));if(n=[o,l,-l,o,0,0],1!==s.length){var h=new vd.Transform([1,0,0,1,-s[1],-s[2]]),c=new vd.Transform([1,0,0,1,s[1],s[2]]);h.multiply(h,new vd.Transform(n)),h.multiply(h,c),n=h.matrix}e.multiply(new vd.Transform(n),e);break;case"skewX":if(s.length<1)return null;n=[1,0,Math.tan(vd.deg2rad(s[0])),1,0,0],e.multiply(new vd.Transform(n),e);break;case"skewY":if(s.length<1)return null;n=[1,Math.tan(vd.deg2rad(s[0])),0,1,0,0],e.multiply(new vd.Transform(n),e)}}),e},bd.count=0,bd.prototype.activeAtlas=null,bd.prototype.activeTexture=null,bd.prototype.disposeTexture=function(t){0===t.vg.nbRefs&&(t.dispose(),this.activeTexture===t&&(this.activeTexture=null,this.activeAtlas=null),t.vg&&t.vg.options&&(t.vg.options.canvas=void 0,t.vg.options=null),t.onUpdate=void 0,t.image=null)},bd.prototype.realize=function(){this.atlasList.forEach(function(t){t.atlas.realize(),t.texture.image=t.atlas.canvas,t.texture.needsUpdate=!0,t.atlas.canvasContext=null})};var wd=function(t){for(var e=t+.5|0,i=e,n=0;i>>=1;)n++;var r=1<<n;return e==r?r:2*r};function _d(){bd.prototype.constructor.call(this),this.measuringCanvas=document.createElement("canvas")}function Md(){bd.prototype.constructor.call(this),this.iconsAtlas={}}function Sd(t){"boolean"==typeof t&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),t=void 0),this.manager=void 0!==t?t:tc,this.withCredentials=!1}_d.prototype=Object.create(bd.prototype),_d.prototype.constructor=_d,_d.prototype.generateText=function(t,e){e.canvas=document.createElement("canvas");var i=e.canvas,n=i.getContext("2d"),r=Math.floor(.8*(e.textTextureHeight-4)),a=e.style+" "+r+"px "+e.family;n.font=a;var s=Math.ceil(n.measureText(t).width),o=Math.ceil(1.25*r),l=0,h=0,c=1,u=1,p=r+2;if(e.vgmipmap){var d=wd(s+4),m=wd(o+4);i.width=d,i.height=m,l=1/d,u=1-2/m,c=(s+2)/d,h=1-(o+2)/m}else i.width=s+4,i.height=o+4;var f=s/o;n.font=a,n.fillStyle="#"+("000000"+e.color.toString(16)).slice(-6),n.fillText(t,2,p);var g=new ni(i);g.vg={nbRefs:0},n=null,i=null,g.minFilter=ot,g.magFilter=ot,g.needsUpdate=!0,g.vg.options=e,g.onUpdate=function(){this.vg.options.canvas=void 0,this.vg.options=null,this.onUpdate=void 0,this.image=null};var v=this.plane_geometry;if(e.vgmipmap){g.minFilter=1008;var y=(v=this.plane_geometry.clone()).attributes.uv.array;y[0]=l,y[1]=u,y[2]=c,y[3]=u,y[4]=l,y[5]=h,y[6]=c,y[7]=h,v.attributes.uv.needsUpdate=!0}return{aspectRatio:f,width:s,height:o,geometry:v,texture:g}},_d.prototype.measureText=function(t,e){var i=e.vgpadding,n=this.measuringCanvas.getContext("2d"),r=Math.floor(.8*(e.textTextureHeight-2*i));n.font=e.style+" "+r+"px "+e.family;var a=Math.ceil(n.measureText(t).width),s=Math.ceil(1.25*r);return n.clearRect(0,0,a,s),{width:a,height:s}},_d.prototype.generateTextOnAtlas=function(t,e,i,n){var r=this.activeAtlas,a=this.activeTexture,s={width:n,height:n,delayCanvasCreation:i.vgdelaycanvascreation},o={x0:0,y0:0,x1:1,y1:1};null!==r&&r.delayCanvasCreation==s.delayCanvasCreation||(this.activeAtlas=r=new t(s),this.activeTexture=a=new ni,this.atlasList.push({atlas:this.activeAtlas,texture:this.activeTexture}),i.vgdelaycanvascreation||(a.image=r.canvas),a.name="generateTextOnAtlas",a.vg={nbRefs:0});var l=this.measureText(e,i),h=l.width/l.height,c={width:l.width+2*i.vgpadding,height:l.height+2*i.vgpadding};if(r.isLargerThanAtlas(c))return!1;var u=r.insert(c,i.vgpadding);return!(!u&&(a.vg.nbRefs>0?(this.activeAtlas=r=new t(s),this.activeTexture=a=new ni,this.atlasList.push({atlas:this.activeAtlas,texture:this.activeTexture}),i.vgdelaycanvascreation||(a.image=r.canvas),a.name="generateTextOnAtlas2",a.vg={nbRefs:0}):(i.vgdelaycanvascreation||r.canvasContext.clearRect(0,0,r.width,r.height),r.resetNodes()),!1===(u=r.insert(c,i.vgpadding))))&&(u.textOptions={textTextureHeight:i.textTextureHeight,style:i.style,family:i.family,color:i.color},u.text=e,i.vgdelaycanvascreation||u.drawText(r.canvasContext),a.minFilter=1008,a.magFilter=ot,a.needsUpdate=!0,i.vgdelaycanvascreation||(o.x0=(u.x+i.vgpadding-1)/r.width,o.y1=1-(u.y+i.vgpadding)/r.height,o.x1=(u.x+u.width-i.vgpadding)/r.width,o.y0=1-(u.y+u.height-i.vgpadding)/r.height),{aspectRatio:h,width:l.width,height:l.height,texture:a,uv:o,node:u})},Md.prototype=Object.create(bd.prototype),Md.prototype.constructor=Md,Md.prototype.disposeTexture=function(t){var e;if(bd.prototype.disposeTexture.call(this,t),0===t.vg.nbRefs&&t.vg.inIconsAtlas)for(var i in this.iconsAtlas)this.iconsAtlas[i].texture===t&&((e=this.iconsAtlas[i]).texture=!1,e.debugImage=!1,e.loaded=!1,this.iconsAtlas[i]=!1)},Md.prototype.generateIconOnAtlasFromImage=function(t,e,i,n){var r=this.iconsAtlas[e.url];if(void 0===r||!1===r){r={debugUrl:e.url,debugImage:i,aspectRatio:!1,texture:!1,uv:!1,node:!1};var a=this.findAtlasForImage(t,e,i,n);a&&(a.texture.vg.inIconsAtlas=!0,r={aspectRatio:a.aspectRatio,texture:a.texture,uv:a.uv,node:a.node,loaded:!0},a.node&&e.vgdelaycanvascreation&&a.node.iconSlots.push(r)),this.iconsAtlas[e.url]=r}return r},Md.prototype.findAtlasForImage=function(t,e,i,n){var r,a=this.activeAtlas,s=this.activeTexture,o={width:n,height:n,delayCanvasCreation:e.vgdelaycanvascreation},l={x0:0,y0:0,x1:1,y1:1},h=i.width/i.height;null!==a&&a.delayCanvasCreation==o.delayCanvasCreation||(this.activeAtlas=a=new t(o),this.activeTexture=s=new ni,this.atlasList.push({atlas:this.activeAtlas,texture:this.activeTexture}),e.vgdelaycanvascreation||(s.image=a.canvas),s.name="findAtlasForImage",s.vg={nbRefs:0});var c=e.vgpadding,u={width:i.width+2*c,height:i.height+2*c};if(a.isLargerThanAtlas(u))return(r=new ni(i)).name="single after isLargerThanAtlas",r.needsUpdate=!0,r.vg={nbRefs:0},{texture:r,aspectRatio:h,uv:l};var p=a.insert(u,c);return!(!p&&(s.vg.nbRefs>0?(this.activeAtlas=a=new t(o),this.activeTexture=s=new ni,this.atlasList.push({atlas:this.activeAtlas,texture:this.activeTexture}),e.vgdelaycanvascreation||(s.image=a.canvas),s.name="findAtlasForImage2",s.vg={nbRefs:0}):(e.vgdelaycanvascreation||a.canvasContext.clearRect(0,0,a.width,a.height),a.resetNodes()),!1===(p=a.insert(u,c))))&&(p.image=i,e.vgdelaycanvascreation||p.drawImage(a.canvasContext),s.minFilter=1008,s.magFilter=ot,s.needsUpdate=!0,e.vgdelaycanvascreation||(l.x0=(p.x+c)/a.width,l.y0=1-(p.y+p.height-1-c)/a.height,l.x1=(p.x+p.width-c)/a.width,l.y1=1-(p.y+c)/a.height),{aspectRatio:h,texture:s,uv:l,node:p})},Sd.prototype.constructor=Sd,Object.assign(Sd.prototype,{crossOrigin:"anonymous",load:function(t,e,i,n){var r=this,a=void 0===this.path?Yc.extractUrlBase(t):this.path,s=new nc(this.manager);s.setPath(this.path),s.setWithCredentials(this.withCredentials),s.load(t,function(i){var n=JSON.parse(i),s=n.metadata;if(void 0!==s){var o=s.type;if(void 0!==o&&"object"===o.toLowerCase())return void console.error("THREE.JSONLoader: "+t+" should be loaded with THREE.ObjectLoader instead.")}var l=r.parse(n,a);e(l.geometry,l.materials)},i,n)},setPath:function(t){return this.path=t,this},setResourcePath:function(t){return this.resourcePath=t,this},setCrossOrigin:function(t){return this.crossOrigin=t,this},parse:function(){var t={NoBlending:c,NormalBlending:u,AdditiveBlending:p,SubtractiveBlending:d,MultiplyBlending:m,CustomBlending:f},e=new On,i=new hc,n=new Xc;function r(i,r,s){var o={},c={uuid:Ke.generateUUID(),type:"MeshLambertMaterial"};for(var u in i){var p=i[u];switch(u){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":c.name=p;break;case"blending":c.blending=t[p];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",u,"is no longer supported.");break;case"colorDiffuse":c.color=e.fromArray(p).getHex();break;case"colorSpecular":c.specular=e.fromArray(p).getHex();break;case"colorEmissive":c.emissive=e.fromArray(p).getHex();break;case"specularCoef":c.shininess=p;break;case"shading":"basic"===p.toLowerCase()&&(c.type="MeshBasicMaterial"),"phong"===p.toLowerCase()&&(c.type="MeshPhongMaterial"),"standard"===p.toLowerCase()&&(c.type="MeshStandardMaterial");break;case"mapDiffuse":c.map=a(p,i.mapDiffuseRepeat,i.mapDiffuseOffset,i.mapDiffuseWrap,i.mapDiffuseAnisotropy,o,r,s);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":c.emissiveMap=a(p,i.mapEmissiveRepeat,i.mapEmissiveOffset,i.mapEmissiveWrap,i.mapEmissiveAnisotropy,o,r,s);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":c.lightMap=a(p,i.mapLightRepeat,i.mapLightOffset,i.mapLightWrap,i.mapLightAnisotropy,o,r,s);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":c.aoMap=a(p,i.mapAORepeat,i.mapAOOffset,i.mapAOWrap,i.mapAOAnisotropy,o,r,s);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":c.bumpMap=a(p,i.mapBumpRepeat,i.mapBumpOffset,i.mapBumpWrap,i.mapBumpAnisotropy,o,r,s);break;case"mapBumpScale":c.bumpScale=p;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":c.normalMap=a(p,i.mapNormalRepeat,i.mapNormalOffset,i.mapNormalWrap,i.mapNormalAnisotropy,o,r,s);break;case"mapNormalFactor":c.normalScale=p;break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":c.specularMap=a(p,i.mapSpecularRepeat,i.mapSpecularOffset,i.mapSpecularWrap,i.mapSpecularAnisotropy,o,r,s);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":c.metalnessMap=a(p,i.mapMetalnessRepeat,i.mapMetalnessOffset,i.mapMetalnessWrap,i.mapMetalnessAnisotropy,o,r,s);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":c.roughnessMap=a(p,i.mapRoughnessRepeat,i.mapRoughnessOffset,i.mapRoughnessWrap,i.mapRoughnessAnisotropy,o,r,s);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":c.alphaMap=a(p,i.mapAlphaRepeat,i.mapAlphaOffset,i.mapAlphaWrap,i.mapAlphaAnisotropy,o,r,s);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":c.side=l;break;case"doubleSided":c.side=h;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),c.opacity=p;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":c[u]=p;break;case"vertexColors":!0===p&&(c.vertexColors=Wp),"face"===p&&(c.vertexColors=Vp);break;default:console.error("THREE.Loader.createMaterial: Unsupported",u,p)}}return"MeshBasicMaterial"===c.type&&delete c.emissive,"MeshPhongMaterial"!==c.type&&delete c.specular,c.opacity<1&&(c.transparent=!0),n.setTextures(o),n.parse(c)}function a(t,e,n,r,a,s,o,l){var h,c=o+t,u=tc.getHandler(c);null!==u?h=u.load(c):(i.setCrossOrigin(l),h=i.load(c)),void 0!==e&&(h.repeat.fromArray(e),1!==e[0]&&(h.wrapS=et),1!==e[1]&&(h.wrapT=et)),void 0!==n&&h.offset.fromArray(n),void 0!==r&&("repeat"===r[0]&&(h.wrapS=et),"mirror"===r[0]&&(h.wrapS=nt),"repeat"===r[1]&&(h.wrapT=et),"mirror"===r[1]&&(h.wrapT=nt)),void 0!==a&&(h.anisotropy=a);var p=Ke.generateUUID();return s[p]=h,p}return function(t,e){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var i=new al;return function(t,e){function i(t,e){return t&1<<e}var n,r,a,s,o,l,h,c,u,p,d,m,f,g,v,y,x,b,w,_,M,S,T,E,A,P,L,O=t.faces,C=t.vertices,R=t.normals,I=t.colors,D=t.scale,N=0;if(void 0!==t.uvs){for(n=0;n<t.uvs.length;n++)t.uvs[n].length&&N++;for(n=0;n<N;n++)e.faceVertexUvs[n]=[]}for(s=0,o=C.length;s<o;)(b=new li).x=C[s++]*D,b.y=C[s++]*D,b.z=C[s++]*D,e.vertices.push(b);for(s=0,o=O.length;s<o;)if(d=i(p=O[s++],0),m=i(p,1),f=i(p,3),g=i(p,4),v=i(p,5),y=i(p,6),x=i(p,7),d){if((_=new Cn).a=O[s],_.b=O[s+1],_.c=O[s+3],(M=new Cn).a=O[s+1],M.b=O[s+2],M.c=O[s+3],s+=4,m&&(u=O[s++],_.materialIndex=u,M.materialIndex=u),a=e.faces.length,f)for(n=0;n<N;n++)for(E=t.uvs[n],e.faceVertexUvs[n][a]=[],e.faceVertexUvs[n][a+1]=[],r=0;r<4;r++)P=E[2*(c=O[s++])],L=E[2*c+1],A=new Qe(P,L),2!==r&&e.faceVertexUvs[n][a].push(A),0!==r&&e.faceVertexUvs[n][a+1].push(A);if(g&&(h=3*O[s++],_.normal.set(R[h++],R[h++],R[h]),M.normal.copy(_.normal)),v)for(n=0;n<4;n++)h=3*O[s++],T=new li(R[h++],R[h++],R[h]),2!==n&&_.vertexNormals.push(T),0!==n&&M.vertexNormals.push(T);if(y&&(S=I[l=O[s++]],_.color.setHex(S),M.color.setHex(S)),x)for(n=0;n<4;n++)S=I[l=O[s++]],2!==n&&_.vertexColors.push(new On(S)),0!==n&&M.vertexColors.push(new On(S));e.faces.push(_),e.faces.push(M)}else{if((w=new Cn).a=O[s++],w.b=O[s++],w.c=O[s++],m&&(u=O[s++],w.materialIndex=u),a=e.faces.length,f)for(n=0;n<N;n++)for(E=t.uvs[n],e.faceVertexUvs[n][a]=[],r=0;r<3;r++)P=E[2*(c=O[s++])],L=E[2*c+1],A=new Qe(P,L),e.faceVertexUvs[n][a].push(A);if(g&&(h=3*O[s++],w.normal.set(R[h++],R[h++],R[h])),v)for(n=0;n<3;n++)h=3*O[s++],T=new li(R[h++],R[h++],R[h]),w.vertexNormals.push(T);if(y&&(l=O[s++],w.color.setHex(I[l])),x)for(n=0;n<3;n++)l=O[s++],w.vertexColors.push(new On(I[l]));e.faces.push(w)}}(t,i),function(t,e){var i=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var n=0,r=t.skinWeights.length;n<r;n+=i){var a=t.skinWeights[n],s=i>1?t.skinWeights[n+1]:0,o=i>2?t.skinWeights[n+2]:0,l=i>3?t.skinWeights[n+3]:0;e.skinWeights.push(new ri(a,s,o,l))}if(t.skinIndices)for(n=0,r=t.skinIndices.length;n<r;n+=i){var h=t.skinIndices[n],c=i>1?t.skinIndices[n+1]:0,u=i>2?t.skinIndices[n+2]:0,p=i>3?t.skinIndices[n+3]:0;e.skinIndices.push(new ri(h,c,u,p))}e.bones=t.bones,e.bones&&e.bones.length>0&&(e.skinWeights.length!==e.skinIndices.length||e.skinIndices.length!==e.vertices.length)&&console.warn("When skinning, number of vertices ("+e.vertices.length+"), skinIndices ("+e.skinIndices.length+"), and skinWeights ("+e.skinWeights.length+") should match.")}(t,i),function(t,e){var i=t.scale;if(void 0!==t.morphTargets)for(var n=0,r=t.morphTargets.length;n<r;n++){e.morphTargets[n]={},e.morphTargets[n].name=t.morphTargets[n].name,e.morphTargets[n].vertices=[];for(var a=e.morphTargets[n].vertices,s=t.morphTargets[n].vertices,o=0,l=s.length;o<l;o+=3){var h=new li;h.x=s[o]*i,h.y=s[o+1]*i,h.z=s[o+2]*i,a.push(h)}}if(void 0!==t.morphColors&&t.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var c=e.faces,u=t.morphColors[0].colors;for(n=0,r=c.length;n<r;n++)c[n].color.fromArray(u,3*n)}}(t,i),function(t,e){var i=[],n=[];void 0!==t.animation&&n.push(t.animation),void 0!==t.animations&&(t.animations.length?n=n.concat(t.animations):n.push(t.animations));for(var r=0;r<n.length;r++){var a=Jh.parseAnimation(n[r],e.bones);a&&i.push(a)}if(e.morphTargets){var s=Jh.CreateClipsFromMorphTargetSequences(e.morphTargets,10);i=i.concat(s)}i.length>0&&(e.animations=i)}(t,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:i}:{geometry:i,materials:function(t,e,i){for(var n=[],a=0;a<t.length;++a)n[a]=r(t[a],e,i);return n}(t.materials,this.resourcePath||e,this.crossOrigin)}}}()});var Td=Object.freeze({ArcCurve:pc,CatmullRomCurve3:yc,CubicBezierCurve:_c,CubicBezierCurve3:Mc,EllipseCurve:uc,LineCurve:Sc,LineCurve3:Tc,QuadraticBezierCurve:Ec,QuadraticBezierCurve3:Ac,SplineCurve:Pc}),Ed=Object.freeze({WireframeGeometry:Sh,ParametricGeometry:ah,ParametricBufferGeometry:rh,TetrahedronGeometry:fh,TetrahedronBufferGeometry:mh,OctahedronGeometry:nh,OctahedronBufferGeometry:ih,IcosahedronGeometry:$l,IcosahedronBufferGeometry:Ql,DodecahedronGeometry:fl,DodecahedronBufferGeometry:ml,PolyhedronGeometry:oh,PolyhedronBufferGeometry:dl,TubeGeometry:Mh,TubeBufferGeometry:_h,TorusKnotGeometry:wh,TorusKnotBufferGeometry:bh,TorusGeometry:xh,TorusBufferGeometry:yh,TextGeometry:vh,TextBufferGeometry:gh,SphereGeometry:dh,SphereBufferGeometry:ph,RingGeometry:hh,RingBufferGeometry:lh,PlaneGeometry:sh,PlaneBufferGeometry:jr,LatheGeometry:eh,LatheBufferGeometry:th,ShapeGeometry:uh,ShapeBufferGeometry:ch,ExtrudeGeometry:Kl,ExtrudeBufferGeometry:Zl,EdgesGeometry:bl,ConeGeometry:ul,ConeBufferGeometry:pl,CylinderGeometry:cl,CylinderBufferGeometry:hl,CircleGeometry:ll,CircleBufferGeometry:ol,BoxGeometry:sl,BoxBufferGeometry:Mr});class Ad extends $c{parseGeometries(t,e){var i={};if(void 0!==t)for(var n=new Sd,r=new Kc,a=0,s=t.length;a<s;a++){var o,l=t[a];switch(l.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Ed[l.type](l.width,l.height,l.widthSegments,l.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Ed[l.type](l.width,l.height,l.depth,l.widthSegments,l.heightSegments,l.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Ed[l.type](l.radius,l.segments,l.thetaStart,l.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Ed[l.type](l.radiusTop,l.radiusBottom,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Ed[l.type](l.radius,l.height,l.radialSegments,l.heightSegments,l.openEnded,l.thetaStart,l.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Ed[l.type](l.radius,l.widthSegments,l.heightSegments,l.phiStart,l.phiLength,l.thetaStart,l.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Ed[l.type](l.radius,l.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Ed[l.type](l.innerRadius,l.outerRadius,l.thetaSegments,l.phiSegments,l.thetaStart,l.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Ed[l.type](l.radius,l.tube,l.radialSegments,l.tubularSegments,l.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Ed[l.type](l.radius,l.tube,l.tubularSegments,l.radialSegments,l.p,l.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Ed[l.type]((new Td[l.path.type]).fromJSON(l.path),l.tubularSegments,l.radius,l.radialSegments,l.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Ed[l.type](l.points,l.segments,l.phiStart,l.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Ed[l.type](l.vertices,l.indices,l.radius,l.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var h=[],c=0,u=l.shapes.length;c<u;c++){var p=e[l.shapes[c]];h.push(p)}o=new Ed[l.type](h,l.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(h=[],c=0,u=l.shapes.length;c<u;c++){p=e[l.shapes[c]];h.push(p)}var d=l.options.extrudePath;void 0!==d&&(l.options.extrudePath=(new Td[d.type]).fromJSON(d)),o=new Ed[l.type](h,l.options);break;case"BufferGeometry":o=r.parse(l);break;case"Geometry":o=n.parse(l,this.resourcePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+l.type+'"');continue}o.uuid=l.uuid,void 0!==l.name&&(o.name=l.name),!0===o.isBufferGeometry&&void 0!==l.userData&&(o.userData=l.userData),i[l.uuid]=o}return i}}function Pd(){}Pd.create=function(t,e,i,n,r){t=t||{},i=i||[],n=n||[],r=r||[],Object.keys(i).forEach(function(t){var n=i[t];void 0!==e[n]&&Object.defineProperty(this,n,{get:function(){return e[n]},set:function(t){e[n]=t}})},t),Object.keys(n).forEach(function(t){var i=n[t];void 0!==e[i]&&Object.defineProperty(this,i,{get:function(){return e[i]}})},t),Object.keys(r).forEach(function(t){var i=r[t];void 0!==e[i]&&(this[i]=function(){return e[i].apply(e,arguments)})},t),t.destroyPublicInterface=function(){Object.keys(r).forEach(function(e){var i=r[e];t[i]=null}),e=null}};var Ld=[],Od=[],Cd=["setEnabled","isEnabled"];function Rd(t){Pd.create(this,t,Ld,Od,Cd)}function Id(t,e,i){this.index=i,this.mapviewer=t,this.node=new ln,this.node.visible=!1,this.node.matrixAutoUpdate=!1,this.contentNode=new ln,this.contentNode.matrixAutoUpdate=!1,this.floor=e,this.pickables=[],this.cameraUpdatableObjects=[],this.pathObjects=[],this.animatedObjects=[],this.rampObjects=[],this.groundObjects=[],this.layers={},this.poiBatches={texts:{},icons:{}},this.active=!1,this.publicLOD=!1,this.node.add(this.contentNode),e.node.add(this.node)}Id.prototype.constructor=Id,Id.prototype.getPublicLOD=function(){return this.publicLOD=this.publicLOD||new Rd(this),this.publicLOD},Id.prototype.unload=function(){this.setActive(!1),this.node.traverse(function(t){t instanceof br&&t.geometry.dispose()}),this.pickables.forEach(function(t){t instanceof br||t instanceof ln||this.mapviewer.places.unregisterGeometryElement(t)}.bind(this)),Object.keys(this.poiBatches.texts,function(t){var e=this.poiBatches.texts[t];e.batches.forEach(function(t){e.removeBatch(t)}),delete this.poiBatches.texts[t]}.bind(this)),Object.keys(this.poiBatches.icons,function(t){var e=this.poiBatches.icons[t];e.batches.forEach(function(t){e.removeBatch(t)}),delete this.poiBatches.icons[t]}.bind(this))},Id.prototype.setContentEnabled=function(t){this.contentNode.visible!=t&&(this.contentNode.visible=t,this.mapviewer.requestRedraw())},Id.prototype.isContentEnabled=function(){return this.contentNode.visible},Id.prototype.setEnabled=function(t){this.node.visible!=t&&(this.node.visible=t,this.mapviewer.requestRedraw())},Id.prototype.isEnabled=function(){return this.node.visible},Id.prototype.getOrCreateLayer=function(t){if(void 0===this.layers[t]){var e=new ln;e.matrixAutoUpdate=!1,this.layers[t]=e,this.node.add(e)}return this.layers[t]},Id.prototype.setActive=function(t){this.active!==t&&(t&&!1===this.floor.isEnabled()||(t?this.mapviewer.addActiveLOD(this):this.mapviewer.removeActiveLOD(this),this.active=t,this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()))},Id.prototype.isActive=function(){return this.active};var Dd=[],Nd=["name","index","heightMin","heightMax"],Fd=["setActive","setEnabled","isEnabled","setLODEnabled","setContentEnabled","isContentEnabled","getPosition","setPosition","getLODs","setAutoUpdateLOD","isAutoUpdateLOD","fadeIn","fadeOut"];function zd(t){Pd.create(this,t,Dd,Nd,Fd)}function kd(t,e){this.name=e,this.lods=[],this.node=new ln,this.node.visible=!1,this.node.matrixAutoUpdate=!1,this.contentNode=new ln,this.contentNode.matrixAutoUpdate=!1,this.node.add(this.contentNode),this.mapviewer=t,this.floorContentLOD=new Id(t,this,-1),this.floorContentLOD.setEnabled(!0),this.positionUpdatableLinks=[],this.publicFloor=!1,this.publicLODs=!1,this.autoUpdateLOD=!0,this.complete=!1,this.separate=!1,this.loading=!1,this.unloadTimeout=!1,this.setContentEnabled(!0)}kd.prototype.constructor=kd,kd.prototype.UNLOAD_DELAY=2e3,kd.prototype.getPublicFloor=function(){return this.publicFloor=this.publicFloor||new zd(this),this.publicFloor},kd.prototype.loadPartial=function(){if(!this.complete&&!this.loading){var t=this;return t.loading=!0,this.mapviewer.loadFloor(this.name).then(function(){t.setActive(!0),t.complete=!0,t.separate=!0,t.loading=!1}).catch(function(e){"nocontent"===e&&(t.setActive(!0),t.complete=!0,t.separate=!1),t.loading=!1})}},kd.prototype.unloadTiledImages=function(){if(this.tiledImages){for(var t=0,e=this.tiledImages.length;t<e;++t){this.tiledImages[t].remove()}this.tiledImages=[],delete this.tiledImages}},kd.prototype.unload=function(){this.unloadTiledImages(),this.lods.forEach(function(t){t.unload()}),this.node.traverse(function(t){t instanceof br&&t.geometry.dispose()}),this.mapviewer.scene.remove(this.node),this.complete=!1},kd.prototype.unloadPartial=function(){if(this.loading)clearTimeout(this.unloadTimeout),this.unloadTimeout=setTimeout(this.unloadPartial.bind(this),this.UNLOAD_DELAY);else if(this.complete){this.unloadTiledImages();for(var t=Object.keys(this.mapviewer.pois),e=t.length-1;e>=0;e--)for(var i=this.mapviewer.pois[t[e]],n=i.length-1;n>=0;n--){var r=i[n],a=r.options("lod");r.options("floor")===this.name&&a&&a>0&&r.remove()}this.lods.forEach(function(t){0!==t.index&&(t.unload(),this.node.remove(t.node))},this),this.lods=[this.getLOD(0)],this.complete=!1,this.unloadTimeout=!1}},kd.prototype.scheduleUnloadPartial=function(){this.unloadTimeout||(this.unloadTimeout=setTimeout(this.unloadPartial.bind(this),this.UNLOAD_DELAY))},kd.prototype.getLODs=function(){if(!this.publicLODs){this.publicLODs=[];for(var t=0,e=this.lods.length;t<e;t++)this.publicLODs.push(this.lods[t].getPublicLOD())}return this.publicLODs},kd.prototype.createLOD=function(t){var e=new Id(this.mapviewer,this,t,this.name);return this.lods[t]=e,e},kd.prototype.getLOD=function(t){for(var e=null,i=0;i<this.lods.length;++i){var n=this.lods[i];if(void 0!==n&&n.index===t){e=n;break}}return e},kd.prototype.info=function(){var t=this.node.position;console.log("=============="),console.log("Floor "+this.name+" visible "+this.node.visible+" content "+this.floorContentLOD.node.visible+" pos("+t.x+","+t.y+","+t.z+")");for(var e=0,i=this.lods.length;e<i;++e){var n=this.lods[e],r=this.lods[e].node.position;console.log("  LOD  "+e+" visible "+n.node.visible+" pos ("+r.x+","+r.y+","+r.z+")")}console.log("this.positionUpdatableLinks.length: "+this.positionUpdatableLinks.length)},kd.prototype.fadeOut=function(t){var e=this;return this.mapviewer.animateValue(0,1,{duration:t,step:function(t){e.setOpacity(1-nd.easeOut(t))}})},kd.prototype.fadeIn=function(t){var e=this;return this.mapviewer.animateValue(0,1,{duration:t,step:function(t){e.setOpacity(nd.easeIn(t))},complete:function(){e.setContentEnabled(!0)}})},kd.prototype.setOpacity=function(t,e){t>0?this.setEnabled(!0):this.setEnabled(!1),t>0&&t<1?(this.node.traverse(function(e){void 0!==e.material&&(Array.isArray(e.material)?(void 0===e.originalMaterials&&(e.originalMaterials=[],e.material.forEach(function(t,i){e.originalMaterials[i]=t,e.material[i]=e.originalMaterials[i].clone()})),e.material.forEach(function(i,n){i.opacity=t*e.originalMaterials[n].opacity,i.transparent=!0})):e.material instanceof Dn?(void 0===e.originalMaterial&&(e.originalMaterial=e.material,e.material=e.originalMaterial.clone()),e.material.opacity=t*e.originalMaterial.opacity,e.material.transparent=!0):e.material instanceof Lr&&(void 0===e.material.originalOpacity&&(e.material.originalOpacity=e.material.uniforms.opacity.value),e.material.uniforms.opacity.value=t*e.material.originalOpacity))}),this.floorContentLOD.node.traverse(function(t){void 0===t.originalRenderOrder&&(t.originalRenderOrder=t.renderOrder),t.renderOrder=1})):(this.node.traverse(function(t){void 0!==t.material&&(Array.isArray(t.material)?void 0!==t.originalMaterials&&t.material.forEach(function(e,i){t.material[i]=t.originalMaterials[i].clone()}):t.material instanceof Dn?void 0!==t.originalMaterial&&(t.material=t.originalMaterial.clone()):t.material instanceof Lr&&void 0!==t.material.originalOpacity&&(t.material.uniforms.opacity.value=t.material.originalOpacity))}),this.floorContentLOD.node.traverse(function(t){t.renderOrder=t.originalRenderOrder})),this.mapviewer.requestRedraw()},kd.prototype.setActive=function(t){this.floorContentLOD.isEnabled()&&this.floorContentLOD.setActive(t);for(var e=0;e<this.lods.length;++e){var i=this.lods[e];i.isEnabled()&&i.setActive(t)}this.mapviewer.requestRedraw()},kd.prototype.setLODEnabled=function(t){for(var e=0;e<this.lods.length;++e)this.lods[e].setEnabled(e==t);this.update()},kd.prototype.setEnabled=function(t){this.node.visible=t,this.update()},kd.prototype.isEnabled=function(){return this.node.visible},kd.prototype.setContentEnabled=function(t){this.floorContentLOD.setContentEnabled(t);for(var e=0;e<this.lods.length;++e){this.lods[e].setContentEnabled(t)}},kd.prototype.isContentEnabled=function(){return this.floorContentLOD.isContentEnabled()},kd.prototype.getPosition=function(){var t=this.node.position;return{x:t.x,y:t.y,z:t.z}},kd.prototype.setPosition=function(t){var e=this.node.position;if(e.x!=t.x||e.y!=t.y||e.z!=t.z){t.z=t.z||0,this.node.position.copy(t);for(var i=0,n=this.positionUpdatableLinks.length;i<n;i++){var r=this.positionUpdatableLinks[i],a=!1;if(r.linkOptions.startFloor===this||r.linkOptions.endFloor===this){var s=r.linkOptions.endPoint,o=r.linkOptions.startFloor.getPosition(),l=r.linkOptions.endFloor.getPosition();a={x:l.x-o.x+s.x,y:l.y-o.y+s.y,z:l.z-o.z+s.z}}a&&r.updateEndPoints(!1,a)}this.mapviewer.mustUpdateCameraObjects=!0,this.node.updateMatrix(),this.node.updateMatrixWorld(!0),this.mapviewer.requestRedraw()}},kd.prototype.removeLink=function(t){for(var e=0,i=this.positionUpdatableLinks.length;e<i;e++)if(this.positionUpdatableLinks[e]===t)return this.positionUpdatableLinks.splice(e,1),!0;return!1},kd.prototype.addLink=function(t){this.positionUpdatableLinks.push(t)},kd.prototype.isAutoUpdateLOD=function(){return this.autoUpdateLOD},kd.prototype.setAutoUpdateLOD=function(t){this.autoUpdateLOD=t,this.update()},kd.prototype.update=function(){this.node.visible&&this.autoUpdateLOD?(this.unloadTimeout&&(clearTimeout(this.unloadTimeout),this.unloadTimeout=!1),this.loadPartial()):this.node.visible&&!this.getLOD(0).isEnabled()||(this.separate&&this.scheduleUnloadPartial(),this.setActive(!1),this.node.visible&&this.floorContentLOD.isEnabled()&&this.floorContentLOD.setActive(!0)),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()};var Bd=function(){this.onNotificationHandlers={},this.onStickyNotification={}};function Ud(t){this.proxy=t,this.count=Ud.counter++,this.vg={poi:!0}}Bd.prototype.on=function(t,e,i){i=i||!1;var n=t.split(/ /);1==n.length?(void 0===this.onNotificationHandlers[t]&&(this.onNotificationHandlers[t]=[]),this.onNotificationHandlers[t].push({callback:e,once:i}),void 0!==this.onStickyNotification[t]&&(e(this.onStickyNotification[t].event),i&&this.off(t,e))):Object.keys(n).forEach(function(t){this.on(n[t],e)},this)},Bd.prototype.off=function(t,e){var i=t.split(/ /);if(1==i.length){if(void 0===this.onNotificationHandlers[t])return!1;if(void 0===e)return this.onNotificationHandlers[t]=[],!0;for(var n=this.onNotificationHandlers[t],r=0,a=n.length;r<a;++r)if(n[r].callback===e)return n.splice(r,1),!0;return!1}Object.keys(i).forEach(function(t){this.off(i[t],e)},this)},Bd.prototype.trigger=function(t,e,i){var n,r=t.split(/ /);if(1==r.length){if(i&&(this.onStickyNotification[t]={event:a}),void 0!==this.onNotificationHandlers[t]){for(var a={type:t,args:e},s=this.onNotificationHandlers[t],o=[],l=0,h=s.length;l<h;++l)o.push(s[l]);for(l=0,h=o.length;l<h;++l){var c=o[l];if(n=c.callback(a),c.once&&this.off(t,c.function),!1===n)return!1}}}else Object.keys(r).forEach(function(t){if(!1===(n=this.trigger(r[t],e,i)))return!1},this)},Bd.prototype.unstick=function(t){var e=t.split(/ /);1!=e.length?e.forEach(function(t){this.onStickyNotification[t]&&delete this.onStickyNotification[t]},this):this.onStickyNotification[t]&&delete this.onStickyNotification[t]},Ud.counter=0,Ud.prototype.constructor=Ud,Ud.prototype.show=function(){return this.proxy.setVisible(!0)},Ud.prototype.hide=function(){return this.proxy.setVisible(!1)},Ud.prototype.remove=function(){return this.proxy.remove.apply(this.proxy,arguments)},Ud.prototype.options=function(){return this.proxy.options.apply(this.proxy,arguments)},Object.defineProperty(Ud.prototype,"visible",{get:function(){return this.proxy.getVisible()},set:function(t){this.proxy.setVisible(t)}}),Object.defineProperty(Ud.prototype,"opacity",{get:function(){return this.proxy.getOpacity()},set:function(t){this.proxy.setOpacity(t)}}),Object.defineProperty(Ud.prototype,"ready",{get:function(){return this.proxy.isReady()}});var Gd=[],Hd=[],jd=["isReady","getVisible","setVisible","getOpacity","setOpacity","remove","options"],Vd=["text","url","model","selector","textTextureHeight","style","family","color","position","alignment","scale","zoomScaleFactor","zoomScaleFast","iconScale","angle","heading","floor","lod","visible","opacity","id","visibilityRampStartVisible","visibilityRampFullyVisible","visibilityRampStartInvisible","visibilityRampFullyInvisible","clickable","fixed","width","height","overlay","flip","face2d","image","onObjectMouseOver","onObjectMouseOut","onObjectMouseUp","multiline","track","animationNames"];function Wd(t){this.publicPOI=null,this.count=Wd.counter++,Pd.create(this,t,Gd,Hd,jd)}function qd(t,e){this.mapviewer=e,this.constraints=void 0!==t.constraints?t.constraints:[qd.CAMERA_FACING,qd.FIXED,qd.CAMERA_FACING],void 0!==t.face2d&&!0===t.face2d&&(this.constraints=[qd.FIXED,qd.FIXED,qd.CAMERA_FACING]),this.face2d=this.constraints[0]==qd.FIXED&&this.constraints[1]==qd.FIXED&&this.constraints[2]==qd.CAMERA_FACING,this.lastCameraOrientationZ=!1,ln.call(this)}Wd.isPublicParameter=function(t){return-1!==Vd.indexOf(t)},Wd.getPublicParameters=function(t){var e={};return Object.keys(t).map(function(i){Wd.isPublicParameter(i)&&(e[i]=t[i])}),e},Wd.counter=1e3,Wd.prototype.constructor=Wd,qd.CAMERA_FACING=0,qd.FIXED_MODULO_PI=1,qd.FIXED=2,qd.prototype=new ln,qd.prototype.constructor=qd;var Xd=new Fi,Yd=new Fi,Zd=new Fi;function Jd(t){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",Sd),this.manager=void 0!==t?t:tc}qd.prototype.updateMatrix=function(){if(this.face2d){if(!this._dirty&&!1!==this.lastCameraOrientationZ&&this.mapviewer.manipulator.orientation.z==this.lastCameraOrientationZ)return;if(this.lastCameraOrientationZ=this.mapviewer.manipulator.orientation.z,this.mapviewer.manipulator.cachedMatrixOrientationZ===this.mapviewer.manipulator.orientation.z)return this.matrix.copy(this.mapviewer.manipulator.cachedMatrixForOrientation),this.matrix.setPosition(this.position),void(this.matrixWorldNeedsUpdate=!0)}if(this.mapviewer.camera.vg){var t=this.mapviewer.camera.vg.cameraComponents;this.rotation.set(0,0,0);for(var e=this.rotation.toArray(),i=0;i<3;++i){switch(this.constraints[i]){case qd.CAMERA_FACING:e[i]=t[i];break;case qd.FIXED:}switch(i){case 0:Yd.makeRotationX(-e[0]);break;case 1:Zd.makeRotationY(e[1]);break;case 2:Xd.makeRotationZ(-e[2])}}this.rotation.fromArray(e),this.matrix.identity(),this.matrix.multiply(Xd),this.matrix.multiply(Yd),this.matrix.multiply(Zd),this.face2d&&(this.mapviewer.manipulator.cachedMatrixOrientationZ=this.mapviewer.manipulator.orientation.z,this.mapviewer.manipulator.cachedMatrixForOrientation=this.matrix.clone()),this.matrix.setPosition(this.position),this.matrixWorldNeedsUpdate=!0,this._dirty=!1}},Jd.prototype={constructor:Ad,load:function(t,e,i,n){var r=this;new Kp(r.manager).load(t,function(i){r.parse(JSON.parse(i),e,t)},i,n)},addGeometryHandler:function(t,e){this.geometryHandlers[t]={loaderClass:e}},addHierarchyHandler:function(t,e){this.hierarchyHandlers[t]={loaderClass:e}},parse:function(t,e,i){var n,r,a,s,c,p,d,m,f,g,v,y=this,x=Yc.extractUrlBase(i),b=[],w=t;for(var _ in this.geometryHandlers){var M=this.geometryHandlers[_].loaderClass;this.geometryHandlers[_].loaderObject=new M}for(var _ in this.hierarchyHandlers){M=this.hierarchyHandlers[_].loaderClass;this.hierarchyHandlers[_].loaderObject=new M}if(d=0,m=0,v={scene:new $s,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},w.transform){var S=w.transform.position,T=w.transform.rotation,E=w.transform.scale;S&&v.scene.position.fromArray(S),T&&v.scene.rotation.fromArray(T),E&&v.scene.scale.fromArray(E),(S||T||E)&&(v.scene.updateMatrix(),v.scene.updateMatrixWorld())}if(w.animations)for(var A in v.scene.animations=[],w.animations){var P=w.animations[A];if(void 0===P.duration){var L={name:P.name,duration:0,tracks:[]};P.tracks.forEach(function(t){var e={name:t.name,times:[],values:[],type:"float"===t.type?"number":t.type};t.keys.forEach(function(t){var i=t.time/P.fps;L.duration=Math.max(L.duration,i),e.times.push(i),e.values.push(t.value)}),L.tracks.push(e)}),v.scene.animations.push(Jh.parse(L))}else v.scene.animations.push(Jh.parse(P))}function O(t,e){return"relativeToHTML"==e?t:x+t}function C(){w.object?R(v.scene,w.object.children):R(v.scene,w.objects)}function R(t,e){var i,s,o,l,h;for(var c in e){var u=v.objects[c],d=e[c];if(void 0===u){if(d.type&&d.type in y.hierarchyHandlers){if(void 0===d.loading){r=v.materials[d.material],d.loading=!0;var m=y.hierarchyHandlers[d.type].loaderObject;m.options,m.load(O(d.url,w.urlBaseType),N(c,t,r,d))}}else if(void 0!==d.geometry)(n=v.geometries[d.geometry])&&(r=v.materials[d.material],s=d.position,o=d.rotation,l=d.scale,i=d.matrix,h=d.quaternion,d.material||(r=new Xp(v.face_materials[d.geometry])),r instanceof Xp&&0===r.materials.length&&(r=new Xp(v.face_materials[d.geometry])),(u=d.skin?new Mo(n,r):new br(n,r)).name=c,i?(u.matrixAutoUpdate=!1,u.matrix.set(i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]),u.matrix.decompose(u.position,u.quaternion,u.scale)):(u.position.fromArray(s),h?u.quaternion.fromArray(h):u.rotation.fromArray(o),u.scale.fromArray(l)),u.visible=d.visible,u.castShadow=d.castShadow,u.receiveShadow=d.receiveShadow,t.add(u),v.objects[c]=u);else if("AmbientLight"===d.type||"PointLight"===d.type||"DirectionalLight"===d.type||"SpotLight"===d.type||"HemisphereLight"===d.type){var f=d.color,g=d.intensity,x=d.distance,b=d.position,_=d.rotation;switch(d.type){case"AmbientLight":p=new jc(f);break;case"PointLight":(p=new Bc(f,g,x)).position.fromArray(b);break;case"DirectionalLight":(p=new Hc(f,g)).position.fromArray(d.direction);break;case"SpotLight":(p=new zc(f,g,x)).angle=d.angle,p.position.fromArray(b),p.target.set(b[0],b[1]-x,b[2]),p.target.applyEuler(new Vi(_[0],_[1],_[2],"XYZ"));break;case"HemisphereLight":(p=new Hc(f,g,x)).target.set(b[0],b[1]-x,b[2]),p.target.applyEuler(new Vi(_[0],_[1],_[2],"XYZ"))}t.add(p),p.name=c,v.lights[c]=p,v.objects[c]=p}else if("PerspectiveCamera"===d.type||"OrthographicCamera"===d.type)s=d.position,o=d.rotation,h=d.quaternion,"PerspectiveCamera"===d.type?a=new Cr(d.fov,d.aspect,d.near,d.far):"OrthographicCamera"===d.type&&(a=new Uc(d.left,d.right,d.top,d.bottom,d.near,d.far)),a.name=c,a.position.fromArray(s),void 0!==h?a.quaternion.fromArray(h):void 0!==o?a.rotation.fromArray(o):d.target&&a.lookAt((new li).fromArray(d.target)),t.add(a),v.cameras[c]=a,v.objects[c]=a;else{if((u=new ln).name=c,void 0!==d.matrix){var M=new Fi;M.fromArray(d.matrix),M.decompose(u.position,u.quaternion,u.scale)}else void 0!==d.position&&u.position.fromArray(d.position),void 0!==d.rotation?u.rotation.fromArray(d.rotation):void 0!==d.quaternion&&u.quaternion.fromArray(d.quaternion),void 0!==d.scale&&u.scale.fromArray(d.scale);u.visible=void 0!==d.visible&&d.visible,t.add(u),v.objects[c]=u,v.empties[c]=u}if(u){if(void 0!==d.userData)for(var S in d.userData){var T=d.userData[S];u.userData[S]=T}if(void 0!==d.groups)for(var E=0;E<d.groups.length;E++){var A=d.groups[E];void 0===v.groups[A]&&(v.groups[A]=[]),v.groups[A].push(c)}}}void 0!==u&&void 0!==d.children&&R(u,d.children)}}function I(t,e,i,n,r){var a=r.position,s=r.rotation,o=r.quaternion,l=r.scale;t.position.fromArray(a),o?t.quaternion.fromArray(o):t.rotation.fromArray(s),t.scale.fromArray(l),n&&t.traverse(function(t){t.material=n});var h=void 0===r.visible||r.visible;t.traverse(function(t){t.visible=h}),i.add(t),t.name=e,v.objects[e]=t,C()}function D(t){return function(e,i){e.name=t,function(t,e,i){v.geometries[i]=t,v.face_materials[i]=e,C()}(e,i,t),d-=1,y.onLoadComplete(),z()}}function N(t,e,i,n){return function(r){I(r.content?r.content:r.dae?r.scene:r,t,e,i,n),d-=1,y.onLoadComplete(),z()}}function F(t){return function(e,i){e.name=t,v.geometries[t]=e,v.face_materials[t]=i}}function z(){var t={totalModels:f,totalTextures:g,loadedModels:f-d,loadedTextures:g-m};y.callbackProgress(t,v),y.onLoadProgress(),0===d&&0===m&&(!function(){for(var t=0;t<b.length;t++){var e=b[t],i=v.objects[e.targetName];i?e.object.target=i:(e.object.target=new ln,v.scene.add(e.object.target)),e.object.target.userData.targetInverse=e.object}}(),e(v))}var k,B,G,H,j,V,W,q,X,Y=function(t){return function(){!function(t){m-=t,z(),y.onLoadComplete()}(t)}};function Z(t,e){if(e(t),void 0!==t.children)for(var i in t.children)Z(t.children[i],e)}for(k in w.fogs)"linear"===(B=w.fogs[k]).type?s=new Qs(0,B.near,B.far):"exp2"===B.type&&(s=new Ks(0,B.density)),c=B.color,s.color.setRGB(c[0],c[1],c[2]),v.fogs[k]=s;for(G in w.geometries)(H=w.geometries[G]).type in this.geometryHandlers&&(d+=1,y.onLoadStart());for(var J in w.objects)Z(w.objects[J],function(t){t.type&&t.type in y.hierarchyHandlers&&(d+=1,y.onLoadStart())});for(G in f=d,w.geometries)if("cube"===(H=w.geometries[G]).type)(n=new sl(H.width,H.height,H.depth,H.widthSegments,H.heightSegments,H.depthSegments)).name=G,v.geometries[G]=n;else if("plane"===H.type)(n=new sh(H.width,H.height,H.widthSegments,H.heightSegments)).name=G,v.geometries[G]=n;else if("sphere"===H.type)(n=new dh(H.radius,H.widthSegments,H.heightSegments)).name=G,v.geometries[G]=n;else if("cylinder"===H.type)(n=new cl(H.topRad,H.botRad,H.height,H.radSegs,H.heightSegs)).name=G,v.geometries[G]=n;else if("torus"===H.type)(n=new xh(H.radius,H.tube,H.segmentsR,H.segmentsT)).name=G,v.geometries[G]=n;else if("icosahedron"===H.type)(n=new $l(H.radius,H.subdivisions)).name=G,v.geometries[G]=n;else if(H.type in this.geometryHandlers){(st=this.geometryHandlers[H.type].loaderObject).load(O(H.url,w.urlBaseType),D(G))}else if("Geometry"===H.type){var K=(st=new Sd).parse(H.data);K.geometry.name=H.uuid,v.geometries[H.uuid]=K.geometry}else if("embedded"===H.type){var Q=w.embeds[H.id];if(Q.metadata=w.metadata,Q){var $=this.geometryHandlers.ascii.loaderObject.parse(Q,"");F(G)($.geometry,$.materials)}}for(j in w.textures)if(V=w.textures[j],Array.isArray(V.url)){m+=V.url.length;for(var tt=0;tt<V.url.length;tt++)y.onLoadStart()}else m+=1,y.onLoadStart();for(j in g=m,w.textures){if(void 0!==(V=w.textures[j]).mapping&&void 0!==td[V.mapping]&&(V.mapping=td[V.mapping]),Array.isArray(V.url)){var it=V.url.length,rt=[];for(A=0;A<it;A++)rt[A]=O(V.url[A],w.urlBaseType);null!==(st=tc.getHandler(rt[0]))?(pt=st.load(rt,Y(it)),void 0!==V.mapping&&(pt.mapping=V.mapping)):(pt=(new oc).load(rt,Y(it))).mapping=V.mapping}else{if(V.image){var at=!1;for(var A in w.images)if(w.images[A].uuid===V.image){at=w.images[A];break}at&&(V.url=at.url)}var st,ot=O(V.url,w.urlBaseType),lt=Y(1);if(null!==(st=tc.getHandler(ot))?pt=st.load(ot,lt):(pt=new ni,(st=new sc).setCrossOrigin(""),function(t,e){st.load(ot,function(i){i.toDataURL=function(){return e},t.image=i,t.needsUpdate=!0,lt()})}(pt,V.url)),void 0!==V.mapping&&(pt.mapping=V.mapping),void 0!==td[V.minFilter]&&(pt.minFilter=td[V.minFilter]),void 0!==td[V.magFilter]&&(pt.magFilter=td[V.magFilter]),V.anisotropy&&(pt.anisotropy=V.anisotropy),V.repeat&&(pt.repeat.set(V.repeat[0],V.repeat[1]),1!==V.repeat[0]&&(pt.wrapS=et),1!==V.repeat[1]&&(pt.wrapT=et)),V.offset&&pt.offset.set(V.offset[0],V.offset[1]),V.wrap){var ht={repeat:et,mirror:nt};void 0!==ht[V.wrap[0]]&&(pt.wrapS=ht[V.wrap[0]]),void 0!==ht[V.wrap[1]]&&(pt.wrapT=ht[V.wrap[1]])}}v.textures[j]=pt,V.loadedTexture=pt}for(W in w.materials){for(X in(q=w.materials[W]).parameters)if("envMap"===X||"map"===X||"lightMap"===X||"bumpMap"===X||"normalMap"===X||"alphaMap"===X)q.parameters[X]=v.textures[q.parameters[X]];else if("shading"===X)q.parameters[X]="flat"===q.parameters[X]?1:2;else if("side"===X)"double"==q.parameters[X]?q.parameters[X]=h:"back"==q.parameters[X]?q.parameters[X]=l:q.parameters[X]=o;else if("blending"===X)q.parameters[X]=q.parameters[X]in td?td[q.parameters[X]]:u;else if("combine"===X)q.parameters[X]=q.parameters[X]in td?td[q.parameters[X]]:U;else if("vertexColors"===X)"face"==q.parameters[X]?q.parameters[X]=Vp:q.parameters[X]&&(q.parameters[X]=Wp);else if("wrapRGB"===X){var ct=q.parameters[X];q.parameters[X]=new li(ct[0],ct[1],ct[2])}else if("normalScale"===X){var ut=q.parameters[X];q.parameters[X]=new Qe(ut[0],ut[1])}if(void 0===q.parameters){if(q.map){var pt=!1;for(var A in w.textures)if(w.textures[A].uuid===q.map){pt=w.textures[A];break}pt&&(q.map=pt.loadedTexture)}W=q.uuid,r="MeshFaceMaterial"===q.type||"MultiMaterial"===q.type?q.materials:new td[q.type](q)}else void 0!==q.parameters.opacity&&q.parameters.opacity<1&&(q.parameters.transparent=!0),void 0!==q.parameters.ambient&&(void 0===q.parameters.color&&(q.parameters.color=q.parameters.ambient),delete q.parameters.ambient),void 0!==q.parameters.emissive&&(void 0===q.parameters.color&&(q.parameters.color=q.parameters.emissive),delete q.parameters.emissive),void 0!==q.parameters.reflectionMap&&delete q.parameters.reflectionMap,r="MeshFaceMaterial"===q.type||"MultiMaterial"===q.type?q.parameters.materials:new td[q.type](q.parameters);r.name=W,v.materials[W]=r}for(W in w.materials)if((q=w.materials[W]).parameters&&q.parameters.materials){var dt=[];for(A=0;A<q.parameters.materials.length;A++){var mt=q.parameters.materials[A];dt.push(v.materials[mt])}v.materials[W]=dt}C(),v.cameras&&w.defaults&&w.defaults.camera&&(v.currentCamera=v.cameras[w.defaults.camera]),v.fogs&&w.defaults&&w.defaults.fog&&(v.scene.fog=v.fogs[w.defaults.fog]),y.callbackSync(v),z()}};var Kd=function(){function t(t){ec.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new s(t)}),this.register(function(t){return new c(t)}),this.register(function(t){return new u(t)}),this.register(function(t){return new l(t)}),this.register(function(t){return new r(t)}),this.register(function(t){return new p(t)})}function e(){var t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(ec.prototype),{constructor:t,load:function(t,e,i,n){var r,a=this;r=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Yc.extractUrlBase(t),this.manager.itemStart(t);var s=function(e){n?n(e):console.error(e),a.manager.itemError(t),a.manager.itemEnd(t)},o=new nc(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(i){try{a.parse(i,r,function(i){e(i),a.manager.itemEnd(t)},s)}catch(t){s(t)}},i,s)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},setKTX2Loader:function(t){return this.ktx2Loader=t,this},setMeshoptDecoder:function(t){return this.meshoptDecoder=t,this},register:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse:function(t,e,r,s){var o,l,h={},c={};if("string"==typeof t)o=t,l=JSON.parse(o);else if(t instanceof ArrayBuffer){if(Yc.decodeText(new Uint8Array(t,0,4))===d){try{h[i.KHR_BINARY_GLTF]=new g(t)}catch(t){return void(s&&s(t))}o=h[i.KHR_BINARY_GLTF].content}else o=Yc.decodeText(new Uint8Array(t));l=JSON.parse(o)}else l=t;if(void 0===l.asset||l.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var u=new W(l,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(var p=0;p<this.pluginCallbacks.length;p++){var m=this.pluginCallbacks[p](u);c[m.name]=m,h[m.name]=!0}if(l.extensionsUsed)for(p=0;p<l.extensionsUsed.length;++p){var f=l.extensionsUsed[p],x=l.extensionsRequired||[];switch(f){case i.KHR_MATERIALS_UNLIT:h[f]=new a;break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:h[f]=new b;break;case i.KHR_DRACO_MESH_COMPRESSION:h[f]=new v(l,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:h[f]=new n(this.ddsLoader);break;case i.KHR_TEXTURE_TRANSFORM:h[f]=new y;break;case i.KHR_MESH_QUANTIZATION:h[f]=new w;break;default:x.indexOf(f)>=0&&void 0===c[f]&&console.warn('THREE.GLTFLoader: Unknown extension "'+f+'".')}}u.setExtensions(h),u.setPlugins(c),u.parse(r,s)}}});var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function n(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=t}function r(t){this.parser=t,this.name=i.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function a(){this.name=i.KHR_MATERIALS_UNLIT}function s(t){this.parser=t,this.name=i.KHR_MATERIALS_CLEARCOAT}function l(t){this.parser=t,this.name=i.KHR_MATERIALS_TRANSMISSION}function c(t){this.parser=t,this.name=i.KHR_TEXTURE_BASISU}function u(t){this.parser=t,this.name=i.EXT_TEXTURE_WEBP,this.isSupported=null}function p(t){this.name=i.EXT_MESHOPT_COMPRESSION,this.parser=t}r.prototype._markDefs=function(){for(var t=this.parser,e=this.parser.json.nodes||[],i=0,n=e.length;i<n;i++){var r=e[i];r.extensions&&r.extensions[this.name]&&void 0!==r.extensions[this.name].light&&t._addNodeRef(this.cache,r.extensions[this.name].light)}},r.prototype._loadLight=function(t){var e=this.parser,i="light:"+t,n=e.cache.get(i);if(n)return n;var r,a=e.json,s=((a.extensions&&a.extensions[this.name]||{}).lights||[])[t],o=new On(16777215);void 0!==s.color&&o.fromArray(s.color);var l=void 0!==s.range?s.range:0;switch(s.type){case"directional":(r=new Hc(o)).target.position.set(0,0,-1),r.add(r.target);break;case"point":(r=new Bc(o)).distance=l;break;case"spot":(r=new zc(o)).distance=l,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,r.angle=s.spot.outerConeAngle,r.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,r.target.position.set(0,0,-1),r.add(r.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+s.type+'".')}return r.position.set(0,0,0),r.decay=2,void 0!==s.intensity&&(r.intensity=s.intensity),r.name=e.createUniqueName(s.name||"light_"+t),n=Promise.resolve(r),e.cache.add(i,n),n},r.prototype.createNodeAttachment=function(t){var e=this,i=this.parser,n=i.json.nodes[t],r=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then(function(t){return i._getNodeRef(e.cache,r,t)})},a.prototype.getMaterialType=function(){return Dn},a.prototype.extendParams=function(t,e,i){var n=[];t.color=new On(1,1,1),t.opacity=1;var r=e.pbrMetallicRoughness;if(r){if(Array.isArray(r.baseColorFactor)){var a=r.baseColorFactor;t.color.fromArray(a),t.opacity=a[3]}void 0!==r.baseColorTexture&&n.push(i.assignTexture(t,"map",r.baseColorTexture))}return Promise.all(n)},s.prototype.getMaterialType=function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Lh:null},s.prototype.extendMaterialParams=function(t,e){var i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=[],a=n.extensions[this.name];if(void 0!==a.clearcoatFactor&&(e.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&r.push(i.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&r.push(i.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(r.push(i.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){var s=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new Qe(s,s)}return Promise.all(r)},l.prototype.getMaterialType=function(t){var e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Lh:null},l.prototype.extendMaterialParams=function(t,e){var i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();var r=[],a=n.extensions[this.name];return void 0!==a.transmissionFactor&&(e.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&r.push(i.assignTexture(e,"transmissionMap",a.transmissionTexture)),Promise.all(r)},c.prototype.loadTexture=function(t){var e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;var r=n.extensions[this.name],a=i.images[r.source],s=e.options.ktx2Loader;if(!s){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,a,s)},u.prototype.loadTexture=function(t){var e=this.name,i=this.parser,n=i.json,r=n.textures[t];if(!r.extensions||!r.extensions[e])return null;var a=r.extensions[e],s=n.images[a.source],o=s.uri?i.options.manager.getHandler(s.uri):i.textureLoader;return this.detectSupport().then(function(r){if(r)return i.loadTextureImage(t,s,o);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)})},u.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise(function(t){var e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}})),this.isSupported},p.prototype.loadBufferView=function(t){var e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){var n=i.extensions[this.name],r=this.parser.getDependency("buffer",n.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([r,a.ready]).then(function(t){var e=n.byteOffset||0,i=n.byteLength||0,r=n.count,s=n.byteStride,o=new ArrayBuffer(r*s),l=new Uint8Array(t[0],e,i);return a.decodeGltfBuffer(new Uint8Array(o),r,s,l,n.mode,n.filter),o})}return null};var d="glTF",m=12,f={JSON:1313821514,BIN:5130562};function g(t){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var e=new DataView(t,0,m);if(this.header={magic:Yc.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==d)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=new DataView(t,m),r=0;r<n.byteLength;){var a=n.getUint32(r,!0);r+=4;var s=n.getUint32(r,!0);if(r+=4,s===f.JSON){var o=new Uint8Array(t,m+r,a);this.content=Yc.decodeText(o)}else if(s===f.BIN){var l=m+r;this.body=t.slice(l,l+a)}r+=a}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function v(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function y(){this.name=i.KHR_TEXTURE_TRANSFORM}function x(t){Ph.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),i=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),r=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new On).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(t){for(var o in s)t.uniforms[o]=s[o];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",r).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(t){s.specular.value=t}},specularMap:{get:function(){return s.specularMap.value},set:function(t){s.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(t){s.glossiness.value=t}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(t){s.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function b(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return x},extendParams:function(t,e,i){var n=e.extensions[this.name];t.color=new On(1,1,1),t.opacity=1;var r=[];if(Array.isArray(n.diffuseFactor)){var a=n.diffuseFactor;t.color.fromArray(a),t.opacity=a[3]}if(void 0!==n.diffuseTexture&&r.push(i.assignTexture(t,"map",n.diffuseTexture)),t.emissive=new On(0,0,0),t.glossiness=void 0!==n.glossinessFactor?n.glossinessFactor:1,t.specular=new On(1,1,1),Array.isArray(n.specularFactor)&&t.specular.fromArray(n.specularFactor),void 0!==n.specularGlossinessTexture){var s=n.specularGlossinessTexture;r.push(i.assignTexture(t,"glossinessMap",s)),r.push(i.assignTexture(t,"specularMap",s))}return Promise.all(r)},createMaterial:function(t){var e=new x(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=Ge,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function w(){this.name=i.KHR_MESH_QUANTIZATION}function _(t,e,i,n){kh.call(this,t,e,i,n)}v.prototype.decodePrimitive=function(t,e){var i=this.json,n=this.dracoLoader,r=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,s={},o={},l={};for(var h in a){var c=D[h]||h.toLowerCase();s[c]=a[h]}for(h in t.attributes){c=D[h]||h.toLowerCase();if(void 0!==a[h]){var u=i.accessors[t.attributes[h]],p=O[u.componentType];l[c]=p,o[c]=!0===u.normalized}}return e.getDependency("bufferView",r).then(function(t){return new Promise(function(e){n.decodeDracoFile(t,function(t){for(var i in t.attributes){var n=t.attributes[i],r=o[i];void 0!==r&&(n.normalized=r)}e(t)},s,l)})})},y.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},x.prototype=Object.create(Ph.prototype),x.prototype.constructor=x,x.prototype.copy=function(t){return Ph.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},_.prototype=Object.create(kh.prototype),_.prototype.constructor=_,_.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n*3+n,a=0;a!==n;a++)e[a]=i[r+a];return e},_.prototype.beforeStart_=_.prototype.copySampleValue_,_.prototype.afterEnd_=_.prototype.copySampleValue_,_.prototype.interpolate_=function(t,e,i,n){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,o=2*s,l=3*s,h=n-e,c=(i-e)/h,u=c*c,p=u*c,d=t*l,m=d-l,f=-2*p+3*u,g=p-u,v=1-f,y=g-u+c,x=0;x!==s;x++){var b=a[m+x+s],w=a[m+x+o]*h,_=a[d+x+s],M=a[d+x]*h;r[x]=v*b+y*w+f*_+g*M}return r};var M=0,S=1,T=2,E=3,A=4,P=5,L=6,O={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},C={9728:rt,9729:ot,9984:at,9985:lt,9986:st,9987:ht},R={33071:it,33648:nt,10497:et},I={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},D={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},N={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},F={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},z="OPAQUE",k="MASK",B="BLEND";function U(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)?t:/^data:.*,.*$/i.test(t)?t:/^blob:.*$/i.test(t)?t:e+t)}function G(t,e,i){for(var n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function H(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function j(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){var r=e.extras.targetNames;if(t.morphTargetInfluences.length===r.length){t.morphTargetDictionary={};for(i=0,n=r.length;i<n;i++)t.morphTargetDictionary[r[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function V(t){for(var e="",i=Object.keys(t).sort(),n=0,r=i.length;n<r;n++)e+=i[n]+":"+t[i[n]]+";";return e}function W(t,i){this.json=t||{},this.extensions={},this.plugins={},this.options=i||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new nu(this.options.manager):this.textureLoader=new hc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new nc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function q(t,e,i){var n=e.attributes,r=[];function a(e,n){return i.getDependency("accessor",e).then(function(e){t.setAttribute(n,e)})}for(var s in n){var o=D[s]||s.toLowerCase();o in t.attributes||r.push(a(n[s],o))}if(void 0!==e.indices&&!t.index){var l=i.getDependency("accessor",e.indices).then(function(e){t.setIndex(e)});r.push(l)}return H(t,e),function(t,e,i){var n=e.attributes,r=new ui;if(void 0!==n.POSITION){var a=(p=i.json.accessors[n.POSITION]).min,s=p.max;if(void 0!==a&&void 0!==s){r.set(new li(a[0],a[1],a[2]),new li(s[0],s[1],s[2]));var o=e.targets;if(void 0!==o){for(var l=new li,h=new li,c=0,u=o.length;c<u;c++){var p,d=o[c];if(void 0!==d.POSITION)a=(p=i.json.accessors[d.POSITION]).min,s=p.max,void 0!==a&&void 0!==s?(h.setX(Math.max(Math.abs(a[0]),Math.abs(s[0]))),h.setY(Math.max(Math.abs(a[1]),Math.abs(s[1]))),h.setZ(Math.max(Math.abs(a[2]),Math.abs(s[2]))),l.max(h)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}r.expandByVector(l)}t.boundingBox=r;var m=new Ai;r.getCenter(m.center),m.radius=r.min.distanceTo(r.max)/2,t.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,e,i),Promise.all(r).then(function(){return void 0!==e.targets?function(t,e,i){for(var n=!1,r=!1,a=0,s=e.length;a<s&&(void 0!==(h=e[a]).POSITION&&(n=!0),void 0!==h.NORMAL&&(r=!0),!n||!r);a++);if(!n&&!r)return Promise.resolve(t);var o=[],l=[];for(a=0,s=e.length;a<s;a++){var h=e[a];if(n){var c=void 0!==h.POSITION?i.getDependency("accessor",h.POSITION):t.attributes.position;o.push(c)}r&&(c=void 0!==h.NORMAL?i.getDependency("accessor",h.NORMAL):t.attributes.normal,l.push(c))}return Promise.all([Promise.all(o),Promise.all(l)]).then(function(e){var i=e[0],a=e[1];return n&&(t.morphAttributes.position=i),r&&(t.morphAttributes.normal=a),t.morphTargetsRelative=!0,t})}(t,e.targets,i):t})}function X(t,e){var i=t.getIndex();if(null===i){var n=[],r=t.getAttribute("position");if(void 0===r)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var a=0;a<r.count;a++)n.push(a);t.setIndex(n),i=t.getIndex()}var s=i.count-2,o=[];if(e===Oe)for(a=1;a<=s;a++)o.push(i.getX(0)),o.push(i.getX(a)),o.push(i.getX(a+1));else for(a=0;a<s;a++)a%2==0?(o.push(i.getX(a)),o.push(i.getX(a+1)),o.push(i.getX(a+2))):(o.push(i.getX(a+2)),o.push(i.getX(a+1)),o.push(i.getX(a)));o.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=t.clone();return l.setIndex(o),l}return W.prototype.setExtensions=function(t){this.extensions=t},W.prototype.setPlugins=function(t){this.plugins=t},W.prototype.parse=function(t,e){var i=this,n=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll(function(t){return t._markDefs&&t._markDefs()}),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(e){var a={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};G(r,a,n),H(a,n),t(a)}).catch(e)},W.prototype._markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[],n=0,r=e.length;n<r;n++)for(var a=e[n].joints,s=0,o=a.length;s<o;s++)t[a[s]].isBone=!0;for(var l=0,h=t.length;l<h;l++){var c=t[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(i[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},W.prototype._addNodeRef=function(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)},W.prototype._getNodeRef=function(t,e,i){if(t.refs[e]<=1)return i;var n=i.clone();return n.name+="_instance_"+t.uses[e]++,n},W.prototype._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var i=0;i<e.length;i++){var n=t(e[i]);if(n)return n}},W.prototype._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var i=[],n=0;n<e.length;n++){var r=t(e[n]);r&&i.push(r)}return i},W.prototype.getDependency=function(t,e){var i=t+":"+e,n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this.loadNode(e);break;case"mesh":n=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(e)});break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(e)});break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(e)});break;case"texture":n=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(e)});break;case"skin":n=this.loadSkin(e);break;case"animation":n=this.loadAnimation(e);break;case"camera":n=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n},W.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map(function(e,n){return i.getDependency(t,n)})),this.cache.add(t,e)}return e},W.prototype.loadBuffer=function(t){var e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var r=this.options;return new Promise(function(t,i){n.load(U(e.uri,r.path),t,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})},W.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(t){var i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)})},W.prototype.loadAccessor=function(t){var e=this,i=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse)return Promise.resolve(null);var r=[];return void 0!==n.bufferView?r.push(this.getDependency("bufferView",n.bufferView)):r.push(null),void 0!==n.sparse&&(r.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),r.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(r).then(function(t){var r,a=t[0],s=I[n.type],o=O[n.componentType],l=o.BYTES_PER_ELEMENT,h=l*s,c=n.byteOffset||0,u=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,p=!0===n.normalized;if(u&&u!==h){var d=Math.floor(c/u),m="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+d+":"+n.count,f=e.cache.get(m);f||(f=new to(new o(a,d*u,n.count*u/l),u/l),e.cache.add(m,f)),r=new io(f,s,c%u/l,p)}else r=new zn(null===a?new o(n.count*s):new o(a,c,n.count*s),s,p);if(void 0!==n.sparse){var g=I.SCALAR,v=O[n.sparse.indices.componentType],y=n.sparse.indices.byteOffset||0,x=n.sparse.values.byteOffset||0,b=new v(t[1],y,n.sparse.count*g),w=new o(t[2],x,n.sparse.count*s);null!==a&&(r=new zn(r.array.slice(),r.itemSize,r.normalized));for(var _=0,M=b.length;_<M;_++){var S=b[_];if(r.setX(S,w[_*s]),s>=2&&r.setY(S,w[_*s+1]),s>=3&&r.setZ(S,w[_*s+2]),s>=4&&r.setW(S,w[_*s+3]),s>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r})},W.prototype.loadTexture=function(t){var e,n,r=this.json,a=this.options,s=r.textures[t],o=s.extensions||{};return(e=o[i.MSFT_TEXTURE_DDS]?r.images[o[i.MSFT_TEXTURE_DDS].source]:r.images[s.source]).uri&&(n=a.manager.getHandler(e.uri)),n||(n=o[i.MSFT_TEXTURE_DDS]?this.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(t,e,n)},W.prototype.loadTextureImage=function(t,e,i){var n=this,r=this.json,a=this.options,s=r.textures[t],o=self.URL||self.webkitURL,l=e.uri,h=!1,c=!0;return"image/jpeg"===e.mimeType&&(c=!1),void 0!==e.bufferView&&(l=n.getDependency("bufferView",e.bufferView).then(function(t){if("image/png"===e.mimeType){var i=new DataView(t,25,1).getUint8(0,!1);c=6===i||4===i||3===i}h=!0;var n=new Blob([t],{type:e.mimeType});return l=o.createObjectURL(n)})),Promise.resolve(l).then(function(t){return new Promise(function(e,n){var r=e;!0===i.isImageBitmapLoader&&(r=function(t){e(new $o(t))}),i.load(U(t,a.path),r,void 0,n)})}).then(function(e){!0===h&&o.revokeObjectURL(l),e.flipY=!1,s.name&&(e.name=s.name),c||(e.format=Mt);var i=(r.samplers||{})[s.sampler]||{};return e.magFilter=C[i.magFilter]||ot,e.minFilter=C[i.minFilter]||ht,e.wrapS=R[i.wrapS]||et,e.wrapT=R[i.wrapT]||et,n.associations.set(e,{type:"textures",index:t}),e})},W.prototype.assignTexture=function(t,e,n){var r=this;return this.getDependency("texture",n.index).then(function(a){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),r.extensions[i.KHR_TEXTURE_TRANSFORM]){var s=void 0!==n.extensions?n.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;if(s){var o=r.associations.get(a);a=r.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(a,s),r.associations.set(a,o)}}t[e]=a})},W.prototype.assignFinalMaterial=function(t){var e=t.geometry,i=t.material,n=void 0!==e.attributes.tangent,r=void 0!==e.attributes.color,a=void 0===e.attributes.normal,s=!0===t.isSkinnedMesh,o=Object.keys(e.morphAttributes).length>0,l=o&&void 0!==e.morphAttributes.normal;if(t.isPoints){var h="PointsMaterial:"+i.uuid,c=this.cache.get(h);c||(c=new Vo,In.prototype.copy.call(c,i),c.color.copy(i.color),c.map=i.map,c.sizeAttenuation=!1,this.cache.add(h,c)),i=c}else if(t.isLine){h="LineBasicMaterial:"+i.uuid;var u=this.cache.get(h);u||(u=new Io,In.prototype.copy.call(u,i),u.color.copy(i.color),this.cache.add(h,u)),i=u}if(n||r||a||s||o){h="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(h+="specular-glossiness:"),s&&(h+="skinning:"),n&&(h+="vertex-tangents:"),r&&(h+="vertex-colors:"),a&&(h+="flat-shading:"),o&&(h+="morph-targets:"),l&&(h+="morph-normals:");var p=this.cache.get(h);p||(p=i.clone(),s&&(p.skinning=!0),n&&(p.vertexTangents=!0),r&&(p.vertexColors=!0),a&&(p.flatShading=!0),o&&(p.morphTargets=!0),l&&(p.morphNormals=!0),this.cache.add(h,p),this.associations.set(p,this.associations.get(i))),i=p}i.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),i.normalScale&&!n&&(i.normalScale.y=-i.normalScale.y),i.clearcoatNormalScale&&!n&&(i.clearcoatNormalScale.y=-i.clearcoatNormalScale.y),t.material=i},W.prototype.getMaterialType=function(){return Ph},W.prototype.loadMaterial=function(t){var e,n=this,r=this.json,a=this.extensions,s=r.materials[t],o={},l=s.extensions||{},c=[];if(l[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var u=a[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=u.getMaterialType(),c.push(u.extendParams(o,s,n))}else if(l[i.KHR_MATERIALS_UNLIT]){var p=a[i.KHR_MATERIALS_UNLIT];e=p.getMaterialType(),c.push(p.extendParams(o,s,n))}else{var d=s.pbrMetallicRoughness||{};if(o.color=new On(1,1,1),o.opacity=1,Array.isArray(d.baseColorFactor)){var m=d.baseColorFactor;o.color.fromArray(m),o.opacity=m[3]}void 0!==d.baseColorTexture&&c.push(n.assignTexture(o,"map",d.baseColorTexture)),o.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,o.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(n.assignTexture(o,"metalnessMap",d.metallicRoughnessTexture)),c.push(n.assignTexture(o,"roughnessMap",d.metallicRoughnessTexture))),e=this._invokeOne(function(e){return e.getMaterialType&&e.getMaterialType(t)}),c.push(Promise.all(this._invokeAll(function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)})))}!0===s.doubleSided&&(o.side=h);var f=s.alphaMode||z;return f===B?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,f===k&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&e!==Dn&&(c.push(n.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new Qe(1,1),void 0!==s.normalTexture.scale&&o.normalScale.set(s.normalTexture.scale,s.normalTexture.scale)),void 0!==s.occlusionTexture&&e!==Dn&&(c.push(n.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&e!==Dn&&(o.emissive=(new On).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&e!==Dn&&c.push(n.assignTexture(o,"emissiveMap",s.emissiveTexture)),Promise.all(c).then(function(){var r;return r=e===x?a[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new e(o),s.name&&(r.name=s.name),r.map&&(r.map.encoding=Re),r.emissiveMap&&(r.emissiveMap.encoding=Re),H(r,s),n.associations.set(r,{type:"materials",index:t}),s.extensions&&G(a,r,s),r})},W.prototype.createUniqueName=function(t){for(var e=zu.sanitizeNodeName(t||""),i=1;this.nodeNamesUsed[e];++i)e=t+"_"+i;return this.nodeNamesUsed[e]=!0,e},W.prototype.loadGeometries=function(t){var e=this,n=this.extensions,r=this.primitiveCache;function a(t){return n[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then(function(i){return q(i,t,e)})}for(var s,o,l=[],h=0,c=t.length;h<c;h++){var u,p=t[h],d=(o=void 0,(o=(s=p).extensions&&s.extensions[i.KHR_DRACO_MESH_COMPRESSION])?"draco:"+o.bufferView+":"+o.indices+":"+V(o.attributes):s.indices+":"+V(s.attributes)+":"+s.mode),m=r[d];if(m)l.push(m.promise);else u=p.extensions&&p.extensions[i.KHR_DRACO_MESH_COMPRESSION]?a(p):q(new ir,p,e),r[d]={primitive:p,promise:u},l.push(u)}return Promise.all(l)},W.prototype.loadMesh=function(t){for(var e,i=this,n=this.json,r=this.extensions,a=n.meshes[t],s=a.primitives,l=[],h=0,c=s.length;h<c;h++){var u=void 0===s[h].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new Ph({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:o})),e.DefaultMaterial):this.getDependency("material",s[h].material);l.push(u)}return l.push(i.loadGeometries(s)),Promise.all(l).then(function(e){for(var n=e.slice(0,e.length-1),o=e[e.length-1],l=[],h=0,c=o.length;h<c;h++){var u,p=o[h],d=s[h],m=n[h];if(d.mode===A||d.mode===P||d.mode===L||void 0===d.mode)!0!==(u=!0===a.isSkinnedMesh?new Mo(p,m):new br(p,m)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),d.mode===P?u.geometry=X(u.geometry,1):d.mode===L&&(u.geometry=X(u.geometry,Oe));else if(d.mode===S)u=new Ho(p,m);else if(d.mode===E)u=new Bo(p,m);else if(d.mode===T)u=new jo(p,m);else{if(d.mode!==M)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);u=new Zo(p,m)}Object.keys(u.geometry.morphAttributes).length>0&&j(u,a),u.name=i.createUniqueName(a.name||"mesh_"+t),H(u,a),d.extensions&&G(r,u,d),i.assignFinalMaterial(u),l.push(u)}if(1===l.length)return l[0];var f=new Ws;for(h=0,c=l.length;h<c;h++)f.add(l[h]);return f})},W.prototype.loadCamera=function(t){var e,i=this.json.cameras[t],n=i[i.type];if(n)return"perspective"===i.type?e=new Cr(Ke.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(e=new Uc(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),H(e,i),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},W.prototype.loadSkin=function(t){var e=this.json.skins[t],i={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(i):this.getDependency("accessor",e.inverseBindMatrices).then(function(t){return i.inverseBindMatrices=t,i})},W.prototype.loadAnimation=function(t){for(var e=this.json.animations[t],i=[],n=[],r=[],a=[],s=[],o=0,l=e.channels.length;o<l;o++){var h=e.channels[o],c=e.samplers[h.sampler],u=h.target,p=void 0!==u.node?u.node:u.id,d=void 0!==e.parameters?e.parameters[c.input]:c.input,m=void 0!==e.parameters?e.parameters[c.output]:c.output;i.push(this.getDependency("node",p)),n.push(this.getDependency("accessor",d)),r.push(this.getDependency("accessor",m)),a.push(c),s.push(u)}return Promise.all([Promise.all(i),Promise.all(n),Promise.all(r),Promise.all(a),Promise.all(s)]).then(function(i){for(var n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=[],h=0,c=n.length;h<c;h++){var u=n[h],p=r[h],d=a[h],m=s[h],f=o[h];if(void 0!==u){var g;switch(u.updateMatrix(),u.matrixAutoUpdate=!0,N[f.path]){case N.weights:g=Wh;break;case N.rotation:g=Xh;break;case N.position:case N.scale:default:g=Zh}var v=u.name?u.name:u.uuid,y=void 0!==m.interpolation?F[m.interpolation]:2301,x=[];N[f.path]===N.weights?u.traverse(function(t){!0===t.isMesh&&t.morphTargetInfluences&&x.push(t.name?t.name:t.uuid)}):x.push(v);var b=d.array;if(d.normalized){var w;if(b.constructor===Int8Array)w=1/127;else if(b.constructor===Uint8Array)w=1/255;else if(b.constructor==Int16Array)w=1/32767;else{if(b.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var M=new Float32Array(b.length),S=0,T=b.length;S<T;S++)M[S]=b[S]*w;b=M}for(S=0,T=x.length;S<T;S++){var E=new g(x[S]+"."+N[f.path],p.array,b,y);"CUBICSPLINE"===m.interpolation&&(E.createInterpolant=function(t){return new _(this.times,this.values,this.getValueSize()/3,t)},E.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(E)}}}return new Jh(e.name?e.name:"animation_"+t,void 0,l)})},W.prototype.loadNode=function(t){var e,i=this.json,n=this.extensions,r=this,a=i.nodes[t],s=a.name?r.createUniqueName(a.name):"";return(e=[],void 0!==a.mesh&&e.push(r.getDependency("mesh",a.mesh).then(function(t){var e=r._getNodeRef(r.meshCache,a.mesh,t);return void 0!==a.weights&&e.traverse(function(t){if(t.isMesh)for(var e=0,i=a.weights.length;e<i;e++)t.morphTargetInfluences[e]=a.weights[e]}),e})),void 0!==a.camera&&e.push(r.getDependency("camera",a.camera).then(function(t){return r._getNodeRef(r.cameraCache,a.camera,t)})),r._invokeAll(function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)}).forEach(function(t){e.push(t)}),Promise.all(e)).then(function(e){var i;if((i=!0===a.isBone?new Ao:e.length>1?new Ws:1===e.length?e[0]:new ln)!==e[0])for(var o=0,l=e.length;o<l;o++)i.add(e[o]);if(a.name&&(i.userData.name=a.name,i.name=s),H(i,a),a.extensions&&G(n,i,a),void 0!==a.matrix){var h=new Fi;h.fromArray(a.matrix),i.applyMatrix4(h)}else void 0!==a.translation&&i.position.fromArray(a.translation),void 0!==a.rotation&&i.quaternion.fromArray(a.rotation),void 0!==a.scale&&i.scale.fromArray(a.scale);return r.associations.set(i,{type:"nodes",index:t}),i})},W.prototype.loadScene=function(){function t(e,i,n,r){var a=n.nodes[e];return r.getDependency("node",e).then(function(t){return void 0===a.skin?t:r.getDependency("skin",a.skin).then(function(t){for(var i=[],n=0,a=(e=t).joints.length;n<a;n++)i.push(r.getDependency("node",e.joints[n]));return Promise.all(i)}).then(function(i){return t.traverse(function(t){if(t.isMesh){for(var n=[],r=[],a=0,s=i.length;a<s;a++){var o=i[a];if(o){n.push(o);var l=new Fi;void 0!==e.inverseBindMatrices&&l.fromArray(e.inverseBindMatrices.array,16*a),r.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[a])}t.bind(new Eo(n,r),t.matrixWorld)}}),t});var e}).then(function(e){i.add(e);var s=[];if(a.children)for(var o=a.children,l=0,h=o.length;l<h;l++){var c=o[l];s.push(t(c,e,n,r))}return Promise.all(s)})}return function(e){var i=this.json,n=this.extensions,r=this.json.scenes[e],a=new Ws;r.name&&(a.name=this.createUniqueName(r.name)),H(a,r),r.extensions&&G(n,a,r);for(var s=r.nodes||[],o=[],l=0,h=s.length;l<h;l++)o.push(t(s[l],a,i,this));return Promise.all(o).then(function(){return a})}}(),t}(),Qd=function(t){ec.call(this,t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};Qd.prototype=Object.assign(Object.create(ec.prototype),{constructor:Qd,setDecoderPath:function(t){return this.decoderPath=t,this},setDecoderConfig:function(t){return this.decoderConfig=t,this},setWorkerLimit:function(t){return this.workerLimit=t,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(t,e,i,n){var r=new nc(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(t,t=>{var i={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,i).then(e).catch(n)},i,n)},decodeDracoFile:function(t,e,i,n){var r={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i};this.decodeGeometry(t,r).then(e)},decodeGeometry:function(t,e){for(var i in e.attributeTypes){var n=e.attributeTypes[i];void 0!==n.BYTES_PER_ELEMENT&&(e.attributeTypes[i]=n.name)}var r,a=JSON.stringify(e);if(Qd.taskCache.has(t)){var s=Qd.taskCache.get(t);if(s.key===a)return s.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var o=this.workerNextTaskID++,l=t.byteLength,h=this._getWorker(o,l).then(i=>(r=i,new Promise((i,n)=>{r._callbacks[o]={resolve:i,reject:n},r.postMessage({type:"decode",id:o,taskConfig:e,buffer:t},[t])}))).then(t=>this._createGeometry(t.geometry));return h.catch(()=>!0).then(()=>{r&&o&&this._releaseTask(r,o)}),Qd.taskCache.set(t,{key:a,promise:h}),h},_createGeometry:function(t){var e=new ir;t.index&&e.setIndex(new zn(t.index.array,1));for(var i=0;i<t.attributes.length;i++){var n=t.attributes[i],r=n.name,a=n.array,s=n.itemSize;e.setAttribute(r,new zn(a,s))}return e},_loadLibrary:function(t,e){var i=new nc(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((e,n)=>{i.load(t,e,void 0,n)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(e=>{var i=e[0];t||(this.decoderConfig.wasmBinary=e[1]);var n=Qd.DRACOWorker.toString(),r=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending},_getWorker:function(t,e){return this._initDecoder().then(()=>{var i;this.workerPool.length<this.workerLimit?((i=new Worker(this.workerSourceURL))._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(t){var e=t.data;switch(e.type){case"decode":i._callbacks[e.id].resolve(e);break;case"error":i._callbacks[e.id].reject(e);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+e.type+'"')}},this.workerPool.push(i)):this.workerPool.sort(function(t,e){return t._taskLoad>e._taskLoad?-1:1});return(i=this.workerPool[this.workerPool.length-1])._taskCosts[t]=e,i._taskLoad+=e,i})},_releaseTask:function(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]},debug:function(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))},dispose:function(){for(var t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}),Qd.DRACOWorker=function(){var t,e;function i(t,e,i,n,r,a){var s=a.num_components(),o=i.num_points()*s,l=o*r.BYTES_PER_ELEMENT,h=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),c=t._malloc(l);e.GetAttributeDataArrayForAllPoints(i,a,h,l,c);var u=new r(t.HEAPF32.buffer,c,o).slice();return t._free(c),{name:n,array:u,itemSize:s}}onmessage=function(n){var r=n.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise(function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)});break;case"decode":var a=r.buffer,s=r.taskConfig;e.then(t=>{var e=t.draco,n=new e.Decoder,o=new e.DecoderBuffer;o.Init(new Int8Array(a),a.byteLength);try{var l=function(t,e,n,r){var a,s,o=r.attributeIDs,l=r.attributeTypes,h=e.GetEncodedGeometryType(n);if(h===t.TRIANGULAR_MESH)a=new t.Mesh,s=e.DecodeBufferToMesh(n,a);else{if(h!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new t.PointCloud,s=e.DecodeBufferToPointCloud(n,a)}if(!s.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var c={index:null,attributes:[]};for(var u in o){var p,d,m=self[l[u]];if(r.useUniqueIDs)d=o[u],p=e.GetAttributeByUniqueId(a,d);else{if(-1===(d=e.GetAttributeId(a,t[o[u]])))continue;p=e.GetAttribute(a,d)}c.attributes.push(i(t,e,a,u,m,p))}h===t.TRIANGULAR_MESH&&(c.index=function(t,e,i){var n=3*i.num_faces(),r=4*n,a=t._malloc(r);e.GetTrianglesUInt32Array(i,r,a);var s=new Uint32Array(t.HEAPF32.buffer,a,n).slice();return t._free(a),{array:s,itemSize:1}}(t,e,a));return t.destroy(a),c}(e,n,o,s),h=l.attributes.map(t=>t.array.buffer);l.index&&h.push(l.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:l},h)}catch(t){console.error(t),self.postMessage({type:"error",id:r.id,error:t.message})}finally{e.destroy(o),e.destroy(n)}})}}},Qd.taskCache=new WeakMap,Qd.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},Qd.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},Qd.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},Qd.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};var $d={isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},indexOf:function(t,e){if(null==t)return-1;for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},has:function(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)},keys:function(t){if(!$d.isObject(t))return[];if(Object.keys)return Object.keys(t);var e=[];for(var i in t)$d.has(t,i)&&e.push(i);return e},extend:function(t){if(!$d.isObject(t))return t;for(var e,i,n=1,r=arguments.length;n<r;n++)for(i in e=arguments[n])hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},each:function(t,e){if(null==t)return t;var i,n=t.length;if(n===+n)for(i=0;i<n;i++)e(t[i],i,t);else{var r=$d.keys(t);for(i=0,n=r.length;i<n;i++)e(t[r[i]],r[i],t)}return t},filter:function(t,e){var i=[];return null==t?i:($d.each(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i)},isMatch:function(t,e){var i=$d.keys(e),n=i.length;if(null==t)return!n;for(var r=Object(t),a=0;a<n;a++){var s=i[a];if(e[s]!==r[s]||!(s in r))return!1}return!0},map:function(t,e,i){var n=t.length,r=null;n!==+n&&(n=(r=$d.keys(t)).length);for(var a=Array(n),s=0;s<n;s++){var o=r?r[s]:s;a[s]=e(t[o],o,t)}return a},object:function(t,e){for(var i={},n=0;n<t.length;n++)e?i[t[n]]=e[n]:i[t[n][0]]=t[n][1];return i},pairs:function(t){for(var e=$d.keys(t),i=e.length,n=Array(i),r=0;r<i;r++)n[r]=[e[r],t[e[r]]];return n}},tm=["color","style","family","multiline","text","textTextureHeight"];function em(t,e,i,n,r,a,s,o){if(this.mapviewer=t._mapviewer,this.proxy=new Wd(this),this.addPoiVariables=t,this.parameters=e,!e._empty&&void 0!==i&&void 0!==n){var l=t.MapviewerPrivate,h=new Vi;this.rotationObject=new ln,this.rotationObject.name="rotationObject",this.rotationObject.matrixAutoUpdate=!1,e.fixed?(this.positionObject=new ln,this.positionObject.name="options fixed",s?h.set(-Math.PI/2,e.angle*Math.PI/180,0):h.set(0,0,-e.angle*Math.PI/180),this.rotationObject.rotation.copy(h),this.rotationObject.updateMatrix()):(this.positionObject=new qd({face2d:e.face2d},this.mapviewer),this.positionObject.name="options !fixed",(r||a||s)&&i.cameraUpdatableObjects.push(this.positionObject)),this.positionObject.matrixAutoUpdate=!1,e.position.z=e.position.z||0,this.positionObject.position.copy(e.position),this.positionObject.position.add({x:0,y:0,z:l.zOffsetPOI}),this.positionObject.add(this.rotationObject),this.positionObject.vg={poi:e,meshes:{},opacity:u},this.rotationObject.current_position=new li,this.rotationObject.current_alignment=e.alignment,this.rotationObject.current_aspect=0!==e.scale.y?e.scale.x/e.scale.y:1,this.rotationObject.lastCameraOrientationZ=!1,this.rotationObject.dirty=!1,this.rotationObject._isFlipped=void 0;var c=this;this.rotationObject.updateMatrix=function(){var e=t._mapviewer.manipulator.radius,i=t._mapviewer.manipulator.orientationNormalized.z;im.call(this,e,i,c)},(e.fixed&&e.flip||e.zoomScaleFactor>0)&&(this.rotationObject.matrixAutoUpdate=!1,(r||a||s)&&i.cameraUpdatableObjects.push(this.rotationObject));var u=void 0!==this.parameters.opacity?this.parameters.opacity:this.mapviewer.computeOpacity(this.positionObject.position,this.parameters,this.mapviewer.camera.position);s?this.setModel(e.model):o?this.setSelector(e.selector):(a&&this.setText(e.text),r&&this.setURL(e.url));var p=new Fi;p.makeRotationFromEuler(this.rotationObject.rotation),this.rotationObject.position.applyMatrix4(p),this.rotationObject.dirty=!0,this.rotationObject.updateMatrix(),this.positionObject.updateMatrix(),n.add(this.positionObject),this.positionObject.updateMatrixWorld(!0),(r||s||a||o)&&i.rampObjects.push(this.positionObject),this.updateVisibleObject(),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()}}em.prototype.constructor=em,em.prototype.vg={poi:!0},em.prototype.updateVisibleObject=function(){this.visibleObject=void 0!==this.rotationObject?this.rotationObject:this.positionObject;var t=this.parameters;!1===this.parameters.visible&&this.visibleObject&&this.visibleObject.traverse(function(e){e.visible=t.visible})},em.prototype.isReady=function(){if(this.parameters.url){var t=this.mapviewer.textures[this.parameters.url];return t&&t.loaded}if(this.parameters.selector){var e=document.querySelector(this.parameters.selector);return e&&null!==e.parentNode}return!0},em.prototype.getOpacity=function(){return this.parameters&&this.parameters.opacity},em.prototype.setOpacity=function(t){var e,i,n,r=this.parameters,a=this.mapviewer;(r.opacity=t,"number"!=typeof t)?(t=this.mapviewer.computeOpacity(this.positionObject.position,this.parameters,this.mapviewer.camera.position),delete r.opacity,(i=(e=this.mapviewer.getFloor(this.parameters.floor)).getLOD(this.parameters.lod))||(i=e.floorContentLOD),-1===(n=i.rampObjects.indexOf(this.positionObject))&&i.rampObjects.push(this.positionObject)):((i=(e=this.mapviewer.getFloor(this.parameters.floor)).getLOD(this.parameters.lod))||(i=e.floorContentLOD),-1!==(n=i.rampObjects.indexOf(this.positionObject))&&i.rampObjects.splice(n,1));this.positionObject.traverse(function(e){if(e.material){e.material.opacity=t,t<1&&!e.material.transparent&&(e.material.transparent=!0);var i=e.material.materials;if(i)for(var n=0,r=i.length;n<r;++n)i[n].opacity=t,t<1&&!i[n].transparent&&(i[n].transparent=!0)}}),a.requestRedraw()},em.prototype.getVisible=function(){return this.parameters&&this.parameters.visible},em.prototype.setVisible=function(t){var e=this.parameters,i=this.visibleObject,n=this.mapviewer;null!==e&&e.visible!==t&&(e.visible=t,i&&i.traverse(function(t){t.visible=e.visible}),requestAnimationFrame(function(){n.mustUpdateCameraObjects=!0,n.requestRedraw()}))},em.prototype.realRemove=function(t){var e=this.proxy.publicPOI,i=this.mapviewer,n=this.parameters,r=this.positionObject,a=this.rotationObject;if(t&&this.addPoiVariables.POIFactory.removeFromPois(i,n.id,e),r&&a){var s=i.getFloor(n.floor),o=s.getLOD(n.lod);null===o&&(o=s.floorContentLOD);var l,h=r.vg.meshes,c=o.pickables;for(var u in h)if("poi_text"===u)h[u].forEach(function(t){-1!==(l=c.indexOf(t))&&c.splice(l,1),t.geometry&&t.geometry.vg&&t.geometry.vg.permanent||t.geometry.dispose()});else{var p=h[u];-1!==(l=c.indexOf(p))&&c.splice(l,1),p.geometry&&p.geometry.vg&&p.geometry.vg.permanent||p.geometry.dispose()}if(-1!==(l=i.pois_with_selector.indexOf(n))){var d=document.querySelector(i.pois_with_selector[l].selector);null!==d&&(d.style.display="none"),i.pois_with_selector.splice(l,1)}if(void 0===n.model&&t){var m=this.addPoiVariables;setTimeout(function(t,e,i){return function(){m.POIFactory.removeMaterial(t,e,i)}}(i,n,r),0)}if(void 0!==n.model&&(i.models[n.model].nbRefs--,0===i.models[n.model].nbRefs&&this.addPoiVariables.POIFactory.removeModel(i,n.model)),void 0!==r.parent&&r.parent.remove(r),void 0!==a&&(a.updateMatrix=!1,void 0!==a.parent&&a.parent.remove(r),-1!==(l=o.cameraUpdatableObjects.indexOf(a))&&o.cameraUpdatableObjects.splice(l,1),a.children.length)){p=a.children[0];this.animations&&this.animations.length&&(Object.keys(this.animations).forEach(function(t){this.animations[t].action&&this.animations[t].action.stop(),this.mixer.uncacheClip(this.animations[t].clip)},this),-1!==(l=o.animatedObjects.indexOf(p))&&o.animatedObjects.splice(l,1),this.nbAnimationPlaying>0&&this.mapviewer.decrementUpdatableObjects())}-1!==(l=o.cameraUpdatableObjects.indexOf(r))&&o.cameraUpdatableObjects.splice(l,1),-1!==(l=o.rampObjects.indexOf(r))&&o.rampObjects.splice(l,1),this.proxy.destroyPublicInterface(),this.positionObject=null}},em.prototype.remove=function(){null!==this.parameters&&(this.realRemove(!0),this.mapviewer.requestRedraw(),this.mapviewer=null,this.parameters=null)},em.prototype.options=function(t,e,i){if(null!==this.parameters){if(void 0===t)return Wd.getPublicParameters(this.parameters);if("object"==typeof t)if(this.parameters._empty){var n=$d.extend({},this.parameters);Object.keys(t).forEach(function(e){void 0===t[e]?delete n[e]:n[e]=t[e]}),this.addPoiVariables.POIFactory.createPOI(this.addPoiVariables,n,this.proxy.publicPOI),this.realRemove(!1)}else{var r=!1;Object.keys(t).forEach(function(e){r=r||-1!==tm.indexOf(e),"text"!==e&&this.setParameter(e,t[e])},this),r&&(void 0!==t.text||void 0!==this.parameters.text&&""!==this.parameters.text)&&this.setText(void 0!==t.text?t.text:this.parameters.text,!0)}else if("string"==typeof t){if(void 0===e&&Wd.isPublicParameter(t))return"animationNames"===t?this.getAnimationNames():this.getParameter(t);this.parameters._empty?((n=$d.extend({},this.parameters))[t]=e,this.realRemove(!1),this.addPoiVariables.POIFactory.createPOI(this.addPoiVariables,n,this.proxy.publicPOI)):(this.setParameter(t,e),-1!==tm.indexOf(t)&&void 0!==this.parameters.text&&""!==this.parameters.text&&this.setText(this.parameters.text,!0))}}},em.prototype.setParameter=function(t,e){switch(t){case"position":this.setPosition(e);break;case"text":this.setText(e);break;case"multiline":this.setMultiline(e);break;case"visible":this.setVisible(e);break;case"opacity":this.setOpacity(e);break;case"textTextureHeight":this.setTextTextureHeight(e);break;case"color":this.setColor(e);break;case"style":this.setStyle(e);break;case"family":this.setFamily(e);break;case"url":this.setURL(e);break;case"model":this.setModel(e);break;case"startAnimation":this.startAnimation(e);break;case"stopAnimation":this.stopAnimation(e);break;case"selector":this.setSelector(e);break;case"alignment":this.setAlignment(e);break;case"scale":this.setScale(e);break;case"zoomScaleFactor":this.setZoomScaleFactor(e);break;case"zoomScaleFast":this.setZoomScaleFast(e);break;case"iconScale":case"icon_scale":console.log('Deprecated option. It will be taken into account if there is no text. Otherwise, "scale" option will be used.'),void 0!==this.parameters.text&&""!==this.parameters.text||this.setScale(e);break;case"floor":this.setFloor(e);break;case"id":this.setID(e);break;case"visibilityRampStartVisible":this.parameters.visibilityRampStartVisible=e;break;case"visibilityRampFullyVisible":this.parameters.visibilityRampFullyVisible=e;break;case"visibilityRampStartInvisible":this.parameters.visibilityRampStartInvisible=e;break;case"visibilityRampFullyInvisible":this.parameters.visibilityRampFullyInvisible=e;break;case"onObjectMouseOver":this.parameters.onObjectMouseOver=e;break;case"onObjectMouseOut":this.parameters.onObjectMouseOut=e;break;case"onObjectMouseUp":this.parameters.onObjectMouseUp=e;break;case"clickable":this.setClickable(e);break;case"fixed":this.setFixed(e);break;case"angle":this.setAngle(e);break;case"heading":this.setHeading(e);break;case"width":this.setWidth(e);break;case"height":this.setHeight(e);break;case"overlay":this.setOverlay(e);break;case"flip":this.setFlip(e);break;case"face2d":this.setFace2d(e);break;case"track":this.setTrack(e)}},em.prototype.getParameter=function(t){return this.parameters&&this.parameters[t]},em.prototype.setPosition=function(t){var e=t||{x:0,y:0,z:0};e.z=t.z||0,this.parameters.position=e,void 0!==this.positionObject&&(this.positionObject.position.copy(e),this.positionObject._dirty=!0,this.positionObject.updateMatrix(),this.positionObject.updateMatrixWorld(),void 0!==this.parameters.selector&&""!==this.parameters.selector&&(this.mapviewer.mustUpdateCameraObjects=!0),this.mapviewer.requestRedraw()),void 0!==this.parameters.track&&this.parameters.track&&void 0!==this.mapviewer.statistics&&this.mapviewer.statistics.logStat("position",{id:this.parameters.id,position:e})},em.prototype.initText=function(t){var e=this.mapviewer.textGenerator.generateText(t,this.parameters);e.texture.vg.nbRefs++;var i=void 0!==this.parameters.opacity?this.parameters.opacity:this.mapviewer.computeOpacity(this.positionObject.position,this.parameters,this.mapviewer.camera.position);return e.material=new Dn({map:e.texture,color:16777215,side:o,transparent:!0,depthWrite:!1,depthTest:!this.parameters.overlay&&this.mapviewer.useDepthWriteForPOIs,opacity:i}),e.texture=null,e},em.prototype.pushToLists=function(){var t=this.mapviewer.getFloor(this.parameters.floor);if(t){var e=t.getLOD(this.parameters.lod);e||(e=t.floorContentLOD),this.parameters.fixed||-1===e.cameraUpdatableObjects.indexOf(this.positionObject)&&e.cameraUpdatableObjects.push(this.positionObject),(this.parameters.fixed&&this.parameters.flip||this.parameters.zoomScaleFactor>0)&&-1===e.cameraUpdatableObjects.indexOf(this.rotationObject)&&e.cameraUpdatableObjects.push(this.rotationObject),(void 0!==this.parameters.text&&""!==this.parameters.text||void 0!==this.parameters.url&&""!==this.parameters.url)&&-1===e.rampObjects.indexOf(this.positionObject)&&e.rampObjects.push(this.positionObject)}},em.prototype.getBoxScale=function(){var t=this.parameters._textAspectRatio,e=1;void 0!==this.positionObject.vg.meshes.poi_text&&this.positionObject.vg.meshes.poi_text.length>1&&(e=this.positionObject.vg.meshes.poi_text.length,this.positionObject.vg.meshes.poi_text.forEach(function(e){t=Math.max(t,e.userData.aspectRatio)}));var i=e,n=0,r=0;void 0!==this.parameters.url&&""!==this.parameters.url&&(n=this.parameters._aspectRatio,r=1,0===this.parameters.zoomScaleFactor&&(n*=this.parameters.scale.x,r*=this.parameters.scale.y)),void 0!==this.parameters.text&&""!==this.parameters.text&&(0===this.parameters.zoomScaleFactor&&(t*=this.parameters.scale.x,i*=this.parameters.scale.y),n+=t,r=Math.max(r,i));var a=1;return n>0&&(a=this.parameters.width/n),r>0&&r*a>this.parameters.height&&(a=this.parameters.height/r),a};var im=function(t,e,i){var n=i.parameters,r=0,a=(r=n.zoomScaleFast?function(t){return.02*t}(t)*n.zoomScaleFactor:function(t){return.15*Math.sqrt(t)}(t)*n.zoomScaleFactor)!==n._zoomScale,s=e!==this.lastCameraOrientationZ;if(this.dirty||s||0!==n.zoomScaleFactor&&a){if(0!==n.zoomScaleFactor&&(this.dirty||a)){n._zoomScale=r;var o={x:n._zoomScale,y:n._zoomScale,z:1},l=!0;if(-1!==n.width&&-1!==n.height){var h=i.getBoxScale();if(l=n.zoomScaleVisible||h>n._zoomScale,n.zoomScaleVisible&&h<n._zoomScale)o={x:h,y:h,z:1};void 0!==n.text&&""!==n.text&&n.multiline&&(a||i.shouldRecomputeLines(t))&&i.createMultiLineText()}i.setVisible(l),this.lastCameraRadius=t,void 0!==i.positionObject.vg.meshes.poi_text&&i.positionObject.vg.meshes.poi_text.length>0?this.current_position=i.updateTextMeshes():void 0!==i.positionObject.vg.meshes.poi_url&&(this.current_position=$d.extend({},i.positionObject.vg.meshes.poi_url.position),this.current_position.x*=2),this.current_position.x*=o.x,this.position.copy(new li),this.position.x=-this.current_position.x/2,this.position.x+=n.alignment.x*this.current_position.x/2,this.dirty=!0,this.scale.copy(o)}if(n.fixed&&n.flip&&(this.dirty||s)){this.lastCameraOrientationZ=e;var c=n._inverseAngleInRadians-this.lastCameraOrientationZ,u=c>Math.PI||c<0&&c>-Math.PI;if(this.dirty||u!==this._isFlipped){this._isFlipped=u;var p=-this.current_position.x,d=this.current_alignment;if(u){var m=0;void 0!==n.text&&""!==n.text&&(m=n._textAspectRatio),void 0!==n.url&&""!==n.url&&(m+=this.current_aspect),0===m&&(m=1),this.position.set(.5*p*(d.x+1),p*d.y/m,0),this.rotation.set(0,0,-(n.angle+180)*Math.PI/180)}else this.position.set(.5*p*(1-d.x),0,0),this.rotation.set(0,0,-n.angle*Math.PI/180);var f=new Fi;f.makeRotationFromEuler(this.rotation),this.position.applyMatrix4(f)}}this.dirty=!1,ln.prototype.updateMatrix.apply(this)}else ln.prototype.updateMatrix.apply(this)};em.prototype.shouldRecomputeLines=function(t){var e=this.parameters.text.split(" "),i=e.length;if(i<2||void 0===this.positionObject.vg.meshes.poi_text)return!1;gd.isRTL(textContent)&&(e=e.reverse());var n=this.positionObject.vg.meshes.poi_text.length;if(t===this.rotationObject.lastCameraRadius||t>this.rotationObject.lastCameraRadius&&n===i||t<this.rotationObject.lastCameraRadius&&1===n)return!1;var r=0;this.positionObject.vg.meshes.poi_text.forEach(function(t){t.userData.aspectRatio>r&&(r=t.userData.aspectRatio)}),this.parameters.url&&(r+=this.parameters._aspectRatio*this.parameters.scale.x/this.parameters.scale.y);var a=this.getBoxScale();return 0!==this.parameters.zoomScaleFactor&&(a=this.parameters._zoomScale),!(r*a<this.parameters.width&&t>this.rotationObject.lastCameraRadius)};var nm=function(t,e){var i=t.split(" ");if(e<2||i.length<e)return[];for(var n=[],r=t.length/e,a=i[0],s=1;s<i.length;s++){var o=a.length+i[s].length+1;a.length>r||o>1.5*r?(n.push(a),a=i[s]):a+=" "+i[s]}return n.push(a),n};function rm(t,e,i,n){this.batch=t,this.index=e,this.parameters=i,this.proxy=new Wd(this);var r=4*this.index;this.vertexOffsets=[r,r+1,r+2,r+3];var a=this.batch.geometry.getAttribute("normal");a.needsUpdate=!0,a.setXYZ(this.vertexOffsets[3],0,0,1),this.updateUVAttribute(n),this.updateHalfWidthAndHeight(),this.updateTypesAttribute(),this.updateCenterAttribute(),this.updateGeometryAttributes(),this.updateVisibilityRampAttribute()}function am(t,e,i,n,r){this.batch=t,this.index=e,this.parameters=i,this.fragments=n,this.space=r,this.lines=[],this.proxy=new Wd(this);var a=this.batch.geometry.getAttribute("normal");a.needsUpdate=!0;var s=this.batch.geometry.getAttribute("uv");s.needsUpdate=!0;for(var o=0;o<this.fragments.length;o++){var l=this.fragments[o],h=4*l.index;l.vertexOffsets=[h,h+1,h+2,h+3],a.setXYZ(l.vertexOffsets[3],0,0,1),s.setXY(l.vertexOffsets[0],l.uv.x0,l.uv.y0),s.setXY(l.vertexOffsets[1],l.uv.x1,l.uv.y0),s.setXY(l.vertexOffsets[2],l.uv.x1,l.uv.y1),s.setXY(l.vertexOffsets[3],l.uv.x0,l.uv.y1)}this.updateHalfWidthAndHeightDefault(),this.updateTypesAttribute(),this.updateCenterAttribute(),this.updateGeometryAttributes(),this.updateVisibilityRampAttribute()}em.prototype.hitsTheTop=function(t,e){if(-1===this.parameters.width||-1===this.parameters.height)return!1;var i=t,n=e,r=0,a=0;void 0!==this.parameters.url&&""!==this.parameters.url&&(r=this.parameters._aspectRatio,a=1,0===this.parameters.zoomScaleFactor&&(r*=this.parameters.scale.x,a*=this.parameters.scale.y)),void 0!==this.parameters.text&&""!==this.parameters.text&&(0===this.parameters.zoomScaleFactor&&(i*=this.parameters.scale.x,n*=this.parameters.scale.y),r+=i,a=Math.max(a,n));var s=1;return r>0&&(s=this.parameters.width/r),a>0&&a*s>this.parameters.height},em.prototype.createMultiLineText=function(t){var e=0;this.parameters.url&&(e=this.parameters._aspectRatio*this.parameters.scale.x/this.parameters.scale.y);for(var i,n=this.mapviewer.textGenerator.measureText(this.parameters.text,this.parameters),r=n.width/n.height,a=[this.parameters.text],s=[this.parameters.text],o=this.parameters.text.split(" ").length,l=1,h=n.width,c=e+r,u=function(){return 0!==this.parameters.zoomScaleFactor?this.parameters._zoomScale*c<=this.parameters.width:this.hitsTheTop(c,a.length)},p=u.apply(this);!p&&l<o;){var d=nm(this.parameters.text,++l);if(0===d.length)break;h=0,i=0,c=0,a.splice(0,a.length);for(var m=0;m<d.length;m++){var f=e+(y=this.mapviewer.textGenerator.measureText(d[m],this.parameters)).width/y.height;c=Math.max(c,f),h=Math.max(h,y.width),i+=y.height,a.push(d[m])}(p=u.apply(this))&&0===this.parameters.zoomScaleFactor||(s=a,r=h/i)}if(gd.isRTL(this.parameters.text))for(var g=0;g>s;g++)s[g]=s[g].reverse();var v=!0;if(void 0!==this.positionObject.vg.meshes.poi_text&&this.positionObject.vg.meshes.poi_text.length>0){if(this.positionObject.vg.meshes.poi_text.length===s.length){v=!1;for(g=0;g<s.length;g++)if(this.positionObject.vg.meshes.poi_text[g].userData.text!==s[g]){v=!0;break}}(v||t)&&(this.positionObject.vg.meshes.poi_text.forEach(function(t){t.material.map.vg.nbRefs--,this.mapviewer.textGenerator.disposeTexture(t.material.map),this.rotationObject.remove(t)},this),this.positionObject.vg.meshes.poi_text.splice(0,this.positionObject.vg.meshes.poi_text.length))}else this.positionObject.vg.meshes.poi_text=[];if(v||t){for(g=0;g<s.length;g++){var y;(y=this.initText(s[g])).text=s[g];var x=this.createTextMesh(y.text,y,0,.5*(s.length-1)-g);this.rotationObject.add(x),this.positionObject.vg.meshes.poi_text.push(x)}this.parameters._textAspectRatio=r}},em.prototype.createTextMesh=function(t,e,i,n){var r=new br(e.geometry,e.material);r.name="poi_text",r.userData={text:t,width:e.width,height:e.height,aspectRatio:e.aspectRatio,horizontalOffset:i,verticalOffset:n},r.matrixAutoUpdate=!1,r.renderOrder=-this.addPoiVariables.MapviewerPrivate.renderDepthPOI,this.parameters.overlay&&(r.renderOrder=-this.addPoiVariables.MapviewerPrivate.renderDepthPOIOverlay);var a=this.mapviewer.getFloor(this.parameters.floor),s=a.getLOD(this.parameters.lod);return s||(s=a.floorContentLOD),null!==s&&this.parameters.clickable&&(r.vg={id:this.parameters.id,poi:this.parameters,originalColor:16777215},s.pickables.push(r)),r},em.prototype.updateTextMeshes=function(){var t=new li,e=this.parameters._textAspectRatio;return this.positionObject.vg.meshes.poi_text.length>1&&this.positionObject.vg.meshes.poi_text.forEach(function(t){e=Math.max(e,t.userData.aspectRatio)}),0===this.parameters.zoomScaleFactor?(t.x+=.5*this.parameters.scale.x*e,t.y+=.5*this.parameters.scale.y*this.parameters.alignment.y,void 0!==this.parameters.url&&""!==this.parameters.url&&(t.x+=this.parameters.scale.x*this.parameters._aspectRatio),this.positionObject.vg.meshes.poi_text.forEach(function(e){var i=$d.extend({},t);i.x+=this.parameters.scale.x*e.userData.horizontalOffset,i.y+=this.parameters.scale.y*e.userData.verticalOffset,e.position.copy(i);var n={x:e.userData.aspectRatio*this.parameters.scale.x,y:this.parameters.scale.y,z:1};e.scale.copy(n),e.updateMatrix()},this),t.x+=.5*this.parameters.scale.x*e):(t.x+=.5*e,t.y+=.5*this.parameters.alignment.y,void 0!==this.parameters.url&&""!==this.parameters.url&&(t.x+=this.parameters._aspectRatio),this.positionObject.vg.meshes.poi_text.forEach(function(e){var i=$d.extend({},t);i.x+=e.userData.horizontalOffset,i.y+=e.userData.verticalOffset,e.position.copy(i);var n={x:e.userData.aspectRatio,y:1,z:1};e.scale.copy(n),e.updateMatrix()},this),t.x+=.5*e),t},em.prototype.setText=function(t,e){if(("string"!=typeof t||""===t)&&void 0!==this.positionObject.vg.meshes.poi_text&&this.positionObject.vg.meshes.poi_text.length>0){if(delete this.parameters.text,this.positionObject.vg.meshes.poi_text.forEach(function(t){this.rotationObject.remove(t)},this),this.positionObject.vg.meshes.poi_text.splice(0,this.positionObject.vg.meshes.poi_text.length),delete this.positionObject.vg.meshes.poi_text,void 0!==this.parameters.url&&""!==this.parameters.url){if(this.mapviewer.optimizations.batchIcons&&!this.parameters.vgnobatch)return this.realRemove(!1),void this.addPoiVariables.POIFactory.createPOI(this.addPoiVariables,this.parameters,this.proxy.publicPOI);this.rotationObject.dirty=!0,this.setURL(this.parameters.url)}}else{if(void 0!==this.parameters.model&&""!==this.parameters.model)return void console.log("Cannot set text on a POI initialized with a model.");if(this.parameters.multiline)this.parameters.text=t.replace(/\s+/g," ").trim(),this.createMultiLineText(e),void 0!==this.positionObject.vg.meshes.poi_text&&this.positionObject.vg.meshes.poi_text.length>0&&this.pushToLists();else{this.parameters.text=t;var i=this.initText(this.parameters.text);this.parameters._textAspectRatio=i.aspectRatio,void 0!==this.positionObject.vg.meshes.poi_text&&this.positionObject.vg.meshes.poi_text.length>0&&(this.positionObject.vg.meshes.poi_text.forEach(function(t){t.material.map.vg.nbRefs--,this.mapviewer.textGenerator.disposeTexture(t.material.map),this.rotationObject.remove(t)},this),this.positionObject.vg.meshes.poi_text.splice(0,this.positionObject.vg.meshes.poi_text.length));var n=this.createTextMesh(this.parameters.text,i,0,0);this.rotationObject.add(n),this.positionObject.vg.meshes.poi_text=[],this.positionObject.vg.meshes.poi_text.push(n),this.pushToLists()}var r=this.updateTextMeshes();if(this.rotationObject.current_position=r,0===this.parameters.zoomScaleFactor){if(-1!==this.parameters.width&&-1!==this.parameters.height){var a=this.getBoxScale();this.rotationObject.scale.copy({x:a,y:a,z:1}),r.x*=this.rotationObject.scale.x}this.rotationObject.current_position=r,this.rotationObject.position.copy(new li),this.rotationObject.position.x=-this.rotationObject.current_position.x/2,this.rotationObject.position.x+=this.parameters.alignment.x*this.rotationObject.current_position.x/2}this.rotationObject.dirty=!0,this.rotationObject.updateMatrix()}this.positionObject.updateMatrix(),this.positionObject.updateMatrixWorld(!0),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()},em.prototype.setMultiline=function(t){"boolean"==typeof t&&this.parameters.multiline!==t&&(this.parameters.multiline=t)},em.prototype.setTextTextureHeight=function(t){"number"==typeof t&&this.parameters.textTextureHeight!==t&&(this.parameters.textTextureHeight=t)},em.prototype.setColor=function(t){"string"==typeof t&&this.parameters.color!==t&&null!==t.match("#[0-9A-Fa-f]{6}")&&(this.parameters.color=t)},em.prototype.setStyle=function(t){"string"==typeof t&&this.parameters.style!==t&&(this.parameters.style=t)},em.prototype.setFamily=function(t){"string"==typeof t&&this.parameters.family!==t&&(this.parameters.family=t)},em.prototype.setURL=function(t){if(void 0!==t&&""!==t||void 0===this.positionObject.vg.meshes.poi_url){if(void 0!==this.parameters.model&&""!==this.parameters.model)return void console.log("Cannot set image on a POI initialized with a model.");var e=new li,i=this.rotationObject.getObjectByName("poi_url"),n=void 0!==i,r=this.mapviewer.textures[t];if(!n||this.parameters.url!==t){var a;if(!r||!r.loaded)return void new ed(this.mapviewer,t,!0,(m=t,f=this,function(t){f.options("url",m)}));this.parameters.url=t,a=new ed(this.mapviewer,this.parameters.url,!0);var s=void 0!==this.parameters.opacity?this.parameters.opacity:this.mapviewer.computeOpacity(this.positionObject.position,this.parameters,this.mapviewer.camera.position),l=this.mapviewer.plane_geometry,h=new Dn({map:a,color:16777215,side:o,transparent:!0,depthWrite:!1,depthTest:!this.parameters.overlay&&this.mapviewer.useDepthWriteForPOIs,opacity:s});if(void 0===(i=this.positionObject.vg.meshes.poi_url)){if((i=new br(l,h)).name="poi_url",i.matrixAutoUpdate=!1,i.renderOrder=-this.addPoiVariables.MapviewerPrivate.renderDepthPOI,this.parameters.overlay&&(i.renderOrder=-this.addPoiVariables.MapviewerPrivate.renderDepthPOIOverlay),this.parameters.clickable){i.vg={id:this.parameters.id,poi:this.parameters,originalColor:16777215};var c=this.mapviewer.getFloor(this.parameters.floor),u=c.getLOD(this.parameters.lod);u||(u=c.floorContentLOD),u.pickables.push(i)}this.positionObject.vg.meshes.poi_url=i,this.rotationObject.add(i)}else i.material=h;n||this.pushToLists()}r&&r.loaded&&r.texture&&(this.parameters._aspectRatio=this.parameters.keepAspectRatio?r.texture.image.width/r.texture.image.height:1);var p=$d.extend({},this.parameters.scale);if(p.x*=this.parameters._aspectRatio,this.parameters.zoomScaleFactor>0&&(p={x:this.parameters._aspectRatio,y:1,z:1}),e.x+=.5*p.x,e.y+=.5*p.y*this.parameters.alignment.y,i.position.copy(e),e.x+=.5*p.x,i.scale.set(p.x,p.y,1),i.updateMatrix(),void 0!==this.positionObject.vg.meshes.poi_text&&this.positionObject.vg.meshes.poi_text.length>0&&(e=this.updateTextMeshes()),this.rotationObject.current_position=e,0===this.parameters.zoomScaleFactor){if(-1!==this.parameters.width&&-1!==this.parameters.height){var d=this.getBoxScale();this.rotationObject.scale.copy({x:d,y:d,z:1}),e.x*=this.rotationObject.scale.x}this.rotationObject.current_position=e,this.rotationObject.position.x=-e.x/2,this.rotationObject.position.x+=this.parameters.alignment.x*e.x/2}this.rotationObject.dirty=!0,this.rotationObject.updateMatrix()}else if(this.rotationObject.remove(this.positionObject.vg.meshes.poi_url),delete this.parameters.url,delete this.positionObject.vg.meshes.poi_url,void 0!==this.parameters.text&&""!==this.parameters.text){if(this.mapviewer.optimizations.batchIcons&&!this.parameters.vgnobatch)return this.realRemove(!1),void this.addPoiVariables.POIFactory.createPOI(this.addPoiVariables,this.parameters,this.proxy.publicPOI);this.rotationObject.dirty=!0,this.setText(this.parameters.text)}var m,f;this.positionObject.updateMatrix(),this.positionObject.updateMatrixWorld(!0),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()},em.prototype.setSelector=function(t){if("string"!=typeof t||""===t)document.querySelector(this.parameters.selector).remove();else{this.parameters.selector=t;var e=document.querySelector(this.parameters.selector),i=void 0!==this.parameters.opacity?this.parameters.opacity:this.mapviewer.computeOpacity(this.positionObject.position,this.parameters,this.mapviewer.camera.position);0===i?e.style.display="none":(e.style.opacity=i,e.style.display=""),this.addPoiVariables.container.appendChild(e),e.style.position="absolute",e.style.left="0px",e.style.top="0px",this.mapviewer.pois_with_selector.push(this.parameters)}},em.animationLoopModes={once:_e,repeat:Me,pingpong:Se},em.prototype.getAnimationNames=function(){if(void 0===this.rotationObject.getObjectByName("poi_model"))return console.log("Warning: this POI is not a 3D model, animation was not started."),[];if(void 0===this.animations)return[];var t=[];return Object.keys(this.animations).forEach(function(e){t.push(this.animations[e].clip.name)},this),t},em.prototype.startAnimation=function(t){if(void 0===(r=this.rotationObject.getObjectByName("poi_model"))||void 0===this.animations)return this.startAnimationDelayed=t,console.log("Warning: this POI is not an animated 3D model. This animation will be delayed when model will be loaded: ",t),!1;this.startAnimationDelayed=void 0;var e="",i=Me;if("number"==typeof t)e=t;else if("string"==typeof t){var n=t;e=this.animations.findIndex(function(t){return n===t.clip.name})}else{if("object"!=typeof t)return!1;if(void 0===(e=t.index)){if(void 0===(n=t.name))return console.log("No animation index or name was provided."),!1;e=this.animations.findIndex(function(t){return n===t.clip.name})}void 0!==t.loopMode&&void 0!==em.animationLoopModes[t.loopMode]&&(i=em.animationLoopModes[t.loopMode])}var r=this.rotationObject.getObjectByName("poi_model");if(void 0===this.animations[e])return console.log("Warning: requested animation does not exist."),!1;var a=this.nbAnimationPlaying;if((!this.animations[e].action||!this.animations[e].action.isRunning()&&this.animations[e].action.enabled)&&this.nbAnimationPlaying++,this.animations[e].action?this.animations[e].action.reset():this.animations[e].action=this.mixer.clipAction(this.animations[e].clip),this.animations[e].action.setLoop(i,1/0),this.animations[e].action.play(),0===a&&1===this.nbAnimationPlaying){var s=this.mapviewer.getFloor(this.parameters.floor),o=s.getLOD(this.parameters.lod);null===o&&(o=s.floorContentLOD),o.animatedObjects.push(r),this.mapviewer.incrementUpdatableObjects(),r.matrixAutoUpdate=!0,r.traverse(function(t){t.matrixAutoUpdate=!0})}return!0},em.prototype.stopAnimation=function(t){var e=this.rotationObject.getObjectByName("poi_model");if(void 0===e||void 0===this.animations)return console.log("Warning: this POI is not an animated 3D model."),!1;if("string"==typeof t){var i=t;t=this.animations.findIndex(function(t){return i===t.clip.name})}if(void 0===this.animations[t]||void 0===this.animations[t].action||void 0!==this.animations[t].action&&!this.animations[t].action.isRunning())return console.log("Warning: requested animation does not exist or it is not running."),!1;if(this.animations[t].action.stop(),this.nbAnimationPlaying--,0===this.nbAnimationPlaying){var n=this.mapviewer.getFloor(this.parameters.floor),r=n.getLOD(this.parameters.lod);null===r&&(r=n.floorContentLOD),-1!==(t=r.animatedObjects.indexOf(e))&&r.animatedObjects.splice(t,1),this.mapviewer.decrementUpdatableObjects(),e.traverse(function(t){t.matrixAutoUpdate=!1})}return!0},em.prototype.initAnimations=function(t,e){var i=[];if(3.2===t.version?i=t.result.scene.animations:t.version>=4.4&&(i=t.scene.animations),void 0!==i&&i.length>0){var n=[];e.forEach(function(t){n[t.name]={loopMode:t.loopMode}});var r=this.rotationObject.getObjectByName("poi_model");this.mixer=new Uu(r),r.vg=r.vg||{},r.vg.mixer=this.mixer,this.animations=[],this.nbAnimationPlaying=0,Object.keys(i).forEach(function(t){var e=i[t],r=e.name;this.animations[t]={clip:e,action:!1},void 0!==n[r]&&this.startAnimation({index:t,loopMode:n[r].loopMode})},this)}},em.prototype.setModel=function(t){if("string"!=typeof t||""===t)this.rotationObject.remove(this.rotationObject.getObjectByName("poi_model")),delete this.parameters.model;else{void 0!==this.parameters.url&&""!==this.parameters.url&&this.setURL(""),void 0!==this.parameters.text&&""!==this.parameters.text&&this.setText("");var e=this.rotationObject.getObjectByName("poi_model"),i=void 0!==e;if(!i||this.parameters.model!==t){i&&(this.rotationObject.remove(e),this.mapviewer.models[this.parameters.model].nbRefs--,0===this.mapviewer.models[this.parameters.model].nbRefs&&this.addPoiVariables.POIFactory.removeModel(this.mapviewer,this.parameters.model)),this.parameters.model=t;var n=this.mapviewer;if(void 0===this.mapviewer.models[this.parameters.model]){var r={url:this.parameters.model,loaded:!1,geometry:null,materials:null,bbox:null,pending:[],nbRefs:1};this.mapviewer.models[this.parameters.model]=r,this.mapviewer.loaderStatistics.models++;var a=this;md.request(this.parameters.model,"GET",null,{crossDomain:!0,responseType:-1!==t.indexOf(".glb")?"arraybuffer":void 0}).then(function(e){if(-1!==t.indexOf(".glb")){var i=new Kd;const t=new Qd;t.setDecoderPath("/lib/draco/"),i.setDRACOLoader(t),i.parse(e.response,"",t=>{r.loaded=!0,r.scene=t.scene.children[0],r.scene.material.vertexColors=!1,r.scene.material.needsUpdate=!0,r.version=4.4,Object.keys(r.pending).forEach(function(t){r.pending[t](r)}),n.loaderStatistics.models--,n.requestRedraw(),void 0!==a.startAnimationDelayed&&a.startAnimation(a.startAnimationDelayed)},t=>{console.log("ERROR while loading glb",t)})}else{var s=JSON.parse(e.response);if(-1!==t.indexOf(".gltf"))(i=new Kd).parse(s,"",t=>{r.loaded=!0,r.scene=t.scene.children[0],r.scene.material.vertexColors=!1,r.scene.material.needsUpdate=!0,r.version=4.4,Object.keys(r.pending).forEach(function(t){r.pending[t](r)}),n.loaderStatistics.models--,n.requestRedraw(),void 0!==a.startAnimationDelayed&&a.startAnimation(a.startAnimationDelayed)},t=>{console.log("ERROR while loading gltf",t)});else if(void 0!==s.metadata&&"Object"===s.metadata.type){(d=new Ad).crossOrigin="",r.version=s.metadata.version,s.images&&s.images.forEach(function(t){t.url+="?"+n.mapTimestamp});var o=Yc.extractUrlBase(t);d.setPath(o),d.setResourcePath(o),d.parse(s,function(t){t.updateMatrix(),r.loaded=!0,r.scene=t,Object.keys(r.pending).forEach(function(t){r.pending[t](r)}),n.loaderStatistics.models--,n.requestRedraw(),void 0!==a.startAnimationDelayed&&a.startAnimation(a.startAnimationDelayed)})}else if(void 0===s.metadata||void 0!==s.metadata.formatVersion&&3.1===s.metadata.formatVersion){(d=new Sd).crossOrigin="";o=Yc.extractUrlBase(t);void 0!==s.materials&&s.materials.forEach(function(t){void 0!==t.colorAmbient&&delete t.colorAmbient,void 0!==t.transparency&&(t.opacity=t.transparency,delete t.transparency),t.mapDiffuse&&(t.mapDiffuse+="?"+n.mapTimestamp)});var l=d.parse(s,o);r.loaded=!0,r.geometry=l.geometry,r.materials=l.materials,r.version=s.metadata.formatVersion;var h=Object.keys(r.materials),c=0,u=h.length,p=function(){++c===u&&n.loaderStatistics.models--,n.requestRedraw(),void 0!==a.startAnimationDelayed&&a.startAnimation(a.startAnimationDelayed)};h.forEach(function(t){r.materials[t].map.image.complete?p():r.materials[t].map.image.addEventListener("load",p)}),Object.keys(r.pending).forEach(function(t){r.pending[t](r)})}else{var d;Object.keys(s.textures).forEach(function(t){s.textures[t].url+="?"+n.mapTimestamp}),(d=new Jd).crossOrigin="",d.parse(s,function(t){r.loaded=!0,r.result=t,r.version=s.metadata.version?s.metadata.version:s.metadata.formatVersion;var e=r.result.scene;e.updateMatrix(),e.matrixAutoUpdate=!1,e.traverse(function(t){t.updateMatrix(),t.matrixAutoUpdate=!1}),Object.keys(r.pending).forEach(function(t){r.pending[t](r)}),n.loaderStatistics.models--,n.requestRedraw(),void 0!==a.startAnimationDelayed&&a.startAnimation(a.startAnimationDelayed)},t)}}}).catch(function(){n.loaderStatistics.models--})}else this.mapviewer.models[this.parameters.model].nbRefs++;var s=this.mapviewer.getFloor(this.parameters.floor),o=s.getLOD(this.parameters.lod);null===o&&(o=s.floorContentLOD);var l=void 0!==this.parameters.opacity?this.parameters.opacity:this.mapviewer.computeOpacity(this.positionObject.position,this.parameters,this.mapviewer.camera.position);if((r=this.mapviewer.models[this.parameters.model]).loaded)this.addPoiVariables.POIFactory.onModelLoaded(this.mapviewer,r,this.parameters,l,this.rotationObject,o),this.initAnimations(r,this.parameters.startAnimations);else{var h=this;r.pending.push(function(t,e,i,r,a){return function(){h.addPoiVariables.POIFactory.onModelLoaded(n,t,e,i,r,a),h.initAnimations(t,h.parameters.startAnimations)}}(r,this.parameters,l,this.rotationObject,o))}i||this.pushToLists()}var c=new li;if(-1!==this.parameters.width&&-1!==this.parameters.height){var u=this.getBoxScale();this.rotationObject.scale.copy({x:u,y:1,z:u})}this.rotationObject.current_position=c,this.rotationObject.position.x=-c.x/2,this.rotationObject.position.x+=this.parameters.alignment.x*c.x/2,this.rotationObject.dirty=!0,this.rotationObject.updateMatrix()}this.positionObject.updateMatrix(),this.positionObject.updateMatrixWorld(!0),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()},em.prototype.setAlignment=function(t){"object"==typeof t&&t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&(this.parameters.alignment=t,this.rotationObject.current_alignment=t,void 0!==this.parameters.model&&""!==this.parameters.model?this.setModel(this.parameters.model):(void 0!==this.parameters.url&&""!==this.parameters.url&&this.setURL(this.parameters.url),void 0!==this.parameters.text&&""!==this.parameters.text&&this.setText(this.parameters.text)))},em.prototype.setScale=function(t){var e=t;"number"==typeof t&&(e={x:t,y:t,z:t}),"object"==typeof e&&this.parameters.scale!==e&&(this.parameters.scale=e,void 0!==this.parameters.url&&""!==this.parameters.url&&this.setURL(this.parameters.url),void 0!==this.parameters.text&&""!==this.parameters.text&&this.setText(this.parameters.text))},em.prototype.setZoomScaleFactor=function(t){if(!("number"!=typeof t||this.parameters.zoomScaleFactor===t||t<0)){this.parameters.zoomScaleFactor=t;var e=this.mapviewer.getFloor(this.parameters.floor),i=e.getLOD(this.parameters.lod);if(i||(i=e.floorContentLOD),this.parameters.zoomScaleFactor>0)-1===i.cameraUpdatableObjects.indexOf(this.rotationObject)&&i.cameraUpdatableObjects.push(this.rotationObject);else if(this.parameters._zoomScale=0,this.parameters.fixed&&!this.parameters.flip){var n=i.cameraUpdatableObjects.indexOf(this.rotationObject);-1!==n&&i.cameraUpdatableObjects.splice(n,1)}void 0!==this.parameters.url&&""!==this.parameters.url&&this.setURL(this.parameters.url),void 0!==this.parameters.text&&""!==this.parameters.text&&this.setText(this.parameters.text),this.rotationObject.updateMatrix(),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()}},em.prototype.setZoomScaleFast=function(t){"boolean"==typeof t&&this.parameters.zoomScaleFast!==t&&(this.parameters.zoomScaleFast=t,this.rotationObject.updateMatrix(),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw())},em.prototype.setFloor=function(t){if("string"==typeof t&&""!==t&&this.parameters.floor!==t){this.positionObject.parent.remove(this.positionObject),this.parameters.floor=t;var e,i=this.mapviewer.scene;if(null===(t=this.mapviewer.getFloor(this.parameters.floor)))return void console.log("Warning: POI was not updated, required floor doesn't exist.");if(null!==t)if(e=void 0!==this.parameters.lod?t.getLOD(this.parameters.lod):t.floorContentLOD,this.parameters.overlay)i=e.contentNode;else{if(null===e)return;i=e.contentNode}i.add(this.positionObject)}},em.prototype.setID=function(t){if("string"==typeof t&&this.parameters.id!==t)if(this.setClickable(!1),this.addPoiVariables.POIFactory.removeFromPois(this.mapviewer,this.parameters.id,this.proxy.publicPOI),""===t)for(var e in delete this.parameters.id,this.positionObject.vg.meshes)"poi_text"===e?this.positionObject.vg.meshes[e].forEach(function(t){t.vg.id=""}):this.positionObject.vg.meshes[e].vg.id="";else{for(var e in this.addPoiVariables.POIFactory.addToPois(this.mapviewer,t,this.proxy.publicPOI),this.parameters.id=t,this.positionObject.vg.meshes)"poi_text"===e?this.positionObject.vg.meshes[e].forEach(function(e){e.vg.id=t}):this.positionObject.vg.meshes[e].vg.id=t;this.setClickable(!0)}},em.prototype.setClickable=function(t){if("boolean"==typeof t&&this.parameters.clickable!==t){this.parameters.clickable=t;var e=this.mapviewer.getFloor(this.parameters.floor).getLOD(this.parameters.lod);if(null!==e)if(this.parameters.clickable)for(var i in this.positionObject.vg.meshes)if("poi_text"===i)this.positionObject.vg.meshes[i].forEach(function(t){e.pickables.push(t)});else{var n=this.positionObject.vg.meshes[i];e.pickables.push(n)}else for(var i in this.positionObject.vg.meshes)if("poi_text"===i)this.positionObject.vg.meshes[i].forEach(function(t){var i=e.pickables.indexOf(t);-1!==i&&e.pickables.splice(i,1)});else{n=this.positionObject.vg.meshes[i];var r=e.pickables.indexOf(n);-1!==r&&e.pickables.splice(r,1)}}},em.prototype.setWidth=function(t){"number"==typeof t&&this.parameters.width!==t&&(this.parameters.width=t,void 0!==this.parameters.url&&""!==this.parameters.url&&this.setURL(this.parameters.url),void 0!==this.parameters.text&&""!==this.parameters.text&&this.setText(this.parameters.text))},em.prototype.setHeight=function(t){"number"==typeof t&&this.parameters.height!==t&&(this.parameters.height=t,void 0!==this.parameters.url&&""!==this.parameters.url&&this.setURL(this.parameters.url),void 0!==this.parameters.text&&""!==this.parameters.text&&this.setText(this.parameters.text))},em.prototype.setOverlay=function(t){if("boolean"==typeof t&&this.parameters.overlay!==t){this.parameters.overlay=t,void 0!==this.positionObject.vg.meshes.poi_text&&this.positionObject.vg.meshes.poi_text.length>0&&this.positionObject.vg.meshes.poi_text.forEach(function(t){t.material.depthTest=!this.parameters.overlay&&this.mapviewer.useDepthWriteForPOIs,t.renderOrder=this.parameters.overlay?-this.addPoiVariables.MapviewerPrivate.renderDepthPOIOverlay:-this.addPoiVariables.MapviewerPrivate.renderDepthPOI},this);var e=this.positionObject.vg.meshes.poi_url;void 0!==e&&(e.material.depthTest=!this.parameters.overlay&&this.mapviewer.useDepthWriteForPOIs,e.renderOrder=this.parameters.overlay?-this.addPoiVariables.MapviewerPrivate.renderDepthPOIOverlay:-this.addPoiVariables.MapviewerPrivate.renderDepthPOI)}},em.prototype.setFixed=function(t){if("boolean"==typeof t&&this.parameters.fixed!==t){this.parameters.fixed=t;var e,i,n=this.mapviewer.getFloor(this.parameters.floor),r=n.getLOD(this.parameters.lod);r||(r=n.floorContentLOD);var a=new Vi;this.parameters.fixed?((e=new ln).name="options fixed",a.set(0,0,this.parameters.angle*Math.PI/180)):((e=new qd({face2d:this.parameters.face2d},this.mapviewer)).name="options !fixed",(void 0!==this.parameters.url&&""!==this.parameters.url||void 0!==this.parameters.model&&""!==this.parameters.model||void 0!==this.parameters.text&&""!==this.parameters.text)&&r.cameraUpdatableObjects.push(e)),e.vg=$d.extend({},this.positionObject.vg),e.matrixAutoUpdate=!1,e.position.copy(this.positionObject.position),e.add(this.rotationObject),this.parameters.fixed&&this.parameters.flip&&(this.parameters.flip=!1,this.setFlip(!0));var s=new Fi;s.makeRotationFromEuler(a),this.rotationObject.position.copy(new li),this.rotationObject.position.x=-this.rotationObject.current_position.x/2,this.rotationObject.position.x+=this.parameters.alignment.x*this.rotationObject.current_position.x/2,this.rotationObject.position.applyMatrix4(s),(void 0!==this.parameters.url&&""!==this.parameters.url||void 0!==this.parameters.model&&""!==this.parameters.model||void 0!==this.parameters.text&&""!==this.parameters.text||void 0!==this.parameters.selector&&""!==this.parameters.selector)&&r.rampObjects.push(e),-1!==(i=r.cameraUpdatableObjects.indexOf(this.positionObject))&&r.cameraUpdatableObjects.splice(i,1),-1!==(i=r.rampObjects.indexOf(this.positionObject))&&r.rampObjects.splice(i,1);var o=this.positionObject.parent;o.remove(this.positionObject),o.add(e),this.positionObject=e,this.rotationObject.rotation.copy(a),this.rotationObject.updateMatrix(),this.positionObject.updateMatrix(),this.positionObject.updateMatrixWorld(!0),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()}},em.prototype.setFlip=function(t){if("boolean"==typeof t&&this.parameters.flip!==t){this.parameters.flip=t;var e=this.mapviewer.getFloor(this.parameters.floor),i=e.getLOD(this.parameters.lod);if(i||(i=e.floorContentLOD),this.parameters.fixed){if(this.parameters.flip)this.rotationObject.current_alignment=this.parameters.alignment,this.rotationObject.current_aspect=0!==this.parameters.scale.y?this.parameters.scale.x/this.parameters.scale.y:1,this.rotationObject.matrixAutoUpdate=!1,(void 0!==this.parameters.url&&""!==this.parameters.url||void 0!==this.parameters.model&&""!==this.parameters.model||void 0!==this.parameters.text&&""!==this.parameters.text)&&i.cameraUpdatableObjects.push(this.rotationObject),this.mapviewer.mustUpdateCameraObjects=!0;else if(0!==this.parameters.zoomScaleFactor){var n=i.cameraUpdatableObjects.indexOf(this.rotationObject);-1!==n&&i.cameraUpdatableObjects.splice(n,1)}this.rotationObject.updateMatrix(),this.mapviewer.requestRedraw()}}},em.prototype.setFace2d=function(t){"boolean"==typeof t&&this.parameters.face2d!==t&&(this.parameters.face2d=t,"boolean"==typeof this.parameters.fixed&&this.parameters.fixed||(this.parameters.face2d?this.positionObject.constraints=[qd.FIXED,qd.FIXED,qd.CAMERA_FACING]:this.positionObject.constraints=[qd.CAMERA_FACING,qd.FIXED,qd.CAMERA_FACING],this.positionObject.lastCameraOrientationZ=!1,this.positionObject.face2d=this.parameters.face2d,this.positionObject.updateMatrix(),this.positionObject.updateMatrixWorld(!0),this.mapviewer.mustUpdateCameraObjects=!0,this.mapviewer.requestRedraw()))},em.prototype.setTrack=function(t){"boolean"==typeof t&&this.parameters.track!==t&&(this.parameters.track=t)},em.prototype.setAngle=function(t){if("number"==typeof t&&this.parameters.angle!==t&&(this.parameters.angle=t,this.parameters._inverseAngleInRadians=2*Math.PI-t*Math.PI/180,this.parameters.fixed)){var e=new Vi;e.set(0,0,this.parameters.angle*Math.PI/180),this.rotationObject.rotation.copy(e);var i=new Fi;i.makeRotationFromEuler(e),this.rotationObject.position.copy(new li),this.rotationObject.position.x=-this.rotationObject.current_position.x/2,this.rotationObject.position.x+=this.parameters.alignment.x*this.rotationObject.current_position.x/2,this.rotationObject.position.applyMatrix4(i),this.positionObject.updateMatrix(),this.rotationObject.dirty=!0,this.rotationObject.updateMatrix(),this.positionObject.updateMatrixWorld(!0),this.mapviewer.requestRedraw()}},em.prototype.setHeading=function(t){"number"==typeof t&&this.parameters.heading!==t&&this.parameters.angle!==t-this.mapviewer.cameraNorthRotation&&(this.parameters.heading=t,this.setAngle(this.parameters.heading-this.mapviewer.cameraNorthRotation))},em.prototype.getUUID=function(){return this.positionObject?this.positionObject.uuid:"does not exist"},rm.prototype.constructor=rm,rm.prototype.isReady=function(){if(this.parameters.url){var t=this.batch.mapviewer.textures[this.parameters.url];return t&&t.loaded}return!0},rm.prototype.getVisible=function(){return this.getParameter("visible")},rm.prototype.setVisible=function(t,e){if(this.parameters&&this.parameters.visible!=t||e){this.parameters.visible=t;var i=this.batch.geometry.getIndex(),n=6*this.index,r=this.batch.indices,a=4*this.index;t?(r[n]=a,r[n+1]=a+1,r[n+2]=a+3,r[n+3]=a+1,r[n+4]=a+2,r[n+5]=a+3):(r[n]=0,r[n+1]=0,r[n+2]=0,r[n+3]=0,r[n+4]=0,r[n+5]=0),i.needsUpdate=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw()}},rm.prototype.getOpacity=function(){return 1},rm.prototype.setOpacity=function(t){},rm.prototype.options=function(t,e,i){if(!this.parameters)return!1;if(null!==this.parameters){if(void 0===t)return Wd.getPublicParameters(this.parameters);if("object"==typeof t){var n=$d.extend({},this.parameters);Object.keys(t).forEach(function(e){void 0===t[e]?delete n[e]:n[e]=t[e]}),this.batch.addPoiVariables.POIFactory.createPOI(this.batch.addPoiVariables,n,this.proxy.publicPOI),this.realRemove(!1)}else if("string"==typeof t){if(void 0===e&&Wd.isPublicParameter(t))return this.getParameter(t);this.setParameter(t,e)}}},rm.prototype.getParameter=function(t){return this.parameters&&this.parameters[t]},rm.prototype.setParameter=function(t,e){switch(t){case"visibilityRampStartVisible":return this.parameters.visibilityRampStartVisible=e,void this.updateVisibilityRampAttribute();case"visibilityRampFullyVisible":return this.parameters.visibilityRampFullyVisible=e,void this.updateVisibilityRampAttribute();case"visibilityRampStartInvisible":return this.parameters.visibilityRampStartInvisible=e,void this.updateVisibilityRampAttribute();case"visibilityRampFullyInvisible":return this.parameters.visibilityRampFullyInvisible=e,void this.updateVisibilityRampAttribute();case"onObjectMouseOver":return void(this.parameters.onObjectMouseOver=e);case"onObjectMouseOut":return void(this.parameters.onObjectMouseOut=e);case"onObjectMouseUp":return void(this.parameters.onObjectMouseUp=e);case"visible":return void this.setVisible(e);case"opacity":return;case"position":return void this.setPosition(e);case"scale":return void this.setScale(e);case"zoomScaleFactor":if(e>0&&this.parameters.zoomScaleFactor>0||!this.parameters.fixed)return void this.setZoomScaleFactor(e);this.parameters.zoomScaleFactor=e;break;case"zoomScaleFast":return void this.setZoomScaleFast(e);case"iconScale":case"icon_scale":return console.log('Deprecated option. It will be taken into account if there is no text. Otherwise, "scale" option will be used.'),void(void 0!==this.parameters.text&&""!==this.parameters.text||this.setScale(e));case"angle":return void this.setAngle(e);case"heading":return void this.setHeading(e);case"width":return void this.setWidth(e);case"height":return void this.setHeight(e);case"fixed":if(this.parameters.fixed===e)return;if(this.parameters.zoomScaleFactor>0)return void this.setFixed(e);this.parameters.fixed=e;break;case"flip":return void this.setFlip(e);case"face2d":return void this.setFace2d(e);case"id":return void this.setID(e);case"clickable":return void this.setClickable(e);case"track":return void this.setTrack(e);default:this.parameters[t]=e}this.batch.addPoiVariables.POIFactory.createPOI(this.batch.addPoiVariables,this.parameters,this.proxy.publicPOI),this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw(),this.realRemove(!1)},rm.prototype.setPosition=function(t){this.parameters.position=t||{x:0,y:0,z:0},this.parameters.position.z=t.z||0,this.parameters._center=this.parameters.position,this.parameters._centerZ=this.parameters.position.z+this.parameters._zOffset,this.updateCenterAttribute(),this.updateGeometryAttributes(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.geometry.computeBoundingSphere(),this.batch.mapviewer.requestRedraw(),void 0!==this.parameters.track&&this.parameters.track&&void 0!==this.batch.mapviewer.statistics&&this.batch.mapviewer.statistics.logStat("position",{id:this.parameters.id,position:this.parameters.position})},rm.prototype.setScale=function(t){var e=t;"number"==typeof t&&(e={x:t,y:t,z:t}),"object"==typeof e&&this.parameters.scale!==e&&(this.parameters.scale=e,this.updateHalfWidthAndHeight(),this.updateCenterAttribute(),this.updateGeometryAttributes(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setZoomScaleFactor=function(t){"number"==typeof t&&this.parameters.zoomScaleFactor!==t&&(this.parameters.zoomScaleFactor=t,this.updateHalfWidthAndHeight(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setZoomScaleFast=function(t){"boolean"==typeof t&&this.parameters.zoomScaleFast!==t&&(this.parameters.zoomScaleFast=t,this.updateHalfWidthAndHeight(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setWidth=function(t){"number"==typeof t&&this.parameters.width!==t&&(this.parameters.width=t,this.updateHalfWidthAndHeight(),this.updateCenterAttribute(),this.updateGeometryAttributes(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setHeight=function(t){"number"==typeof t&&this.parameters.height!==t&&(this.parameters.height=t,this.updateHalfWidthAndHeight(),this.updateCenterAttribute(),this.updateGeometryAttributes(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setAngle=function(t){"number"==typeof t&&this.parameters.angle!==t&&(this.parameters.angle=t,this.updateCenterAttribute(),this.updateGeometryAttributes(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setHeading=function(t){"number"==typeof t&&this.parameters.heading!==t&&this.parameters.angle!==t-this.batch.mapviewer.cameraNorthRotation&&(this.parameters.heading=t,this.setAngle(this.parameters.heading-this.batch.mapviewer.cameraNorthRotation))},rm.prototype.setFixed=function(t){"boolean"==typeof t&&this.parameters.fixed!==t&&(this.parameters.fixed=t,this.updateTypesAttribute(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setFlip=function(t){"boolean"==typeof t&&this.parameters.flip!==t&&(this.parameters.flip=t,this.updateTypesAttribute(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setFace2d=function(t){"boolean"==typeof t&&this.parameters.face2d!==t&&(this.parameters.face2d=t,this.updateTypesAttribute(),this.parameters._dirty=!0,this.batch.mesh.updateMatrix(),this.batch.mapviewer.requestRedraw())},rm.prototype.setTrack=function(t){"boolean"==typeof t&&this.parameters.track!==t&&(this.parameters.track=t)},rm.prototype.setID=function(t){"string"==typeof t&&this.parameters.id!==t&&(this.batch.addPoiVariables.POIFactory.removeFromPois(this.batch.mapviewer,this.parameters.id,this.proxy.publicPOI),""!==t&&this.batch.addPoiVariables.POIFactory.addToPois(this.batch.mapviewer,t,this.proxy.publicPOI),this.parameters.id=t)},rm.prototype.setClickable=function(t){"boolean"==typeof t&&this.parameters.clickable!==t&&(this.parameters.clickable=t)},rm.prototype.updateVisibility=function(){this.parameters._halfWidth*this.parameters._zoomScale<.5*this.parameters.width&&this.parameters._halfHeight*this.parameters._zoomScale<.5*this.parameters.height?this.setVisible(!0):this.parameters.zoomScaleVisible?(this.parameters._zoomScale=Math.min(.5*this.parameters.width/this.parameters._halfWidth,.5*this.parameters.height/this.parameters._halfHeight),this.setVisible(!0)):this.setVisible(!1)},rm.prototype.updateHalfWidthAndHeight=function(){var t,e;if(this.parameters.zoomScaleFactor>0)t=.5*this.parameters._aspectRatio,e=.5;else if(t=.5*this.parameters._aspectRatio*this.parameters.scale.x,e=.5*this.parameters.scale.y,-1!==this.parameters.width&&-1!==this.parameters.height){var i=this.parameters.width/(2*t);2*e*i>this.parameters.height&&(i=this.parameters.height/(2*e)),t*=i,e*=i}this.parameters._halfWidth=t,this.parameters._halfHeight=e},rm.prototype.updateGeometryAttributesWithScale=function(t){var e=this.parameters._halfWidth*t,i=this.parameters._halfHeight*t,n=this.parameters.position,r=this.parameters._centerZ,a=-this.parameters.angle*Math.PI/180,s=Math.cos(a),o=Math.sin(a),l=o*e,h=s*e,c=o*i,u=s*i,p=this.batch.geometry.getAttribute("position");p.needsUpdate=!0,p.setXYZ(this.vertexOffsets[0],n.x-h+c,n.y-l-u,r),p.setXYZ(this.vertexOffsets[1],n.x+h+c,n.y+l-u,r),p.setXYZ(this.vertexOffsets[2],n.x+h-c,n.y+l+u,r),p.setXYZ(this.vertexOffsets[3],n.x-h-c,n.y-l+u,r);var d=this.batch.geometry.getAttribute("centerOffset");d.needsUpdate=!0,d.setXY(this.vertexOffsets[0],-h+c,-l-u),d.setXY(this.vertexOffsets[1],+h+c,+l-u),d.setXY(this.vertexOffsets[2],+h-c,+l+u),d.setXY(this.vertexOffsets[3],-h-c,-l+u);var m=this.batch.geometry.getAttribute("angleVector");m.needsUpdate=!0,m.setXY(this.vertexOffsets[0],-o,s),m.setXY(this.vertexOffsets[1],-o,s),m.setXY(this.vertexOffsets[2],-o,s),m.setXY(this.vertexOffsets[3],-o,s)},rm.prototype.updateGeometryAttributes=function(){this.updateGeometryAttributesWithScale(1)},rm.prototype.updateUVAttribute=function(t){var e=this.batch.geometry.getAttribute("uv");e.needsUpdate=!0,e.setXY(this.vertexOffsets[0],t.x0,t.y0),e.setXY(this.vertexOffsets[1],t.x1,t.y0),e.setXY(this.vertexOffsets[2],t.x1,t.y1),e.setXY(this.vertexOffsets[3],t.x0,t.y1)},rm.prototype.updateCenterAttribute=function(){var t=this.parameters.position,e=this.parameters._centerZ,i=this.batch.geometry.getAttribute("center");i.needsUpdate=!0,i.setXYZ(this.vertexOffsets[0],t.x,t.y,e),i.setXYZ(this.vertexOffsets[1],t.x,t.y,e),i.setXYZ(this.vertexOffsets[2],t.x,t.y,e),i.setXYZ(this.vertexOffsets[3],t.x,t.y,e)},rm.prototype.updateGeometryAttributeFace2d=function(t,e,i){var n=this.parameters._center,r=this.parameters._centerZ,a=this.parameters._halfWidth*i,s=this.parameters._halfHeight*i,o=e*a,l=t*a,h=e*s,c=t*s,u=this.batch.geometry.getAttribute("position");u.needsUpdate=!0,u.setXYZ(this.vertexOffsets[0],n.x-l+h,n.y-o-c,r),u.setXYZ(this.vertexOffsets[1],n.x+l+h,n.y+o-c,r),u.setXYZ(this.vertexOffsets[2],n.x+l-h,n.y+o+c,r),u.setXYZ(this.vertexOffsets[3],n.x-l-h,n.y-o+c,r)},rm.prototype.updateGeometryAttributeFacing=function(t,e){var i=this.parameters._center,n=this.parameters._centerZ,r=this.parameters._halfWidth*e,a=this.parameters._halfHeight*e,s=[{x:-r,y:-a},{x:r,y:-a},{x:r,y:a},{x:-r,y:a}],o=this.batch.geometry.getAttribute("position");o.needsUpdate=!0;for(var l=0;l<4;l++)o.setXYZ(this.vertexOffsets[l],t[0]*s[l].x+t[3]*s[l].y+i.x,t[1]*s[l].x+t[4]*s[l].y+i.y,t[2]*s[l].x+t[5]*s[l].y+n)},rm.prototype.updateTypesAttribute=function(){var t;this.parameters.fixed?t=this.parameters.flip?0:1:this.parameters.face2d?(this.batch.mapviewer.mustUpdateCameraObjects=!0,t=2):(this.batch.mapviewer.mustUpdateCameraObjects=!0,t=3);var e=this.batch.geometry.getAttribute("type");e.needsUpdate=!0,e.setX(this.vertexOffsets[0],t),e.setX(this.vertexOffsets[1],t),e.setX(this.vertexOffsets[2],t),e.setX(this.vertexOffsets[3],t)},rm.prototype.updateVisibilityRampAttribute=function(){var t=this.batch.geometry.getAttribute("visibilityRamp");t.needsUpdate=!0,t.setXYZW(this.vertexOffsets[0],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible),t.setXYZW(this.vertexOffsets[1],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible),t.setXYZW(this.vertexOffsets[2],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible),t.setXYZW(this.vertexOffsets[3],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible)},rm.prototype.decrementBatchUsage=function(){this.batch.inuse--,0==this.batch.inuse&&this.batch.dispose()},rm.prototype.realRemove=function(t){var e=this.parameters;if(!e)return!1;this.setVisible(!1,!0),this.parameters=null;var i=this.proxy;t&&this.batch.addPoiVariables.POIFactory.removeFromPois(this.batch.mapviewer,e.id,i.publicPOI),this.proxy.destroyPublicInterface(),this.proxy=null,this.decrementBatchUsage()},rm.prototype.remove=function(){this.realRemove(!0)},am.prototype=Object.create(rm.prototype),am.prototype.constructor=am,am.prototype.setVisible=function(t,e){if(this.parameters&&this.parameters.visible!=t||e){this.parameters.visible=t;var i=this.batch.geometry.getIndex(),n=this.batch.indices;if(t)for(var r=0;r<this.fragments.length;r++){var a=6*(o=this.fragments[r]).index,s=4*o.index;n[a]=s,n[a+1]=s+1,n[a+2]=s+3,n[a+3]=s+1,n[a+4]=s+2,n[a+5]=s+3}else for(r=0;r<this.fragments.length;r++){var o;a=6*(o=this.fragments[r]).index,s=4*o.index;n[a]=0,n[a+1]=0,n[a+2]=0,n[a+3]=0,n[a+4]=0,n[a+5]=0}i.needsUpdate=!0}},am.prototype.computeLines=function(t){var e=this.parameters._aspectRatio/t,i=this.fragments[0].aspectRatio,n=0;this.fragments[0].lineNb=0;for(var r=[{fragments:[0],width:this.fragments[0].width,height:this.fragments[0].height,aspectRatio:this.fragments[0].aspectRatio}],a=1;a<this.fragments.length;a++){var s=this.fragments[a],o=i+this.space.aspectRatio+s.aspectRatio;n<t&&(i>e||o>1.5*e)?(n++,s.lineNb=n,r[n]={fragments:[a],width:s.width,height:s.height,aspectRatio:s.aspectRatio},i=s.aspectRatio):(i=o,s.lineNb=n,r[n].fragments.push(a),r[n].width+=this.space.width+s.width,r[n].height=Math.max(r[n].height,s.height),r[n].aspectRatio=r[n].width/r[n].height)}if(void 0!==this.parameters.isRTL&&this.parameters.isRTL)for(var l=0;l<r.length;l++)r[l].fragments=r[l].fragments.reverse();return r},am.prototype.updateLinesDefault=function(){var t=this.parameters._aspectRatio,e=1,i=this.computeLines(e),n=this.hitsTheTop(i,this.parameters.scale);for(this.lines=i;!n&&e<this.fragments.length;){e++,i=this.computeLines(e),t=0;for(var r=0;r<i.length;r++)t=Math.max(t,i[r].aspectRatio);(n=this.hitsTheTop(i,this.parameters.scale))||(this.lines=i)}},am.prototype.updateLinesZoomScale=function(){var t=this.parameters._aspectRatio,e=1;for(this.lines=this.computeLines(e);this.parameters._zoomScale*t>this.parameters.width&&e<this.fragments.length;){e++,this.lines=this.computeLines(e),t=0;for(var i=0;i<this.lines.length;i++)t=Math.max(t,this.lines[i].aspectRatio)}},am.prototype.hitsTheTop=function(t,e){if(-1===this.parameters.width||-1===this.parameters.height)return!1;for(var i=0,n=0;n<t.length;n++)i=Math.max(i,t[n].aspectRatio);return i*=e.x,t.length*e.y*(this.parameters.width/i)>this.parameters.height},am.prototype.updateHalfWidthAndHeightDefault=function(t){(0===this.lines.length||t)&&this.updateLinesDefault();for(var e=0;e<this.lines.length;e++)for(var i=this.lines[e],n=.5*-i.aspectRatio*this.parameters.scale.x,r=.5*(this.lines.length-1)-e,a=0;a<i.fragments.length;a++){n+=.5*(c=this.fragments[i.fragments[a]]).aspectRatio*this.parameters.scale.x,c.horizontalOffset=n,n+=.5*c.aspectRatio*this.parameters.scale.x,a<i.fragments.length-1&&(n+=this.space.aspectRatio*this.parameters.scale.x),c.verticalOffset=r*this.parameters.scale.y,c.halfWidth=.5*c.aspectRatio*this.parameters.scale.x,c.halfHeight=.5*this.parameters.scale.y}if(-1!==this.parameters.width&&-1!==this.parameters.height){var s=0;for(e=0;e<this.lines.length;e++)s=Math.max(s,this.lines[e].aspectRatio);s*=this.parameters.scale.x;var o=this.lines.length*this.parameters.scale.y,l=this.parameters.width/s;if(o*l>this.parameters.height&&(l=this.parameters.height/o),1!==l)for(var h=0;h<this.fragments.length;h++){var c;(c=this.fragments[h]).horizontalOffset*=l,c.verticalOffset*=l,c.halfWidth*=l,c.halfHeight*=l}}},am.prototype.updateHalfWidthAndHeightZoomScale=function(){var t=this.lines.length,e=this.fragments.length;(0===this.lines.length||!(this.parameters._zoomScale===this.parameters._previousZoomScale||this.parameters._zoomScale>this.parameters._previousZoomScale&&t===e||this.parameters._zoomScale<this.parameters._previousZoomScale&&1===t))&&this.updateLinesZoomScale(),this.parameters._previousZoomScale=this.parameters._zoomScale,this.parameters._halfWidth=0;for(var i=0;i<this.lines.length;i++){for(var n=this.lines[i],r=.5*-n.aspectRatio,a=.5*(this.lines.length-1)-i,s=0;s<n.fragments.length;s++){var o=this.fragments[n.fragments[s]];r+=.5*o.aspectRatio,o.horizontalOffset=r,r+=.5*o.aspectRatio,s<n.fragments.length-1&&(r+=this.space.aspectRatio),o.verticalOffset=a,o.halfWidth=.5*o.aspectRatio,o.halfHeight=.5}this.parameters._halfWidth=Math.max(this.parameters._halfWidth,.5*n.aspectRatio)}this.parameters._halfHeight=.5*this.lines.length},am.prototype.updateHalfWidthAndHeight=function(){this.parameters.zoomScaleFactor>0?this.updateHalfWidthAndHeightZoomScale():this.updateHalfWidthAndHeightDefault()},am.prototype.updateVisibility=function(){this.updateHalfWidthAndHeightZoomScale(),this.parameters._halfWidth*this.parameters._zoomScale<.5*this.parameters.width&&this.parameters._halfHeight*this.parameters._zoomScale<.5*this.parameters.height?this.setVisible(!0):this.parameters.zoomScaleVisible?(this.parameters._zoomScale=0,this.parameters._dirty=!0,this.setVisible(!0)):this.setVisible(!1)},am.prototype.updateFragmentUVAttribute=function(t,e){var i=this.batch.geometry.getAttribute("uv");i.needsUpdate=!0;var n=this.fragments[e],r=4*n.index;n.vertexOffsets=[r,r+1,r+2,r+3],i.setXY(n.vertexOffsets[0],t.x0,t.y0),i.setXY(n.vertexOffsets[1],t.x1,t.y0),i.setXY(n.vertexOffsets[2],t.x1,t.y1),i.setXY(n.vertexOffsets[3],t.x0,t.y1)},am.prototype.updateGeometryAttributesWithScale=function(t){var e=this.batch.geometry.getAttribute("position"),i=this.batch.geometry.getAttribute("centerOffset"),n=this.batch.geometry.getAttribute("angleVector");e.needsUpdate=!0,i.needsUpdate=!0,n.needsUpdate=!0;for(var r=this.parameters._centerZ,a=-this.parameters.angle*Math.PI/180,s=Math.cos(a),o=Math.sin(a),l=0;l<this.fragments.length;l++)for(var h=this.fragments[l],c=h.halfWidth,u=h.halfHeight,p=[{x:-c+h.horizontalOffset,y:-u+h.verticalOffset},{x:c+h.horizontalOffset,y:-u+h.verticalOffset},{x:c+h.horizontalOffset,y:u+h.verticalOffset},{x:-c+h.horizontalOffset,y:u+h.verticalOffset}],d=this.parameters.position,m=0;m<4;m++){var f=p[m],g=(s*f.x-o*f.y)*t,v=(o*f.x+s*f.y)*t;e.setXYZ(h.vertexOffsets[m],d.x+g,d.y+v,r),i.setXY(h.vertexOffsets[m],g,v),n.setXY(h.vertexOffsets[m],-o,s)}},am.prototype.updateCenterAttribute=function(){var t=this.parameters.position,e=this.parameters._centerZ,i=this.batch.geometry.getAttribute("center");i.needsUpdate=!0;for(var n=0;n<this.fragments.length;n++){var r=this.fragments[n];i.setXYZ(r.vertexOffsets[0],t.x,t.y,e),i.setXYZ(r.vertexOffsets[1],t.x,t.y,e),i.setXYZ(r.vertexOffsets[2],t.x,t.y,e),i.setXYZ(r.vertexOffsets[3],t.x,t.y,e)}},am.prototype.updateGeometryAttributeFace2d=function(t,e,i){var n=this.parameters._centerZ,r=this.batch.geometry.getAttribute("position");r.needsUpdate=!0;for(var a=0;a<this.fragments.length;a++)for(var s=this.fragments[a],o=s.halfWidth,l=s.halfHeight,h=[{x:-o+s.horizontalOffset,y:-l+s.verticalOffset},{x:o+s.horizontalOffset,y:-l+s.verticalOffset},{x:o+s.horizontalOffset,y:l+s.verticalOffset},{x:-o+s.horizontalOffset,y:l+s.verticalOffset}],c=this.parameters.position,u=0;u<4;u++){var p=h[u],d=(t*p.x-e*p.y)*i,m=(e*p.x+t*p.y)*i;r.setXYZ(s.vertexOffsets[u],c.x+d,c.y+m,n)}},am.prototype.updateGeometryAttributeFacing=function(t,e){var i=this.parameters._centerZ,n=this.batch.geometry.getAttribute("position");n.needsUpdate=!0;for(var r=0;r<this.fragments.length;r++)for(var a=this.fragments[r],s=a.halfWidth,o=a.halfHeight,l=[{x:-s+a.horizontalOffset,y:-o+a.verticalOffset},{x:s+a.horizontalOffset,y:-o+a.verticalOffset},{x:s+a.horizontalOffset,y:o+a.verticalOffset},{x:-s+a.horizontalOffset,y:o+a.verticalOffset}],h=this.parameters.position,c=0;c<4;c++){var u=l[c],p=u.x*e,d=u.y*e;n.setXYZ(a.vertexOffsets[c],t[0]*p+t[3]*d+h.x,t[1]*p+t[4]*d+h.y,t[2]*p+t[5]*d+i)}},am.prototype.updateTypesAttribute=function(){var t;this.parameters.fixed?t=this.parameters.flip?0:1:this.parameters.face2d?(this.batch.mapviewer.mustUpdateCameraObjects=!0,t=2):(this.batch.mapviewer.mustUpdateCameraObjects=!0,t=3);var e=this.batch.geometry.getAttribute("type");e.needsUpdate=!0;for(var i=0;i<this.fragments.length;i++){var n=this.fragments[i];e.setX(n.vertexOffsets[0],t),e.setX(n.vertexOffsets[1],t),e.setX(n.vertexOffsets[2],t),e.setX(n.vertexOffsets[3],t)}},am.prototype.updateVisibilityRampAttribute=function(){var t=this.batch.geometry.getAttribute("visibilityRamp");t.needsUpdate=!0;for(var e=0;e<this.fragments.length;e++){var i=this.fragments[e];t.setXYZW(i.vertexOffsets[0],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible),t.setXYZW(i.vertexOffsets[1],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible),t.setXYZW(i.vertexOffsets[2],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible),t.setXYZW(i.vertexOffsets[3],this.parameters.visibilityRampStartVisible,this.parameters.visibilityRampFullyVisible,this.parameters.visibilityRampStartInvisible,this.parameters.visibilityRampFullyInvisible)}},am.prototype.decrementBatchUsage=function(){this.batch.inuse-=this.fragments.length,0==this.batch.inuse&&this.batch.dispose()};var sm="uniform vec2 camAngleVector;varying vec2 vUv;varying float visibilityOpacity;attribute vec4 visibilityRamp;attribute vec3 center;attribute vec2 angleVector;attribute vec2 centerOffset;attribute float type;float mylength(vec3 v){return sqrt((v.x*v.x)+(v.y*v.y)+(v.z*v.z));}float mydot(vec2 A,vec2 B){return((A.x*B.x)+(A.y*B.y));}float computeOpacity(float pDist){float result;float startVisible=visibilityRamp.x;float fullyVisible=visibilityRamp.y;float startInvisible=visibilityRamp.z;float fullyInvisible=visibilityRamp.w;if(pDist>fullyVisible){if(pDist<startInvisible){result=1.0;}else if(pDist>fullyInvisible){result=0.0;}else{result=1.0-((pDist-startInvisible)/(fullyInvisible-startInvisible));}}else if(pDist<startVisible){result=0.0;}else{result=(pDist-startVisible)/(fullyVisible-startVisible);}return result;}void main(){float d=mydot(angleVector,camAngleVector);vec3 calculatedPosition;if(type==0.0&&d>=0.0){calculatedPosition=center-vec3(centerOffset,0);}else{calculatedPosition=position;}vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(calculatedPosition,1.0);vec4 centerWorldPosition=modelMatrix*vec4(center,1.0);vec3 cameraPositionVector=cameraPosition-centerWorldPosition.xyz;float lDist=mylength(cameraPositionVector);visibilityOpacity=computeOpacity(lDist);}",om="varying vec2 vUv;uniform sampler2D map;uniform float opacity;varying float visibilityOpacity;void main(){gl_FragColor=vec4(vec3(1.0),1.0)*texture2D(map,vUv);;gl_FragColor.a*=visibilityOpacity*opacity;}",lm=function(t){return.02*t},hm=function(t){return.15*Math.sqrt(t)};function cm(t,e,i,n,r,a){this.mapviewer=n,this.texture=t,t.vg.nbRefs++,this.dynamic=a,this.poiBatches=e,this.geometry=new ir,this.geometry.matrixAutoUpdate=!1,this.material=new Lr({uniforms:{map:{type:"t",value:t},opacity:{type:"f",value:1},camAngleVector:{type:"v2",value:n.manipulator.cameraAngleVector}},vertexShader:sm,fragmentShader:om,transparent:!0,side:h,depthWrite:!1,depthTest:!r&&n.useDepthWriteForPOIs}),this.mesh=new br(this.geometry,this.material),this.mesh.matrixAutoUpdate=!1,a&&(this.orientationSerials=new Uint16Array(200),this.mesh.updateMatrix=function(){var t=this.vgbatch,e=t.types,i=t.indices,n=t.mapviewer,r=n.manipulator.cameraAngleVector.x,a=-n.manipulator.cameraAngleVector.y,s=n.manipulator.orientationSerial,o=t.orientationSerials,l=n.manipulator.radius,h=(n.camera.vg.cameraMatrix3||new $e).elements;Object.keys(t.pois).forEach(function(n){var c=t.pois[n],u=c.parameters;if(u){var p=0;if((p=u.zoomScaleFast?lm(l)*u.zoomScaleFactor:hm(l)*u.zoomScaleFactor)>0&&p!==u._zoomScale&&-1!==u.width&&-1!==u.height&&(u._zoomScale=p,c.updateVisibility(),p=u._zoomScale),i[6*n]!==i[6*n+1]&&(s!=o[n]||u._dirty||p>0)){o[n]=s;var d=e[4*n],m=p>0?p:1;d<2&&p>0?c.updateGeometryAttributesWithScale(m):2===d?c.updateGeometryAttributeFace2d(a,r,m):3===d&&c.updateGeometryAttributeFacing(h,m),u._dirty=!1}}}),ln.prototype.updateMatrix.apply(this)},this.mesh.vgbatch=this),this.mesh.renderOrder=-i,this.capacity=200,this.inuse=0,this.nextFreeQuadNumber=0;this.vertices=new Float32Array(2400),this.types=new Float32Array(800),this.center=new Float32Array(2400),this.centerOffset=new Float32Array(1600),this.visibilityRamp=new Float32Array(3200),this.normals=new Float32Array(2400),this.uvs=new Float32Array(1600),this.angleVector=new Float32Array(1600),this.geometry.setAttribute("position",new zn(this.vertices,3)),this.geometry.setAttribute("type",new zn(this.types,1)),this.geometry.setAttribute("center",new zn(this.center,3)),this.geometry.setAttribute("centerOffset",new zn(this.centerOffset,2)),this.geometry.setAttribute("normal",new zn(this.normals,3)),this.geometry.setAttribute("uv",new zn(this.uvs,2)),this.geometry.setAttribute("visibilityRamp",new zn(this.visibilityRamp,4)),this.geometry.setAttribute("angleVector",new zn(this.angleVector,2)),this.pois=[]}function um(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.padding=t.padding,this.hasContent=!1,this.image=null,this.text=null,this.textOptions=null,this.batchElements=[],this.batchMultilineTexts=[],this.iconSlots=[],this.left=null,this.right=null}function pm(t){this.width=void 0!==t.width?t.width:2048,this.height=void 0!==t.height?t.height:2048,this.delayCanvasCreation=t.delayCanvasCreation,this.delayCanvasCreation?(this.canvas=null,this.canvasContext=null):this.createCanvas(this.width,this.height),this.count=0,this.locked=!1,this.resetNodes()}function dm(t,e,i,n){this.lod=t,this.renderDepthPOI=i,this.overlay=e.overlay,this.dynamic=!e.fixed||e.zoomScaleFactor>0,this.textureGenerator=n||new _d,this.batches=[]}cm.prototype.constructor=cm,cm.prototype.dispose=function(){this.texture.vg.nbRefs--,this.poiBatches.removeBatch(this),this.poiBatches=null,this.vertices=null,this.types=null,this.center=null,this.centerOffset=null,this.visibilityRamp=null,this.normals=null,this.uvs=null,this.angleVector=null,this.pois=null,this.mesh.updateMatrix=null,this.mesh.vgbatch=null,this.mesh=null,this.material.dispose(),this.geometry.dispose()},cm.prototype.isFull=function(t){return this.nextFreeQuadNumber+t-1>=this.capacity},cm.prototype.allocateNextFreeQuad=function(t){var e=this.nextFreeQuadNumber++;this.inuse++;var i=0,n=6*this.nextFreeQuadNumber,r=this.indices,a=new(n>65535?Uint32Array:Uint16Array)(n),s=(i=0,0);if(r){for(;i<6*e;++i)a[i]=r[i];s=4*e}return t?(a[i]=s,a[i+1]=s+1,a[i+2]=s+3,a[i+3]=s+1,a[i+4]=s+2,a[i+5]=s+3):(a[i]=0,a[i+1]=0,a[i+2]=0,a[i+3]=0,a[i+4]=0,a[i+5]=0),this.indices=a,this.geometry.setIndex(new zn(this.indices,1)),e},cm.prototype.getPickableFromIntersection=function(t){if(!this.pois)return!1;if(t&&t.face){var e=t.face.a/4|0;if(e<this.nextFreeQuadNumber){for(;void 0===this.pois[e];)e--;var i=this.pois[e].parameters;if(!i)return!1;var n,r=t.distance;return!(r<i.visibilityRampStartVisible||r>i.visibilityRampFullyInvisible)&&(n=this.pois[e].proxy.publicPOI,void 0===i||i.id,{publicObject:n,options:{id:i.id,poi:i}})}}return!1},cm.prototype.recalculatePositionCameraFacing=function(t,e,i){var n=t.matrix,r=new $e,a=n.elements,s=r.elements;s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[4],s[4]=a[5],s[5]=a[6],s[6]=a[8],s[7]=a[9],s[8]=a[10];var o=e._halfWidth,l=e._halfHeight,h=e._center,c=e._centerZ,u=new li(-o,-l,0),p=new li(o,-l,0),d=new li(o,l,0),m=new li(-o,l,0);u.applyMatrix3(r),p.applyMatrix3(r),d.applyMatrix3(r),m.applyMatrix3(r);var f=i,g=i+1,v=i+2,y=i+3,x=this.geometry.getAttribute("position");x.setXYZ(f,u.x+h.x,u.y+h.y,u.z+c),x.setXYZ(g,p.x+h.x,p.y+h.y,p.z+c),x.setXYZ(v,d.x+h.x,d.y+h.y,d.z+c),x.setXYZ(y,m.x+h.x,m.y+h.y,m.z+c),x.needsUpdate=!0},cm.prototype.recalculatePositionFace2D=function(t,e,i,n){var r=i._halfWidth,a=i._halfHeight,s=i._center,o=i._centerZ,l=n,h=n+1,c=n+2,u=n+3,p=t*r,d=e*r,m=t*a,f=e*a,g=this.geometry.getAttribute("position");g.setXYZ(l,s.x-d+m,s.y-p-f,o),g.setXYZ(h,s.x+d+m,s.y+p-f,o),g.setXYZ(c,s.x+d-m,s.y+p+f,o),g.setXYZ(u,s.x-d-m,s.y-p+f,o),g.needsUpdate=!0},cm.prototype.createElement=function(t,e,i,n){n._aspectRatio=t,n._zOffset=i,n._center=n.position,n._centerZ=(n.position.z||0)+i;var r=this.allocateNextFreeQuad(n.visible),a=new rm(this,r,n,e);return this.pois[r]=a,this.geometry.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.mesh.updateMatrix(),this.mesh.updateMatrixWorld(!0),a},cm.prototype.createMultiLineText=function(t,e,i,n,r){r._aspectRatio=t,r._zOffset=n,r._center=r.position,r._centerZ=(r.position.z||0)+n;for(var a=0;a<e.length;a++)e[a].index=this.allocateNextFreeQuad(r.visible);var s=new am(this,e[0].index,r,e,i);return this.pois[e[0].index]=s,this.geometry.needsUpdate=!0,this.geometry.computeBoundingSphere(),this.mesh.updateMatrix(),this.mesh.updateMatrixWorld(!0),s},um.prototype.isLeaf=function(){return null===this.left&&null===this.right},um.prototype.insert=function(t,e){if(this.isLeaf()){var i=t.width+2*e,n=t.height+2*e;return this.hasContent?null:i>this.width||n>this.height?null:i===this.width&&n===this.height?this:(this.width-i>this.height-n?(this.left=new um({x:this.x,y:this.y,width:i,height:this.height,padding:e}),this.right=new um({x:this.x+i,y:this.y,width:this.width-i,height:this.height,padding:e})):(this.left=new um({x:this.x,y:this.y,width:this.width,height:n,padding:e}),this.right=new um({x:this.x,y:this.y+n,width:this.width,height:this.height-n,padding:e})),this.left.insert(t,e))}var r=this.left.insert(t,e);return null!==r?r:this.right.insert(t,e)},um.prototype.traverse=function(t,e,i){this.text&&this.textOptions?this.drawText(t):this.image&&this.drawImage(t);var n={x0:(this.x+this.padding)/e,y0:1-(this.y+this.height-1-this.padding)/i,x1:(this.x+this.width-this.padding)/e,y1:1-(this.y+this.padding)/i};this.batchElements.forEach(t=>t.updateUVAttribute(n)),this.batchMultilineTexts.forEach(t=>t.element.updateFragmentUVAttribute(n,t.index)),this.iconSlots.forEach(t=>t.uv=n),this.left&&this.left.traverse(t,e,i),this.right&&this.right.traverse(t,e,i)},um.prototype.drawImage=function(t){t.drawImage(this.image,this.x+this.padding,this.y+this.padding)},um.prototype.drawText=function(t){var e=Math.floor(.8*(this.textOptions.textTextureHeight-2*this.padding));t.font=this.textOptions.style+" "+e+"px "+this.textOptions.family,t.fillStyle="#"+("000000"+this.textOptions.color.toString(16)).slice(-6),t.fillText(this.text,this.x+this.padding,this.y+e+this.padding)},um.prototype.getDimensions=function(t,e){this.hasContent&&(t.push(this.x+this.width),e.push(this.y+this.height)),this.left&&this.left.getDimensions(t,e),this.right&&this.right.getDimensions(t,e)},pm.prototype.createCanvas=function(t,e){var i=document.createElement("canvas");this.canvas=i,i.width=t,i.height=e,this.canvasContext=i.getContext("2d")},pm.prototype.getDimensions=function(){let t=[],e=[];return this.root.getDimensions(t,e),t.sort((t,e)=>e-t),e.sort((t,e)=>e-t),{width:t[0],height:e[0]}},pm.prototype.realize=function(){if(!this.canvas){const t=this.getDimensions();this.createCanvas(t.width,t.height),this.root.traverse(this.canvasContext,this.canvas.width,this.canvas.height),this.locked=!0}},pm.prototype.resetNodes=function(){this.root=new um({x:0,y:0,width:this.width,height:this.height,padding:0})},pm.prototype.insert=function(t,e){if(this.locked)return!1;e=e||0;var i=this.root.insert(t,e);return null!==i&&(this.count++,i.hasContent=!0,i)},pm.prototype.isLargerThanAtlas=function(t,e){return e=e||0,t.width+e>this.width||t.height+e>this.height},dm.prototype.constructor=dm,dm.prototype.removeBatch=function(t){var e=this.batches.indexOf(t);-1!==e&&(this.batches.splice(e,1),this.textureGenerator.disposeTexture(t.texture),-1!==(e=this.lod.pickables.indexOf(t.mesh))&&this.lod.pickables.splice(e,1),t.mesh.parent&&t.mesh.parent.remove(t.mesh),t.dynamic&&-1!==(e=this.lod.cameraUpdatableObjects.indexOf(t.mesh))&&this.lod.cameraUpdatableObjects.splice(e,1))},dm.prototype.addBatch=function(t){this.batches.push(t);var e=t.mesh;this.lod.contentNode.add(e),e.vg={id:!0,batch:t},this.lod.pickables.push(e),t.dynamic&&this.lod.cameraUpdatableObjects.push(t.mesh)},dm.prototype.getBatch=function(t,e,i,n,r){var a;if(n)for(var s=0,o=this.batches.length;s<o;++s)if((a=this.batches[s]).texture===t&&!a.isFull(r))return this.batches[s];return((a=0==this.batches.length?{}:this.batches[this.batches.length-1]).texture!==t||a.isFull(r))&&((a=new cm(t,this,this.renderDepthPOI,e,this.overlay,this.dynamic)).addPoiVariables=i,this.addBatch(a)),a},dm.prototype.createPOI=function(t,e){var i=t.MapviewerPrivate,n=t._mapviewer,r=e.text;if(void 0!==r&&""!==r&&this.textureGenerator instanceof _d){var a=r.replace(/\s+/g," ").trim().split(" ");if(e.multiline&&a.length>1){e.isRTL=!1,gd.isRTL(r)&&(e.isRTL=!0);var s=this.textureGenerator.generateTextOnAtlas(pm," ",e,n.optimizations.batchTexts.atlasSize);if(!1===s)return!1;for(var o=[],l=0,h=0,c=!1,u=0;u<a.length;u++){var p=a[u],d=this.textureGenerator.generateTextOnAtlas(pm,p,e,n.optimizations.batchTexts.atlasSize);if(c||(c=d.texture),!1===d||c!==d.texture)return!1;h+=d.width,l=Math.max(l,d.height),o.push({text:p,uv:d.uv,width:d.width,height:d.height,aspectRatio:d.aspectRatio,space:!1,node:d.node}),u<a.length-1&&(h+=s.width)}var m=h/l,f=!1,g=this.getBatch(c,n,t,f,o.length).createMultiLineText(m,o,s,i.zOffsetPOI,e);return d.node&&o.forEach(function(t,e){t.node.batchMultilineTexts.push({element:g,index:e})}),n.requestRedraw(),g}if(!1===(d=this.textureGenerator.generateTextOnAtlas(pm,r,e,n.optimizations.batchTexts.atlasSize)))return!1;f=!1,g=this.getBatch(d.texture,n,t,f,1).createElement(d.aspectRatio,d.uv,i.zOffsetPOI,e);return d.node&&d.node.batchElements.push(g),n.requestRedraw(),g}if(this.textureGenerator instanceof Md){var v=n.textures[e.url].texture.image;if(!1===(d=this.textureGenerator.generateIconOnAtlasFromImage(pm,e,v,n.optimizations.batchIcons.atlasSize)))return!1;d.aspectRatio=e.keepAspectRatio?v.width/v.height:1;f=!0,g=this.getBatch(d.texture,n,t,f,1).createElement(d.aspectRatio,d.uv,i.zOffsetPOI,e);return d.node&&d.node.batchElements.push(g),n.requestRedraw(),g}return!1};var mm={DEFAULT_POI_OPTIONS:{style:"",family:"Arial",textTextureHeight:64,color:16777215,visibilityRampStartVisible:2,visibilityRampFullyVisible:5,visibilityRampStartInvisible:3e3,visibilityRampFullyInvisible:5e3},removeFromPois:function(t,e,i){if(null!=e){var n=t.pois[e];if(void 0!==n){var r=n.indexOf(i);-1!==r&&(n.splice(r,1),0==n.length&&delete t.pois[e])}}},addToPois:function(t,e,i){null!=e&&(void 0===t.pois[e]&&(t.pois[e]=[]),t.pois[e].push(i))},updateOrCreatePublicPOI:function(t,e,i){if(i)i.proxy=e;else{i=new Ud(e);var n=e.options("id");mm.addToPois(t._mapviewer,n,i)}return e.publicPOI=i,i},createPOIBatchElement:function(t,e,i,n,r){var a,s=t.MapviewerPrivate,o=t._mapviewer;return r?a=e.overlay?!e.fixed||e.zoomScaleFactor>0?i.poiBatches.texts.overlayFacing||(i.poiBatches.texts.overlayFacing=new dm(i,e,s.renderDepthPOIOverlayFacing)):i.poiBatches.texts.overlay||(i.poiBatches.texts.overlay=new dm(i,e,s.renderDepthPOIOverlay)):!e.fixed||e.zoomScaleFactor>0?i.poiBatches.texts.facing||(i.poiBatches.texts.facing=new dm(i,e,s.renderDepthPOIFacing)):i.poiBatches.texts.default||(i.poiBatches.texts.default=new dm(i,e,s.renderDepthPOI)):n&&(a=e.overlay?!e.fixed||e.zoomScaleFactor>0?i.poiBatches.icons.overlayFacing||(i.poiBatches.icons.overlayFacing=new dm(i,e,s.renderDepthPOIOverlayFacing,o.iconGenerator)):i.poiBatches.icons.overlay||(i.poiBatches.icons.overlay=new dm(i,e,s.renderDepthPOIOverlay,o.iconGenerator)):!e.fixed||e.zoomScaleFactor>0?i.poiBatches.icons.facing||(i.poiBatches.icons.facing=new dm(i,e,s.renderDepthPOIFacing,o.iconGenerator)):i.poiBatches.icons.default||(i.poiBatches.icons.default=new dm(i,e,s.renderDepthPOI,o.iconGenerator))),a.createPOI(t,e)},createPOI:function(t,e,i){t.POIFactory=mm;var n,r=t._mapviewer,a=mm.DEFAULT_POI_OPTIONS;void 0!==e.model&&(a.visibilityRampStartVisible=0,a.visibilityRampFullyVisible=0,a.visibilityRampStartInvisible=1/0,a.visibilityRampFullyInvisible=1/0);var s=void 0!==e.id,o={text:void 0!==e.text&&""!==e.text?String(e.text):"",url:e.url,model:e.model,startAnimations:e.startAnimations||[],textureAnimation:e.textureAnimation,selector:e.selector,textTextureHeight:e.textTextureHeight||a.textTextureHeight,style:e.style||a.style,family:e.family||a.family,color:void 0!==e.color?e.color:a.color,position:e.position||{x:0,y:0,z:0},alignment:e.alignment||{x:0,y:0},multiline:e.multiline||!1,_textNbLines:1,keepAspectRatio:e.keepAspectRatio||!1,_aspectRatio:1,_textAspectRatio:1,scale:e.scale||e.iconScale||e.icon_scale||{x:1,y:1,z:1},zoomScaleFactor:e.zoomScaleFactor||0,zoomScaleFast:e.zoomScaleFast||!1,zoomScaleVisible:e.zoomScaleVisible||!1,_zoomScale:0,_previousZoomScale:0,angle:e.angle,heading:e.heading,_inverseAngleInRadians:0,floor:void 0!==e.floor?e.floor:r.currentFloorName,lod:e.lod,visible:void 0===e.visible||e.visible,forceVisible:void 0!==e.forceVisible&&e.forceVisible,id:s?e.id:"_anonymous"+ ++r._anonymous_poi_counter,visibilityRampStartVisible:e.visibilityRampStartVisible||a.visibilityRampStartVisible,visibilityRampFullyVisible:e.visibilityRampFullyVisible||a.visibilityRampFullyVisible,visibilityRampStartInvisible:e.visibilityRampStartInvisible||a.visibilityRampStartInvisible,visibilityRampFullyInvisible:e.visibilityRampFullyInvisible||a.visibilityRampFullyInvisible,clickable:void 0===e.clickable||e.clickable,fixed:void 0!==e.fixed&&e.fixed,width:void 0!==e.width&&0!==e.width?e.width:-1,height:void 0!==e.height&&0!==e.height?e.height:-1,overlay:void 0!==e.overlay&&e.overlay,flip:void 0!==e.flip&&e.flip,face2d:void 0!==e.face2d&&e.face2d,image:void 0!==e.image&&e.image,onObjectMouseOver:e.onObjectMouseOver,onObjectMouseOut:e.onObjectMouseOut,onObjectMouseUp:e.onObjectMouseUp,track:void 0!==e.track&&e.track,vgnobatch:void 0!==e.vgnobatch&&e.vgnobatch,vgmipmap:void 0!==e.vgmipmap?e.vgmipmap:r.optimizations.batchTexts.enabled&&!e.vgnobatch,vgpadding:2,vgdelaycanvascreation:void 0!==e.vgdelaycanvascreation&&e.vgdelaycanvascreation,_empty:!1};for("number"==typeof o.heading&&(o.angle=e.heading-r.cameraNorthRotation),o.angle=void 0!==o.angle?o.angle:0;o.angle<0;)o.angle+=360;for(;o.angle>360;)o.angle-=360;o._inverseAngleInRadians=nd.TWOPI-o.angle*Math.PI/180,"number"==typeof o.scale&&(o.scale={x:o.scale,y:o.scale,z:o.scale});var l=void 0!==o.url&&""!==o.url,h=void 0!==o.text&&""!==o.text,c=void 0!==o.model&&""!==o.model,u=void 0!==o.selector&&""!==o.selector,p=0!==o.alignment.x||0!==o.alignment.y,d=!1;if(l){var m=r.textures[o.url];if(d=m&&m.loaded){var f=r.textures[o.url].texture.image;o._aspectRatio=o.keepAspectRatio?f.width/f.height:1}}var g=!o.vgnobatch&&!(p||c||u)&&!(h&&l)&&(l&&r.optimizations.batchIcons.enabled&&d||h&&r.optimizations.batchTexts.enabled);g&&l?o.vgpadding=r.optimizations.batchIcons.padding:g&&h&&(o.vgpadding=r.optimizations.batchTexts.padding),void 0!==e.vgpadding&&(o.vgpadding=e.vgpadding),o._empty=!(l&&d||h||c||u);var v,y=r.scene,x=r.getFloor(o.floor);if(null===x)return console.log("Warning: POI was not created, required floor doesn't exist."),null;if(null!==x){if(v=void 0!==o.lod?x.getLOD(o.lod):x.floorContentLOD,!o.overlay&&!v)return null;y=o.forceVisible?v.node:v.contentNode}if(!(l&&d||h||c||u)){if(n=new em(t,o,v,y,l,h,c,u),i&&r.requestRedraw(),n=mm.updateOrCreatePublicPOI(t,n.proxy,i),l&&!d){var b=o.url;n.options("url",""),new ed(r,b,!0,function(t,e){return function(){e.options("url",t)}}(b,n))}return n}var w=!1;if(g&&(w=this.createPOIBatchElement(t,o,v,l,h)),o.vgdelaycanvascreation=!1,w)return this.updateOrCreatePublicPOI(t,w.proxy,i);var _=new em(t,o,v,y,l,h,c,u);return this.updateOrCreatePublicPOI(t,_.proxy,i)},createTextureAnimation:function(t,e,i){var n=i.match(/(sintranslate|timetranslate|sinscale)\(\s*([0-9\.-]+)\s*,\s*([0-9\.-]+)\s*,\s*([0-9\.-]+)\s*,\s*([0-9\.-]+)\s*\)/);if(null!==n){var r=n[1],a=n[2],s=n[3],o=n[4];switch(r){case"timetranslate":t.animateValue(0,1,{duration:1e3*a,step:function(t){var i=-t;e.offset.set(i*s,i*o)}}).repeat(1/0);break;case"sintranslate":t.animateValue(0,1,{duration:1e3*a,step:function(t){var i=Math.sin(nd.TWOPI*t);e.offset.set(i*s,i*o)}}).repeat(1/0);break;case"sinscale":t.animateValue(0,1,{duration:1e3*a,step:function(t){var i=Math.sin(nd.TWOPI*t);e.repeat.set(1+i*s,1+i*o),e.offset.set(-.5*i*s,-.5*i*o)}}).repeat(1/0)}}},onModelLoaded:function(t,e,i,n,r,a){var s;if(3.1===e.version){var l=!1,h=[];Object.keys(e.materials).forEach(function(t){var i=new Dn({map:e.materials[t].map,color:16777215,side:o,transparent:e.materials[t].transparent,alphaTest:.1,opacity:n});h.push(i),!l&&i.transparent&&(l=!0)}),(s=new br(e.geometry,h)).matrixAutoUpdate=!1,(i.visibilityRampStartVisible>0||i.visibilityRampFullyVisible>0||i.visibilityRampStartInvisible<1/0||i.visibilityRampFullyInvisible<1/0)&&(h.forEach(function(t,e){h[e].transparent=!0}),l=!0),s.renderOrder=l?1:0,s.vg={id:i.id,poi:i,originalColor:16777215},a.pickables.push(s),null===e.bbox?((p=new ui).setFromObject(s),e.bbox=p):p=e.bbox;var c=new li;p.getSize(c);var u=Math.max(c.x,c.y,c.z)/i.scale.x;s.position.x=0,s.position.y=0,s.position.z=0,s.scale.x=1/u,s.scale.y=-1/u,s.scale.z=-1/u,s.updateMatrix(),s.traverse(function(t){t instanceof br&&(t.castShadow=!0,t.receiveShadow=!0),t.matrixAutoUpdate=s.matrixAutoUpdate})}else if(e.version>=4.4){(s=e.scene.clone(void 0,!1)).updateMatrixWorld(!0);l=!1;s.matrixAutoUpdate=!1,s.traverse(function(e){e.matrixAutoUpdate=s.matrixAutoUpdate,e instanceof br&&((e.material instanceof Dn||e.material instanceof Ih||e.material instanceof Oh)&&e.material.map&&e.material.color.setHex(16777215),void 0!==i.textureAnimation&&(e.material=e.material.clone()),e.material.side=o,e.material.alphaTest=.1,e.material.opacity=n,!l&&e.material.transparent&&(l=!0),e.material.map&&void 0!==e.material.map.image&&(void 0!==i.textureAnimation&&(e.material.map=e.material.map.clone(),mm.createTextureAnimation(t,e.material.map,i.textureAnimation)),e.material.map.wrapS=et,e.material.map.wrapT=et,e.material.map.needsUpdate=!0),e.vg={id:i.id,poi:i,originalColor:16777215},a.pickables.push(e),e.castShadow=!0,e.receiveShadow=!0)}),(i.visibilityRampStartVisible>0||i.visibilityRampFullyVisible>0||i.visibilityRampStartInvisible<1/0||i.visibilityRampFullyInvisible<1/0)&&(s.traverse(function(t){t instanceof br&&(Array.isArray(t.material)?t.material.forEach(function(e,i){t.material[i].transparent=!0}):t.material.transparent=!0)}),l=!0),s.renderOrder=l?1:0,null===e.bbox?((p=new ui).setFromObject(s),e.bbox=p):p=e.bbox,s.position.x=0,s.position.y=0,s.position.z=0;u=2*Math.max(Math.abs(p.min.x),Math.abs(p.max.x),Math.abs(p.min.y),Math.abs(p.max.y))/Math.max(i.scale.x,i.scale.y);s.scale.x*=1/u,s.scale.y*=1/u,s.scale.z*=1/u,s.rotation.x=nd.PI_2,s.updateMatrix(),s.updateMatrixWorld()}else if(3.2===e.version){var p;l=!1;for(var d in e.result.materials)if((e.result.materials[d]instanceof Dn||e.result.materials[d]instanceof Ih||e.result.materials[d]instanceof Oh)&&e.result.materials[d].map&&e.result.materials[d].color.setHex(16777215),e.result.materials[d].side=o,e.result.materials[d].alphaTest=.1,e.result.materials[d].opacity=n,!l&&e.result.materials[d].transparent&&(l=!0),e.result.materials[d].map){var m=e.result.materials[d].map;m.wrapS=et,m.wrapT=et}s=e.result.scene.clone(void 0,!1),(i.visibilityRampStartVisible>0||i.visibilityRampFullyVisible>0||i.visibilityRampStartInvisible<1/0||i.visibilityRampFullyInvisible<1/0)&&(s.traverse(function(t){t instanceof br&&(Array.isArray(t.material)?t.material.forEach(function(e,i){t.material[i].transparent=!0}):t.material.transparent=!0)}),l=!0),s.renderOrder=l?1:0,s.matrixAutoUpdate=!1,s.traverse(function(t){t.matrixAutoUpdate=s.matrixAutoUpdate,t instanceof br&&(t.vg={id:i.id,poi:i,originalColor:16777215},a.pickables.push(t),t.castShadow=!0,t.receiveShadow=!0)}),null===e.bbox?((p=new ui).setFromObject(s),e.bbox=p):p=e.bbox;u=2*Math.max(Math.abs(p.min.x),Math.abs(p.max.x),Math.abs(p.min.y),Math.abs(p.max.y))/Math.max(i.scale.x,i.scale.y);s.position.x=0,s.position.y=0,s.position.z=0,s.scale.x=1/u,s.scale.y=1/u,s.scale.z=1/u,s.rotation.x=nd.PI_2,s.updateMatrix(),s.updateMatrixWorld()}s.name="poi_model",r.add(s),r.updateMatrixWorld(!0),i._opacity=null,t.mustUpdateCameraObjects=!0,t.requestRedraw()},removeMaterial:function(t,e,i){null!==e&&i.traverse(function(e){if(e&&void 0!==e.material&&null!==e.material.map&&"object"==typeof e.material.map){var i=function(){var i;void 0!==e.material.map.vg&&e.material.map.vg.nbRefs--,(void 0===e.material.map.vg||e.material.map.vg.nbRefs<=0)&&((i=e.material.map).dispose(),i.sourceFile&&void 0!==t.textures[i.sourceFile]&&delete t.textures[i.sourceFile],i.image instanceof HTMLCanvasElement||(i.image=null))};"object"==typeof e.material.map?i(e.material):void 0!==e.material.length&&e.material.forEach(function(t){i()})}})},removeModel:function(t,e){var i=function(t){t instanceof In?(t.map&&t.map.dispose(),t.dispose()):t.length>0&&t.forEach(function(t){i(t)})},n=t.models[e];if(n.loaded)if(3.1===n.version){n.geometry.dispose();for(var r=n.materials.length-1;r>=0;r--)i(n.materials[r])}else 3.2===n.version?(Object.keys(n.result.geometries).forEach(function(t){n.result.geometries[t].dispose()}),Object.keys(n.result.materials).forEach(function(t){i(n.result.materials[t])}),Object.keys(n.result.textures).forEach(function(t){n.result.textures[t].dispose()})):n.version>=4.4&&n.scene.traverse(function(t){t.geometry&&t.geometry.dispose(),void 0!==t.material&&i(t.material)});n.pending.splice(0),delete t.models[e]}},fm=[],gm=[],vm=["show","hide","remove","getLength","getInterpolatedPosition","setInterpolatedStartEnd","getVisible","options","updateEndPoints"];function ym(t){Pd.create(this,t,fm,gm,vm),Object.defineProperty(this,"visible",{get:function(){return t.getVisible()},set:function(e){t.setVisible(e)}})}function xm(t){ym.apply(this,[t])}function bm(t,e,i,n,r,a,s){this.mesh=r,r.traverse(function(t){t.visible=e.visible}),r=null,this.lod=s,this.pathGeometry=a,this.spline=i,this.meshParent=this.mesh.parent,this.previousRight=new li,this.publicPath=!1,this.publicLink=!1,this.getPublicPath=function(){return this.publicPath=this.publicPath||new ym(this),this.publicPath},this.getPublicLink=function(){return this.publicLink=this.publicLink||new xm(this),this.publicLink},this.setVisible=function(i){this.mesh&&e&&e.visible!==i&&(0!==e.speed&&(i?t.incrementUpdatableObjects():t.decrementUpdatableObjects()),e.visible=i,this.mesh.traverse(function(t){t.visible=i}),t.requestRedraw())},this.getVisible=function(){return e&&e.visible},this.show=function(){this.setVisible(!0)},this.hide=function(){this.setVisible(!1)},this.remove=function(){if(this.mesh){var i=this.mesh;void 0!==i.parent&&(i.parent.remove(i),e.visible&&0!==e.speed&&t.decrementUpdatableObjects(),t.requestRedraw()),this.linkOptions&&(t.removeLink(this),this.linkOptions.startFloor.removeLink(this),this.linkOptions.endFloor.removeLink(this)),this.mesh&&(this.mesh.geometry.dispose(),mm.removeMaterial(t,{},this.mesh),this.mesh=null),t.removePath(this)}},this.getLength=function(){return n},this.getInterpolatedPosition=function(t){if(i){t<0?t=0:t>1&&(t=1);var e=i.getPoint(t);return{x:e.x,y:e.y,z:e.z}}return!1},this.setInterpolatedStartEnd=function(i,n){(i=i||0)<0?i=0:i>1&&(i=1),(n=void 0===n?1:n)<0?n=0:n>1&&(n=1),e.interpolationStart=i,e.interpolationEnd=n,a.interpolationStart=i,a.interpolationEnd=n,a.recalculate(),this.mesh=t.recreateAndUpdateMeshFromPathGeometry(a.getGeometry(),this.mesh,e.visible),this.isCameraFacing&&this.updateCamerafacing(!0)},this.updateEndPoints=function(e,r){if(this.mesh){var s=this.mesh.vg&&this.mesh.vg.path||{};if(s.points&&2!=s.points.length)return!1;if(s.points[0]=e||i.getPoint(0),s.points[1]=r||i.getPoint(1),s.points[0].x===s.points[1].x&&s.points[0].y===s.points[1].y&&s.points[0].z===s.points[1].z)return void 0!==this.mesh.parent&&this.mesh.parent.remove(this.mesh),!1;(i=new Oc).add(new Tc(new li(s.points[0].x,s.points[0].y,s.points[0].z),new li(s.points[1].x,s.points[1].y,s.points[1].z))),n=i.getLength(),a.updatePath(i),void 0===this.mesh.parent&&(this.meshParent.add(this.mesh),this.mesh.updateMatrixWorld());var o=s.repeat;s.repeat<0&&s.url&&(o*=-n/s.thickness,this.mesh.material.map.repeat.x=o),this.mesh=t.recreateAndUpdateMeshFromPathGeometry(a.getGeometry(),this.mesh,s.visible),this.isCameraFacing&&this.updateCamerafacing(!0)}},this.setLinkOptions=function(t){this.isCameraFacing=t.cameraFacing||!1,this.linkOptions=t,this.linkOptions.startFloor.addLink(this),this.linkOptions.endFloor.addLink(this)},this.updateCamerafacing=function(e){var i={x:t.camera.matrix.elements[0],y:t.camera.matrix.elements[1],z:t.camera.matrix.elements[2]};if(!this.previousRight.equals(i)||e){this.previousRight.copy(i);var n=this.mesh.vg&&this.mesh.vg.path||{};if(n.points&&2!=n.points.length)return!1;var r=n.points[1].z<n.points[0].z;a.recalculate({binormal:i}),this.mesh=t.recreateAndUpdateMeshFromPathGeometry(a.getGeometry(),this.mesh,n.visible),this.mesh.material.side=r?o:l}},this.options=function(i,n){if(void 0===i)return e;if(void 0===n)return"interpolationTextureLikeWindow"===i?a.interpolationTextureLikeWindow:e[i];"speed"===i?this.mesh.vg&&this.mesh.vg.path&&void 0!==this.mesh.vg.path.speed&&(0!==this.mesh.vg.path.speed&&t.decrementUpdatableObjects(),e.speed=n,this.mesh.vg.path.speed=n,0!=n&&e.visible&&t.incrementUpdatableObjects()):"interpolationTextureLikeWindow"===i?a.interpolationTextureLikeWindow!=n&&(a.interpolationTextureLikeWindow=n,e.interpolationTextureLikeWindow=n,this.setInterpolatedStartEnd(e.interpolationStart,e.interpolationEnd)):"interpolationStart"===i||"interpolationEnd"===i?("interpolationStart"===i?e.interpolationStart=n:"interpolationEnd"===i&&(e.interpolationEnd=n),this.setInterpolatedStartEnd(e.interpolationStart,e.interpolationEnd)):"color"===i&&(this.mesh.material.color=new On(n))}}var wm=[],_m=["vg"],Mm=["isLoaded","setName","setIcon","setColor","resetColor"];function Sm(t){Pd.create(this,t,wm,_m,Mm)}function Tm(t,e,i){this.mapviewer=t,this.init(e,i),this.publicPlace=!1,this.state=null}function Em(t){this.places={},this.publicPlaces={},this.placeGeometryElements={},this.placeStates={},this.createPlace=function(e,i){this.places[e]=new Tm(t,e,i),this.places[e].setState(this.getOrCreatePlaceState(e))},this.initFromList=function(t){$d.each(t,function(t){this.places[t.poiID]||this.createPlace(t.poiID,t.floor)}.bind(this))},this.load=function(t){for(var e in this.placeGeometryElements){var i=this.placeGeometryElements[e],n=this.places[e];t&&n&&n.vg.floor!==t||(n&&!n.isLoaded()||this.createPlace(e,t),this.places[e].addElements(i))}},this.realize=function(e){for(var i in this.places){var n=this.places[i],r=this.placeStates[i];e&&n.vg.floor!==e||n.isLoaded()&&r&&(r.name&&this.setPlaceName(i,r.name),r.icon&&this.setPlaceIcon(i,r.icon),r.color?(n.setElementsColor(r.color),t.requestRedraw()):(n.resetElementsColor(),t.requestRedraw()))}},this.registerGeometryElement=function(t,e){this.placeGeometryElements[e]||(this.placeGeometryElements[e]=[]),this.placeGeometryElements[e].push(t)},this.unregisterGeometryElement=function(t){var e=this.placeGeometryElements[t.id];if(e){var i=e.findIndex(function(e){return e.vg===t});-1!==i&&e.splice(i,1);var n=this.places[t.id];n.init(n.vg.id,n.vg.floor),n.addElements(e)}},this.getPlaces=function(){return 0===Object.keys(this.publicPlaces).length&&$d.each(this.places,function(t){this.publicPlaces[t.vg.id]=t.getPublicPlace()}.bind(this)),this.publicPlaces},this.getPlace=function(t){return!!this.places[t]&&this.places[t].getPublicPlace()},this.getPlaceName=function(t){var e=this.getOrCreatePlaceState(t);return void 0!==e&&null!==e.name&&e.name.text},this.getPlaceIcon=function(t){var e=this.getOrCreatePlaceState(t);return void 0!==e&&null!==e.icon&&e.icon.url},this.setPlaceName=function(t,e){var i=this.getPlace(t);return i?i.setName(e):(void 0===e?e={text:""}:"string"==typeof e&&(e={text:e}),this.getOrCreatePlaceState(t).name=e,!1)},this.setPlaceIcon=function(t,e){var i=this.getPlace(t);return i?i.setIcon(e):(void 0===e?e={url:""}:"string"==typeof e&&(e={url:e}),this.getOrCreatePlaceState(t).icon=e,!1)},this.setPlaceColor=function(t,e){if(t&&t.setColor)return t.setColor(e);if("string"==typeof t){var i=this.getPlace(t);if(i)return i.setColor(e);this.getOrCreatePlaceState(t).color=e}return!1},this.resetPlaceColor=function(t){if(void 0===t||!1===t)return!1;var e=!1;if(t instanceof Array){for(var i in t)if(t[i].resetColor)t[i].resetColor(),e=!0;else if("string"==typeof t[i]){if(n=this.getPlace(t[i]))n.resetColor(),e=!0;else this.getOrCreatePlaceState(t[i]).color=null}}else if(t.resetColor)e=t.resetColor();else if("string"==typeof t){var n;if(n=this.getPlace(t))e=n.resetColor();else this.getOrCreatePlaceState(t).color=null}return!!e};["getPlaces","getPlace","getPlaceName","getPlaceIcon","setPlaceName","setPlaceIcon","setPlaceColor","resetPlaceColor"].forEach(function(e){t[e]=this[e].bind(this)},this),this.getOrCreatePlaceState=function(t){return this.placeStates[t]||(this.placeStates[t]={name:null,icon:null,color:null}),this.placeStates[t]},this.destroy=function(){for(var t in this.placeGeometryElements)this.placeGeometryElements[t].splice(0);this.places={},this.publicPlaces={},this.placeGeometryElements={},this.placeStates={}}}function Am(t){this.mapviewer=t,this.sendingData=!1,this.statURL="https://s.visioglobe.com/stats/SDKStatLogger.php",this.secretCode="L3sStatsS3r0ntHash33s",this.dbVersion=1,this.logVersion=1,this.lastLogTime=md.now(),this.minLogPositionInterval=30,this.delayedLogging=void 0,this.statDB={},this.shortDelay=6e4,this.veryShortDelay=1e4,this.sendRequestNumber=0,this.longDelay=9e5,this.sendDelay=this.veryShortDelay,this.oldLogDelay=604800,this.sendDelayWhenNoFreshData=this.longDelay,this.appID=!1,this.statDB.indexedDB={},this.statDB.indexedDB.db=null,this.firstLoad=!0;var e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;"webkitIndexedDB"in window&&!("IDBKeyRange"in window)&&(window.IDBKeyRange=window.webkitIDBKeyRange),"webkitIndexedDB"in window&&!("IDBTransaction"in window)&&(window.IDBTransaction=window.webkitIDBTransaction);var i=this;this.statDB.indexedDB.db=null,this.statDB.indexedDB.onerror=function(t){console.log(t)},this.statDB.indexedDB.open=function(){var t=e.open("stats",i.dbVersion);t.onupgradeneeded=function(e){t.result.createObjectStore("stat",{keyPath:"timestamp"})},t.onsuccess=function(t){i.statDB.indexedDB.db=t.target.result,i.logStat("sessionInfo",null)},t.onfailure=i.statDB.indexedDB.onerror},this.statDB.indexedDB.addStat=function(t){var e=i.statDB.indexedDB.db;if(null!=e){var n=e.transaction("stat","readwrite").objectStore("stat").put(t);n.onsuccess=function(t){i.sendingData||(i.firstLoad?(setTimeout(i.sendStats,1),i.firstLoad=!1):setTimeout(i.sendStats,i.sendDelay),i.sendingData=!0)},n.onerror=function(t){console.error("Error Adding an item: ",t)}}},this.statDB.indexedDB.getAllStatItems=function(t){var e=i.statDB.indexedDB.db.transaction("stat","readwrite").objectStore("stat"),n=IDBKeyRange.lowerBound(0),r=e.openCursor(n),a=[],s=[];r.onsuccess=function(e){var n=e.target.result;0!=!!n?(a.push(n.value),s.push(n.primaryKey),n.continue()):a.length>0?t(a,s):i.sendingData||(setTimeout(i.sendStats,i.sendDelay),i.sendingData=!0)},r.onerror=i.statDB.indexedDB.onerror},this.statDB.indexedDB.getOldStatItems=function(t){var e=i.statDB.indexedDB.db.transaction("stat","readwrite").objectStore("stat"),n=IDBKeyRange.upperBound((new Date).getTime()-i.oldLogDelay),r=e.openCursor(n),a=[],s=[];r.onsuccess=function(e){var n=e.target.result;0!=!!n?(a.push(n.value),s.push(n.primaryKey),n.continue()):a.length>0?t(s):i.sendingData||(setTimeout(i.sendStats,i.sendDelay),i.sendingData=!0)},r.onerror=i.statDB.indexedDB.onerror},this.statDB.indexedDB.deleteStats=function(t){for(var e=t.length,n=i.statDB.indexedDB.db.transaction("stat","readwrite").objectStore("stat"),r=0;r<t.length;r++){var a=t[r],s=n.delete(a);s.onsuccess=function(t){0===--e&&(i.sendingData||(setTimeout(i.sendStats,i.sendDelay),i.sendingData=!0))},s.onerror=function(t){console.error("Error deleteing "+a+": ",t)}}},this.sendData=function(t,e){var n=JSON.stringify(t),r=new FormData;r.append("compress",!1),r.append("log",n),r.append("hash",md.sha1(n+i.secretCode)),r.append("sdk_timestamp",md.now()),null!==md.getCookie("sdk_stat_session_id")&&r.append("sdk_stat_session_id",md.getCookie("sdk_stat_session_id")),md.request(i.statURL,"POST",r,{crossDomain:!0}).then(function(t){var n=JSON.parse(t.response);md.setCookie("sdk_stat_session_id",n.sdk_stat_session_id,30),i.statDB.indexedDB.deleteStats(e),i.sendRequestNumber_++,i.sendRequestNumber<10?i.sendDelay=i.veryShortDelay:i.sendDelay=i.shortDelay}).catch(function(t){console.log("error :(",t.message),i.sendRequestNumber++,i.sendRequestNumber<10?i.sendDelay=i.shortDelay:i.sendDelay=i.longDelay,i.statDB.indexedDB.getOldStatItems(i.statDB.indexedDB.deleteStats)})},this.sendStats=function(){i.sendingData=!1,i.statDB.indexedDB.getAllStatItems(i.sendData)},this.lastType=void 0,this.lastData=void 0,this.logStatCaller=function(){void 0!==i.lastType&&void 0!==i.lastData&&i.logStat(i.lastType,i.lastData)},this.logStat=function(t,e){if("sessionInfo"===t){var n,r={type:t,appCodeName:(n=window.navigator).appCodeName,appName:n.appName,appVersion:n.appVersion,language:n.language,platform:n.platform,product:n.product,productSub:n.productSub,userAgent:n.userAgent,vendor:n.vendor,vendorSub:n.vendorSub,timestamp:md.now(),sdkVersion:i.mapviewer.version,sdkName:"web",version:i.logVersion,platformVersion:n.oscpu};void 0!==i.mapParameters&&(r.mapPath=i.mapParameters.path||i.mapParameters.svg||i.mapParameters.mapContentString,void 0!==i.mapviewer.mapName&&!1!==i.mapviewer.mapName&&(r.mapName=i.mapviewer.mapName)),i.appID&&(r.appID=i.appID),i.statDB.indexedDB.addStat(r)}if("mapLoaded"===t){r={type:t,mapPath:e.path||"",timestamp:md.now()};i.statDB.indexedDB.addStat(r)}if("position"===t){void 0!==i.delayedLogging&&clearTimeout(i.delayedLogging);var a=md.now();if(a-i.lastLogTime<i.minLogPositionInterval)return i.lastType=t,i.lastData=e,void(i.delayedLogging=setTimeout(i.logStatCaller,1e3*(i.minLogPositionInterval+1)));i.lastLogTime=a;r={type:t,id:e.id,position:i.mapviewer.convertPointToLatLon(e.position),floor:i.mapviewer.getCurrentFloor(),timestamp:md.now()};void 0!==i.mapParameters&&(r.mapPath=i.mapParameters.path||"",void 0!==i.mapviewer.mapName&&!1!==i.mapviewer.mapName&&(r.mapName=i.mapviewer.mapName)),i.statDB.indexedDB.addStat(r)}if("routing"===t){var s=void 0,o=void 0;if("string"==typeof e.src)s={id:e.src};else if("object"==typeof e.src){if(void 0!==e.src.x&&void 0!==e.src.y)(r={position:i.mapviewer.convertPointToLatLon(e.src)}).position.floor=i.mapviewer.getCurrentFloor(),s=r}else s=e.src;if("string"==typeof e.dst)o={id:e.dst};else if("object"==typeof e.dst||e.dst.length>0){o=[];for(var l=0;l<e.dst.length;l++)if("string"==typeof e.dst[l])o.push({id:e.dst[l]});else if("object"==typeof e.dst[l]){if(void 0!==e.dst[l].x&&void 0!==e.dst[l].y)(r={position:i.mapviewer.convertPointToLatLon(e.dst[l])}).position.floor=i.mapviewer.getCurrentFloor(),o.push(r)}else o.push(e.dst[l])}else if("object"==typeof e.dst){if(void 0!==e.dst.x&&void 0!==e.dst.y)(r={position:i.mapviewer.convertPointToLatLon(e.dst)}).position.floor=i.mapviewer.getCurrentFloor(),o=[r]}else o=e.dst;r={type:t,src:s,dst:o,timestamp:md.now()};void 0!==i.mapParameters&&(r.mapPath=i.mapParameters.path||"",void 0!==i.mapviewer.mapName&&!1!==i.mapviewer.mapName&&(r.mapName=i.mapviewer.mapName)),i.statDB.indexedDB.addStat(r)}if("selectPlace"===t){r={type:t,id:e.vg.id,floor:e.vg.floor,timestamp:md.now()};var h=i.mapviewer.getPOI(e.vg.id);if(void 0!==h&&h.length>0)for(l=0;l<h.length;l++){var c=h[l].options("text");void 0!==c&&""!==c&&(r.name=c)}void 0!==i.mapParameters&&(r.mapPath=i.mapParameters.path||"",void 0!==i.mapviewer.mapName&&!1!==i.mapviewer.mapName&&(r.mapName=i.mapviewer.mapName)),i.statDB.indexedDB.addStat(r)}},this.getURL=function(){return i.statURL},this.setURL=function(t){i.statURL=t,i.logStat("sessionInfo",null)},this.getAppID=function(){return i.appID},this.setAppID=function(t){i.appID=t,i.logStat("sessionInfo",null)},this.setMapParameters=function(t){i.mapParameters=t},this.statDB.indexedDB.open()}function Pm(t,e){if(e.overlay=void 0!==e.overlay&&e.overlay,this.options=e,this.mapviewer=e.mapviewer,this.spriteLayer=this.mapviewer.scene,this.floor=this.mapviewer.getFloor(this.options.floor),null===this.floor)return console.log("Warning: POI was not created, required floor doesn't exist."),null;var i;if(null!==this.floor){if(i=void 0!==this.options.lod?this.floor.getLOD(this.options.lod):this.floor.floorContentLOD,!this.options.overlay&&!i)return null;this.spriteLayer=i.contentNode}this.textureLoader=this.mapviewer.textureLoader,this.planeGeometry=new sh(1,1),this.useTexture=!0,this.updateQuadtree=!0,this.distanceCoef=.25,this.prunedTilesByLevel=[];for(var n=0;n<=this.options.depth;++n){var r=$d.filter(this.options.pruned,function(t){return t[2]===n});this.prunedTilesByLevel.push(r)}this.camera=t,this.rootNode=this.loadTile(0,0,0),this.rootNode.rotation.set(0,0,-this.options.angle*Math.PI/180),this.rootNode.scale.x=this.options.scale.x,this.rootNode.scale.y=this.options.scale.y,this.rootNode.scale.z=this.options.scale.z,this.rootNode.position.x=this.options.position.x,this.rootNode.position.y=this.options.position.y,this.rootNode.position.z=this.options.position.z,this.rootNode.updateMatrix(),this.rootNode.updateMatrixWorld(!0),this.floor.tiledImages||(this.floor.tiledImages=[]),this.update()}Tm.prototype.constructor=Tm,Tm.prototype.getPublicPlace=function(){return this.publicPlace=this.publicPlace||new Sm(this),this.publicPlace},Tm.prototype.init=function(t,e){this.vg={id:t,floor:void 0===e?null:e,originalColor:null,position:null,radius:null},this.severalElementsWarningShown={},this.length=new li,this.boundingBox=new ui,this.elements=[]},Tm.prototype.addElements=function(t){t.forEach(function(t){for(var e in this.elements.push(t),this.vg)if("id"!==e)if(null===this.vg[e]&&"radius"===e)if(t.geometry.boundingBox)t.geometry.boundingBox.getSize(this.length),this.vg[e]=2*this.length.length();else{if(this.boundingBox.makeEmpty(),t.geometry instanceof al)for(var i=t.geometry.vertices,n=t.geometry.faces,r=t.vg.faces_offset,a=t.vg.faces_offset+t.vg.nb_faces,s=n.length;r<s&&r<a;r++){var o=n[r];this.boundingBox.expandByPoint(i[o.a]),this.boundingBox.expandByPoint(i[o.b]),this.boundingBox.expandByPoint(i[o.c])}else if(t.geometry instanceof ir){var l=t.geometry.getAttribute("position");for(r=t.vg.faces_offset,a=t.vg.faces_offset+t.vg.nb_faces;r<a;r++)for(var h=3*r,c=h;c<h+3;c++){var u=new li(l.getX(c),l.getY(c),l.getZ(c));this.boundingBox.expandByPoint(u)}}this.boundingBox.getSize(this.length),this.vg[e]=2*this.length.length()}else null===this.vg[e]?this.vg[e]=t.vg[e]:this.vg[e]!==t.vg[e]&&-1===["position","radius","originalColor"].indexOf(e)&&(this.severalElementsWarningShown[e]||(console.log("ERROR: Several element with same ID but different "+e+" are present"),this.severalElementsWarningShown[e]=!0))},this)},Tm.prototype.setState=function(t){this.state=t},Tm.prototype.isLoaded=function(){return null!==this.vg.floor&&null!==this.originalColor&&null!==this.position&&null!==this.radius&&this.elements.length>0},Tm.prototype.setName=function(t){void 0===t?t={text:""}:"string"==typeof t&&(t={text:t}),""!==t.text?this.state.name=t:this.state.name=null;var e=this.mapviewer.getPOI(this.vg.id);if(void 0===e)return!1;for(var i in e){var n=e[i];"function"!=typeof n.options||n.options("image")||n.options("model")||n.options(t)}return!0},Tm.prototype.setIcon=function(t){void 0===t?t={url:""}:"string"==typeof t&&(t={url:t}),""!==t.url?this.state.icon=t:this.state.icon=null;var e=this.mapviewer.getPOI(this.vg.id);if(void 0===e)return!1;for(var i in e){var n=e[i];"function"!=typeof n.options||n.options("image")||n.options("model")||n.options(t)}return!0},Tm.prototype.setColor=function(t){return this.state.color=t,!!this.isLoaded()&&(this.setElementsColor(t),this.mapviewer.requestRedraw(),!0)},Tm.prototype.resetColor=function(){return this.state.color=null,!!this.isLoaded()&&(this.resetElementsColor(),this.mapviewer.requestRedraw(),!0)},Tm.prototype.setElementsColor=function(t){$d.each(this.elements,function(e){var i=e.geometry,n=e.vg.nb_faces,r=e.vg.faces_offset,a=e.vg.position.z,s=t;"_INVERTED_"===s?s=16777215-e.vg.originalColor:null!=s&&""!==s||(s=e.vg.originalColor);var o=new On(s),l=new On(o);void 0!==e.vg.topRatio&&l.multiplyScalar(e.vg.topRatio);var h=new On(o);if(void 0!==e.vg.bottomRatio&&h.multiplyScalar(e.vg.bottomRatio),i instanceof al){for(var c=i.faces,u=["a","b","c"],p=r;p<r+n;++p){var d=c[p];if(d.vertexColors.length>0)for(var m=0;m<d.vertexColors.length;++m){var f=i.vertices[d[u[m]]];f.z>a?d.vertexColors[m]=l:f.z<a?d.vertexColors[m]=h:d.vertexColors[m]=o}else d.color=o}i.elementsNeedUpdate=!0}else if(i instanceof ir){var g=i.getAttribute("position"),v=i.getAttribute("color");for(p=r;p<r+n;++p)for(var y=m=3*p;y<m+3;y++){var x=g.getZ(y);x>a?(v.setX(y,l.r),v.setY(y,l.g),v.setZ(y,l.b)):x<a?(v.setX(y,h.r),v.setY(y,h.g),v.setZ(y,h.b)):(v.setX(y,o.r),v.setY(y,o.g),v.setZ(y,o.b))}v.needsUpdate=!0}})},Tm.prototype.resetElementsColor=function(){this.setElementsColor(null)},Pm.prototype.constructor=Pm,Pm.prototype.loadTile=function(t,e,i){var n=this,r=new ln;r.visible=!1;var a=this.options.name+""+i+"/"+t+"-"+e+".png?"+this.mapviewer.mapTimestamp,s=this.textureLoader.load(a,function(t){return function(){t.quadtree.loaded=!0,n.mapviewer.mustUpdateCameraObjects=!0,n.mapviewer.requestRedraw()}}(r),function(){},function(t){return function(){t.quadtree.loaded=!1}}(r)),l=new Dn({wireframe:this.mapviewer.wireframe,color:16777215,side:o,transparent:!0,depthWrite:!1,depthTest:!this.options.overlay&&this.mapviewer.useDepthWriteForPOIs});l.originalMap=s,l.map=l.originalMap;var h=new br(this.planeGeometry,l);h.renderOrder=-this.mapviewer.constructor.renderDepthPOI,this.options.overlay&&(h.renderOrder=-this.mapviewer.constructor.renderDepthPOIOverlay),h.visible=!1;var c=Math.pow(2,i);h.scale.x=1/c,h.scale.y=1/c,h.scale.z=1/c;var u=.5/c*(c-1);return h.position.x=t/c-u,h.position.y=-e/c+u,r.add(h),r.quadtree={x:t,y:e,z:i},r},Pm.prototype.refineQuadtree=function(t){var e=this,i=function(t){return t.quadtree.loaded},n=function(t,i,r){return!!e.prunedTilesByLevel[r].find(function(e){return e[0]===t&&e[1]===i})||0!==r&&n(parseInt(t/2),parseInt(i/2),r-1)},r=function(t,i,r,a){if(!n(i,r,a)){var s=e.loadTile(i,r,a);t.add(s),s.updateMatrixWorld(!0)}},a=new li;t.children[0].getWorldPosition(a);var s=new li;t.children[0].getWorldScale(s);var o=new li;e.camera.getWorldPosition(o);var l=o.distanceTo(a),h=s.x,c=l*e.distanceCoef<h;if(function(t){return t.quadtree.z<e.options.depth}(t)&&c)if(t.isQueried||(r(t,2*t.quadtree.x+0,2*t.quadtree.y+0,t.quadtree.z+1),r(t,2*t.quadtree.x+1,2*t.quadtree.y+0,t.quadtree.z+1),r(t,2*t.quadtree.x+0,2*t.quadtree.y+1,t.quadtree.z+1),r(t,2*t.quadtree.x+1,2*t.quadtree.y+1,t.quadtree.z+1),t.isQueried=!0),function(t){for(var e=!0,n=1;n<t.children.length;++n)if(!i(t.children[n])){e=!1;break}return e}(t)){t.visible=!0,t.children[0].visible=!1;for(var u=1;u<t.children.length;++u)this.refineQuadtree(t.children[u])}else{t.visible=!0,t.children[0].visible=!0;for(u=1;u<t.children.length;++u)t.children[u].visible=!1}else{t.visible=!0,t.children[0].visible=!0;for(u=1;u<t.children.length;++u)t.children[u].visible=!1}},Pm.prototype.update=function(){this.updateQuadtree&&this.refineQuadtree(this.rootNode)},Pm.prototype.add=function(){-1===this.spriteLayer.children.indexOf(this.rootNode)&&this.spriteLayer.add(this.rootNode),-1===this.floor.tiledImages.indexOf(this)&&this.floor.tiledImages.push(this)},Pm.prototype.remove=function(){this.spriteLayer.remove(this.rootNode);var t=this.floor.tiledImages.indexOf(this);-1!==t&&this.floor.tiledImages.splice(t,1)};var Lm=[],Om=["position","id","level","nbChildren","properties"],Cm=["getParent","getViewpointPosition","hide","hideChildren","remove","show","showChildren"];function Rm(t){Pd.create(this,t,Lm,Om,Cm)}function Im(t,e,i,n,r,a,s){this.mapviewer=t,this.position=e,this.id=i,this.numPoints=n||1,this.poi=r||null,this.properties=a||{},this.options=s||{},this.children={},this.parent=null,this.level=1/0,this._spiderfied=!1,this._clusterChildrenCreated=!1,this._convexHull=null,this._publicPOICluster=null,this._closeOnNextMouseUpCallback=this.closeOnNextMouseUp.bind(this)}Im.prototype.constructor=Im,Object.defineProperty(Im.prototype,"nbChildren",{get:function(){return Object.keys(this.children).length}}),Im.prototype.getPublicPOICluster=function(){return this._publicPOICluster=this._publicPOICluster||new Rm(this),this._publicPOICluster},Im.prototype.createPOI=function(){if(1!==this.numPoints){if(null!==this.poi&&this.poi.remove(),this.options.poiOptions&&this.options.poiOptions.selector){var t=this.options.poiOptions.selector,e="function"==typeof t.innerHTML?t.innerHTML.call(this.getPublicPOICluster()):t.innerHTML;document.getElementById(t.parent).innerHTML+='<div id="'+this.id+'">'+e+"</div>",requestAnimationFrame(function(){document.getElementById(this.id).addEventListener("click",this.onMouseUp.bind(this),!1)}.bind(this));var i={id:this.id,selector:"#"+this.id,floor:this.options.floor,position:{x:this.position.x,y:this.position.y,z:0},visible:0===this.level,overlay:!0}}else{i={id:this.id,url:"../media/cluster.png",floor:this.options.floor,position:{x:this.position.x,y:this.position.y,z:0},zoomScaleFactor:Math.max(1,5-1*this.level),zoomScaleFast:!0,onObjectMouseUp:this.onMouseUp.bind(this),visible:0===this.level,overlay:!0};if(this.options.poiOptions){var n=["id","floor","position","onObjectMouseUp","overlay","visible"];for(var r in void 0!==this.options.poiOptions.scale&&void 0!==this.options.poiOptions.zoomScaleFactor&&0!==this.options.poiOptions.zoomScaleFactor?delete this.options.poiOptions.scale:void 0!==this.options.poiOptions.scale&&void 0===this.options.poiOptions.zoomScaleFactor&&delete i.zoomScaleFactor,this.options.poiOptions)-1===n.indexOf(r)&&("function"==typeof this.options.poiOptions[r]?i[r]=this.options.poiOptions[r].call(this.getPublicPOICluster()):i[r]=this.options.poiOptions[r])}}this.poi=this.mapviewer.addPOI(i),this.poi.vg.cluster=!0}},Im.prototype.remove=function(){this.numPoints>1&&this.poi&&(this.poi.remove(),this.poi=null)},Im.prototype.addChild=function(t){this.children[t.id]=t},Im.prototype.removeChild=function(t){delete this.children[t]},Im.prototype.getParent=function(){return this.parent?this.parent.getPublicPOICluster():null},Im.prototype.setParent=function(t){this.parent=t,t.addChild(this)},Im.prototype.isParent=function(t){if(1===this.numPoints)return!1;if(void 0!==this.children[t])return!0;for(var e in this.children)if(this.children[e].isParent(t))return!0;return!1},Im.prototype.reduce=function(t){$d.each(this.children,function(e){t(this.properties,e.properties)}.bind(this))},Im.prototype.getX=function(){return this.position.x},Im.prototype.getY=function(){return this.position.y},Im.prototype.animateFromPosition=function(t){return new Promise(function(e){var i=this.position,n=this.poi;n&&!n.options("selector")?this.mapviewer.animateValue(0,1,{duration:this.options.animationDuration,step:function(e){n.options("position",{x:t.x+e*(i.x-t.x),y:t.y+e*(i.y-t.y),z:t.z+e*(i.z-t.z)})},complete:e}):e()}.bind(this))},Im.prototype.animateToPosition=function(t){return new Promise(function(e){var i=this.position,n=this.poi;n&&!n.options("selector")?this.mapviewer.animateValue(0,1,{duration:this.options.animationDuration,step:function(e){n.options("position",{x:i.x+e*(t.x-i.x),y:i.y+e*(t.y-i.y),z:i.z+e*(t.z-i.z)})},complete:e}):e()}.bind(this))},Im.prototype.hide=function(){return this.poi&&this.poi.hide(),Promise.resolve()},Im.prototype.hideChildren=function(){var t=[],e=this.position;return $d.each(this.children,function(i){t.push(i.hideChildren().then(function(){return i.animateToPosition(e)}).then(function(){i.hide()}))}),this._spiderfied=!1,Promise.all(t).then(this.show.bind(this))},Im.prototype.show=function(){return this.poi&&this.poi.show(),Promise.resolve()},Im.prototype.showChildren=function(){var t=[],e=this.position;return $d.each(this.children,function(i){t.push(i.show().then(function(){return i.animateFromPosition(e)}))}),this._spiderfied=!0,Promise.all(t)},Im.prototype.createChildren=function(){return new Promise(function(t){if(this._clusterChildrenCreated)t();else{var e=[];$d.each($d.filter(this.children,function(t){return t.numPoints>1}),function(t){t.createPOI(),e.push(t)});var i=setInterval(function(){for(var n=!0,r=0;r<e.length;++r)if(!e[r].poi.ready){n=!1;break}n&&(clearInterval(i),this._clusterChildrenCreated=!0,t())}.bind(this),50)}}.bind(this))},Im.prototype.onMouseUp=function(){this._spiderfied?this.options.autoClose||this.options.onClose.call(this.getPublicPOICluster()):this.options.autoClose?this.createChildren().then(this.options.onOpen.bind(this.getPublicPOICluster())).then(this.hide.bind(this)).then(function(){0===this.level&&this.mapviewer.on("mouseup",this._closeOnNextMouseUpCallback)}.bind(this)):this.createChildren().then(this.options.onOpen.bind(this.getPublicPOICluster()))},Im.prototype.closeOnNextMouseUp=function(t){var e=t.args.element,i=!e.vg||!e.vg.poi;if(!i){var n=e.options("id");i=this.id!==n&&!this.isParent(n)}return i&&(this.show().then(this.options.onClose.bind(this.getPublicPOICluster())),this._spiderfied=!1),this._spiderfied||this.mapviewer.off("mouseup",this._closeOnNextMouseUpCallback),!0},Im.prototype.getViewpointPosition=function(){return this.mapviewer.getViewpointPosition({points:this.getConvexHull(),top:.3,bottom:.4,right:.3,left:.3})},Im.prototype.getConvexHull=function(){return null===this._convexHull&&(this._convexHull=md.getConvexHull($d.map(this.children,function(t){return t.position}))),this._convexHull};var Dm,Nm,Fm,zm,km,Bm,Um,Gm,Hm,jm,Vm,Wm,qm,Xm,Ym,Zm,Jm=ld(function(t,e){t.exports=function(){function t(i,n,r,a,s,o){if(!(s-a<=r)){var l=a+s>>1;!function t(i,n,r,a,s,o){for(;s>a;){if(s-a>600){var l=s-a+1,h=r-a+1,c=Math.log(l),u=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*u*(l-u)/l)*(h-l/2<0?-1:1),d=Math.max(a,Math.floor(r-h*u/l+p)),m=Math.min(s,Math.floor(r+(l-h)*u/l+p));t(i,n,r,d,m,o)}var f=n[2*r+o],g=a,v=s;for(e(i,n,a,r),n[2*s+o]>f&&e(i,n,a,s);g<v;){for(e(i,n,g,v),g++,v--;n[2*g+o]<f;)g++;for(;n[2*v+o]>f;)v--}n[2*a+o]===f?e(i,n,a,v):e(i,n,++v,s),v<=r&&(a=v+1),r<=v&&(s=v-1)}}(i,n,l,a,s,o),t(i,n,r,a,l-1,1-o),t(i,n,r,l+1,s,1-o)}}function e(t,e,n,r){i(t,n,r),i(e,2*n,2*r),i(e,2*n+1,2*r+1)}function i(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function n(t,e,i,n){var r=t-i,a=e-n;return r*r+a*a}var r=function(t){return t[0]},a=function(t){return t[1]},s=function(e,i,n,s,o){void 0===i&&(i=r),void 0===n&&(n=a),void 0===s&&(s=64),void 0===o&&(o=Float64Array),this.nodeSize=s,this.points=e;for(var l=e.length<65536?Uint16Array:Uint32Array,h=this.ids=new l(e.length),c=this.coords=new o(2*e.length),u=0;u<e.length;u++)h[u]=u,c[2*u]=i(e[u]),c[2*u+1]=n(e[u]);t(h,c,s,0,h.length-1,0)};return s.prototype.range=function(t,e,i,n){return function(t,e,i,n,r,a,s){for(var o=[0,t.length-1,0],l=[];o.length;){var h=o.pop(),c=o.pop(),u=o.pop();if(c-u<=s)for(var p=u;p<=c;p++){var d=e[2*p],m=e[2*p+1];d>=i&&d<=r&&m>=n&&m<=a&&l.push(t[p])}else{var f=u+c>>1,g=e[2*f],v=e[2*f+1];g>=i&&g<=r&&v>=n&&v<=a&&l.push(t[f]),(0===h?i<=g:n<=v)&&(o.push(u),o.push(f-1),o.push(1-h)),(0===h?r>=g:a>=v)&&(o.push(f+1),o.push(c),o.push(1-h))}}return l}(this.ids,this.coords,t,e,i,n,this.nodeSize)},s.prototype.within=function(t,e,i){return function(t,e,i,r,a,s){for(var o=[0,t.length-1,0],l=[],h=a*a;o.length;){var c=o.pop(),u=o.pop(),p=o.pop();if(u-p<=s)for(var d=p;d<=u;d++)n(e[2*d],e[2*d+1],i,r)<=h&&l.push(t[d]);else{var m=p+u>>1,f=e[2*m],g=e[2*m+1];n(f,g,i,r)<=h&&l.push(t[m]),(0===c?i-a<=f:r-a<=g)&&(o.push(p),o.push(m-1),o.push(1-c)),(0===c?i+a>=f:r+a>=g)&&(o.push(m+1),o.push(u),o.push(1-c))}}return l}(this.ids,this.coords,t,e,i,this.nodeSize)},s}()}),Km=ld(function(t,e){!function(t){function e(t){return function(){return t}}function i(t){return t[0]}function n(t){return t[1]}function r(){this._=null}function a(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function s(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function o(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function l(t){for(;t.L;)t=t.L;return t}function h(t,e,i,n){var r=[null,null],a=I.push(r)-1;return r.left=t,r.right=e,i&&u(r,t,e,i),n&&u(r,e,t,n),C[t.index].halfedges.push(a),C[e.index].halfedges.push(a),r}function c(t,e,i){var n=[e,i];return n.left=t,n}function u(t,e,i,n){t[0]||t[1]?t.left===i?t[1]=n:t[0]=n:(t[0]=n,t.left=e,t.right=i)}function p(t,e,i,n,r){var a,s=t[0],o=t[1],l=s[0],h=s[1],c=o[0],u=o[1],p=0,d=1,m=c-l,f=u-h;if(a=e-l,m||!(a>0)){if(a/=m,m<0){if(a<p)return;a<d&&(d=a)}else if(m>0){if(a>d)return;a>p&&(p=a)}if(a=n-l,m||!(a<0)){if(a/=m,m<0){if(a>d)return;a>p&&(p=a)}else if(m>0){if(a<p)return;a<d&&(d=a)}if(a=i-h,f||!(a>0)){if(a/=f,f<0){if(a<p)return;a<d&&(d=a)}else if(f>0){if(a>d)return;a>p&&(p=a)}if(a=r-h,f||!(a<0)){if(a/=f,f<0){if(a>d)return;a>p&&(p=a)}else if(f>0){if(a<p)return;a<d&&(d=a)}return!(p>0||d<1)||(p>0&&(t[0]=[l+p*m,h+p*f]),d<1&&(t[1]=[l+d*m,h+d*f]),!0)}}}}}function d(t,e,i,n,r){var a=t[1];if(a)return!0;var s,o,l=t[0],h=t.left,c=t.right,u=h[0],p=h[1],d=c[0],m=c[1],f=(u+d)/2,g=(p+m)/2;if(m===p){if(f<e||f>=n)return;if(u>d){if(l){if(l[1]>=r)return}else l=[f,i];a=[f,r]}else{if(l){if(l[1]<i)return}else l=[f,r];a=[f,i]}}else if(o=g-(s=(u-d)/(m-p))*f,s<-1||s>1)if(u>d){if(l){if(l[1]>=r)return}else l=[(i-o)/s,i];a=[(r-o)/s,r]}else{if(l){if(l[1]<i)return}else l=[(r-o)/s,r];a=[(i-o)/s,i]}else if(p<m){if(l){if(l[0]>=n)return}else l=[e,s*e+o];a=[n,s*n+o]}else{if(l){if(l[0]<e)return}else l=[n,s*n+o];a=[e,s*e+o]}return t[0]=l,t[1]=a,!0}function m(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function f(t,e){return e[+(e.left!==t.site)]}function g(t,e){return e[+(e.left===t.site)]}r.prototype={constructor:r,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=l(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)n=i.U,i===n.L?(r=n.R)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(s(this,i),i=(t=i).U),i.C=!1,n.C=!0,o(this,n)):(r=n.L)&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(o(this,i),i=(t=i).U),i.C=!1,n.C=!0,s(this,n)),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,i,n,r=t.U,a=t.L,h=t.R;if(i=a?h?l(h):a:h,r?r.L===t?r.L=i:r.R=i:this._=i,a&&h?(n=i.C,i.C=t.C,i.L=a,a.U=i,i!==h?(r=i.U,i.U=t.U,t=i.R,r.L=t,i.R=h,h.U=i):(i.U=r,r=i,t=i.R)):(n=t.C,t=i),t&&(t.U=r),!n)if(t&&t.C)t.C=!1;else{do{if(t===this._)break;if(t===r.L){if((e=r.R).C&&(e.C=!1,r.C=!0,s(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,o(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,s(this,r),t=this._;break}}else if((e=r.L).C&&(e.C=!1,r.C=!0,o(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,s(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,o(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}};var v,y=[];function x(){a(this),this.x=this.y=this.arc=this.site=this.cy=null}function b(t){var e=t.P,i=t.N;if(e&&i){var n=e.site,r=t.site,a=i.site;if(n!==a){var s=r[0],o=r[1],l=n[0]-s,h=n[1]-o,c=a[0]-s,u=a[1]-o,p=2*(l*u-h*c);if(!(p>=-N)){var d=l*l+h*h,m=c*c+u*u,f=(u*d-h*m)/p,g=(l*m-c*d)/p,b=y.pop()||new x;b.arc=t,b.site=r,b.x=f+s,b.y=(b.cy=g+o)+Math.sqrt(f*f+g*g),t.circle=b;for(var w=null,_=R._;_;)if(b.y<_.y||b.y===_.y&&b.x<=_.x){if(!_.L){w=_.P;break}_=_.L}else{if(!_.R){w=_;break}_=_.R}R.insert(w,b),w||(v=b)}}}}function w(t){var e=t.circle;e&&(e.P||(v=e.N),R.remove(e),y.push(e),a(e),t.circle=null)}var _=[];function M(){a(this),this.edge=this.site=this.circle=null}function S(t){var e=_.pop()||new M;return e.site=t,e}function T(t){w(t),O.remove(t),_.push(t),a(t)}function E(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],a=t.P,s=t.N,o=[t];T(t);for(var l=a;l.circle&&Math.abs(i-l.circle.x)<D&&Math.abs(n-l.circle.cy)<D;)a=l.P,o.unshift(l),T(l),l=a;o.unshift(l),w(l);for(var c=s;c.circle&&Math.abs(i-c.circle.x)<D&&Math.abs(n-c.circle.cy)<D;)s=c.N,o.push(c),T(c),c=s;o.push(c),w(c);var p,d=o.length;for(p=1;p<d;++p)c=o[p],l=o[p-1],u(c.edge,l.site,c.site,r);l=o[0],(c=o[d-1]).edge=h(l.site,c.site,null,r),b(l),b(c)}function A(t){for(var e,i,n,r,a=t[0],s=t[1],o=O._;o;)if((n=P(o,s)-a)>D)o=o.L;else{if(!((r=a-L(o,s))>D)){n>-D?(e=o.P,i=o):r>-D?(e=o,i=o.N):e=i=o;break}if(!o.R){e=o;break}o=o.R}!function(t){C[t.index]={site:t,halfedges:[]}}(t);var l=S(t);if(O.insert(e,l),e||i){if(e===i)return w(e),i=S(e.site),O.insert(l,i),l.edge=i.edge=h(e.site,l.site),b(e),void b(i);if(i){w(e),w(i);var c=e.site,p=c[0],d=c[1],m=t[0]-p,f=t[1]-d,g=i.site,v=g[0]-p,y=g[1]-d,x=2*(m*y-f*v),_=m*m+f*f,M=v*v+y*y,T=[(y*_-f*M)/x+p,(m*M-v*_)/x+d];u(i.edge,c,g,T),l.edge=h(c,t,null,T),i.edge=h(t,g,null,T),b(e),b(i)}else l.edge=h(e.site,l.site)}}function P(t,e){var i=t.site,n=i[0],r=i[1],a=r-e;if(!a)return n;var s=t.P;if(!s)return-1/0;var o=(i=s.site)[0],l=i[1],h=l-e;if(!h)return o;var c=o-n,u=1/a-1/h,p=c/h;return u?(-p+Math.sqrt(p*p-2*u*(c*c/(-2*h)-l+h/2+r-a/2)))/u+n:(n+o)/2}function L(t,e){var i=t.N;if(i)return P(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var O,C,R,I,D=1e-6,N=1e-12;function F(t,e){return e[1]-t[1]||e[0]-t[0]}function z(t,e){var i,n,a,s=t.sort(F).pop();for(I=[],C=new Array(t.length),O=new r,R=new r;;)if(a=v,s&&(!a||s[1]<a.y||s[1]===a.y&&s[0]<a.x))s[0]===i&&s[1]===n||(A(s),i=s[0],n=s[1]),s=t.pop();else{if(!a)break;E(a.arc)}if(function(){for(var t,e,i,n,r=0,a=C.length;r<a;++r)if((t=C[r])&&(n=(e=t.halfedges).length)){var s=new Array(n),o=new Array(n);for(i=0;i<n;++i)s[i]=i,o[i]=m(t,I[e[i]]);for(s.sort(function(t,e){return o[e]-o[t]}),i=0;i<n;++i)o[i]=e[s[i]];for(i=0;i<n;++i)e[i]=o[i]}}(),e){var o=+e[0][0],l=+e[0][1],h=+e[1][0],u=+e[1][1];!function(t,e,i,n){for(var r,a=I.length;a--;)d(r=I[a],t,e,i,n)&&p(r,t,e,i,n)&&(Math.abs(r[0][0]-r[1][0])>D||Math.abs(r[0][1]-r[1][1])>D)||delete I[a]}(o,l,h,u),function(t,e,i,n){var r,a,s,o,l,h,u,p,d,m,v,y,x=C.length,b=!0;for(r=0;r<x;++r)if(a=C[r]){for(s=a.site,l=a.halfedges,o=l.length;o--;)I[l[o]]||l.splice(o,1);for(o=0,h=l.length;o<h;)m=g(a,I[l[o]]),v=m[0],y=m[1],u=f(a,I[l[++o%h]]),p=u[0],d=u[1],(Math.abs(v-p)>D||Math.abs(y-d)>D)&&(l.splice(o,0,I.push(c(s,m,Math.abs(v-t)<D&&n-y>D?[t,Math.abs(p-t)<D?d:n]:Math.abs(y-n)<D&&i-v>D?[Math.abs(d-n)<D?p:i,n]:Math.abs(v-i)<D&&y-e>D?[i,Math.abs(p-i)<D?d:e]:Math.abs(y-e)<D&&v-t>D?[Math.abs(d-e)<D?p:t,e]:null))-1),++h);h&&(b=!1)}if(b){var w,_,M,S=1/0;for(r=0,b=null;r<x;++r)(a=C[r])&&(s=a.site,w=s[0]-t,_=s[1]-e,(M=w*w+_*_)<S&&(S=M,b=a));if(b){var T=[t,e],E=[t,n],A=[i,n],P=[i,e];b.halfedges.push(I.push(c(s=b.site,T,E))-1,I.push(c(s,E,A))-1,I.push(c(s,A,P))-1,I.push(c(s,P,T))-1)}}for(r=0;r<x;++r)(a=C[r])&&(a.halfedges.length||delete C[r])}(o,l,h,u)}this.edges=I,this.cells=C,O=R=I=C=null}z.prototype={constructor:z,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(i){return f(e,t[i])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(a=(r=i.halfedges).length)for(var r,a,s,o,l,h,c=i.site,u=-1,p=e[r[a-1]],d=p.left===c?p.right:p.left;++u<a;)s=d,p=e[r[u]],d=p.left===c?p.right:p.left,s&&d&&n<s.index&&n<d.index&&(l=s,h=d,((o=c)[0]-h[0])*(l[1]-o[1])-(o[0]-l[0])*(h[1]-o[1])<0)&&t.push([c.data,s.data,d.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n,r,a=this,s=a._found||0,o=a.cells.length;!(r=a.cells[s]);)if(++s>=o)return null;var l=t-r.site[0],h=e-r.site[1],c=l*l+h*h;do{r=a.cells[n=s],s=null,r.halfedges.forEach(function(i){var n=a.edges[i],o=n.left;if(o!==r.site&&o||(o=n.right)){var l=t-o[0],h=e-o[1],u=l*l+h*h;u<c&&(c=u,s=o.index)}})}while(null!==s);return a._found=n,null==i||c<=i*i?r.site:null}},t.voronoi=function(){var t=i,r=n,a=null;function s(e){return new z(e.map(function(i,n){var a=[Math.round(t(i,n,e)/D)*D,Math.round(r(i,n,e)/D)*D];return a.index=n,a.data=i,a}),a)}return s.polygons=function(t){return s(t).polygons()},s.links=function(t){return s(t).links()},s.triangles=function(t){return s(t).triangles()},s.x=function(i){return arguments.length?(t="function"==typeof i?i:e(+i),s):t},s.y=function(t){return arguments.length?(r="function"==typeof t?t:e(+t),s):r},s.extent=function(t){return arguments.length?(a=null==t?null:[[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]],s):a&&[[a[0][0],a[0][1]],[a[1][0],a[1][1]]]},s.size=function(t){return arguments.length?(a=null==t?null:[[0,0],[+t[0],+t[1]]],s):a&&[a[1][0]-a[0][0],a[1][1]-a[0][1]]},s},Object.defineProperty(t,"__esModule",{value:!0})}(e)}),Qm=(Dm=Km)&&Dm.__esModule&&Object.prototype.hasOwnProperty.call(Dm,"default")?Dm.default:Dm,$m={log:!1,prefix:"cluster_",depth:3,animationDuration:200,autoClose:!0,reducer:null,map:function(t){return t},onOpen:function(){this.showChildren()},onClose:function(){this.hideChildren()},poiOptions:!1};function tf(t,e){this.mapviewer=t,this.options=$d.extend(Object.create($m),e),this.clusterOptions={animationDuration:this.options.animationDuration,autoClose:this.options.autoClose,onOpen:this.options.onOpen,onClose:this.options.onClose,poiOptions:this.options.poiOptions,floor:!1},this.points={},this.ids=[],this.extent=1/0,this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0},this.trees=new Array(this.options.depth+1),this.clusters=[]}function ef(t){return t.getX()}function nf(t){return t.getY()}tf.prototype.constructor=tf,tf.prototype.load=function(t){if(this.options.log&&console.log("======================="),this.options.log&&console.time("full algo"),this.options.log&&console.time("hac"),"object"!=typeof t||Array.isArray(t))return!1;if(this.points=t,this.ids=Object.keys(this.points),this.ids.length<2)return!1;for(var e=[],i=0;i<this.ids.length;++i){var n=this.ids[i],r=this.points[n];if(void 0!==r.poi&&void 0!==r.poi.options){if(this.clusterOptions.floor){if(r.poi.options("floor")!==this.clusterOptions.floor)continue}else this.clusterOptions.floor=r.poi.options("floor");var a=r.poi.options("position");this.min.x=Math.min(this.min.x,a.x),this.min.y=Math.min(this.min.y,a.y),this.max.x=Math.max(this.max.x,a.x),this.max.y=Math.max(this.max.y,a.y),e.push(new Im(this.mapviewer,a,n,1,r.poi,this.options.map(r.properties),this.clusterOptions))}}if(this.min.x-=1e-6,this.min.y-=1e-6,this.max.x+=1e-6,this.max.y+=1e-6,e.length<2)return!1;this.extent=Math.max(this.max.x-this.min.x,this.max.y-this.min.y);var s=Math.max(1,Math.min(64,this.ids.length>>7));this.trees[this.options.depth+1]=new Jm(e,ef,nf,s,Float32Array);for(var o=this.options.depth;o>=0;--o)e=this.clusterLevel(e,o),this.trees[o]=new Jm(e,ef,nf,s,Float32Array);return this.options.log&&console.timeEnd("hac"),this.options.log&&console.time("voronoi"),this.redistributeChildren(),this.options.log&&console.timeEnd("voronoi"),this.options.log&&console.timeEnd("full algo"),!0},tf.prototype.clusterLevel=function(t,e){for(var i=[],n=this.extent/Math.pow(2,2*e),r=0;r<t.length;++r){var a=t[r];if(!(a.level<=e+1)){a.level=e+1;for(var s=this.trees[e+1],o=s.within(a.getX(),a.getY(),n),l=a.numPoints||1,h=a.getX()*l,c=a.getY()*l,u=this.options.prefix+(r<<5)+(e+1),p=[],d=0;d<o.length;++d){var m=s.points[o[d]];if(!(m.level<=e+1)){m.level=e+1;var f=m.numPoints||1;h+=m.getX()*f,c+=m.getY()*f,l+=f,p.push(m)}}if(1===l)i.push(a);else{var g=new Im(this.mapviewer,{x:h/l,y:c/l,z:0},u,l,null,{},this.clusterOptions);a.setParent(g);for(var v=0;v<p.length;++v)p[v].setParent(g);0===e&&(g.level=0),i.push(g)}}}return i},tf.prototype.redistributeChildren=function(){for(var t=0;t<=this.options.depth;++t){var e=this.trees[t];if(!(e.points.length<3)){var i=e.range(this.min.x,this.min.y,this.max.x,this.max.y),n=$d.map(i,function(t){return[e.points[t].getX(),e.points[t].getY()]}),r=Qm.voronoi();r.extent([[this.min.x,this.min.y],[this.max.x,this.max.y]]);for(var a=r(n),s=0;s<i.length;++s){var o,l,h,c,u=e.points[i[s]],p=[],d=$d.extend({},u.children,u.clusterChildren);for(o in d)l=d[o],(c=a.find(l.getX(),l.getY()))&&c.index!==s&&(h=e.points[i[c.index]],p.push(o),h.addChild(l));p.forEach(function(t){u.removeChild(t,d[t].numPoints>1)})}}}},tf.prototype.getClusters=function(){if(0===this.clusters.length&&this.trees.length>0){this.options.log&&console.time("getting clusters");var t=0;$d.each(this.trees,function(e){t+=e.points.length});var e=0;this.clusters=new Array(t);for(var i=this.options.depth+1;i>=0;i--){for(var n=this.trees[i],r=n.range(this.min.x,this.min.y,this.max.x,this.max.y),a=0;a<r.length;++a){var s=n.points[r[a]];s.numPoints>1&&(this.options.reducer&&s.reduce(this.options.reducer),this.clusters[e++]=s)}this.trees[i]=[]}this.clusters.splice(e),this.options.log&&console.timeEnd("getting clusters")}return this.trees=[],this.clusters},tf.prototype.finalize=function(){0===this.clusters.length&&this.getClusters(),this.options.log&&console.time("create root clusters");var t=this.clusters.filter(function(t){return 0===t.level});$d.each(t,function(t){t.createPOI()}),this.options.log&&console.timeEnd("create root clusters")},zm=Math.floor,Vm=Math.min;var rf=function(t,e){if(null==t)return-1;for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1};Fm=function(t,e){return t<e?-1:t>e?1:0},jm=function(t,e,i,n,r){var a;if(null==i&&(i=0),null==r&&(r=Fm),i<0)throw new Error("lo must be non-negative");for(null==n&&(n=t.length);i<n;)r(e,t[a=zm((i+n)/2)])<0?n=a:i=a+1;return[].splice.apply(t,[i,i-i].concat(e)),e},Um=function(t,e,i){return null==i&&(i=Fm),t.push(e),Ym(t,0,t.length-1,i)},Bm=function(t,e){var i,n;return null==e&&(e=Fm),i=t.pop(),t.length?(n=t[0],t[0]=i,Zm(t,0,e)):n=i,n},Hm=function(t,e,i){var n;return null==i&&(i=Fm),n=t[0],t[0]=e,Zm(t,0,i),n},Gm=function(t,e,i){var n;return null==i&&(i=Fm),t.length&&i(t[0],e)<0&&(e=(n=[t[0],e])[0],t[0]=n[1],Zm(t,0,i)),e},km=function(t,e){var i,n,r,a,s,o;for(null==e&&(e=Fm),s=[],n=0,r=(a=function(){o=[];for(var e=0,i=zm(t.length/2);0<=i?e<i:e>i;0<=i?e++:e--)o.push(e);return o}.apply(this).reverse()).length;n<r;n++)i=a[n],s.push(Zm(t,i,e));return s},Xm=function(t,e,i){var n;if(null==i&&(i=Fm),-1!==(n=rf(t,e)))return Ym(t,0,n,i),Zm(t,n,i)},Wm=function(t,e,i){var n,r,a,s,o;if(null==i&&(i=Fm),!(r=t.slice(0,e)).length)return r;for(km(r,i),a=0,s=(o=t.slice(e)).length;a<s;a++)n=o[a],Gm(r,n,i);return r.sort(i).reverse()},qm=function(t,e,i){var n,r,a,s,o,l,h,c,u;if(null==i&&(i=Fm),10*e<=t.length){if(!(a=t.slice(0,e).sort(i)).length)return a;for(r=a[a.length-1],s=0,l=(h=t.slice(e)).length;s<l;s++)i(n=h[s],r)<0&&(jm(a,n,0,null,i),a.pop(),r=a[a.length-1]);return a}for(km(t,i),u=[],o=0,c=Vm(e,t.length);0<=c?o<c:o>c;0<=c?++o:--o)u.push(Bm(t,i));return u},Ym=function(t,e,i,n){var r,a,s;for(null==n&&(n=Fm),r=t[i];i>e&&n(r,a=t[s=i-1>>1])<0;)t[i]=a,i=s;return t[i]=r},Zm=function(t,e,i){var n,r,a,s,o;for(null==i&&(i=Fm),r=t.length,o=e,a=t[e],n=2*e+1;n<r;)(s=n+1)<r&&!(i(t[n],t[s])<0)&&(n=s),t[e]=t[n],n=2*(e=n)+1;return t[e]=a,Ym(t,o,e,i)},Nm=function(){function t(t){this.cmp=null!=t?t:Fm,this.nodes=[]}return t.push=Um,t.pop=Bm,t.replace=Hm,t.pushpop=Gm,t.heapify=km,t.updateItem=Xm,t.nlargest=Wm,t.nsmallest=qm,t.prototype.push=function(t){return Um(this.nodes,t,this.cmp)},t.prototype.pop=function(){return Bm(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==rf(this.nodes,t)},t.prototype.replace=function(t){return Hm(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return Gm(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return km(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return Xm(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return(e=new t).nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}();var af=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0};function sf(t,e,i,n,r){for(this.solver=t,this.origin=e,this.inputDestinations=i,this.numInputDestinations=i.length,this.runParameters=n,this.finishOnLast=r,this.found=!1,this.bestDistance=Number.POSITIVE_INFINITY,this.numDestinations=i.length+1,this.destinations=[],this.bestSolution=[],this.nodeIDs=[],this.nodes=[],this.distances=[],a=0,s=this.numDestinations;a<s;a++)this.destinations[a]=a;for(var a=0,s=this.numInputDestinations;a<s;a++)this.nodeIDs[a]=i[a].id,this.nodes[a]=i[a];for(this.nodeIDs[this.numInputDestinations]=e.id,this.nodes[this.numInputDestinations]=e,this.originNodeIndex=this.numInputDestinations,a=0,s=this.numDestinations*this.numDestinations;a<s;a++)this.distances[a]=!1;this.finishOnLast?(this.lastNodeIndex=this.numInputDestinations-1,this.numSearchDestinations=this.numInputDestinations-1):this.numSearchDestinations=this.numInputDestinations}function of(t,e){this.geoinformation=e,void 0!==t.routing&&this.load(t.routing)}function lf(t,e,i){this.routingSolver=t,this.metersPerPixel=e,this.hasIntersections=i||!1}af.prototype={negative:function(){return new af(-this.x,-this.y,-this.z)},add:function(t){return t instanceof af?new af(this.x+t.x,this.y+t.y,this.z+t.z):new af(this.x+t,this.y+t,this.z+t)},subtract:function(t){return t instanceof af?new af(this.x-t.x,this.y-t.y,this.z-t.z):new af(this.x-t,this.y-t,this.z-t)},multiply:function(t){return t instanceof af?new af(this.x*t.x,this.y*t.y,this.z*t.z):new af(this.x*t,this.y*t,this.z*t)},divide:function(t){return t instanceof af?new af(this.x/t.x,this.y/t.y,this.z/t.z):new af(this.x/t,this.y/t,this.z/t)},equals:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new af(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return Math.sqrt(this.dot(this))},lengthSq:function(){return this.dot(this)},unit:function(){return this.divide(this.length())},normalize:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(t){return Math.acos(this.dot(t)/(this.length()*t.length()))},toArray:function(t){return[this.x,this.y,this.z].slice(0,t||3)},clone:function(){return new af(this.x,this.y,this.z)},init:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},af.negative=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},af.add=function(t,e,i){return e instanceof af?(i.x=t.x+e.x,i.y=t.y+e.y,i.z=t.z+e.z):(i.x=t.x+e,i.y=t.y+e,i.z=t.z+e),i},af.subtract=function(t,e,i){return e instanceof af?(i.x=t.x-e.x,i.y=t.y-e.y,i.z=t.z-e.z):(i.x=t.x-e,i.y=t.y-e,i.z=t.z-e),i},af.multiply=function(t,e,i){return e instanceof af?(i.x=t.x*e.x,i.y=t.y*e.y,i.z=t.z*e.z):(i.x=t.x*e,i.y=t.y*e,i.z=t.z*e),i},af.divide=function(t,e,i){return e instanceof af?(i.x=t.x/e.x,i.y=t.y/e.y,i.z=t.z/e.z):(i.x=t.x/e,i.y=t.y/e,i.z=t.z/e),i},af.cross=function(t,e,i){return i.x=t.y*e.z-t.z*e.y,i.y=t.z*e.x-t.x*e.z,i.z=t.x*e.y-t.y*e.x,i},af.unit=function(t,e){var i=t.length();return e.x=t.x/i,e.y=t.y/i,e.z=t.z/i,e},af.fromAngles=function(t,e){return new af(Math.cos(t)*Math.cos(e),Math.sin(e),Math.sin(t)*Math.cos(e))},af.randomDirection=function(){return af.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},af.min=function(t,e){return new af(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},af.max=function(t,e){return new af(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},af.lerp=function(t,e,i){return e.subtract(t).multiply(i).add(t)},af.fromArray=function(t){return new af(t[0],t[1],t[2])},af.angleBetween=function(t,e){return t.angleTo(e)},sf.prototype.distance=function(t,e){if(this.nodeIDs[t]==this.nodeIDs[e])return!1;var i=t*this.numDestinations+e,n=this.distances[i];if(!1===n){var r={legs:[],length:0,duration:0,status:200},a=this.solver.run(this.nodes[t],this.nodes[e],this.runParameters);return!1!==this.solver._appendRunResult(r,a,i)?((n={}).found=!0,n.distance=this.runParameters.fastest?r.length:r.duration,this.distances[i]=n,n.distance):(n.found=!1,this.distances[i]=n,!1)}return!!n.found&&n.distance},sf.prototype.find=function(t,e,i,n){var r,a,s,o,l,h;if(0==i)return!1;if(1==i){if(!1!==(a=this.distance(t,this.destinations[e]))){if(this.finishOnLast){if(!1===(s=this.distance(this.destinations[e],this.lastNodeIndex)))return!1;a+=s}if(a+=n,!1===this.found||a<this.bestDistance)return this.found=!0,this.bestDistance=a,this.bestSolution=this.destinations.slice(0),!0}return!1}for(!1!==(a=this.distance(t,this.destinations[e]))&&(r=n+a)<this.bestDistance&&this.find(this.destinations[e],e+1,i-1,r),o=this.destinations[e],h=1;h<i;h++)l=this.destinations[e+h],this.destinations[e+h]=o,this.destinations[e]=l,!1!==(a=this.distance(t,l))&&(r=n+a)<this.bestDistance&&this.find(l,e+1,i-1,r),this.destinations[e+h]=l,this.destinations[e]=o;return!0},sf.prototype.compute=function(){var t,e,i,n=[];if(this.find(this.originNodeIndex,0,this.numSearchDestinations,0),this.found){for(t=0,e=this.numInputDestinations;t<e;t++)i=this.bestSolution[t],n[t]=this.inputDestinations[i];return this.solver.runInOrder(this.origin,n,this.runParameters,this.bestSolution)}return{legs:[],length:0,duration:0,status:404,message:"No solution found"}},of.prototype._initializeLayerNameToIDMap=function(){var t=this;$d.each(this.floors,function(e,i){t.layerNameToIDMap[e.name]=i,t.layerIDToNameMap[i]=e.name})},of.prototype.getLayerID=function(t){var e=this.layerNameToIDMap[t];return void 0!==e&&e},of.prototype.getLayerIDsForHeight=function(t){var e=[];return $d.each(this.floors,function(i,n){t>=i.zmin&&t<=i.zmax&&e.push(n)}),e.length>0&&e},of.prototype._getSqDistanceOfPointNoZ=function(t,e,i){var n={onEdge:!1,distSq:0},r=new af(t.x,t.y,0),a=new af(e.x,e.y,0),s=new af(i.x,i.y,0),o=s.subtract(a),l=r.subtract(a),h=o.lengthSq();if(h<1e-6)return n.distSq=l.lengthSq(),n;var c=Math.sqrt(h),u=(o=o.divide(c)).dot(l);if(u<0)return n.distSq=l.lengthSq(),n;if(u<c){var p=l.subtract(o.multiply(u));return n.onEdge=!0,n.projectionFromStart=u/c,n.projectionPosition=a.add(o.multiply(u)),n.distSq=p.lengthSq(),n}var d=r.subtract(s);return n.distSq=d.lengthSq(),n},of.prototype._getClosestNodeWithoutZ=function(t,e,i,n){var r,a,s,o=(n=n||{}).option||"onEdge",l=!1,h=this,c={},u=!1;if(Array.isArray(n.excludedModalities))for(r=0,a=n.excludedModalities.length;r<a;r++)-1!==(s=this.modalityToID[(this.modalities,n.excludedModalities[r])])&&(c[s]=!0,u=!0);else"string"==typeof n.excludedModalities&&-1!==(s=this.modalityToID[n.excludedModalities])&&(c[s]=!0,u=!0);var p=e*e;return $d.each(i,function(e){"onEdge"===o?($d.each(h.nodesByFloor[e],function(i){if(!1===i.isVirtual)for(var n=0,r=i.modalityEdges.length;n<r;n++){var a=i.modalityEdges[n];if(!u||!c[a.modality]){var s=a.edge,o=h.nodes[s.endNode];if(!1===i.isVirtual&&e===h.nodes[s.endNode].floor){var d=h._getSqDistanceOfPointNoZ(t,i,o);d.onEdge&&d.distSq<p&&(p=d.distSq,l={type:"edge",node:null,edge:s,floor:e,edgeExtra:d,hasEdgeExcludedModalities:u,edgeExcludedModalities:c})}}}var m=(i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y);m<p&&!1===i.isVirtual&&(p=m,l={type:"node",node:i,edge:null,floor:e})}),"edge"===l.type&&(l.edgeExtra.projectionFromStart<1e-5?(l.type="node",l.node=h.nodes[l.edge.startNode],l.edge=null,l.edgeExtra=null):l.edgeExtra.projectionFromStart>.99999&&(l.type="node",l.node=h.nodes[l.edge.endNode],l.edge=null,l.edgeExtra=null))):$d.each(h.nodesByFloor[e],function(i){var n=(i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y);n<p&&!1===i.isVirtual&&(p=n,l={type:"node",node:i,floor:e})})}),l},of.prototype.getAccessNearWithoutZ=function(t,e,i){var n=[],r=e*e;return $d.each(this.accessByFloor[i],function(e,i){var a=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y);a<r&&n.push({node:e,distSq:a,accessName:e.accessName,nodeID:e.id})}),n},of.prototype.getAttributes=function(){return this.attributes},of.prototype.getModalities=function(){return this.modalities},of.prototype.getRoutingNode=function(t,e){if(void 0!==t._hint)return t;if("string"==typeof t){if(void 0!==this.accesses[t]){var i=this.accesses[t].node;return{id:t,_hint:{type:"node",node:i},floor:this.layerIDToNameMap[i.floor]}}return!1}var n=this.getNodeHintForPosition(t,e);return!1!==n&&{position:t,routePosition:this._getPointFromHint(n),floor:this.layerIDToNameMap[n.floor],_hint:n}},of.prototype.processSnapToEdgeRoutingNodes=function(t){var e={originalNumberOfNodes:this.nodes.length,originalNumberOfEdges:this.edges.length,nodeModalityEdgeRollbackMap:{}},i=null,n=null,r=null,a=null,s=null;if(t.src=this.getRoutingNode(t.src),t.src._hint&&"edge"==t.src._hint.type&&(i=t.src._hint,r=this._constructNodeEdgesFromHint(i,!0,e),t.src={_hint:{type:"node",node:r}}),Array.isArray(t.dst)&&t.dst.length>0){t.dst=t.dst.slice(0);for(var o=0;o<t.dst.length-1;o++){var l=this.getRoutingNode(t.dst[o]);l._hint&&"edge"===l._hint.type&&(s=this.nodes[l._hint.edgeExtra.projectionFromStart<.5?l._hint.edge.startNode:l._hint.edge.endNode],t.dst[o]={_hint:{type:"node",node:s}})}var h=this.getRoutingNode(t.dst[t.dst.length-1]);h._hint&&"edge"==h._hint.type&&(n=h._hint,a=this._constructNodeEdgesFromHint(n,!1,e),t.dst[t.dst.length-1]={_hint:{type:"node",node:a}})}else t.dst=this.getRoutingNode(t.dst),t.dst._hint&&"edge"===t.dst._hint.type&&(n=t.dst._hint,a=this._constructNodeEdgesFromHint(n,!1,e),t.dst={_hint:{type:"node",node:a}});if(null!==i&&null!==n&&null!==r&&null!==a){var c=!1,u=0;if((i.edge.startNode===n.edge.startNode&&i.edge.endNode===n.edge.endNode||i.edge.startNode===n.edge.endNode&&i.edge.endNode===n.edge.startNode)&&(void 0===i.oppositeEdge?i.edgeExtra.projectionFromStart<n.edgeExtra.projectionFromStart&&(c=!0,u=n.edgeExtra.projectionFromStart-i.edgeExtra.projectionFromStart):(c=!0,(u=i.edge===n.edge?n.edgeExtra.projectionFromStart-i.edgeExtra.projectionFromStart:1-n.edgeExtra.projectionFromStart-i.edgeExtra.projectionFromStart)<0&&(u=-u))),c){var p={startNode:r.id,endNode:a.id,length:i.edge.length*u,attributes:i.edge.attributes};this.edges[this.edges.length]=p;var d=this.nodes[i.edge.startNode];$d.each(d.modalityEdges,function(t){if(t.edge===i.edge&&(!i.hasEdgeExcludedModalities||!0!==i.edgeExcludedModalities[t.modality])){var e={edge:p,modality:t.modality,time:t.time*u};r.modalityEdges.push(e)}})}}return e},of.prototype.rollbackEdgeRoutingNodes=function(t){this.nodes.length=t.originalNumberOfNodes,this.edges.length=t.originalNumberOfEdges;var e=this;$d.each(t.nodeModalityEdgeRollbackMap,function(t,i){e.nodes[i].modalityEdges.length=t})},of.prototype._getPointFromHint=function(t){var e;if("edge"===t.type){var i=t.edge,n=this.nodes[i.startNode];e={x:t.edgeExtra.projectionPosition.x,y:t.edgeExtra.projectionPosition.y,z:n.z*this.geoinformation.meters_per_pixel}}else{if("node"!==t.type)return!1;var r=t.node;e={x:r.x,y:r.y,z:r.z*this.geoinformation.meters_per_pixel}}return this.geoinformation.convertSVGToPoint(e)},of.prototype._constructNodeEdgesFromHint=function(t,e,i){var n=this,r=t.edge,a=this.nodes[r.startNode],s=this.nodes[r.endNode],o={attributes:e?a.attributes:s.attributes,floor:a.floor,id:this.nodes.length,modalityEdges:[],w:void 0,x:t.edgeExtra.projectionPosition.x,y:t.edgeExtra.projectionPosition.y,z:a.z,isVirtual:!1,isAccess:!1};this.nodes[this.nodes.length]=o;var l={startNode:e?o.id:r.startNode,endNode:e?r.endNode:o.id,length:r.length*(e?1-t.edgeExtra.projectionFromStart:t.edgeExtra.projectionFromStart),attributes:r.attributes};this.edges[this.edges.length]=l,$d.each(a.modalityEdges,function(a){if(a.edge===r&&(!t.hasEdgeExcludedModalities||!0!==t.edgeExcludedModalities[a.modality])){var s={edge:l,modality:a.modality,time:a.time*(e?1-t.edgeExtra.projectionFromStart:t.edgeExtra.projectionFromStart)};e?o.modalityEdges.push(s):(void 0===i.nodeModalityEdgeRollbackMap[r.startNode]&&(i.nodeModalityEdgeRollbackMap[r.startNode]=n.nodes[r.startNode].modalityEdges.length),n.nodes[r.startNode].modalityEdges.push(s))}});var h=0,c=s.modalityEdges;for(h=0;h<c.length;h++)if(c[h].edge.endNode===a.id){var u=c[h].edge;t.oppositeEdge=u;var p={startNode:e?o.id:u.startNode,endNode:e?u.endNode:o.id,length:r.length*(e?t.edgeExtra.projectionFromStart:1-t.edgeExtra.projectionFromStart),attributes:u.attributes};this.edges[this.edges.length]=p,$d.each(s.modalityEdges,function(r){if(r.edge===u&&(!t.hasEdgeExcludedModalities||!0!==t.edgeExcludedModalities[r.modality])){var a={edge:p,modality:r.modality,time:r.time*(e?t.edgeExtra.projectionFromStart:1-t.edgeExtra.projectionFromStart)};e?o.modalityEdges.push(a):(void 0===i.nodeModalityEdgeRollbackMap[u.startNode]&&(i.nodeModalityEdgeRollbackMap[u.startNode]=n.nodes[u.startNode].modalityEdges.length),n.nodes[u.startNode].modalityEdges.push(a))}});break}return o},of.prototype.load=function(t){var e=this;this.maxSpeed=t.maxSpeed||1,this.floors=t.floors,this.layerNameToIDMap={},this.layerIDToNameMap={},this._initializeLayerNameToIDMap(),this.attributes=t.attributes,this.modalities=t.modalities,this.modalityToID={},$d.each(this.modalities,function(t,i){e.modalityToID[t]=i}),this.nodesByFloor=[],$d.each(this.floors,function(t,i){e.nodesByFloor[i]=[]}),this.accessByFloor=[],$d.each(this.floors,function(t,i){e.accessByFloor[i]=[]}),this.virtualAttributeID=$d.indexOf(t.attributes,"virtual"),this.accessAttributeID=$d.indexOf(t.attributes,"access"),this.intersectionAttributeID=$d.indexOf(t.attributes,"intersection"),this.nodes=[],$d.each(t.nodes,function(t,i){var n={x:t.x,y:t.y,z:t.z,w:t.w,floor:t.f,id:i,modalityEdges:[],attributes:!1,isAccess:!1,isVirtual:!1};e.nodes[i]=n,e.nodesByFloor[t.f].push(n)}),this.edges=[],$d.each(t.edges,function(t){e.edges.push({startNode:t.s,endNode:t.e,length:t.l,attributes:!1})}),$d.each(t.routingNodeAttributes,function(t){var i=e.nodes[t.n],n=t.a;n===e.virtualAttributeID?i.isVirtual=!0:n===e.accessAttributeID?(i.isAccess=!0,e.accessByFloor[i.floor].push(i)):n===e.intersectionAttributeID?i.isIntersection=!0:!1===i.attributes?i.attributes=[n]:i.attributes.push(n)}),$d.each(t.routingEdgeAttributes,function(t){var i=e.edges[t.e],n=t.a;!1===i.attributes?i.attributes=[n]:i.attributes.push(n)}),$d.each(t.routingEdgeModalities,function(t){var i=e.edges[t.e];e.nodes[i.startNode].modalityEdges.push({time:t.t,edge:i,modality:t.m})}),this.accesses={},$d.each(t.poiRoutingNodes,function(t){void 0===e.accesses[t.a]&&(e.accesses[t.a]={entries:[]}),e.accesses[t.a].entries.push({node:e.nodes[t.n]}),e.nodes[t.n].accessName=t.a}),$d.each(this.accesses,function(t){var e=!1;if($d.each(t.entries,function(t){t.node.isVirtual&&(e=t.node)}),!1!==e){var i=[];$d.each(t.entries,function(t){$d.each(t.node.modalityEdges,function(t){t.edge.startNode!==e.id&&t.edge.endNode!==e.id||(t.originalTime=t.time,t.edge.originalLength=t.edge.length,i.push(t))})}),t.node=e,t.modalityEdges=i}})},of.prototype.hasIntersections=function(){return-1!==this.intersectionAttributeID},of.prototype._heuristic=function(t,e,i){var n=parseFloat(t.x),r=parseFloat(t.y),a=parseFloat(t.z),s=parseFloat(e.x),o=parseFloat(e.y),l=parseFloat(e.z),h=Math.sqrt((s-n)*(s-n)+(o-r)*(o-r)+(l-a)*(l-a));return void 0!==e.w&&(h-=e.w),void 0!==i.w&&(h-=i.w),h=Math.max(h,0)},of.prototype.run=function(t,e,i){var n,r,a,s,o,l,h=(i=i||{}).fastest,c=i.weight,u=i.hasExcludedAttributes,p=i.hasExcludedModalities,d=i.excludedAttributes,m=i.excludedModalities,f=i.hasRemapResultinModality,g=i.remapResultingModalityByID,v=new Nm(function(t,e){return t.f-e.f});for(s=e.isVirtual,$d.each(this.nodes,function(t){t.parentModalityEdge=null,t.f=0,t.g=0,t.h=0,t.closed=!1,t.opened=!1}),v.push(t),t.opened=!0;!v.empty();){var y=v.pop();if(y.closed=!0,y===e){for(var x=[];null!==y.parentModalityEdge;)!1===y.isVirtual&&!1===this.nodes[y.parentModalityEdge.edge.startNode].isVirtual&&(a=y.parentModalityEdge.modality,f&&void 0===(a=g[a])&&(a=y.parentModalityEdge.modality),x.push({startNode:y.parentModalityEdge.edge.startNode,endNode:y.id,modality:this.modalities[a],time:y.parentModalityEdge.time,lengthSvg:y.parentModalityEdge.edge.length,attributes:y.parentModalityEdge.edge.attributes})),y=this.nodes[y.parentModalityEdge.edge.startNode];return x=x.reverse()}for(var b=y.modalityEdges,w=0,_=b.length;w<_;++w){var M=b[w],S=this.nodes[M.edge.endNode];if(!S.closed&&((!0!==S.isVirtual||s&&S.id===e.id)&&(!p||!m[M.modality]))){var T=M.edge.attributes,E=!1;if(u&&!1!==T)for(r=0,n=T.length;r<n;r++)if(d[T[r]]){E=!0;break}E||(o=h?M.time:M.edge.length,l=y.g+o,(!S.opened||l<S.g)&&(S.g=l,S.h=S.h||c*this._heuristic(S,e,t),S.f=S.g+S.h,S.parentModalityEdge=M,S.opened?v.updateItem(S):(v.push(S),S.opened=!0)))}}}return[]},of.prototype.queryNearPlaces=function(t,e){var i,n=[],r="number"==typeof(e=e||{heading:0,threshold:10}).threshold?e.threshold:10,a=e.heading||0,s=t.lat,o=t.lon,l=t.alt||t.z||0;if(void 0!==s&&void 0!==o?i=this.geoinformation.convertLatLonToPoint(t):void 0!==t.x&&void 0!==t.y&&(i={x:t.x,y:t.y}),void 0!==i){var h=!1;if(void 0!==t.floor){var c=this.getLayerID(t.floor);!1!==c&&(h=[c])}else h=this.getLayerIDsForHeight(l);if(!1!==h){var u=this.geoinformation.convertPointToSVG(i),p=this.geoinformation.meters_per_pixel,d=this.geoinformation.rotation_angle_in_degrees,m=r/p,f=this;$d.each(h,function(t){for(var e=f.getAccessNearWithoutZ(u,m,t),i=0,r=e.length;i<r;i++){var s,o=e[i],l=new af(o.node.x-u.x,o.node.y-u.y).normalize();for(l.y=-l.y,s=l.x>0?Math.acos(l.y):-Math.acos(l.y),s*=180/Math.PI,s-=a,s-=d;s>180;)s-=360;for(;s<-180;)s+=360;n.push({id:o.accessName,distance:Math.sqrt(o.distSq)*p,angle:s})}})}n.sort(function(t,e){return t.distance-e.distance})}return n},of.prototype.getNodeHintForPosition=function(t,e){var i,n=e||{option:"onEdge",distanceThreshold:200},r="number"==typeof n.distanceThreshold?n.distanceThreshold:200,a=t.lat,s=t.lon,o=t.alt||t.z||0;void 0!==a&&void 0!==s?i=this.geoinformation.convertLatLonToPoint(t):void 0!==t.x&&void 0!==t.y&&(i={x:t.x,y:t.y});var l=!1;if(void 0!==i){var h=!1,c=!1;if(void 0!==t.floor?!1!==(c=this.getLayerID(t.floor))&&(h=[c]):h=this.getLayerIDsForHeight(o),!1!==h){var u=this.geoinformation.convertPointToSVG(i);l=this._getClosestNodeWithoutZ(u,r/this.geoinformation.meters_per_pixel,h,n)}}return l},of.prototype._getLayerName=function(t){var e=!1;return void 0!==this.floors&&t.floor<this.floors.length&&(e=this.floors[t.floor].name),e},of.prototype.addPointToLeg=function(t,e,i,n,r){var a=this.geoinformation.convertSVGToPoint(e),s=this.geoinformation.convertPointToLatLon(a);t.points.push({lat:s.lat,lon:s.lon,_svg:{x:e.x,y:e.y,z:e.z},_routing:{id:e.id,isIntersection:e.isIntersection||!1,pointAttributes:e.attributes,edgeAttributes:r},_cumullength:i,_cumultime:n})},of.prototype._appendRunResult=function(t,e,i){if(e&&e.length>0){var n=!1,r=t.duration,a=t.length,s=e.length,o=this;return $d.each(e,function(e,l,h){var c=e.time,u=e.lengthSvg*o.geoinformation.meters_per_pixel,p=o.nodes[e.startNode],d=o.nodes[e.endNode];!1===n&&(n=of.createLeg(o._getLayerName(p),e.modality,p.z*o.geoinformation.meters_per_pixel,i),t.legs.push(n),o.addPointToLeg(n,p,a,r,e.attributes));var m=n.modality!==e.modality,f=p.floor!==d.floor,g=l+1<s&&h[l+1].attributes;if(f){var v=l+1<s?h[l+1].modality:e.modality;n=of.createLeg(o._getLayerName(d),v,d.z*o.geoinformation.meters_per_pixel,i),r+=c,a+=u,o.addPointToLeg(n,d,a,r,g),t.legs.push(n)}else m?(n=of.createLeg(o._getLayerName(d),e.modality,d.z*o.geoinformation.meters_per_pixel,i),o.addPointToLeg(n,p,a,r,e.attributes),r+=c,a+=u,o.addPointToLeg(n,d,a,r,g),t.legs.push(n)):(r+=c,a+=u,o.addPointToLeg(n,d,a,r,g))}),t.length=a,t.duration=r,t.legs=$d.filter(t.legs,function(e,i){return 0!==e.points.length&&(1!==e.points.length||(0===i||i===t.legs.length-1))}),void 0===t.destinationIndices?t.destinationIndices=[i]:t.destinationIndices.push(i),!0}return!1},of.createLeg=function(t,e,i,n){return{dataset:t,modality:e,destinationIndex:n,points:[],height:i}},of.prototype.runInOrder=function(t,e,i,n){for(var r,a,s,o={legs:[],length:0,duration:0,status:200},l=0,h=e.length;l<h;l++){if(r=e[l],a=this.run(t,r,i),s=n?n[l]:l,!1===this._appendRunResult(o,a,s)){o.status=404,o.error="Route not found.src not routable.dst not routable.";break}t=r}return o},of.prototype.runClosest=function(t,e,i){for(var n,r,a=!1,s=1e99,o=!1,l=0,h=e.length;l<h;l++){n=e[l],r=this.run(t,n,i);var c={legs:[],length:0,duration:0,status:200};!1!==this._appendRunResult(c,r,l)&&(a=i.fastest?c.duration:c.length)<s&&(s=a,o=c)}return!1!==o?o:{legs:[],length:0,duration:0,error:"Route not found",status:404}},of.prototype.computeRoute=function(t){var e=t.routingParameters||{},i={src:t.src,dst:t.dst,routingParameters:e};void 0!==e.requestType&"shortest"===e.requestType?(i.fastest=!1,i.weight=1):(i.fastest=!0,this.geoinformation=this.geoinformation||{},this.geoinformation.meters_per_pixel=this.geoinformation.meters_per_pixel||1,i.weight=this.geoinformation.meters_per_pixel/this.maxSpeed);var n,r,a,s,o,l,h,c,u={},p=!1;if(void 0!==e.excludedAttributes)if(c=e.excludedAttributes,Array.isArray(c))for(M=0,S=c.length;M<S;M++)r=c[M],-1!==(n=$d.indexOf(this.attributes,r))&&(u[n]=!0,p=!0);else"string"==typeof c&&-1!==(n=$d.indexOf(this.attributes,c))&&(u[n]=!0,p=!0);0==u.length&&(u=!1),i.hasExcludedAttributes=p,i.excludedAttributes=u;var d={},m=!1;if(void 0!==e.excludedModalities)if(h=e.excludedModalities,Array.isArray(h))for(M=0,S=h.length;M<S;M++)s=h[M],-1!==(a=this.modalityToID[s])&&(d[a]=!0,m=!0);else"string"==typeof h&&-1!==(a=this.modalityToID[h])&&(d[a]=!0,m=!0);i.hasExcludedModalities=m,i.excludedModalities=d,void 0!==e.remapResultingModality?(i.remapResultingModalityByID={},Object.keys(e.remapResultingModality).forEach(function(t){o=this.modalityToID[t],l=this.modalityToID[e.remapResultingModality[t]],void 0!==o&&void 0!==l&&(i.remapResultingModalityByID[o]=l)},this),i.hasRemapResultinModality=!0):(i.hasRemapResultinModality=!1,i.remapResultingModalityByID={});var f,g,v,y=this.processSnapToEdgeRoutingNodes(i),x=!1,b=this.getRoutingNode(i.src),w={legs:[],length:0,duration:0,status:200};do{if(!1===b){w.status=404,w.error="Route not found.src not routable.dst not routable.";break}if("node"!==(b=b._hint).type){w.status=500,w.error="src is on edge, even after filtering..";break}if(g=b.node,Array.isArray(i.dst)){for(var _=[],M=0,S=i.dst.length;M<S;M++){if(!1===(f=this.getRoutingNode(i.dst[M]))){w.status=404,w.error="routable.dst "+M+" not routable.";break}if("node"!==(f=f._hint).type){w.status=500,w.error="dst "+M+" is on edge, even after filtering..";break}v=f.node,_.push(v)}if(200==w.status)switch(void 0===t.destinationOrder&&(t.destinationOrder="optimalFinishOnLast"),1==i.dst.length&&(t.destinationOrder="inOrder"),t.destinationOrder){case"inOrder":w=this.runInOrder(g,_,i);break;case"closest":w=this.runClosest(g,_,i);break;case"optimal":w=new sf(this,g,_,i,!1).compute();break;case"optimalFinishOnLast":w=new sf(this,g,_,i,!0).compute();break;default:w.status=500,w.error="Bad destination order: "+t.destinationOrder}}else{if(!1===(f=this.getRoutingNode(i.dst))){w.status=404,w.error="routable.dst not routable.";break}if("node"!==(f=f._hint).type){w.status=500,w.error="dst is on edge, even after filtering..";break}if(v=f.node,g.id===v.id){var T=g.modalityEdges.length>0?g.modalityEdges[0]:{modality:0,edge:{attributes:!1}},E=of.createLeg(this._getLayerName(g),T.modality,g.z*this.geoinformation.meters_per_pixel,-1);this.addPointToLeg(E,g,0,0,T.edge.attributes),w.legs.push(E);break}if(x=this.run(g,v,i),!1===this._appendRunResult(w,x,0)){w.status=404,w.error="Route not found.src not routable.dst not routable.";break}}}while(0);return this.rollbackEdgeRoutingNodes(y),w.request=t,w},of.prototype._displayNetwork=function(t){var e=this;$d.each(e.floors,function(i,n){var r=i.name;$d.each(e.nodesByFloor[n],function(i){var n=2,a="#ff0000";if(i.isVirtual)return n=1,void(a="#00ff00");i.isAccess?(n=1.5,a="#0000ff"):i.isIntersection&&(n=2.5,a="#808080");var s=e.geoinformation.convertSVGToPoint(i);t.addPOI({position:{x:s.x,y:s.y,z:0},text:i.id,floor:r,scale:n,color:a,opacity:.5,overlay:!0})})})},lf._getVector=function(t){return new af(t.x,t.y,0)},lf._subVectors=function(t,e){return t.subtract(e)},lf._crossVectors=function(t,e){return t.cross(e)},lf._computeAngle=function(t,e){var i=t.dot(e),n=lf._crossVectors(e,t);if(i>.999999)return 0;if(i<-.999999)return 180;var r=180*Math.acos(i)/Math.PI;return n.z<0&&(r=-r),r=-r},lf.prototype._defaultNavigationParameters={straightAngleThreshold:30,distanceFromCouloirThreshold:2,nearPlacesThreshold:10,minimumInstructionLength:0},lf.prototype._getParam=function(t,e){return void 0===t&&console.log("BAD: undefined modality for getParam"),void 0===e&&console.log("BAD: undefined parameterName for getParam"),void 0!==this.mModalityParameters&&void 0!==this.mModalityParameters[t]&&void 0!==this.mModalityParameters[t][e]?this.mModalityParameters[t][e]:void 0!==this._defaultNavigationParameters[e]?this._defaultNavigationParameters[e]:1/0},lf.prototype._angle2maneuver=function(t,e){var i=this._getParam(e,"straightAngleThreshold"),n=t>0,r=Math.abs(t);return r<i?"eVgManeuverTypeGoStraight":r<45?!0===n?"eVgManeuverTypeTurnGentleRight":"eVgManeuverTypeTurnGentleLeft":r<135?!0===n?"eVgManeuverTypeTurnRight":"eVgManeuverTypeTurnLeft":!0===n?"eVgManeuverTypeTurnSharpRight":"eVgManeuverTypeTurnSharpLeft"},lf.prototype.computeNavigation=function(t,e){(e=e||{}).algorithm=e.algorithm||"auto";var i=e.algorithm;return"auto"===i&&this.hasIntersections&&(i="intersectionAlgorithm"),"intersectionAlgorithm"===i?this.computeNavigationIntersection(t,e):this.computeNavigationOriginal(t,e)},lf.prototype.computeNavigationOriginal=function(t,e){(e=e||{}).mergeFloorChangeInstructions=void 0===e.mergeFloorChangeInstructions||e.mergeFloorChangeInstructions,e.modalityParameters=e.modalityParameters||{};var i=e.mergeFloorChangeInstructions;if(this.mModalityParameters=e.modalityParameters||{},0===t.legs.length)return{instructions:[{length:0,duration:0,maneuverType:"eVgManeuverTypeEnd",icon:"transit_instruction_end.png",destinationIndex:0}],parameters:e,route:t,_algorithm:"originalAlgorithm, prefer to use explicit intersections algorithm"};for(var n=[],r=t.legs[t.legs.length-1],a=r.points[r.points.length-1]._cumultime,s=0,o=t.legs,l=0,h=o.length;l<h;l++){for(var c=o[l],u=c.points.slice(0),p=!1;u.length<2;)p=!0,u.push(u[0]);(j={positions:[],attributes:[]}).position=u[0],j.height=j.position._svg.z*this.metersPerPixel,j.modality=c.modality,j.dataset=c.dataset,j.destinationIndex=c.destinationIndex,s=u[0]._cumullength,j.time=u[0]._cumultime;var d=lf._getVector(u[0]._svg),m=lf._getVector(u[1]._svg);j.positions.push(u[0]),u[0]._routing.edgeAttributes&&j.attributes.push(u[0]._routing.edgeAttributes),p||(j.positions.push(u[1]),u[1]._routing.edgeAttributes&&j.attributes.push(u[1]._routing.edgeAttributes));for(var f=lf._subVectors(d,m).length()*this.metersPerPixel,g=0,v=2,y=u.length;v<y;v++){var x=lf._subVectors(d,m).normalize(),b=lf._getVector(u[v]._svg),w=lf._subVectors(d,b),_=w.clone().normalize();g=lf._computeAngle(x,_);Math.abs(g);var M=lf._crossVectors(x,_).length()*w.length()*this.metersPerPixel,S=Math.abs(M),T=this._getParam(c.modality,"distanceFromCouloirThreshold"),E=(this._getParam(c.modality,"straightAngleThreshold"),S>T||!1);if(E){var A=lf._subVectors(m,b).normalize(),P=lf._computeAngle(x,A);(Math.abs(P)<this._getParam(c.modality,"straightAngleThreshold")||f<this._getParam(c.modality,"minimumInstructionLength"))&&(E=!1,d=m.clone())}if(E){var L=lf._computeAngle(x,lf._subVectors(m,b).normalize());j.length=u[v-1]._cumullength-s,j.duration=u[v-1]._cumultime-j.time,j.maneuverType=this._angle2maneuver(L,c.modality),this._computeNearPlaces(j,x,L),n.push(j),j={positions:[],attributes:[]},s=u[v-1]._cumullength,j.time=u[v-1]._cumultime,f=lf._subVectors(b,m).length()*this.metersPerPixel,d=m.clone(),j.position=u[v-1],j.height=j.position._svg.z*this.metersPerPixel,j.dataset=c.dataset,j.destinationIndex=c.destinationIndex,j.modality=c.modality,j.positions.push(j.position),u[v-1]._routing.edgeAttributes&&j.attributes.push(u[v-1]._routing.edgeAttributes)}else f+=lf._subVectors(b,m).length()*this.metersPerPixel;d=m.clone(),m=b.clone(),x=lf._subVectors(d,m).normalize(),j.positions.push(u[v]),u[v]._routing.edgeAttributes&&j.attributes.push(u[v]._routing.edgeAttributes)}if(j.maneuverType="eVgManeuverTypeGoStraight",f>0){var O=lf._getVector({x:0,y:0}),C=j.positions.length;C>1&&(O=lf._subVectors(lf._getVector(j.positions[C-1]._svg),lf._getVector(j.positions[C-2]._svg)).normalize()),this._computeNearPlaces(j,O,0),j.length=u[v-1]._cumullength-s,j.duration=u[v-1]._cumultime-j.time,n.push(j),j={positions:[],attributes:[]},s=u[v-1]._cumullength,j.time=u[v-1]._cumultime}if(!1===i){if(l===h-1)j.maneuverType="eVgManeuverTypeEnd",j.destinationIndex=c.destinationIndex,j.length=0,j.duration=0;else{var R=o[l+1],I=R.dataset,D=R.destinationIndex,N=c.dataset,F=c.destinationIndex,z=R.modality,k=c.modality,B=u[0]._svg.z,U=R.points[0]._svg.z;U<B?(j.maneuverType="eVgManeuverTypeGoDown",j.length=0):U>B?(j.maneuverType="eVgManeuverTypeGoUp",j.length=0):B===U&&N!==I?(j.maneuverType="eVgManeuverTypeChangeLayer",j.length=0):k!==z?(j.maneuverType="eVgManeuverTypeChangeModality",j.length=0):F!==D?(j.maneuverType="eVgManeuverTypeWaypoint",j.length=0):console.log("This should not happen yet")}0===f&&void 0===j.position&&console.log("BAD1"),f>0&&(j.position=u[u.length-1],j.height=j.position._svg.z*this.metersPerPixel,j.positions.push(j.position),j.position._routing.edgeAttributes&&j.attributes.push(j.position._routing.edgeAttributes)),j.dataset=c.dataset,j.destinationIndex=c.destinationIndex,j.modality=c.modality,j.duration=u[v-1]._cumultime-j.time,j.length=u[v-1]._cumullength-s,this._computeNearPlaces(j),n.push(j),(j={positions:[]}).time=u[v-1]._cumultime}}for(var G=0,H=n.length;G<H;G++){var j;(j=n[G]).totalTime=a,this._uniqueAndConvertAttributes(j),void 0===j.duration&&console.log("HBXX fixme mDuration: "+G),void 0===j.time&&console.log("HBXX fixme time: "+G),void 0===j.length&&console.log("HBXX fixme length: "+G),j.icon=this._getIconName(j)}return 0===n.length&&(n=[{length:0,duration:0,maneuverType:"eVgManeuverTypeEnd",icon:"transit_instruction_end.png",destinationIndex:0}]),{instructions:n,parameters:e,route:t,_algorithm:"originalAlgorithm, prefer to use explicit intersections algorithm"}},lf.prototype._getIconName=function(t){var e="";switch(t.maneuverType){case"eVgManeuverTypeUnknown":e="";break;case"eVgManeuverTypeGoStraight":e="transit_instruction_straight.png";break;case"eVgManeuverTypeTurnGentleRight":e="transit_instruction_turn_gentle_right.png";break;case"eVgManeuverTypeTurnGentleLeft":e="transit_instruction_turn_gentle_left.png";break;case"eVgManeuverTypeTurnRight":e="transit_instruction_turn_right.png";break;case"eVgManeuverTypeTurnLeft":e="transit_instruction_turn_left.png";break;case"eVgManeuverTypeTurnSharpRight":e="transit_instruction_turn_sharp_right.png";break;case"eVgManeuverTypeTurnSharpLeft":e="transit_instruction_turn_sharp_left.png";break;case"eVgManeuverTypeUTurnLeft":e="transit_instruction_uturn_left.png";break;case"eVgManeuverTypeUTurnRight":e="transit_instruction_uturn_right.png";break;case"eVgManeuverTypeStart":e="transit_instruction_start.png";break;case"eVgManeuverTypeEnd":e="transit_instruction_end.png";break;case"eVgManeuverTypeGoUp":e="transit_instruction_up.png";break;case"eVgManeuverTypeGoDown":e="transit_instruction_down.png";break;case"eVgManeuverTypeChangeModality":e="transit_instruction_modality_change.png";break;case"eVgManeuverTypeChangeLayer":e="transit_instruction_layer_change.png";break;case"eVgManeuverTypeWaypoint":e="transit_instruction_intermediate_destination.png";break;default:console.log("bad icon?")}return e},lf.prototype._computeNearPlaces=function(t,e,i){var n=this;if(t.nearPlaces=[],void 0!==this.routingSolver){void 0===e&&(e=lf._getVector({x:0,y:0})),void 0===i&&(i=0),t.actionAngle=i;var r=t.positions[t.positions.length-1],a=lf._getVector(r._svg),s=this._getParam(t.modality,"nearPlacesThreshold")/n.metersPerPixel,o=n.routingSolver.getLayerID(t.dataset),l=this.routingSolver.getAccessNearWithoutZ(a,s,o);$d.each(l,function(i){var r=0;if(0!==e.x||0!==e.y){var s=lf._getVector(i.node),o=lf._subVectors(a,s);0===o.x&&0===o.y||(o=o.normalize(),r=lf._computeAngle(e,o))}t.nearPlaces.push({id:i.accessName,distance:Math.sqrt(i.distSq)*n.metersPerPixel,angle:r})});t.nearPlaces=0===i?t.nearPlaces.sort(function(t,e){return t.distance-e.distance}):t.nearPlaces.sort(function(t){return function(e,i){var n=t>0?90+.5*t:.5*t-90,r=t>0,a=e.angle-n,s=i.angle-n;return Math.abs(a-s)<.01?e.distance-i.distance:r?a>=0&&s<0?-1:a<0&&s>=0?1:a>=0?a-s:s-a:a>=0&&s<0?1:a<0&&s>=0?-1:a>=0?a-s:s-a}}(i))}},lf.prototype.computeNavigationIntersection=function(t,e){(e=e||{}).mergeFloorChangeInstructions=void 0===e.mergeFloorChangeInstructions||e.mergeFloorChangeInstructions,e.modalityParameters=e.modalityParameters||{},e.firstNodeAsIntersection=void 0!==e.firstNodeAsIntersection&&e.firstNodeAsIntersection;var i=e.mergeFloorChangeInstructions;this.mModalityParameters=e.modalityParameters||{};var n=e.firstNodeAsIntersection;if(0===t.legs.length)return{instructions:[{length:0,duration:0,maneuverType:"eVgManeuverTypeEnd",icon:"transit_instruction_end.png",destinationIndex:0}],parameters:e,route:t,_algorithm:"intersectionAlgorithm"};for(var r,a=[],s=0,o=t.legs,l=0,h=!1,c=0,u=o.length;c<u;c++){for(var p=o[c],d=p.points.slice(0),m=!1;d.length<2;)m=!0,d.push(d[0]);U={position:d[0],positions:[],attributes:[],height:d[0]._svg.z*this.metersPerPixel,time:d[0]._cumultime,modality:p.modality,dataset:p.dataset,destinationIndex:p.destinationIndex},s=d[0]._cumullength,a.length>0&&((r=a[a.length-1]).duration=U.time-r.time,r.length=U.position._cumullength-r.position._cumullength);var f,g=lf._getVector(d[0]._svg),v=lf._getVector(d[1]._svg);U.positions.push(d[0]),d[0]._routing.edgeAttributes&&U.attributes.push(d[0]._routing.edgeAttributes),m||(U.positions.push(d[1]),d[1]._routing.edgeAttributes&&U.attributes.push(d[1]._routing.edgeAttributes));for(var y=this._getParam(p.modality,"straightAngleThreshold"),x=lf._subVectors(g,v).normalize(),b=lf._getVector({x:0,y:0}),w=0,_=0,M=d[1]._routing.isIntersection||0==c&&n||c>0&&o[c].destinationIndex!=o[c-1].destinationIndex&&n,S=2,T=d.length;S<T;S++){if(f=lf._getVector(d[S]._svg),b=lf._subVectors(v,f).normalize(),w=lf._computeAngle(x,b),_=Math.abs(w),M&&_>y){var E=w;U.length=d[S-1]._cumullength-s,U.duration=d[S-1]._cumultime-U.time,U.maneuverType=this._angle2maneuver(E,p.modality),s=d[S-1]._cumullength,this._computeNearPlaces(U,x,E),a.push(U),r=U,(U={position:d[S-1],positions:[],attributes:[],height:r.height,time:d[S-1]._cumultime,modality:r.modality,dataset:r.dataset,destinationIndex:r.destinationIndex}).positions.push(U.position),d[S-1]._routing.edgeAttributes&&U.attributes.push(d[S-1]._routing.edgeAttributes)}g=v.clone(),v=f.clone(),x=b,M=d[S]._routing.isIntersection,U.positions.push(d[S]),d[S]._routing.edgeAttributes&&U.attributes.push(d[S]._routing.edgeAttributes)}if(U.maneuverType="eVgManeuverTypeGoStraight",(l=d[S-1]._cumullength-s)>0?(this._computeNearPlaces(U,x,0),U.length=d[S-1]._cumullength-s,U.duration=d[S-1]._cumultime-U.time,s=d[S-1]._cumullength,a.push(U),r=U,U={positions:[],attributes:[],time:d[S-1]._cumultime}):h=!0,!i||h){if(h=!1,c===u-1)U.maneuverType="eVgManeuverTypeEnd",U.length=0,U.duration=0;else{var A=p.dataset,P=p.modality,L=p.destinationIndex,O=o[c+1],C=O.dataset,R=O.modality,I=O.destinationIndex,D=d[0]._svg.z,N=O.points[0]._svg.z;N<D?U.maneuverType="eVgManeuverTypeGoDown":N>D?U.maneuverType="eVgManeuverTypeGoUp":D===N&&A!==C?U.maneuverType="eVgManeuverTypeChangeLayer":P!==R?U.maneuverType="eVgManeuverTypeChangeModality":L!==I?U.maneuverType="eVgManeuverTypeWaypoint":console.log("This should not happen yet")}0===l&&void 0===U.position&&console.log("BAD1"),l>0&&(U.position=d[d.length-1],U.height=U.position._svg.z*this.metersPerPixel,U.positions.push(U.position),U.position._routing.edgeAttributes&&U.attributes.push(U.position._routing.edgeAttributes)),U.dataset=p.dataset,U.destinationIndex=p.destinationIndex,U.modality=p.modality,U.duration=d[S-1]._cumultime-U.time,U.length=d[S-1]._cumullength-s,s=d[S-1]._cumullength,this._computeNearPlaces(U),a.push(U)}}for(var F=t.legs[t.legs.length-1],z=F.points[F.points.length-1]._cumultime,k=0,B=a.length;k<B;k++){var U=a[k];a[k].totalTime=z,this._uniqueAndConvertAttributes(U),void 0===a[k].duration&&console.log("fixme duration: "+k),void 0===a[k].time&&console.log("fixme time: "+k),void 0===a[k].length&&console.log("fixme length: "+k),a[k].icon=this._getIconName(a[k])}return 0===a.length&&(a=[{length:0,duration:0,maneuverType:"eVgManeuverTypeEnd",icon:"transit_instruction_end.png",destinationIndex:0}]),{instructions:a,parameters:e,route:t,_algorithm:"intersectionAlgorithm"}},lf.prototype._uniqueAndConvertAttributes=function(t){for(var e={},i=[],n=!1,r=0,a=t.attributes.length;r<a;r++)for(var s=t.attributes[r],o=0,l=s.length;o<l;o++){var h=s[o];void 0===e[h]&&(i.push(this.routingSolver.attributes[h]),e[h]=!0,n=!0)}n&&(t.attributes=i)};var hf=500;function cf(t){return t<0&&(t+=360*(-t/360+1|0)),t%=360}function uf(t){var e=t,i=!1,n=!1;Object.defineProperty(this,"pitch",{get:function(){return e.manipulator.orientation.x*nd.RAD2DEG},set:function(t){var i=Ke.clamp(t*nd.DEG2RAD,e.manipulator.rotationXMin,e.manipulator.rotationXMax);e.manipulator.orientation.x!=i&&(e.manipulator.orientation.x=i,e.manipulator.update())}}),Object.defineProperty(this,"minPitch",{get:function(){return e.manipulator.rotationXMin*nd.RAD2DEG},set:function(t){e.manipulator.rotationXMin=t*nd.DEG2RAD;var i=Ke.clamp(e.manipulator.orientation.x,e.manipulator.rotationXMin,e.manipulator.rotationXMax);e.manipulator.orientation.x!=i&&(e.manipulator.orientation.x=i,e.manipulator.update())}}),Object.defineProperty(this,"maxPitch",{get:function(){return e.manipulator.rotationXMax*nd.RAD2DEG},set:function(t){e.manipulator.rotationXMax=t*nd.DEG2RAD;var i=Ke.clamp(e.manipulator.orientation.x,e.manipulator.rotationXMin,e.manipulator.rotationXMax);e.manipulator.orientation.x!=i&&(e.manipulator.orientation.x=i,e.manipulator.update())}}),Object.defineProperty(this,"minRadius",{get:function(){return e.manipulator.minRadius},set:function(t){e.manipulator.minRadius=t,e.manipulator.update()}}),Object.defineProperty(this,"maxRadius",{get:function(){return e.manipulator.maxRadius},set:function(t){e.manipulator.maxRadius=t,e.manipulator.update()}}),Object.defineProperty(this,"position",{get:function(){return{x:e.manipulator.target.x,y:e.manipulator.target.y,radius:e.manipulator.radius}},set:function(t){if(!1!==t){var i=!1;e.manipulator.target.x==t.x&&e.manipulator.target.y==t.y||(e.manipulator.target.x=t.x,e.manipulator.target.y=t.y,i=!0),void 0!==t.radius&&e.manipulator.radius!=t.radius&&(e.manipulator.radius=t.radius,i=!0),i&&(e.manipulator.update(),e.manipulator.track&&void 0!==e.statistics&&e.statistics.logStat("position",{id:"camera",position:t}))}}}),Object.defineProperty(this,"track",{get:function(){return e.manipulator.track},set:function(t){e.manipulator.track=t}}),Object.defineProperty(this,"rotation",{get:function(){return cf(e.manipulator.orientation.z*nd.RAD2DEG+90)},set:function(t){var i=(t-90)*nd.DEG2RAD;e.manipulator.orientation.z!=i&&(e.manipulator.orientation.z=i,e.manipulator.update())}}),Object.defineProperty(this,"heading",{get:function(){return cf((e.cameraNorthRotation?e.cameraNorthRotation:0)-this.rotation)},set:function(t){this.rotation=(e.cameraNorthRotation?e.cameraNorthRotation:0)-t}}),Object.defineProperty(this,"pitchManipulatorEnabled",{get:function(){return e.manipulator.pitchManipulatorEnabled},set:function(t){e.manipulator.pitchManipulatorEnabled=!!t}}),Object.defineProperty(this,"rotationManipulatorEnabled",{get:function(){return e.manipulator.rotationManipulatorEnabled},set:function(t){e.manipulator.rotationManipulatorEnabled=!!t}}),Object.defineProperty(this,"zoomManipulatorEnabled",{get:function(){return e.manipulator.zoomManipulatorEnabled},set:function(t){e.manipulator.zoomManipulatorEnabled=!!t}}),Object.defineProperty(this,"panManipulatorEnabled",{get:function(){return e.manipulator.panManipulatorEnabled},set:function(t){e.manipulator.panManipulatorEnabled=!!t}}),Object.defineProperty(this,"panInertiaEnabled",{get:function(){return e.inertiaManipulator.panEnabled},set:function(t){e.inertiaManipulator.panEnabled=!!t}}),Object.defineProperty(this,"zoomInertiaEnabled",{get:function(){return e.inertiaManipulator.zoomEnabled},set:function(t){e.inertiaManipulator.zoomEnabled=!!t}}),Object.defineProperty(this,"rotationInertiaEnabled",{get:function(){return e.inertiaManipulator.rotationEnabled},set:function(t){e.inertiaManipulator.rotationEnabled=!!t}}),Object.defineProperty(this,"pitchInertiaEnabled",{get:function(){return e.inertiaManipulator.pitchEnabled},set:function(t){e.inertiaManipulator.pitchEnabled=!!t}}),Object.defineProperty(this,"inertiaDuration",{get:function(){return e.inertiaManipulator.animationDuration},set:function(t){isNaN(t)||(e.inertiaManipulator.animationDuration=t)}}),this.getBoundary=function(){return e.manipulator.boundary},this.setBoundary=function(t){t&&t.length>3&&(e.manipulator.boundary=t,e.manipulator.update())},this.setManipulator=function(t){switch(t){case"map":case"hybrid":case"none":e.manipulatorTypeName=t}},this.getManipulator=function(){return e.manipulatorTypeName},this.setCustomPreManipulatorListener=function(t){e.customPreManipulatorListener="function"==typeof t&&t},this.getCustomPreManipulatorListener=function(){return e.customPreManipulatorListener},this.setCustomPostManipulatorListener=function(t){e.customPostManipulatorListener="function"==typeof t&&t},this.getCustomPostManipulatorListener=function(){return e.customPostManipulatorListener},this.removeCustomPreManipulatorListener=function(){e.customPreManipulatorListener=!1},this.removeCustomPostManipulatorListener=function(){e.customPostManipulatorListener=!1},this.goTo=function(t,r){!1!==i&&(i.stop(),i=!1);var a=hf;if(r&&void 0!==r.animationDuration&&(a=r.animationDuration)<0&&(a=0),void 0===t)return Promise.reject();if("string"==typeof t&&!1===(t=e.getPlace(t)))return Promise.reject();var s=new li,o=e.manipulator.radius;if("object"==typeof t&&"object"==typeof t.vg&&"object"==typeof t.vg.position&&void 0!==t.vg.position.x&&void 0!==t.vg.position.y&&void 0!==t.vg.radius)o=t.vg.radius,s.x=t.vg.position.x,s.y=t.vg.position.y;else{if("object"!=typeof t||void 0===t.x||void 0===t.y)return Promise.reject();s.x=t.x,s.y=t.y,void 0!==t.radius&&(o=t.radius)}if(0===a)this.position={x:s.x,y:s.y,radius:o},n=Promise.resolve();else{var l=e.manipulator.radius,h=e.manipulator.target.x,c=e.manipulator.target.y,u=Math.max(e.manipulator.minRadius,o),p=s.x,d=s.y;n=new Promise(function(t){i=e.animateValue(0,1,{duration:a,easing:"linear",step:function(t){var i={x:h+t*(p-h),y:c+t*(d-c),radius:l+t*(u-l)};e.publicCamera.position=i},stop:function(){i=!1,t()},complete:function(){i=!1,e.publicCamera.position={x:p,y:d,radius:u},t()}})})}return n}}var pf=["panFromUndergroundFloor","maxExploreDistance"],df=["isEnabled"],mf=["setEnabled","setBuildingEnabled"];function ff(t){Pd.create(this,t,pf,df,mf)}function gf(t){this.panFromUndergroundFloor=!1,this.maxExploreDistance=0,this.isEnabled=!1,this.publicCameraDrivenExplorer=new ff(this),this.multiBuildingView=t,this.mapviewer=t.mapviewer,this.camera=t.mapviewer.publicCamera,this._updateAndExplore=function(t){this.updateBuildingViewpoints(),this.explore()}.bind(this),this.maxViewpointRadius=0,this.buildingParameters={}}gf.prototype.constructor=gf,gf.prototype.setEnabled=function(t){if(t!==this.isEnabled)if(this.isEnabled=t,this.isEnabled&&this.multiBuildingView.venueLayout.hasGlobalLayer){this.initBuildingInfo();var e=this.explore.bind(this);this.mapviewer.publicCamera.setCustomPostManipulatorListener(e),this.mapviewer.on("resize",this._updateAndExplore)}else this.mapviewer.publicCamera.removeCustomPostManipulatorListener(),this.mapviewer.off("resize",this._updateAndExplore)},gf.prototype.setBuildingEnabled=function(t,e,i){if(void 0===i&&(i="inout"),"string"==typeof e&&void 0!==this.buildingParameters[e])switch(i){case"in":this.buildingParameters[e].exploreTo=t;break;case"out":this.buildingParameters[e].exploreFrom=t;break;case"inout":default:this.buildingParameters[e].exploreTo=t,this.buildingParameters[e].exploreFrom=t}else if("string"!=typeof e&&e.length>0)for(var n in e)this.setBuildingEnabled(t,e[n],i)},gf.prototype.initBuildingInfo=function(){this.multiBuildingView.venueLayout.buildings.forEach(function(t){var e=t.id;this.buildingParameters[e]={},this.buildingParameters[e].viewpoint=this.mapviewer.getPOF(e),this.buildingParameters[e].exploreTo=t.exploreTo,this.buildingParameters[e].exploreFrom=t.exploreFrom},this),this.updateBuildingViewpoints()},gf.prototype.updateBuildingViewpoints=function(){this.maxViewpointRadius=0,this.multiBuildingView.venueLayout.buildings.forEach(function(t){var e=t.id,i=this.mapviewer.getFootprintPoints(e),n=this.mapviewer.getPOF(e),r=this.multiBuildingView.floorModePaddingFactor,a={points:i,top:r*this.multiBuildingView.containerHeight,bottom:r*this.multiBuildingView.containerHeight,left:r*this.multiBuildingView.containerWidth,right:r*this.multiBuildingView.containerWidth,pitch:this.multiBuildingView.floorModePitch,heading:n.headingInDegrees},s=this.mapviewer.getViewpointPosition(a);s&&s.radius>this.maxViewpointRadius&&(this.maxViewpointRadius=s.radius)},this),this.maxViewpointRadius*=2},gf.prototype.explore=function(){if(!1!==this.multiBuildingView.goToPromise)return!1;if(this.multiBuildingView.floorWhitelistIsActive)return!0;var t,e,i=this.camera.position,n=this.camera.position.radius,r=this.camera.pitch,a=this.camera.heading,s=!1,o=this.multiBuildingView.getCurrentExploreState(),l=0!==this.maxExploreDistance?this.maxExploreDistance:this.maxViewpointRadius,h=Math.max(this.maxExploreDistance,this.maxViewpointRadius);if(void 0!==o.buildingID&&(void 0===this.buildingParameters[o.buildingID].exploreFrom||!this.buildingParameters[o.buildingID].exploreFrom))return!1;var c=function(t,e){if("floor"!==o.mode)return!1;var i=e.buildingByID[t.buildingID].floorByID[t.floorID];if(i.levelIndex<0)return!0;var n=Object.keys(i.connectedFloors);return!!(n.length>0&&n.some(function(t){return i.connectedFloors[t].levelIndex<0}))}(o,this.multiBuildingView.venueLayout);if(c&&!this.panFromUndergroundFloor)e=o.buildingID,s=!0;else if("global"!==o.mode&&n<h&&this.mapviewer.isInsideFootprint(i,o.buildingID))e=o.buildingID,s=!0;else if(n<l)for(t in this.buildingParameters)if(void 0!==this.buildingParameters[t].exploreTo&&this.buildingParameters[t].exploreTo&&this.mapviewer.isInsideFootprint(i,t)){e=t,s=!0;break}var u=!1;if((n>h||!s)&&"global"!==o.mode)u={mode:"global",buildingID:o.buildingID,floorID:o.floorID,viewpoint:{position:this.camera.position,heading:a,pitch:r},animationDuration:.5,noViewpoint:!0},c&&(u.floorAnimationDuration=0);else if(s&&("global"===o.mode||"floor"===o.mode&&o.buildingID!==e)){var p=this.multiBuildingView.DEFAULT;if(e===o.buildingID)p=o.floorID;else if("floor"===o.mode){var d=this.multiBuildingView.venueLayout.buildingByID[o.buildingID].floorByID[o.floorID];void 0!==d.connectedFloors[e]&&(p=d.connectedFloors[e].floor)}u=this.multiBuildingView.buildingModeEnabled?{mode:"building",buildingID:e,floorID:p,animationDuration:.5}:{mode:"floor",buildingID:e,floorID:p,viewpoint:{position:this.camera.position,heading:a,pitch:r},animationDuration:.5,noViewpoint:!0}}u&&this.multiBuildingView.goTo(u)};var vf=["placePaddingFactor","floorModePaddingFactor","buildingModePaddingFactor","globalModePaddingFactor","buildingModeEnabled","globalModePitch","buildingModePitch","floorModePitch","floorAnimationDuration","pitchAnimationDuration","headingAnimationDuration","cameraPositionAnimationDuration","buildingModelAnimationDurationUp","buildingModelAnimationDurationDown","stackHeightFarAway","buildingMarkerHeight","buildingMarkerScale","stackGap"],yf=["DEFAULT"],xf=["getCurrentFloor","setCurrentFloor","setFloorWhitelist","resetFloorWhitelist","goTo","getCurrentExploreState","getLocalizedName","getVenueLayout","animatePitch","animateHeading"];function bf(t){Pd.create(this,t,vf,yf,xf)}function wf(t,e,i,n){this.debug=!1,this.mapviewer=t,this.viewType=void 0!==n.viewType?n.viewType:"multibuilding",this.animationType=void 0!==n.animationType?n.animationType:"translation",this.placePaddingFactor=.3,this.floorModePaddingFactor=.1,this.buildingModePaddingFactor=.1,this.globalModePaddingFactor=0,this.buildingModeEnabled=!1;var r={global:-50,building:-20,floor:-50};t.publicCamera.maxPitch=Math.max(t.publicCamera.maxPitch,r.global,r.building,r.floor),t.publicCamera.minPitch=-90,Object.defineProperty(this,"globalModePitch",{get:function(){return r.global},set:function(e){r.global=e,t.publicCamera.maxPitch=Math.max(e,t.publicCamera.maxPitch)}}),Object.defineProperty(this,"buildingModePitch",{get:function(){return r.building},set:function(e){r.building=e,t.publicCamera.maxPitch=Math.max(e,t.publicCamera.maxPitch)}}),Object.defineProperty(this,"floorModePitch",{get:function(){return r.floor},set:function(e){r.floor=e,t.publicCamera.maxPitch=Math.max(e,t.publicCamera.maxPitch)}}),this.floorAnimationDuration=1,this.pitchAnimationDuration=.7,this.headingAnimationDuration=.7,this.cameraPositionAnimationDuration=.7,this.buildingModelAnimationDurationUp=.7,this.buildingModelAnimationDurationDown=0,this.stackHeightFarAway=500,this.buildingMarkerHeight=50,this.buildingMarkerScale=30,this.stackGap=n.stackGap?n.stackGap:0,this.publicMultiBuildingView=new bf(this),this.mapviewerFloorByID={};var a,s,o,l=t.getFloors();for(a=0,s=l.length;a<s;a++)(o=l[a]).setEnabled(!1),this.mapviewerFloorByID[o.name]=o;this.venueLayout=this.parseVenueLayout(t,this.mapviewerFloorByID,e),this.setVenueLayoutLocalization(i),this.parameters=n,this.imagePath=n.imagePath||"../media",this.exploreState={mode:"global"},this.originalChangeFloorFunction=t.changeFloor,this.goToPromise=Promise.resolve(),this.nextExploreState=!1,t.changeFloor=this.setCurrentFloor.bind(this),t.getCurrentFloor=this.getCurrentFloor.bind(this),this.container=n.container?n.container:document.querySelector(n.containerDivSelector),this.customPreManipulatorStartCenter=!1,this.containerHeight=parseInt(window.getComputedStyle(this.container).height,10),this.containerWidth=parseInt(window.getComputedStyle(this.container).width,10),this.verticalPanChangeFloorThreshold=.1*this.containerHeight,this.activeBuildingMarkerPOIs={},this.inactiveBuildingMarkerPOIs={},this.setupActiveBuildingMarkerPOIs(),this.floorWhitelist={},Object.defineProperty(this,"floorWhitelistIsActive",{get:function(){return 0!==Object.keys(this.floorWhitelist).length}}),this.multifloorConfig={click:!1,pitch:!1,rotation:!1,zoom:!1},n.multifloorConfig&&$d.extend(this.multifloorConfig,n.multifloorConfig),this._onBuildingMouseUp=function(t){var e=t.args.element;if(Array.isArray(e))return void console.log("WARNING getting array maybe many POIs, should not happen on VisioWeb 1.7.17+");if(e&&e.options){var i=e.options("id");if(void 0!==this.venueLayout.buildingByID[i])return this.goTo({mode:"building",buildingID:i,floorID:this.DEFAULT}),!1}}.bind(this),t.on("mouseup",this._onBuildingMouseUp)}wf.prototype.constructor=wf,wf.VgFloor=function(t,e){this.id=t,this.levelIndex=parseInt(e,10)},wf.VgBuilding=function(t,e,i,n,r,a,s,o){var l,h,c;for(this.id=t,this.displayIndex=e,this.exploreTo=i,this.exploreFrom=n,this.floors=r,this.groundFloorIndex=a,this.defaultFloorIndex=s,this.floorByID={},l=0,h=this.floors.length;l<h;l++)c=this.floors[l],this.floorByID[c.id]=c;this.modelPOIs=Array.isArray(o)?o:[]},wf.VgVenueLayout=function(t,e,i){var n,r,a,s,o;for(this.buildings=t,this.defaultBuildingIndex=e,void 0!==i&&i.length>0?(this.hasGlobalLayer=!0,this.globalLayerID=i):this.hasGlobalLayer=!1,this.buildingByID={},this.buildingByFloorID={},n=0,r=this.buildings.length;n<r;n++)for(a=this.buildings[n],this.buildingByID[a.id]=a,s=0,o=a.floors.length;s<o;s++)this.buildingByFloorID[a.floors[s].id]=a},wf.prototype.DEFAULT="<DEFAULT VALUE>",wf.prototype.resolveExploreState=function(t){var e,i,n,r,a,s=this.venueLayout,o=this.mapviewer,l={};if(void 0!==t.place){var h,c=o.getPlace(t.place);if(c)h=c.vg.floor;else{var u=o.getPOI(t.place);if(u&&u.length>0)h=u[0].options("floor");else{var p=o.getPOF(t.place);p&&(h=p.floor)}}if(!h)return!1;if(h==s.globalLayerID)l={mode:"global",place:t.place,viewpoint:t.viewpoint};else{if(i=h,void 0===(n=s.buildingByFloorID[i]))throw new Error("ERROR cannot find building for floorID: "+i);if(e=n.id,void 0===n.floorByID[i])throw new Error("ERROR cannot find floorID: "+i+" in building "+e);l={mode:"floor",buildingID:e,floorID:i,place:t.place,viewpoint:t.viewpoint}}return l}if(t.buildingID===this.DEFAULT&&(!1!==this.venueLayout.defaultBuildingIndex?t.buildingID=s.buildings[this.venueLayout.defaultBuildingIndex].id:(t.buildingID=void 0,t.floorID===this.DEFAULT&&(t.floorID=void 0))),void 0!==t.buildingID){if(e=t.buildingID,void 0===(n=s.buildingByID[e]))throw new Error("ERROR cannot find building for floorID: "+i);i=void 0!==t.floorID&&t.floorID!==this.DEFAULT?t.floorID:n.floors[n.defaultFloorIndex].id}else if(void 0!==t.floorID)if(t.floorID===s.globalLayerID)t.mode="global",i=this.exploreState.floorID,e=this.exploreState.buildingID;else{if(i=t.floorID,void 0===(n=s.buildingByFloorID[i]))throw new Error("ERROR cannot find building for floorID: "+i);if(e=n.id,void 0===n.floorByID[i])throw new Error("ERROR cannot find floorID: "+i+" in building "+e)}else i=this.exploreState.floorID,e=this.exploreState.buildingID;if("global"==(a=void 0!==t.mode?t.mode:this.exploreState.mode)&&(s.hasGlobalLayer||(console.log("WARNING, global mode requested, but does not exist"),a="building")),"building"!=a&&"floor"!=a||(void 0===e&&s.buildings.length>0&&(e=s.buildings[0].id),void 0===i&&(n=s.buildingByID[e])&&n.floors.length>0&&(i=n.floors[0].id)),"building"==a&&(this.buildingModeEnabled?(!(n=s.buildingByID[e])||n.floors.length<=1)&&(a="floor"):a="floor"),"floor"==a&&!(n=s.buildingByID[e])){if(!s.hasGlobalLayer)throw new Error("ERROR, no focused building, and no global mode");a="global",console.log("WARNING, requesting a floor, but no focused building, fallback to global")}if(void 0!==t.viewpoint&&(r=t.viewpoint,"building"==a&&(console.log("WARNING: asking for a viewpoint in building mode not possible"),r=void 0)),!("building"!==a&&"floor"!==a||void 0!==i&&void 0!==e)){if(!s.hasGlobalLayer)throw new Error("ERROR: invalid targetFloor or targetBuilding, and no global mode to fallback to");a="global",console.log("WARNING: targetMode was building or floor, but invalid targetFloor or targetBuilding: "+i+"/"+e)}return l={mode:a,buildingID:e,floorID:i},void 0!==r&&(l.viewpoint=r),l},wf.prototype.goTo=function(t){var e=this.mapviewer;if(!1!==this.goToPromise){var i=this.exploreState;this.exploreState.mode=this.nextExploreState.mode,void 0!==this.nextExploreState.buildingID&&(this.exploreState.buildingID=this.nextExploreState.buildingID),void 0!==this.nextExploreState.floorID&&(this.exploreState.floorID=this.nextExploreState.floorID),e.notifications.trigger("exploreStateChanged",{current:this.nextExploreState,previous:i}),this.currentFloorAnimation&&this.currentFloorAnimation.stop&&this.currentFloorAnimation.stop(),this.currentHeadingAnimation&&this.currentHeadingAnimation.stop&&this.currentHeadingAnimation.stop(),this.currentPitchAnimation&&this.currentPitchAnimation.stop&&this.currentPitchAnimation.stop()}this.debug&&console.log("CALL goTo(mode: "+t.mode+", buildingID: "+t.buildingID+", floorID: "+t.floorID);try{this.nextExploreState=this.resolveExploreState(t)}catch(t){return Promise.reject(t)}this.debug&&console.log("CALL goTo resolved(mode: "+this.nextExploreState.mode+", buildingID: "+this.nextExploreState.buildingID+", floorID: "+this.nextExploreState.floorID);var n=this.getMapStateForExploreState(this.nextExploreState);if(t.noViewpoint&&(n.cameraConfig=!1),!1===e.notifications.trigger("exploreStateWillChange",{target:this.nextExploreState,current:this.getCurrentExploreState()}))return Promise.reject(new Error("trigger handler for exploreStateWillChange returned false"));i=this.getCurrentExploreState();return void 0!==t.animationDuration&&(n.pitchAnimationDuration=t.animationDuration,n.headingAnimationDuration=t.animationDuration,n.cameraPositionAnimationDuration=t.animationDuration,n.floorAnimationDuration=t.animationDuration),void 0!==t.pitchAnimationDuration&&(n.pitchAnimationDuration=t.pitchAnimationDuration),void 0!==t.headingAnimationDuration&&(n.headingAnimationDuration=t.headingAnimationDuration),void 0!==t.cameraPositionAnimationDuration&&(n.cameraPositionAnimationDuration=t.cameraPositionAnimationDuration),void 0!==t.floorAnimationDuration&&(n.floorAnimationDuration=t.floorAnimationDuration),this.goToPromise=this.applyMapState(n),this.goToPromise.then(function(){if(this.exploreState.mode=this.nextExploreState.mode,void 0!==this.nextExploreState.buildingID){this.exploreState.buildingID=this.nextExploreState.buildingID;var t=this.venueLayout.buildingByID[this.nextExploreState.buildingID];this.mapviewer.currentFloorName=t.floors[t.defaultFloorIndex].id}void 0!==this.nextExploreState.floorID&&(this.exploreState.floorID=this.nextExploreState.floorID,this.mapviewer.currentFloorName=this.nextExploreState.floorID),"global"===this.exploreState.mode&&(this.mapviewer.currentFloorName=this.venueLayout.globalLayerID),e.notifications.trigger("exploreStateChanged",{current:this.nextExploreState,previous:i}),this.goToPromise=!1}.bind(this))},wf.prototype.getMapStateForExploreState=function(t){var e,i,n,r=this.venueLayout,a=this.mapviewer,s={targetLevelIndex:!1,layerConfig:{},cameraConfig:{},buildingModels:{},manipulator:"map",floorAnimationDuration:this.floorAnimationDuration,pitchAnimationDuration:this.pitchAnimationDuration,headingAnimationDuration:this.headingAnimationDuration,cameraPositionAnimationDuration:this.cameraPositionAnimationDuration,buildingModelAnimationDurationUp:this.buildingModelAnimationDurationUp,buildingModelAnimationDurationDown:this.buildingModelAnimationDurationDown},o=t.mode,l=t.buildingID,h=t.floorID;if(void 0!==l){if(void 0===(e=r.buildingByID[l]))return console.log("ERROR: unknown targetBuildingID: "+l),!1;if(void 0===h)return console.log("ERROR: unknown targetFloorID: "+h),!1;if(void 0===(i=e.floorByID[h]))return console.log("ERROR: unknown targetFloorID "+h),!1;s.targetLevelIndex=i.levelIndex}if(r.hasGlobalLayer){switch(o){case"global":n={lod:"auto",position:{x:0,y:0,z:0},visible:!0},"global"===this.exploreState.mode||"multifloor"!==this.viewType&&("translation"===this.animationType||this.mapviewerFloorByID[r.globalLayerID].isEnabled())||(n.fadeIn=!0);break;case"building":case"floor":if("multifloor"===this.viewType||this.floorWhitelistIsActive)n={lod:"auto",position:{x:0,y:0,z:-i.groundStackHeight},visible:!1,fadeOut:!0};else{var c=i.levelIndex>=0,u=Object.keys(i.connectedFloors);u.length>0&&(c=c&&!u.some(function(t){return i.connectedFloors[t].levelIndex<0})),c?(n={lod:"auto",position:{x:0,y:0,z:"singlefloor"===this.viewType?0:-i.groundStackHeight},visible:!0},this.mapviewerFloorByID[r.globalLayerID].isEnabled()||"opacity"!==this.animationType&&"both"!==this.animationType||(n.fadeIn=!0)):(n={lod:"auto",position:{x:0,y:0,z:"opacity"===this.animationType?-i.groundStackHeight:this.stackHeightFarAway},visible:!1},!this.mapviewerFloorByID[r.globalLayerID].isEnabled()||"opacity"!==this.animationType&&"both"!==this.animationType||(n.fadeOut=!0))}}s.layerConfig[r.globalLayerID]=n}"floor"===o&&("global"===this.exploreState.mode||"floor"===this.exploreState.mode&&this.exploreState.buildingID!==l)&&(s.floorAnimationDuration=0);var p={};if(Object.keys(r.buildings).forEach(function(t){var e=r.buildings[t];Object.keys(e.floors).forEach(function(t){var n=e.floors[t];switch(o){case"global":p=n.levelIndex<=0?{lod:"auto",position:{x:0,y:0,z:n.groundStackHeight},visible:!1,immediateVisible:!1}:{lod:"auto",position:{x:0,y:0,z:this.stackHeightFarAway},visible:!1,immediateVisible:!1};break;case"building":case"floor":if(e.id===l||void 0!==i.connectedFloors[e.id]){var r=e.id===l?i.levelIndex:i.connectedFloors[e.id].levelIndex,a=!1;switch(this.viewType){case"singlefloor":a=this.floorWhitelistIsActive&&this.floorWhitelist[n.id]||!this.floorWhitelistIsActive&&n.levelIndex===r;break;case"multifloor":a=this.floorWhitelistIsActive&&this.floorWhitelist[n.id]||!this.floorWhitelistIsActive&&("building"===o&&e.id===l||n.levelIndex===r);break;case"multibuilding":a=this.floorWhitelistIsActive&&this.floorWhitelist[n.id]||!this.floorWhitelistIsActive&&n.levelIndex<=r}var h=this.mapviewerFloorByID[n.id];a?(p={lod:n.levelIndex===r?"auto":0,position:{x:0,y:0,z:n.groundStackHeight-i.groundStackHeight},visible:!0},n.levelIndex!==r||h.isEnabled()||n.id===this.exploreState.floorID||"opacity"!==this.animationType&&"both"!==this.animationType||"multifloor"===this.viewType||(p.fadeIn=!0),"multifloor"===this.viewType&&(p.lod="building"!==o||this.floorWhitelistIsActive?"auto":0)):(p={lod:h.isEnabled()&&h.isAutoUpdateLOD()?"auto":0,position:{x:0,y:0,z:this.stackHeightFarAway},visible:!1},"opacity"===this.animationType?p.position.z=n.groundStackHeight-i.groundStackHeight:"multibuilding"!==this.viewType&&(p.position.z*=n.levelIndex<i.levelIndex?-1:1),"opacity"!==this.animationType&&"both"!==this.animationType||(p.fadeOut=!0))}else n.levelIndex>0&&"multibuilding"===this.viewType?(p={lod:0,position:{x:0,y:0,z:this.stackHeightFarAway},visible:!1},"opacity"===this.animationType&&(p.position.z=n.groundStackHeight-i.groundStackHeight)):p={lod:0,position:{x:0,y:0,z:n.groundStackHeight-i.groundStackHeight},visible:!1},"opacity"!==this.animationType&&"both"!==this.animationType||(p.fadeOut=!0)}s.layerConfig[n.id]=p},this)},this),this.floorWhitelistIsActive){var d=this;r.buildings.forEach(function(t){var e=$d.map(t.floors,function(t){var e=s.layerConfig[t.id];return e.stackHeight=(0!==d.stackGap?d.stackGap:t.stackGap)+t.stackHeightMax,e}).filter(function(t){return t.visible}).sort(function(t,e){return t.position.z-e.position.z}),n=0;if(e.forEach(function(t){t.position.z=n,n+=t.stackHeight}),void 0!==i){var r=s.layerConfig[i.id].position.z;e.forEach(function(t){t.position.z-=r})}})}Object.keys(r.buildings).forEach(function(t){var e=r.buildings[t];s.buildingModels[e.id]={visible:"global"==o||e.id!=l&&void 0===i.connectedFloors[e.id]}},this);var m,f=!1,g=!1,v=0;switch(o){case"global":s.cameraConfig.pitch=this.globalModePitch,f=a.getFootprintPoints(r.globalLayerID),g=a.getPOF(r.globalLayerID),v=this.globalModePaddingFactor;break;case"building":s.cameraConfig.pitch=this.buildingModePitch,f=a.getFootprintPoints(l)||a.getFootprintPoints(r.globalLayerID),g=a.getPOF(l)||a.getPOF(r.globalLayerID),v=this.buildingModePaddingFactor;break;case"floor":s.cameraConfig.pitch=this.floorModePitch,f=a.getFootprintPoints(l)||a.getFootprintPoints(r.globalLayerID),g=a.getPOF(l)||a.getPOF(r.globalLayerID),v=this.floorModePaddingFactor}if(t.noViewpoint)s.cameraConfig=!1;else if(void 0!==t.viewpoint&&void 0!==t.viewpoint.position)s.cameraConfig.position=t.viewpoint.position,void 0!==t.viewpoint.heading&&(s.cameraConfig.heading=t.viewpoint.heading),void 0!==t.viewpoint.pitch&&(s.cameraConfig.pitch=t.viewpoint.pitch);else{if(void 0!==t.place){var y=a.getFootprintPoints(t.place);y&&(f=y);var x=a.getPOF(t.place);x&&(g=x),v=this.placePaddingFactor}if(g&&(s.cameraConfig.heading=g.headingInDegrees),f&&(m={points:f,top:v*this.containerHeight,bottom:v*this.containerHeight,left:v*this.containerWidth,right:v*this.containerWidth,pitch:s.cameraConfig.pitch,heading:void 0!==s.cameraConfig.heading?s.cameraConfig.heading:a.publicCamera.heading},s.cameraConfig.position=a.getViewpointPosition(m)),"multifloor"===this.viewType&&!1===f&&(void 0===this.cachedInitialPosition&&(this.cachedInitialPosition=a.publicCamera.position),s.cameraConfig.position={x:this.cachedInitialPosition.x,y:this.cachedInitialPosition.y,radius:this.cachedInitialPosition.radius},"floor"===o)){var b=s.cameraConfig.position;b.radius*=.75,s.cameraConfig.position=b}}return s.manipulator="building"==o?"custom":"map",s},wf.prototype.applyMapState=function(t){var e,i,n,r=this.venueLayout,a=this.mapviewer,s=[],o=void 0!==t.pitchAnimationDuration?t.pitchAnimationDuration:this.pitchAnimationDuration,l=void 0!==t.headingAnimationDuration?t.headingAnimationDuration:this.headingAnimationDuration,h=void 0!==t.floorAnimationDuration?t.floorAnimationDuration:this.floorAnimationDuration,c=void 0!==t.cameraPositionAnimationDuration?t.cameraPositionAnimationDuration:this.cameraPositionAnimationDuration,u=void 0!==t.buildingModelAnimationDurationUp?t.buildingModelAnimationDurationUp:this.buildingModelAnimationDurationUp,p=void 0!==t.buildingModelAnimationDurationDown?t.buildingModelAnimationDurationDown:this.buildingModelAnimationDurationDown;Object.keys(t.layerConfig).forEach(function(r){if(void 0===(i=this.mapviewerFloorByID[r]))return console.log("ERROR applyMapState to a non-existing floorID: "+r),Promise.reject();e=t.layerConfig[r],n=i.isEnabled(),void 0===e.visible&&(e.visible=n),void 0!==e.immediateVisible&&i.setEnabled(e.immediateVisible),n&&e.fadeOut?(i.fadeOut(500),s.push({mapviewerFloor:i,startPosition:i.getPosition(),endPosition:{x:e.position.x,y:e.position.y,z:e.position.z},visible:e.visible})):e.visible||n?(!n&&e.visible&&i.setEnabled(e.visible),e.fadeIn&&("multifloor"===this.viewType&&r===this.venueLayout.globalLayerID||"opacity"===this.animationType?i.fadeIn(500):"both"===this.animationType&&i.fadeIn(1e3*h)),s.push({mapviewerFloor:i,startPosition:i.getPosition(),endPosition:{x:e.position.x,y:e.position.y,z:e.position.z},visible:e.visible})):(i.setPosition(e.position),i.setEnabled(e.visible)),i.isEnabled()&&("auto"==e.lod?(i.setAutoUpdateLOD(!0),i.setContentEnabled(!0),i.setActive(!0)):(i.setAutoUpdateLOD(!1),i.setLODEnabled(e.lod),i.setContentEnabled("multifloor"===this.viewType||this.floorWhitelistIsActive),i.setActive("multifloor"===this.viewType||this.floorWhitelistIsActive)))},this);var d,m,f,g=[];switch(g.push(new Promise(function(t){var e=function(){s.forEach(function(t){(i=t.mapviewerFloor).setPosition(t.endPosition),i.setEnabled(t.visible),t.visible||i.setAutoUpdateLOD(!1)}),t()};h>0?(this.currentFloorAnimation&&this.currentFloorAnimation.stop&&this.currentFloorAnimation.stop(),this.currentFloorAnimation=a.animateValue(0,1,{duration:1e3*h,step:function(t){var e,n,r,a=nd.easeInOut(t);s.forEach(function(t){i=t.mapviewerFloor,n=t.startPosition,r=t.endPosition,e={x:n.x+(r.x-n.x)*a,y:n.x+(r.y-n.y)*a,z:n.z+(r.z-n.z)*a},i.setPosition(e)})},complete:e,stop:e})):e()}.bind(this))),this.venueLayout.hasGlobalLayer&&Object.keys(t.buildingModels).forEach(function(e){(f=this.venueLayout.buildingByID[e])&&f.modelPOIs.length>0?(m=f.modelPOIs,d=t.buildingModels[e],m.forEach(function(t){t._modelAnimation&&t._modelAnimation.stop();var e=t.options("position"),i=e.z,n=d.visible?0:200,r=(0==i?u:p)*Math.abs(i-n)/200;t.visible!=d.visible&&function(t,e,s,o){t.visible=!0,t._modelAnimation&&t._modelAnimation.stop(),t._modelAnimation=a.animateValue(i,n,{duration:1e3*r,easing:"linear",step:function(e){s.z=e,t.options("position",s)},stop:function(){t.visible=o.visible,t._modelAnimation=null},complete:function(){t.visible=o.visible,t._modelAnimation=null}})}(t,0,e,d)},this)):r.hasGlobalLayer&&console.log("WARNING no model for buildingID: "+e)},this),t.manipulator){case"map":a.publicCamera.setManipulator("map"),a.publicCamera.getCustomPreManipulatorListener()===this.mapviewerCustomPreManipulatorListener&&a.publicCamera.setCustomPreManipulatorListener(!1);break;case"custom":this.multifloorConfig.click||this.multifloorConfig.pitch||this.multifloorConfig.rotation||this.multifloorConfig.zoom?a.publicCamera.setManipulator("hybrid"):a.publicCamera.setManipulator("none"),!1===a.publicCamera.getCustomPreManipulatorListener()&&a.publicCamera.setCustomPreManipulatorListener(this.mapviewerCustomPreManipulatorListener.bind(this));break;default:console.log("ERROR do not know how to handle manipulator "+t.manipulator)}if(t.cameraConfig&&t.cameraConfig.position){var v=a.publicCamera.getManipulator();a.publicCamera.setManipulator("none"),g.push(a.publicCamera.goTo(t.cameraConfig.position,{animationDuration:1e3*c}).then(function(){a.publicCamera.setManipulator(v)}))}return t.cameraConfig&&void 0!==t.cameraConfig.pitch&&(o>0?g.push(this.animatePitch(t.cameraConfig.pitch,{durationInSeconds:o})):a.publicCamera.pitch=t.cameraConfig.pitch),t.cameraConfig&&void 0!==t.cameraConfig.heading&&(l>0?g.push(this.animateHeading(t.cameraConfig.heading,{durationInSeconds:l})):a.publicCamera.heading=t.cameraConfig.heading),Promise.all(g)},wf.prototype.getCurrentExploreState=function(){return $d.extend({},this.exploreState)},wf.prototype.parseVenueLayout=function(t,e,i){var n,r,a,s,o,l,h,c,u=[],p=!1;if("string"==typeof i.layer&&i.layer.length>0&&(void 0!==e[i.layer]?p=i.layer:console.log("WARNING: venueLayout has layer: "+i.layer+" but non existant in map")),Object.keys(i.buildings).forEach(function(n){r=[];var p=i.buildings[n];if(Object.keys(p.floors).forEach(function(t){var i=p.floors[t];void 0!==e[t]?((a=new wf.VgFloor(t,i.levelIndex)).stackHeightMax=i.stackHeightMax||0,a.stackHeightMin=i.stackHeightMin||0,a.stackGap=0!==this.stackGap?this.stackGap:i.stackGap||0,a.connectedFloors=i.connectedFloors||[],r.push(a)):console.log("WARNING: venueLayout building has floorID : "+t+" but non existant in map")},this),r.sort(function(t,e){return parseInt(t.levelIndex,10)-parseInt(e.levelIndex,10)}),s=!1,o=!1,void 0!==p.defaultFloor){c=!1;for(var d=0,m=r.length;d<m;d++)if(r[d].id==p.defaultFloor){o=d,c=!0;break}c||(console.log("WARNING, there is a defaultFloor: "+p.defaultFloor+" but no floor found for it"),o=0)}c=!1;for(d=0,m=r.length;d<m;d++)if(0==r[d].levelIndex){s=d,c=!0;break}c||(console.log("WARNING, no groundFloor found (with levelIndex 0) for building "+n),s=0);var f=0;r[s].groundStackHeight=0;for(d=s+1,m=r.length;d<m;d++)f+=r[d-1].stackHeightMax+r[d-1].stackGap-r[d].stackHeightMin,r[d].groundStackHeight=f;f=0;for(d=s-1;d>=0;d--)f-=r[d].stackHeightMax+r[d].stackGap-r[d+1].stackHeightMin,r[d].groundStackHeight=f;if(l=[],void 0!==(h=t.getPOI(n)))for(d=0;d<h.length;d++)h[d].options("model")&&l.push(h[d]);var g="boolean"!=typeof p.exploreTo||p.exploreTo,v="boolean"!=typeof p.exploreFrom||p.exploreFrom;u.push(new wf.VgBuilding(n,p.displayIndex,g,v,r,s,o,l))},this),u.sort(function(t,e){return t.displayIndex-e.displayIndex}),u.forEach(function(t){t.floors.forEach(function(t){if(t.connectedFloors.length>0){var e={};t.connectedFloors.forEach(function(t){var i=u.find(function(e){return void 0!==e.floorByID[t]});void 0!==i&&(e[i.id]={floor:t,levelIndex:i.floorByID[t].levelIndex})}),t.connectedFloors=e}})}),n=!1,void 0!==i.defaultBuilding){c=!1;for(var d=0,m=u.length;d<m;d++)if(u[d].id==i.defaultBuilding){n=d,c=!0;break}c||(console.log('WARNING: no building found with venueLayout.defaultBuilding "'+i.defaultBuilding+'"'),n=0)}return new wf.VgVenueLayout(u,n,p)},wf.prototype.getVenueLayout=function(){return $d.extend({},this.venueLayout)},wf.prototype.animatePitch=function(t,e){e=e||{};var i=this.mapviewer,n=i.publicCamera.pitch,r=t-n,a=1e3*(e.durationInSeconds||r/4);return this.currentPitchAnimation&&this.currentPitchAnimation.stop&&this.currentPitchAnimation.stop(),new Promise(function(e){this.currentPitchAnimation=i.animateValue(parseFloat(n),parseFloat(t),{duration:a,easing:"linear",step:function(t){i.publicCamera.pitch=t},complete:function(){e()},stop:function(){e()}})}.bind(this))},wf.prototype.animateHeading=function(t,e){e=e||{};var i=this.mapviewer,n=i.publicCamera.heading;(n%=360)<0&&(n+=360);var r=t-n,a=1e3*(e.durationInSeconds||r/4),s=parseFloat(t);return(s%=360)<0&&(s+=360),Math.abs(n-s)>180&&(n>s?n-=360:s-=360),this.currentHeadingAnimation&&this.currentHeadingAnimation.stop&&this.currentHeadingAnimation.stop(),new Promise(function(t){this.currentHeadingAnimation=i.animateValue(parseFloat(n),s,{duration:a,easing:"linear",step:function(t){i.publicCamera.heading=t},complete:function(){t()},stop:function(){t()}})}.bind(this))},wf.prototype.setCurrentFloor=function(t,e){var i;if(t==this.venueLayout.globalLayerID)i={mode:"global",noViewpoint:!0};else if(this.venueLayout.buildingByID[t])i={mode:"building",buildingID:t};else{var n=this.venueLayout.buildingByFloorID[t];i={mode:"floor",buildingID:n&&n.id,floorID:t,noViewpoint:!0}}return e&&void 0!==e.animationDuration&&(i.floorAnimationDuration=e.animationDuration/1e3),this.goTo(i)},wf.prototype.getCurrentFloor=function(){return"global"===this.exploreState.mode?this.venueLayout.globalLayerID:this.exploreState.floorID},wf.prototype.setFloorWhitelist=function(t){t.forEach(function(t){this.floorWhitelist[t]=!0}.bind(this)),-1!==t.indexOf(this.venueLayout.globalLayerID)&&(this.floorWhitelist[this.venueLayout.globalLayerID]=!0)},wf.prototype.resetFloorWhitelist=function(){this.floorWhitelist={}},wf.prototype.mapviewerCustomPreManipulatorListener=function(t){var e,i,n,r;if("building"==this.exploreState.mode){var a=!1,s=!1;if("wheel"===t.type)if(t.delta=t.delta||0,t.delta>0)a=!0;else{if(!(t.delta<0))return!1;s=!0}else if("panstart"===t.type||"panmove"===t.type||"panup"===t.type||"pandown"===t.type){if(this.multifloorConfig.pitch&&t.pointers.length>1)return!0;var o=this.container.getBoundingClientRect(),l={left:t.center.x-o.left,top:t.center.y-o.top};switch(t.type){case"panstart":this.customPreManipulatorStartCenter=l;break;case"panmove":var h=l.top-this.customPreManipulatorStartCenter.top;Math.abs(h)>this.verticalPanChangeFloorThreshold&&(h>0?a=!0:s=!0,this.customPreManipulatorStartCenter=l)}}else{if("tap"===t.type)return!!this.multifloorConfig.click||(this.goTo({mode:"floor"}),!1);if(this.multifloorConfig.rotation&&("rotatestart"===t.type||"rotatemove"===t.type))return!0;if(this.multifloorConfig.zoom&&("pinchstart"===t.type||"pinchmove"===t.type))return!0}if((a||s)&&void 0!==this.exploreState.buildingID&&void 0!==this.exploreState.floorID){var c=this.exploreState.floorID;for(i=(n=this.venueLayout.buildingByID[this.exploreState.buildingID].floors).length,r=!1,e=0;e<i;e++)if(n[e].id==c){r=!0;break}if(r){if(a&&e<i-1)if(this.floorWhitelistIsActive){for(var u=e+1;!this.floorWhitelist[n[u].id]&&u<i-1;)u++;this.floorWhitelist[n[u].id]&&this.goTo({mode:"building",buildingID:this.exploreState.buildingID,floorID:n[u].id})}else this.goTo({mode:"building",buildingID:this.exploreState.buildingID,floorID:n[e+1].id});else if(s&&e>0)if(this.floorWhitelistIsActive){for(var p=e-1;!this.floorWhitelist[n[p].id]&&p>0;)p--;this.floorWhitelist[n[p].id]&&this.goTo({mode:"building",buildingID:this.exploreState.buildingID,floorID:n[p].id})}else this.goTo({mode:"building",buildingID:this.exploreState.buildingID,floorID:n[e-1].id})}else console.log("ERROR: this.exploreState.floorID not found!: "+this.exploreState.floorID)}return!1}},wf.prototype.setVenueLayoutLocalization=function(t){this.venueLayoutLocalization=t||{}},wf.prototype.getLocalizedName=function(t){return this.venueLayoutLocalization[t]&&this.venueLayoutLocalization[t].name||t},wf.prototype.setupActiveBuildingMarkerPOIs=function(){var t,e,i=this.mapviewer,n=this.venueLayout;n.hasGlobalLayer&&(this.venueLayout.buildings.forEach(function(r){var a=r.id,s=i.getPOF(a);s&&(t=i.addPOI({id:a,url:this.imagePath+"/building_focused.png",image:!0,position:{x:s.x,y:s.y,z:this.buildingMarkerHeight},floor:n.globalLayerID,alignment:{x:0,y:1},scale:this.buildingMarkerScale,visible:!1,overlay:!0}),e=i.addPOI({id:a,url:this.imagePath+"/building.png",image:!0,position:{x:s.x,y:s.y,z:this.buildingMarkerHeight},floor:n.globalLayerID,alignment:{x:0,y:1},scale:this.buildingMarkerScale,visible:!1,overlay:!0}),t&&e&&(this.activeBuildingMarkerPOIs[a]=t,this.inactiveBuildingMarkerPOIs[a]=e))},this),this._toggleBuildingMarkerPOIs=function(t){var e=t.args.target,i=e.buildingID,n=void 0!==i;"global"==e.mode?Object.keys(this.activeBuildingMarkerPOIs).forEach(function(t){n&&t==i?(this.activeBuildingMarkerPOIs[t].show(),this.inactiveBuildingMarkerPOIs[t].hide()):(this.activeBuildingMarkerPOIs[t].hide(),this.inactiveBuildingMarkerPOIs[t].show())},this):Object.keys(this.activeBuildingMarkerPOIs).forEach(function(t){this.activeBuildingMarkerPOIs[t].hide(),this.inactiveBuildingMarkerPOIs[t].hide()},this)}.bind(this),i.on("exploreStateWillChange",this._toggleBuildingMarkerPOIs))},wf.prototype.removeCallbacks=function(){this.mapviewer.off("mouseup",this._onBuildingMouseUp),this.mapviewer.off("exploreStateWillChange",this._toggleBuildingMarkerPOIs)};var _f=[],Mf=[],Sf=["addOrUpdateLanguage","getLanguage","getLanguageCodes","translateInstructions","updateManeuverForLanguage","updateNextManeuverForLanguage","updateKeywordForLanguage","updateDurationForLanguage"];function Tf(t){Pd.create(this,t,_f,Mf,Sf)}function Ef(t,e){this.mapviewer=t,this.destinations=!1,this.vgPlaces=e,this.cLanguageMap={en:{maneuvers:{unknown:"<unknown>",goStraight:"Go straight",turnGentleRight:"Turn gentle right",turnGentleLeft:"Turn gentle left",turnRight:"Turn right",turnLeft:"Turn left",turnSharpRight:"Turn sharp right",turnSharpLeft:"Turn sharp left",UTurnRight:"Make right U-turn",UTurnLeft:"Make left U-turn",start:"Start",end:"You have arrived",goUp:"Go up to floor %L",goDown:"Go down to floor %L",changeModality:"Use transportation mode: %M",changeLayer:"Change building",waypoint:"Stop"},nextManeuvers:{unknown:"<unknown>",goStraight:"go straight",turnGentleRight:"turn gentle right",turnGentleLeft:"turn gentle left",turnRight:"turn right",turnLeft:"turn left",turnSharpRight:"turn sharp right",turnSharpLeft:"turn sharp left",UTurnRight:"make right U-turn",UTurnLeft:"make left U-turn",start:"start",end:"you have arrived",goUp:"go up",goDown:"go down",changeModality:"change transportation mode: %M",changeLayer:"change building",waypoint:"stop"},keywords:{for:" for ",then:" then ",and:" and ",near:" near ",using:" using ",stairway:"the stairway",escalator:"the escalator",lift:"the lift"},durations:{seconds:"a few seconds",oneMinute:"about a minute",minutes:"about %d minutes"}},fr:{maneuvers:{unknown:"<inconnu>",goStraight:"Continuez tout droit",turnGentleRight:"Tournez lgrement  droite",turnGentleLeft:"Tournez lgrement  gauche",turnRight:"Tournez  droite",turnLeft:"Tournez  gauche",turnSharpRight:"Tournez fortement  droite",turnSharpLeft:"Tournez fortement  gauche",UTurnRight:"Effectuez un demi-tour  droite",UTurnLeft:"Effectuez un demi-tour  gauche",start:"Dpart",end:"Arrive",goUp:"Montez  l'tage %L",goDown:"Descendez  l'tage %L",changeModality:"Changez de moyen de transport: %M",changeLayer:"Changez de btiment",waypoint:"Arrtez vous"},nextManeuvers:{unknown:"<inconnu>",goStraight:"continuez tout droit",turnGentleRight:"tournez lgrement  droite",turnGentleLeft:"tournez lgrement  gauche",turnRight:"tournez  droite",turnLeft:"tournez  gauche",turnSharpRight:"tournez fortement  droite",turnSharpLeft:"tournez fortement  gauche",UTurnRight:"effectuez un demi-tour  droite",UTurnLeft:"effectuez un demi-tour  gauche",start:"dpart",end:"vous serez arrivs",goUp:"montez",goDown:"descendez",changeModality:"changez de moyen de transport: %M",changeLayer:"changez de btiment",waypoint:"arrt"},keywords:{for:" pendant ",then:" puis ",and:" et ",near:"  proximit de ",using:" en empruntant ",stairway:"les escaliers",escalator:"l'escalator",lift:"l'ascenseur"},durations:{seconds:"quelques secondes",oneMinute:"environ une minute",minutes:"environ %d minutes"}}},this.publicNavigationTranslator=new Tf(this)}function Af(t,e){this.radius=1e3,this.orientation=new li(-.9800000000000013,0,-1.5707963267948966),this.orientationSerial=1,this.orientationLast=new li,this.orientationNormalized=this.orientation.clone(),this.target=new li(0,0,0),this.translateSpeed=1,this.rotationSpeed=.005*nd.RAD2DEG,this.rotationXMin=-90*nd.DEG2RAD,this.rotationXMax=-45*nd.DEG2RAD,this.zoomSpeed=.003,this.minRadius=10,this.maxRadius=5e3,this.pitchManipulatorEnabled=!0,this.rotationManipulatorEnabled=!0,this.zoomManipulatorEnabled=!0,this.panManipulatorEnabled=!0,this.cameraAngleVector={x:0,y:1},this.boundary=[{x:-1e9,y:-1e9},{x:1e9,y:-1e9},{x:1e9,y:1e9},{x:-1e9,y:1e9},{x:-1e9,y:-1e9}],this.update=function(){var i=!1;for(this.orientation.x===this.orientationLast.x&&this.orientation.y===this.orientationLast.y&&this.orientation.z===this.orientationLast.z||(this.orientationLast=this.orientation.clone(),this.orientationSerial++,i=!0),this.orientationNormalized.x=this.orientation.x,this.orientationNormalized.z=this.orientation.z;this.orientationNormalized.z>2*Math.PI;)this.orientationNormalized.z-=2*Math.PI;for(;this.orientationNormalized.z<0;)this.orientationNormalized.z+=2*Math.PI;this.previousMaxRadius!=this.maxRadius&&"number"==typeof t.sideInMeters&&(e.far=Math.max(this.maxRadius+t.sideInMeters*Math.sqrt(2)),e.updateProjectionMatrix(),this.previousMaxRadius=this.maxRadius),this.radius=Ke.clamp(this.radius,this.minRadius,this.maxRadius),this.translateSpeed=this.radius/616;var n=nd.projectPointToPolygon(this.target,this.boundary);this.target.x=n.x,this.target.y=n.y;var r=this.orientation.z-.5*Math.PI,a=this.orientation.x;e.position.x=this.target.x+Math.sin(r)*Math.cos(a)*-this.radius,e.position.y=this.target.y-Math.cos(r)*Math.cos(a)*-this.radius,e.position.z=this.target.z+Math.sin(a)*-this.radius,a<=.5*-Math.PI+.001?(e.up.x=Math.sin(r),e.up.y=-Math.cos(r),e.up.z=0):(e.up.x=0,e.up.y=0,e.up.z=1),this.cameraAngleVector.x=-Math.sin(r),this.cameraAngleVector.y=Math.cos(r),e.updateMatrix(),e.lookAt(this.target),t.mustUpdateCameraObjects=!0,e instanceof Uc&&t.orthographicNormalizedZoom&&this.wholeRadius&&(e.zoom=t.orthographicNormalizedZoom*this.wholeRadius/this.radius,e.updateProjectionMatrix()),e.updateMatrix(),e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),e.vg||(e.vg={camera_rotation:new Vi,cameraComponents:!1,cameraMatrix3:new $e});var s=new oi;if(s.setFromRotationMatrix(e.matrixWorldInverse),e.vg.camera_rotation.setFromQuaternion(s,"XYZ"),e.vg.cameraComponents=e.vg.camera_rotation.toArray(),i){var o=e.matrix,l=e.vg.cameraMatrix3,h=o.elements,c=l.elements;c[0]=h[0],c[1]=h[1],c[2]=h[2],c[3]=h[4],c[4]=h[5],c[5]=h[6],c[6]=h[8],c[7]=h[9],c[8]=h[10]}t.requestRedraw()}}function Pf(){this.time=0,this.u=0,this.v=0,this.radius=0,this.pitchLength=0,this.rotationLength=0,this.uSpeed=0,this.vSpeed=0,this.zoomSpeed=0,this.rotationSpeed=0,this.pitchSpeed=0,this.uDirection=0,this.vDirection=0,this.zoomDirection=0,this.rotationDirection=0,this.pitchDirection=0,this.resetUData=function(){this.u=0,this.uSpeed=0,this.uDirection=0},this.resetVData=function(){this.v=0,this.vSpeed=0,this.vDirection=0},this.resetPitchData=function(){this.pitchLength=0,this.pitchSpeed=0,this.pitchDirection=0},this.resetRotationData=function(){this.rotationLength=0,this.rotationSpeed=0,this.rotationDirection=0},this.resetZoomData=function(){this.radius=0,this.zoomSpeed=0,this.zoomDirection=0}}function Lf(t){var e=this,i=null,n=[],r=new gu,a={},s=0,o=0;this.animationDuration=2e3,this.panEnabled=!0,this.zoomEnabled=!0,this.rotationEnabled=!0,this.pitchEnabled=!0,Object.defineProperty(this,"enabled",{get:function(){return this.panEnabled||this.zoomEnabled||this.rotationEnabled||this.pitchEnabled},set:function(t){this.panEnabled=t,this.zoomEnabled=t,this.rotationEnabled=t,this.pitchEnabled=t}}),this.pushCameraSample=function(){var e=r.getElapsedTime();n.push({time:e,position:t.publicCamera.position,rotation:t.publicCamera.rotation,pitch:t.publicCamera.pitch}),(o+=e)>.2&&(o-=n[0].time,n.shift())},this.hasGestureStarted=function(){return s>0},this.onGestureStart=function(){i&&i.stop(),1===(s+=1)&&r.start()},this.onGestureEnd=function(){s>1?s--:1===s&&(l(),s=0)};var l=function(){!n||n.length<2||((a=new Pf).u=n[n.length-1].position.x-n[0].position.x,a.v=n[n.length-1].position.y-n[0].position.y,a.radius=n[n.length-1].position.radius-n[0].position.radius,a.time=n[n.length-1].time-n[0].time,a.rotationLength=n[n.length-1].rotation-n[0].rotation,a.pitchLength=n[n.length-1].pitch-n[0].pitch,a.uSpeed=Math.abs(a.u/a.time),a.vSpeed=Math.abs(a.v/a.time),a.rotationSpeed=Math.abs(a.rotationLength/a.time),a.pitchSpeed=Math.abs(a.pitchLength/a.time),a.zoomSpeed=Math.abs(a.radius/a.time),a.uDirection=a.u>0?1:-1,a.vDirection=a.v>0?1:-1,a.rotationDirection=a.rotationLength>0?1:-1,a.pitchDirection=a.pitchLength>0?1:-1,a.zoomDirection=a.radius>0?1:-1,c(),n=[],a.uSpeed>2e3&&(a.uSpeed=2e3),a.vSpeed>2e3&&(a.vSpeed=2e3),a.zoomSpeed>1e3&&(a.zoomSpeed=1e3),a.rotationSpeed>100&&(a.rotationSpeed=100),a.pitchSpeed>100&&(a.pitchSpeed=100),h())},h=function(){for(var n=[a.uSpeed,a.vSpeed,a.zoomSpeed,a.rotationSpeed,a.pitchSpeed],s=n[0],l=0;l<n.length&&(n[l]>s&&(s=n[l]),2e3!==s);++l);n=null;var h=0;i=t.animateValue(1,0,{duration:e.animationDuration,step:function(i){var n=(1-i)*e.animationDuration/1e3,r=n-h;h=n;var s=t.publicCamera.position;t.publicCamera.position={x:e.panEnabled?s.x+r*a.uSpeed*a.uDirection:s.x,y:e.panEnabled?s.y+r*a.vSpeed*a.vDirection:s.y,radius:e.zoomEnabled?s.radius+r*a.zoomSpeed*a.zoomDirection:s.radius},e.rotationEnabled&&(t.publicCamera.rotation+=r*a.rotationSpeed*a.rotationDirection),e.pitchEnabled&&(t.publicCamera.pitch+=r*a.pitchSpeed*a.pitchDirection),a.zoomSpeed=a.zoomSpeed*i*1,a.pitchSpeed=a.pitchSpeed*i*1,a.rotationSpeed=a.rotationSpeed*i*1,a.vSpeed=a.vSpeed*i*1,a.uSpeed=a.uSpeed*i*1},complete:function(){a.resetUData(),a.resetVData(),a.resetZoomData(),a.resetRotationData(),a.resetPitchData(),o=0,r.stop()},stop:function(){a.resetUData(),a.resetVData(),a.resetZoomData(),a.resetRotationData(),a.resetPitchData(),o=0,r.stop()}})},c=function(){a&&(isNaN(a.uSpeed)&&(a.uSpeed=0),isNaN(a.vSpeed)&&(a.vSpeed=0),isNaN(a.zoomSpeed)&&(a.zoomSpeed=0),isNaN(a.rotationSpeed)&&(a.rotationSpeed=0),isNaN(a.pitchSpeed)&&(a.pitchSpeed=0))}}Ef.prototype.getIDFromDestinationIndex=function(t){if("string"==typeof this.destinations)return this.destinations;if(!1===this.destinations||!Array.isArray(this.destinations)||t<0||t>=this.destinations.length)return!1;var e=this.destinations[t];return"string"==typeof e?e:"string"==typeof e.id&&e.id},Ef.prototype.getPlaceNameFromDestinationIndex=function(t){var e=this.getIDFromDestinationIndex(t);return!1!==e&&this.getPlaceNameFromID(e)},Ef.prototype.getPlaceNameFromID=function(t){var e=this.mapviewer.getPlaceName(t);if(Array.isArray(e)&&e.length>1)return e[0];if(!e){var i=this.vgPlaces;void 0!==i&&void 0!==i[t]&&(e=i[t].name)}return e},Ef.prototype.cManeuverIndex={eVgManeuverTypeUnknown:0,eVgManeuverTypeGoStraight:1,eVgManeuverTypeTurnGentleRight:2,eVgManeuverTypeTurnGentleLeft:3,eVgManeuverTypeTurnRight:4,eVgManeuverTypeTurnLeft:5,eVgManeuverTypeTurnSharpRight:6,eVgManeuverTypeTurnSharpLeft:7,eVgManeuverTypeUTurnRight:8,eVgManeuverTypeUTurnLeft:9,eVgManeuverTypeStart:10,eVgManeuverTypeEnd:11,eVgManeuverTypeGoUp:12,eVgManeuverTypeGoDown:13,eVgManeuverTypeChangeModality:14,eVgManeuverTypeChangeLayer:15,eVgManeuverTypeWaypoint:16},Ef.prototype.cManeuverTypes=["unknown","goStraight","turnGentleRight","turnGentleLeft","turnRight","turnLeft","turnSharpRight","turnSharpLeft","UTurnRight","UTurnLeft","start","end","goUp","goDown","changeModality","changeLayer","waypoint"],Ef.prototype.cDurations=["seconds","oneMinute","minutes"],Ef.prototype.cKeywords=["for","then","and","near","using","stairway","escalator","lift"],Ef.prototype.translateInstructions=function(t,e){var i=void 0!==e&&"default"!==e&&void 0!==this.cLanguageMap[e]?e:"en";this.destinations=!1,t.route&&t.route.request&&t.route.request.dst&&(this.destinations=t.route.request.dst);for(var n=0,r=t.instructions.length;n<r;n++)this.translateInstruction(t.instructions,n,i,t.parameters.mergeFloorChangeInstructions)},Ef.prototype.translateInstruction=function(t,e,i,n){var r=i||0;n=n||!1;var a=!1,s=t.length,o=t[e],l=t[e+1],h=this.cManeuverTypes[this.cManeuverIndex[o.maneuverType]],c="",u="",p="",d="",m="";switch(o.maneuverType){case"eVgManeuverTypeEnd":c=this.cLanguageMap[r].maneuvers[h],(g=this.getPlaceNameFromDestinationIndex(o.destinationIndex))&&(c+=": "+g,a=!0);break;case"eVgManeuverTypeChangeModality":case"eVgManeuverTypeChangeLayer":case"eVgManeuverTypeGoDown":case"eVgManeuverTypeGoUp":case"eVgManeuverTypeStart":c=this.cLanguageMap[r].maneuvers[h];break;case"eVgManeuverTypeWaypoint":if(void 0!==o.destinationIndex)c=this.cLanguageMap[r].maneuvers.waypoint,(v=this.getPlaceNameFromDestinationIndex(o.destinationIndex))&&(c+=": "+v,a=!0);break;case"eVgManeuverTypeGoStraight":if(c=this.cLanguageMap[r].maneuvers.goStraight,u=this.cLanguageMap[r].keywords.for+this.timeToText(o.duration/60,r),n){if(!l){p=this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers.end,(g=this.getPlaceNameFromDestinationIndex(o.destinationIndex))&&(p+=": "+g,a=!0);break}if(o.dataset!=(l&&l.dataset)?(p=l.height>o.height?this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers.goUp:l.height<o.height?this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers.goDown:this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers.changeLayer,l.modality!=o.modality&&(p+=this.cLanguageMap[r].keywords.and+this.cLanguageMap[r].nextManeuvers.changeModality)):l.modality!=o.modality&&(p+=this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers.changeModality),l&&l.destinationIndex!==o.destinationIndex)p+=this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers.waypoint,(v=this.getPlaceNameFromDestinationIndex(o.destinationIndex))&&(p+=": "+v,a=!0)}else if(e<s-1){var f=this.cManeuverTypes[this.cManeuverIndex[l.maneuverType]];switch(l.maneuverType){case"eVgManeuverTypeChangeLayer":case"eVgManeuverTypeEnd":var g;p=this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers[f],(g=this.getPlaceNameFromDestinationIndex(l.destinationIndex))&&(p+=": "+g,a=!0);break;case"eVgManeuverTypeGoDown":case"eVgManeuverTypeGoUp":p=this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers[f];break;case"eVgManeuverTypeWaypoint":var v;p=this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers[f],(v=this.getPlaceNameFromDestinationIndex(l.destinationIndex))&&(p+=": "+v,a=!0)}}break;default:c=this.cLanguageMap[r].maneuvers.goStraight,u=this.cLanguageMap[r].keywords.for+this.timeToText(o.duration/60,r),p=this.cLanguageMap[r].keywords.then+this.cLanguageMap[r].nextManeuvers[h]}var y=o.nearPlaces;if((n&&e>=s-1||!n&&e>=s-2)&&(a=!0),"eVgManeuverTypeGoUp"==o.maneuverType||"eVgManeuverTypeGoDown"==o.maneuverType||!n&&e<s-2&&("eVgManeuverTypeGoUp"==t[e+1].maneuverType||"eVgManeuverTypeGoDown"==t[e+1].maneuverType)||n&&e<s-1&&o.height!=t[e+1].height)for(var x=!1,b=0,w=o.attributes.length;b<w;b++){switch(o.attributes[b]){case"stairway":m=this.cLanguageMap[r].keywords.using+this.cLanguageMap[r].keywords.stairway,x=!0;break;case"escalator":m=this.cLanguageMap[r].keywords.using+this.cLanguageMap[r].keywords.escalator,x=!0;break;case"lift":m=this.cLanguageMap[r].keywords.using+this.cLanguageMap[r].keywords.lift,x=!0}if(x)break}if(!a&&y&&y.length>0){var _=y[0].id,M=this.getPlaceNameFromID(_);!1!==(M=M||_)&&"eVgManeuverTypeChangeModality"!=o.maneuverType&&"eVgManeuverTypeChangeLayer"!=o.maneuverType&&"eVgManeuverTypeEnd"!=o.maneuverType&&(d=this.cLanguageMap[r].keywords.near+M)}o.detail=c+u+p,(p&&""!=p||"eVgManeuverTypeGoUp"==o.maneuverType||"eVgManeuverTypeGoDown"==o.maneuverType)&&(o.detail+=m+d),o.brief=c,o.durationString=u,o.detail=this.replaceTokens(o.detail,o,l),o.brief=this.replaceTokens(o.brief,o,l),o.durationString=this.replaceTokens(o.durationString,o,l)},Ef.prototype.replaceTokens=function(t,e,i){if(void 0!==e){var n=Math.floor(e.duration/60);t=(t=(t=t.replace("%d",n)).replace("%m",e.modality)).replace("%l",e.dataset)}return void 0!==i&&(t=(t=t.replace("%M",i.modality)).replace("%L",i.dataset)),t},Ef.prototype.timeToText=function(t,e){return t<1?this.cLanguageMap[e].durations.seconds:t<2?this.cLanguageMap[e].durations.oneMinute:this.cLanguageMap[e].durations.minutes},Ef.prototype.addOrUpdateLanguage=function(t,e){if(void 0===t)return console.log("Invalid language code."),!1;var i="default"===t?"en":t,n=JSON.parse(e);if(void 0===n.maneuvers)return console.log("Could not add or update language '"+i+"': missing maneuvers."),console.log("Expected format: ",JSON.parse('{"maneuvers": {},"nextManeuvers":{},"keywords":{},"durations":{}}')),console.log("Try getLanguage('default') for more info."),!1;if(void 0===n.nextManeuvers)return console.log("Could not add or update language '"+i+"': missing nextManeuvers."),console.log("Expected format: ",JSON.parse('{"maneuvers": {},"nextManeuvers":{},"keywords":{},"durations":{}}')),console.log("Try getLanguage('default') for more info."),!1;if(void 0===n.keywords)return console.log("Could not add or update language '"+i+"': missing keywords."),console.log("Expected format: ",JSON.parse('{"maneuvers": {},"nextManeuvers":{},"keywords":{},"durations":{}}')),console.log("Try getLanguage('default') for more info."),!1;if(void 0===n.durations)return console.log("Could not add or update language '"+i+"': missing durations."),console.log("Expected format: ",JSON.parse('{"maneuvers": {},"nextManeuvers":{},"keywords":{},"durations":{}}')),console.log("Try getLanguage('default') for more info."),!1;$d.each(n.maneuvers,this.checkTokens),$d.each(n.nextManeuvers,function(t,e){return this.checkTokens(t,e,!0)}.bind(this)),$d.each(n.keywords,this.checkTokens),$d.each(n.durations,this.checkTokens);var r=this.cManeuverTypes.filter(function(t){return"string"!=typeof n.maneuvers[t]}),a=this.cManeuverTypes.filter(function(t){return"string"!=typeof n.nextManeuvers[t]}),s=this.cKeywords.filter(function(t){return"string"!=typeof n.keywords[t]}),o=this.cDurations.filter(function(t){return"string"!=typeof n.durations[t]});return r.length>0?(console.log("Could not add or update language, missing maneuvers:"),console.log.apply(null,r),console.log("Try getLanguage('default') for more info."),!1):a.length>0?(console.log("Could not add or update language, missing next maneuvers:"),console.log.apply(null,a),console.log("Try getLanguage('default') for more info."),!1):s.length>0?(console.log("Could not add or update language, missing keywords:"),console.log.apply(null,s),console.log("Try getLanguage('default') for more info."),!1):o.length>0?(console.log("Could not add or update language, missing durations:"),console.log.apply(null,o),console.log("Try getLanguage('default') for more info."),!1):(this.cLanguageMap[i]=n,!0)},Ef.prototype.getLanguageCodes=function(){return Object.keys(this.cLanguageMap)},Ef.prototype.getLanguage=function(t){var e="default"===t?"en":t;return void 0!==this.cLanguageMap[e]&&JSON.stringify(this.cLanguageMap[e])},Ef.prototype.updateManeuverForLanguage=function(t,e,i){var n="default"===e?"en":e;return void 0!==this.cLanguageMap[n]?-1!==this.cManeuverTypes.indexOf(t)?(this.checkTokens(i,t),this.cLanguageMap[n].maneuvers[t]=i,!0):(console.log("Invalid maneuver type."),!1):(console.log("Invalid language code."),!1)},Ef.prototype.updateNextManeuverForLanguage=function(t,e,i){var n="default"===e?"en":e;return void 0!==this.cLanguageMap[n]?-1!==this.cManeuverTypes.indexOf(t)?(this.checkTokens(i,t,!0),this.cLanguageMap[n].nextManeuvers[t]=i,!0):(console.log("Invalid maneuver type."),!1):(console.log("Invalid language code."),!1)},Ef.prototype.updateKeywordForLanguage=function(t,e,i){var n="default"===e?"en":e;return void 0!==this.cLanguageMap[n]?-1!==this.cKeywords.indexOf(t)?(this.checkTokens(i,t),this.cLanguageMap[n].keywords[t]=i,!0):(console.log("Invalid keyword type."),!1):(console.log("Invalid language code."),!1)},Ef.prototype.updateDurationForLanguage=function(t,e,i){var n="default"===e?"en":e;return void 0!==this.cLanguageMap[n]?-1!==this.cDurations.indexOf(t)?(this.checkTokens(i,t),this.cLanguageMap[n].durations[t]=i,!0):(console.log("Invalid duration type."),!1):(console.log("Invalid language code."),!1)},Ef.prototype.checkTokens=function(t,e,i){switch(e){case"goUp":-1!==t.indexOf("%L")||i||console.log("Warning: missing %L token in 'goUp' maneuver.");break;case"goDown":-1!==t.indexOf("%L")||i||console.log("Warning: missing %L token in 'goDown' maneuver.");break;case"changeModality":-1===t.indexOf("%M")&&console.log("Warning: missing %M token in 'changeModality' maneuver or next maneuver.");break;case"minutes":-1===t.indexOf("%d")&&console.log("Warning: missing %d token in 'minutes' duration.")}};var Of=ld(function(t){!function(e,i,n,r){var a,s=["","webkit","Moz","MS","ms","o"],o=i.createElement("div"),l="function",h=Math.round,c=Math.abs,u=Date.now;function p(t,e,i){return setTimeout(x(t,i),e)}function d(t,e,i){return!!Array.isArray(t)&&(m(t,i[e],i),!0)}function m(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==r)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function f(t,i,n){var r="DEPRECATED METHOD: "+i+"\n"+n+" AT \n";return function(){var i=new Error("get-stack-trace"),n=i&&i.stack?i.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",a=e.console&&(e.console.warn||e.console.log);return a&&a.call(e.console,r,n),t.apply(this,arguments)}}a="function"!=typeof Object.assign?function(t){if(t===r||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(n!==r&&null!==n)for(var a in n)n.hasOwnProperty(a)&&(e[a]=n[a])}return e}:Object.assign;var g=f(function(t,e,i){for(var n=Object.keys(e),a=0;a<n.length;)(!i||i&&t[n[a]]===r)&&(t[n[a]]=e[n[a]]),a++;return t},"extend","Use `assign`."),v=f(function(t,e){return g(t,e,!0)},"merge","Use `assign`.");function y(t,e,i){var n,r=e.prototype;(n=t.prototype=Object.create(r)).constructor=t,n._super=r,i&&a(n,i)}function x(t,e){return function(){return t.apply(e,arguments)}}function b(t,e){return typeof t==l?t.apply(e&&e[0]||r,e):t}function w(t,e){return t===r?e:t}function _(t,e,i){m(E(e),function(e){t.addEventListener(e,i,!1)})}function M(t,e,i){m(E(e),function(e){t.removeEventListener(e,i,!1)})}function S(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function T(t,e){return t.indexOf(e)>-1}function E(t){return t.trim().split(/\s+/g)}function A(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function P(t){return Array.prototype.slice.call(t,0)}function L(t,e,i){for(var n=[],r=[],a=0;a<t.length;){var s=e?t[a][e]:t[a];A(r,s)<0&&n.push(t[a]),r[a]=s,a++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function O(t,e){for(var i,n,a=e[0].toUpperCase()+e.slice(1),o=0;o<s.length;){if((n=(i=s[o])?i+a:e)in t)return n;o++}return r}var C=1;function R(t){var i=t.ownerDocument||t;return i.defaultView||i.parentWindow||e}var I="ontouchstart"in e,D=O(e,"PointerEvent")!==r,N=I&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),F=25,z=1,k=2,B=4,U=8,G=1,H=2,j=4,V=8,W=16,q=H|j,X=V|W,Y=q|X,Z=["x","y"],J=["clientX","clientY"];function K(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){b(t.options.enable,[t])&&i.handler(e)},this.init()}function Q(t,e,i){var n=i.pointers.length,a=i.changedPointers.length,s=e&z&&n-a==0,o=e&(B|U)&&n-a==0;i.isFirst=!!s,i.isFinal=!!o,s&&(t.session={}),i.eventType=e,function(t,e){var i=t.session,n=e.pointers,a=n.length;i.firstInput||(i.firstInput=$(e));a>1&&!i.firstMultiple?i.firstMultiple=$(e):1===a&&(i.firstMultiple=!1);var s=i.firstInput,o=i.firstMultiple,l=o?o.center:s.center,h=e.center=tt(n);e.timeStamp=u(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=rt(l,h),e.distance=nt(l,h),function(t,e){var i=e.center,n=t.offsetDelta||{},r=t.prevDelta||{},a=t.prevInput||{};e.eventType!==z&&a.eventType!==B||(r=t.prevDelta={x:a.deltaX||0,y:a.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y});e.deltaX=r.x+(i.x-n.x),e.deltaY=r.y+(i.y-n.y)}(i,e),e.offsetDirection=it(e.deltaX,e.deltaY);var p=et(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=p.x,e.overallVelocityY=p.y,e.overallVelocity=c(p.x)>c(p.y)?p.x:p.y,e.scale=o?(d=o.pointers,m=n,nt(m[0],m[1],J)/nt(d[0],d[1],J)):1,e.rotation=o?function(t,e){return rt(e[1],e[0],J)+rt(t[1],t[0],J)}(o.pointers,n):0,e.maxPointers=i.prevInput?e.pointers.length>i.prevInput.maxPointers?e.pointers.length:i.prevInput.maxPointers:e.pointers.length,function(t,e){var i,n,a,s,o=t.lastInterval||e,l=e.timeStamp-o.timeStamp;if(e.eventType!=U&&(l>F||o.velocity===r)){var h=e.deltaX-o.deltaX,u=e.deltaY-o.deltaY,p=et(l,h,u);n=p.x,a=p.y,i=c(p.x)>c(p.y)?p.x:p.y,s=it(h,u),t.lastInterval=e}else i=o.velocity,n=o.velocityX,a=o.velocityY,s=o.direction;e.velocity=i,e.velocityX=n,e.velocityY=a,e.direction=s}(i,e);var d,m;var f=t.element;S(e.srcEvent.target,f)&&(f=e.srcEvent.target);e.target=f}(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function $(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:h(t.pointers[i].clientX),clientY:h(t.pointers[i].clientY)},i++;return{timeStamp:u(),pointers:e,center:tt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function tt(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var i=0,n=0,r=0;r<e;)i+=t[r].clientX,n+=t[r].clientY,r++;return{x:h(i/e),y:h(n/e)}}function et(t,e,i){return{x:e/t||0,y:i/t||0}}function it(t,e){return t===e?G:c(t)>=c(e)?t<0?H:j:e<0?V:W}function nt(t,e,i){i||(i=Z);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return Math.sqrt(n*n+r*r)}function rt(t,e,i){i||(i=Z);var n=e[i[0]]-t[i[0]],r=e[i[1]]-t[i[1]];return 180*Math.atan2(r,n)/Math.PI}K.prototype={handler:function(){},init:function(){this.evEl&&_(this.element,this.evEl,this.domHandler),this.evTarget&&_(this.target,this.evTarget,this.domHandler),this.evWin&&_(R(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(R(this.element),this.evWin,this.domHandler)}};var at={mousedown:z,mousemove:k,mouseup:B},st="mousedown",ot="mousemove mouseup";function lt(){this.evEl=st,this.evWin=ot,this.pressed=!1,K.apply(this,arguments)}y(lt,K,{handler:function(t){var e=at[t.type];e&z&&0===t.button&&(this.pressed=!0),e&k&&1!==t.which&&(e=B),this.pressed&&(e&B&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var ht={pointerdown:z,pointermove:k,pointerup:B,pointercancel:U,pointerout:U},ct={2:"touch",3:"pen",4:"mouse",5:"kinect"},ut="pointerdown",pt="pointermove pointerup pointercancel";function dt(){this.evEl=ut,this.evWin=pt,K.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}e.MSPointerEvent&&!e.PointerEvent&&(ut="MSPointerDown",pt="MSPointerMove MSPointerUp MSPointerCancel"),y(dt,K,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),r=ht[n],a=ct[t.pointerType]||t.pointerType,s="touch"==a,o=A(e,t.pointerId,"pointerId");r&z&&(0===t.button||s)?o<0&&(e.push(t),o=e.length-1):r&(B|U)&&(i=!0),o<0||(e[o]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:a,srcEvent:t}),i&&e.splice(o,1))}});var mt={touchstart:z,touchmove:k,touchend:B,touchcancel:U},ft="touchstart",gt="touchstart touchmove touchend touchcancel";function vt(){this.evTarget=ft,this.evWin=gt,this.started=!1,K.apply(this,arguments)}y(vt,K,{handler:function(t){var e=mt[t.type];if(e===z&&(this.started=!0),this.started){var i=function(t,e){var i=P(t.touches),n=P(t.changedTouches);e&(B|U)&&(i=L(i.concat(n),"identifier",!0));return[i,n]}.call(this,t,e);e&(B|U)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var yt={touchstart:z,touchmove:k,touchend:B,touchcancel:U},xt="touchstart touchmove touchend touchcancel";function bt(){this.evTarget=xt,this.targetIds={},K.apply(this,arguments)}y(bt,K,{handler:function(t){var e=yt[t.type],i=function(t,e){var i=P(t.touches),n=this.targetIds;if(e&(z|k)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var r,a,s=P(t.changedTouches),o=[],l=this.target;if(a=i.filter(function(t){return S(t.target,l)}),e===z)for(r=0;r<a.length;)n[a[r].identifier]=!0,r++;r=0;for(;r<s.length;)n[s[r].identifier]&&o.push(s[r]),e&(B|U)&&delete n[s[r].identifier],r++;if(!o.length)return;return[L(a.concat(o),"identifier",!0),o]}.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}});var wt=2500,_t=25;function Mt(){K.apply(this,arguments);var t=x(this.handler,this);this.touch=new bt(this.manager,t),this.mouse=new lt(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function St(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var i={x:e.clientX,y:e.clientY};this.lastTouches.push(i);var n=this.lastTouches;setTimeout(function(){var t=n.indexOf(i);t>-1&&n.splice(t,1)},wt)}}y(Mt,K,{handler:function(t,e,i){var n="touch"==i.pointerType,r="mouse"==i.pointerType;if(!(r&&i.sourceCapabilities&&i.sourceCapabilities.firesTouchEvents)){if(n)(function(t,e){t&z?(this.primaryTouch=e.changedPointers[0].identifier,St.call(this,e)):t&(B|U)&&St.call(this,e)}).call(this,e,i);else if(r&&function(t){for(var e=t.srcEvent.clientX,i=t.srcEvent.clientY,n=0;n<this.lastTouches.length;n++){var r=this.lastTouches[n],a=Math.abs(e-r.x),s=Math.abs(i-r.y);if(a<=_t&&s<=_t)return!0}return!1}.call(this,i))return;this.callback(t,e,i)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Tt=O(o.style,"touchAction"),Et=Tt!==r,At="auto",Pt="manipulation",Lt="none",Ot="pan-x",Ct="pan-y",Rt=function(){if(!Et)return!1;var t={},i=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(n){t[n]=!i||e.CSS.supports("touch-action",n)}),t}();function It(t,e){this.manager=t,this.set(e)}It.prototype={set:function(t){"compute"==t&&(t=this.compute()),Et&&this.manager.element.style&&Rt[t]&&(this.manager.element.style[Tt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return m(this.manager.recognizers,function(e){b(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),function(t){if(T(t,Lt))return Lt;var e=T(t,Ot),i=T(t,Ct);if(e&&i)return Lt;if(e||i)return e?Ot:Ct;if(T(t,Pt))return Pt;return At}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var n=this.actions,r=T(n,Lt)&&!Rt[Lt],a=T(n,Ct)&&!Rt[Ct],s=T(n,Ot)&&!Rt[Ot];if(r){var o=1===t.pointers.length,l=t.distance<2,h=t.deltaTime<250;if(o&&l&&h)return}if(!s||!a)return r||a&&i&q||s&&i&X?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var Dt=1,Nt=2,Ft=4,zt=8,kt=zt,Bt=16;function Ut(t){this.options=a({},this.defaults,t||{}),this.id=C++,this.manager=null,this.options.enable=w(this.options.enable,!0),this.state=Dt,this.simultaneous={},this.requireFail=[]}function Gt(t){return t&Bt?"cancel":t&zt?"end":t&Ft?"move":t&Nt?"start":""}function Ht(t){return t==W?"down":t==V?"up":t==H?"left":t==j?"right":""}function jt(t,e){var i=e.manager;return i?i.get(t):t}function Vt(){Ut.apply(this,arguments)}function Wt(){Vt.apply(this,arguments),this.pX=null,this.pY=null}function qt(){Vt.apply(this,arguments)}function Xt(){Ut.apply(this,arguments),this._timer=null,this._input=null}function Yt(){Vt.apply(this,arguments)}function Zt(){Vt.apply(this,arguments)}function Jt(){Ut.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Kt(t,e){return(e=e||{}).recognizers=w(e.recognizers,Kt.defaults.preset),new Qt(t,e)}Ut.prototype={defaults:{},set:function(t){return a(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(d(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=jt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return d(t,"dropRecognizeWith",this)?this:(t=jt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(d(t,"requireFailure",this))return this;var e=this.requireFail;return-1===A(e,t=jt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(d(t,"dropRequireFailure",this))return this;t=jt(t,this);var e=A(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,i=this.state;function n(i){e.manager.emit(i,t)}i<zt&&n(e.options.event+Gt(i)),n(e.options.event),t.additionalEvent&&n(t.additionalEvent),i>=zt&&n(e.options.event+Gt(i))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|Dt)))return!1;t++}return!0},recognize:function(t){var e=a({},t);if(!b(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(kt|Bt|32)&&(this.state=Dt),this.state=this.process(e),this.state&(Nt|Ft|zt|Bt)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},y(Vt,Ut,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(Nt|Ft),r=this.attrTest(t);return n&&(i&U||!r)?e|Bt:n||r?i&B?e|zt:e&Nt?e|Ft:Nt:32}}),y(Wt,Vt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Y},getTouchAction:function(){var t=this.options.direction,e=[];return t&q&&e.push(Ct),t&X&&e.push(Ot),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,r=t.direction,a=t.deltaX,s=t.deltaY;return r&e.direction||(e.direction&q?(r=0===a?G:a<0?H:j,i=a!=this.pX,n=Math.abs(t.deltaX)):(r=0===s?G:s<0?V:W,i=s!=this.pY,n=Math.abs(t.deltaY))),t.direction=r,i&&n>e.threshold&&r&e.direction},attrTest:function(t){return Vt.prototype.attrTest.call(this,t)&&(this.state&Nt||!(this.state&Nt)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=Ht(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),y(qt,Vt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&Nt)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),y(Xt,Ut,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[At]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(B|U)&&!r)this.reset();else if(t.eventType&z)this.reset(),this._timer=p(function(){this.state=kt,this.tryEmit()},e.time,this);else if(t.eventType&B)return kt;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===kt&&(t&&t.eventType&B?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}}),y(Yt,Vt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Lt]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&Nt)}}),y(Zt,Vt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:q|X,pointers:1},getTouchAction:function(){return Wt.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(q|X)?e=t.overallVelocity:i&q?e=t.overallVelocityX:i&X&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&i&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&c(e)>this.options.velocity&&t.eventType&B},emit:function(t){var e=Ht(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),y(Jt,Ut,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Pt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),t.eventType&z&&0===this.count)return this.failTimeout();if(n&&r&&i){if(t.eventType!=B)return this.failTimeout();var a=!this.pTime||t.timeStamp-this.pTime<e.interval,s=!this.pCenter||nt(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,s&&a?this.count+=1:this.count=1,this._input=t,0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=p(function(){this.state=kt,this.tryEmit()},e.interval,this),Nt):kt}return 32},failTimeout:function(){return this._timer=p(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==kt&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Kt.VERSION="2.0.7",Kt.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Yt,{enable:!1}],[qt,{enable:!1},["rotate"]],[Zt,{direction:q}],[Wt,{direction:q},["swipe"]],[Jt],[Jt,{event:"doubletap",taps:2},["tap"]],[Xt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function Qt(t,e){var i;this.options=a({},Kt.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((i=this).options.inputClass||(D?dt:N?bt:I?Mt:lt))(i,Q),this.touchAction=new It(this,this.options.touchAction),$t(this,!0),m(this.options.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function $t(t,e){var i,n=t.element;n.style&&(m(t.options.cssProps,function(r,a){i=O(n.style,a),e?(t.oldCssProps[i]=n.style[i],n.style[i]=r):n.style[i]=t.oldCssProps[i]||""}),e||(t.oldCssProps={}))}Qt.prototype={set:function(t){return a(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var i;this.touchAction.preventDefaults(t);var n=this.recognizers,r=e.curRecognizer;(!r||r&&r.state&kt)&&(r=e.curRecognizer=null);for(var a=0;a<n.length;)i=n[a],2===e.stopped||r&&i!=r&&!i.canRecognizeWith(r)?i.reset():i.recognize(t),!r&&i.state&(Nt|Ft|zt)&&(r=e.curRecognizer=i),a++}},get:function(t){if(t instanceof Ut)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(d(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(d(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,i=A(e,t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this},on:function(t,e){if(t!==r&&e!==r){var i=this.handlers;return m(E(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this}},off:function(t,e){if(t!==r){var i=this.handlers;return m(E(t),function(t){e?i[t]&&i[t].splice(A(i[t],e),1):delete i[t]}),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=i.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](e),r++}},destroy:function(){this.element&&$t(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},a(Kt,{INPUT_START:z,INPUT_MOVE:k,INPUT_END:B,INPUT_CANCEL:U,STATE_POSSIBLE:Dt,STATE_BEGAN:Nt,STATE_CHANGED:Ft,STATE_ENDED:zt,STATE_RECOGNIZED:kt,STATE_CANCELLED:Bt,STATE_FAILED:32,DIRECTION_NONE:G,DIRECTION_LEFT:H,DIRECTION_RIGHT:j,DIRECTION_UP:V,DIRECTION_DOWN:W,DIRECTION_HORIZONTAL:q,DIRECTION_VERTICAL:X,DIRECTION_ALL:Y,Manager:Qt,Input:K,TouchAction:It,TouchInput:bt,MouseInput:lt,PointerEventInput:dt,TouchMouseInput:Mt,SingleTouchInput:vt,Recognizer:Ut,AttrRecognizer:Vt,Tap:Jt,Pan:Wt,Swipe:Zt,Pinch:qt,Rotate:Yt,Press:Xt,on:_,off:M,each:m,merge:v,extend:g,assign:a,inherit:y,bindFn:x,prefixed:O}),(void 0!==e?e:"undefined"!=typeof self?self:{}).Hammer=Kt,"function"==typeof r&&r.amd?r(function(){return Kt}):t.exports?t.exports=Kt:e.Hammer=Kt}(window,document)});var Cf=1,Rf=2,If=4,Df=5,Nf=484813681109536e-20,Ff=Math.PI/2,zf=.16666666666666666,kf=.04722222222222222,Bf=.022156084656084655,Uf=1e-10,Gf=.017453292519943295,Hf=57.29577951308232,jf=Math.PI/4,Vf=2*Math.PI,Wf=3.14159265359,qf={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Xf={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},Yf=/[\s_\-\/\(\)]/g;function Zf(t,e){if(t[e])return t[e];for(var i,n=Object.keys(t),r=e.toLowerCase().replace(Yf,""),a=-1;++a<n.length;)if((i=n[a]).toLowerCase().replace(Yf,"")===r)return t[i]}function Jf(t){var e,i,n,r={},a=t.split("+").map(function(t){return t.trim()}).filter(function(t){return t}).reduce(function(t,e){var i=e.split("=");return i.push(!0),t[i[0].toLowerCase()]=i[1],t},{}),s={proj:"projName",datum:"datumCode",rf:function(t){r.rf=parseFloat(t)},lat_0:function(t){r.lat0=t*Gf},lat_1:function(t){r.lat1=t*Gf},lat_2:function(t){r.lat2=t*Gf},lat_ts:function(t){r.lat_ts=t*Gf},lon_0:function(t){r.long0=t*Gf},lon_1:function(t){r.long1=t*Gf},lon_2:function(t){r.long2=t*Gf},alpha:function(t){r.alpha=parseFloat(t)*Gf},lonc:function(t){r.longc=t*Gf},x_0:function(t){r.x0=parseFloat(t)},y_0:function(t){r.y0=parseFloat(t)},k_0:function(t){r.k0=parseFloat(t)},k:function(t){r.k0=parseFloat(t)},a:function(t){r.a=parseFloat(t)},b:function(t){r.b=parseFloat(t)},r_a:function(){r.R_A=!0},zone:function(t){r.zone=parseInt(t,10)},south:function(){r.utmSouth=!0},towgs84:function(t){r.datum_params=t.split(",").map(function(t){return parseFloat(t)})},to_meter:function(t){r.to_meter=parseFloat(t)},units:function(t){r.units=t;var e=Zf(Xf,t);e&&(r.to_meter=e.to_meter)},from_greenwich:function(t){r.from_greenwich=t*Gf},pm:function(t){var e=Zf(qf,t);r.from_greenwich=(e||parseFloat(t))*Gf},nadgrids:function(t){"@null"===t?r.datumCode="none":r.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(r.axis=t)}};for(e in a)i=a[e],e in s?"function"==typeof(n=s[e])?n(i):r[n]=i:r[e]=i;return"string"==typeof r.datumCode&&"WGS84"!==r.datumCode&&(r.datumCode=r.datumCode.toLowerCase()),r}var Kf=1,Qf=/\s/,$f=/[A-Za-z]/,tg=/[A-Za-z84]/,eg=/[,\]]/,ig=/[\d\.E\-\+]/;function ng(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=Kf}function rg(t,e,i){Array.isArray(e)&&(i.unshift(e),e=null);var n=e?{}:t,r=i.reduce(function(t,e){return ag(e,t),t},n);e&&(t[e]=r)}function ag(t,e){if(Array.isArray(t)){var i=t.shift();if("PARAMETER"===i&&(i=t.shift()),1===t.length)return Array.isArray(t[0])?(e[i]={},void ag(t[0],e[i])):void(e[i]=t[0]);if(t.length)if("TOWGS84"!==i){if("AXIS"===i)return i in e||(e[i]=[]),void e[i].push(t);var n;switch(Array.isArray(i)||(e[i]={}),i){case"UNIT":case"PRIMEM":case"VERT_DATUM":return e[i]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&ag(t[2],e[i]));case"SPHEROID":case"ELLIPSOID":return e[i]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&ag(t[3],e[i]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void rg(e,i,t);default:for(n=-1;++n<t.length;)if(!Array.isArray(t[n]))return ag(t,e[i]);return rg(e,i,t)}}else e[i]=t;else e[i]=!0}else e[t]=!0}ng.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;Qf.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case Kf:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},ng.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(eg.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},ng.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=Kf)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=Kf,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},ng.prototype.number=function(t){if(!ig.test(t)){if(eg.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},ng.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},ng.prototype.keyword=function(t){if(tg.test(t))this.word+=t;else{if("["===t){var e=[];return e.push(this.word),this.level++,null===this.root?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,void(this.state=Kf)}if(!eg.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},ng.prototype.neutral=function(t){if($f.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(ig.test(t))return this.word=t,void(this.state=3);if(!eg.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},ng.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var sg=.017453292519943295;function og(t){return t*sg}function lg(t){var e=new ng(t).output(),i=e.shift(),n=e.shift();e.unshift(["name",n]),e.unshift(["type",i]);var r={};return ag(e,r),function(t){if("GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var e="",i=0,n=t.AXIS.length;i<n;++i){var r=t.AXIS[i][0].toLowerCase();-1!==r.indexOf("north")?e+="n":-1!==r.indexOf("south")?e+="s":-1!==r.indexOf("east")?e+="e":-1!==r.indexOf("west")&&(e+="w")}2===e.length&&(e+="u"),3===e.length&&(t.axis=e)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var a=t.GEOGCS;function s(e){return e*(t.to_meter||1)}"GEOGCS"===t.type&&(a=t),a&&(a.DATUM?t.datumCode=a.DATUM.name.toLowerCase():t.datumCode=a.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"!==t.datumCode&&"world_geodetic_system_1984"!==t.datumCode||("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(t.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=a.DATUM.SPHEROID.a,t.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(t.datum_params=a.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",og],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",og],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",og],["lat0","latitude_of_origin",og],["lat0","standard_parallel_1",og],["lat1","standard_parallel_1",og],["lat2","standard_parallel_2",og],["azimuth","Azimuth"],["alpha","azimuth",og],["srsCode","name"]].forEach(function(e){return i=t,r=(n=e)[0],a=n[1],void(!(r in i)&&a in i&&(i[r]=i[a],3===n.length&&(i[r]=n[2](i[r]))));var i,n,r,a}),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=og(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(r),r}function hg(t){var e=this;if(2===arguments.length){var i=arguments[1];"string"==typeof i?"+"===i.charAt(0)?hg[t]=Jf(arguments[1]):hg[t]=lg(arguments[1]):hg[t]=i}else if(1===arguments.length){if(Array.isArray(t))return t.map(function(t){Array.isArray(t)?hg.apply(e,t):hg(t)});if("string"==typeof t){if(t in hg)return hg[t]}else"EPSG"in t?hg["EPSG:"+t.EPSG]=t:"ESRI"in t?hg["ESRI:"+t.ESRI]=t:"IAU2000"in t?hg["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(hg);var cg=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var ug=["3857","900913","3785","102113"];function pg(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in hg}(t))return hg[t];if(function(t){return cg.some(function(e){return t.indexOf(e)>-1})}(t)){var e=lg(t);if(function(t){var e=Zf(t,"authority");if(e){var i=Zf(e,"epsg");return i&&ug.indexOf(i)>-1}}(e))return hg["EPSG:3857"];var i=function(t){var e=Zf(t,"extension");if(e)return Zf(e,"proj4")}(e);return i?Jf(i):e}return function(t){return"+"===t[0]}(t)?Jf(t):void 0}function dg(t,e){var i,n;if(t=t||{},!e)return t;for(n in e)void 0!==(i=e[n])&&(t[n]=i);return t}function mg(t,e,i){var n=t*e;return i/Math.sqrt(1-n*n)}function fg(t){return t<0?-1:1}function gg(t){return Math.abs(t)<=Wf?t:t-fg(t)*Vf}function vg(t,e,i){var n=t*i,r=.5*t;return n=Math.pow((1-n)/(1+n),r),Math.tan(.5*(Ff-e))/n}function yg(t,e){for(var i,n,r=.5*t,a=Ff-2*Math.atan(e),s=0;s<=15;s++)if(i=t*Math.sin(a),a+=n=Ff-2*Math.atan(e*Math.pow((1-i)/(1+i),r))-a,Math.abs(n)<=1e-10)return a;return-9999}function xg(t){return t}var bg=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=mg(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var e,i,n=t.x,r=t.y;if(r*Hf>90&&r*Hf<-90&&n*Hf>180&&n*Hf<-180)return null;if(Math.abs(Math.abs(r)-Ff)<=Uf)return null;if(this.sphere)e=this.x0+this.a*this.k0*gg(n-this.long0),i=this.y0+this.a*this.k0*Math.log(Math.tan(jf+.5*r));else{var a=Math.sin(r),s=vg(this.e,r,a);e=this.x0+this.a*this.k0*gg(n-this.long0),i=this.y0-this.a*this.k0*Math.log(s)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n=t.x-this.x0,r=t.y-this.y0;if(this.sphere)i=Ff-2*Math.atan(Math.exp(-r/(this.a*this.k0)));else{var a=Math.exp(-r/(this.a*this.k0));if(-9999===(i=yg(this.e,a)))return null}return e=gg(this.long0+n/(this.a*this.k0)),t.x=e,t.y=i,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:xg,inverse:xg,names:["longlat","identity"]}],wg={},_g=[];function Mg(t,e){var i=_g.length;return t.names?(_g[i]=t,t.names.forEach(function(t){wg[t.toLowerCase()]=i}),this):(console.log(e),!0)}var Sg={start:function(){bg.forEach(Mg)},add:Mg,get:function(t){if(!t)return!1;var e=t.toLowerCase();return void 0!==wg[e]&&_g[wg[e]]?_g[wg[e]]:void 0}},Tg={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Eg=Tg.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Tg.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var Ag={};function Pg(t,e){if(!(this instanceof Pg))return new Pg(t);e=e||function(t){if(t)throw t};var i=pg(t);if("object"==typeof i){var n=Pg.projections.get(i.projName);if(n){if(i.datumCode&&"none"!==i.datumCode){var r=Zf(Ag,i.datumCode);r&&(i.datum_params=r.towgs84?r.towgs84.split(","):null,i.ellps=r.ellipse,i.datumName=r.datumName?r.datumName:i.datumCode)}i.k0=i.k0||1,i.axis=i.axis||"enu",i.ellps=i.ellps||"wgs84";var a,s,o,l,h,c,u,p=function(t,e,i,n,r){if(!t){var a=Zf(Tg,n);a||(a=Eg),t=a.a,e=a.b,i=a.rf}return i&&!e&&(e=(1-1/i)*t),(0===i||Math.abs(t-e)<Uf)&&(r=!0,e=t),{a:t,b:e,rf:i,sphere:r}}(i.a,i.b,i.rf,i.ellps,i.sphere),d=(a=p.a,s=p.b,p.rf,o=i.R_A,c=((l=a*a)-(h=s*s))/l,u=0,o?(l=(a*=1-c*(zf+c*(kf+c*Bf)))*a,c=0):u=Math.sqrt(c),{es:c,e:u,ep2:(l-h)/h}),m=i.datum||function(t,e,i,n,r,a){var s={};return s.datum_type=void 0===t||"none"===t?Df:If,e&&(s.datum_params=e.map(parseFloat),0===s.datum_params[0]&&0===s.datum_params[1]&&0===s.datum_params[2]||(s.datum_type=Cf),s.datum_params.length>3&&(0===s.datum_params[3]&&0===s.datum_params[4]&&0===s.datum_params[5]&&0===s.datum_params[6]||(s.datum_type=Rf,s.datum_params[3]*=Nf,s.datum_params[4]*=Nf,s.datum_params[5]*=Nf,s.datum_params[6]=s.datum_params[6]/1e6+1))),s.a=i,s.b=n,s.es=r,s.ep2=a,s}(i.datumCode,i.datum_params,p.a,p.b,d.es,d.ep2);dg(this,i),dg(this,n),this.a=p.a,this.b=p.b,this.rf=p.rf,this.sphere=p.sphere,this.es=d.es,this.e=d.e,this.ep2=d.ep2,this.datum=m,this.init(),e(null,this)}else e(t)}else e(t)}function Lg(t,e,i){var n,r,a,s,o=t.x,l=t.y,h=t.z?t.z:0;if(l<-Ff&&l>-1.001*Ff)l=-Ff;else if(l>Ff&&l<1.001*Ff)l=Ff;else{if(l<-Ff)return{x:-1/0,y:-1/0,z:t.z};if(l>Ff)return{x:1/0,y:1/0,z:t.z}}return o>Math.PI&&(o-=2*Math.PI),r=Math.sin(l),s=Math.cos(l),a=r*r,{x:((n=i/Math.sqrt(1-e*a))+h)*s*Math.cos(o),y:(n+h)*s*Math.sin(o),z:(n*(1-e)+h)*r}}function Og(t,e,i,n){var r,a,s,o,l,h,c,u,p,d,m,f,g,v,y,x=t.x,b=t.y,w=t.z?t.z:0;if(r=Math.sqrt(x*x+b*b),a=Math.sqrt(x*x+b*b+w*w),r/i<1e-12){if(v=0,a/i<1e-12)return Ff,y=-n,{x:t.x,y:t.y,z:t.z}}else v=Math.atan2(b,x);s=w/a,u=(o=r/a)*(1-e)*(l=1/Math.sqrt(1-e*(2-e)*o*o)),p=s*l,g=0;do{g++,h=e*(c=i/Math.sqrt(1-e*p*p))/(c+(y=r*u+w*p-c*(1-e*p*p))),f=(m=s*(l=1/Math.sqrt(1-h*(2-h)*o*o)))*u-(d=o*(1-h)*l)*p,u=d,p=m}while(f*f>1e-24&&g<30);return{x:v,y:Math.atan(m/Math.abs(d)),z:y}}function Cg(t){return t===Cf||t===Rf}function Rg(t,e,i){return function(t,e){return t.datum_type===e.datum_type&&!(t.a!==e.a||Math.abs(t.es-e.es)>5e-11)&&(t.datum_type===Cf?t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]:t.datum_type!==Rf||t.datum_params[0]===e.datum_params[0]&&t.datum_params[1]===e.datum_params[1]&&t.datum_params[2]===e.datum_params[2]&&t.datum_params[3]===e.datum_params[3]&&t.datum_params[4]===e.datum_params[4]&&t.datum_params[5]===e.datum_params[5]&&t.datum_params[6]===e.datum_params[6])}(t,e)?i:t.datum_type===Df||e.datum_type===Df?i:t.es!==e.es||t.a!==e.a||Cg(t.datum_type)||Cg(e.datum_type)?(i=Lg(i,t.es,t.a),Cg(t.datum_type)&&(i=function(t,e,i){if(e===Cf)return{x:t.x+i[0],y:t.y+i[1],z:t.z+i[2]};if(e===Rf){var n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6];return{x:h*(t.x-l*t.y+o*t.z)+n,y:h*(l*t.x+t.y-s*t.z)+r,z:h*(-o*t.x+s*t.y+t.z)+a}}}(i,t.datum_type,t.datum_params)),Cg(e.datum_type)&&(i=function(t,e,i){if(e===Cf)return{x:t.x-i[0],y:t.y-i[1],z:t.z-i[2]};if(e===Rf){var n=i[0],r=i[1],a=i[2],s=i[3],o=i[4],l=i[5],h=i[6],c=(t.x-n)/h,u=(t.y-r)/h,p=(t.z-a)/h;return{x:c+l*u-o*p,y:-l*c+u+s*p,z:o*c-s*u+p}}}(i,e.datum_type,e.datum_params)),Og(i,e.es,e.a,e.b)):i}function Ig(t,e,i){var n,r,a,s=i.x,o=i.y,l=i.z||0,h={};for(a=0;a<3;a++)if(!e||2!==a||void 0!==i.z)switch(0===a?(n=s,r=-1!=="ew".indexOf(t.axis[a])?"x":"y"):1===a?(n=o,r=-1!=="ns".indexOf(t.axis[a])?"y":"x"):(n=l,r="z"),t.axis[a]){case"e":case"w":case"n":case"s":h[r]=n;break;case"u":void 0!==i[r]&&(h.z=n);break;case"d":void 0!==i[r]&&(h.z=-n);break;default:return null}return h}function Dg(t){var e={x:t[0],y:t[1]};return t.length>2&&(e.z=t[2]),t.length>3&&(e.m=t[3]),e}function Ng(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Fg(t,e,i){var n;if(Array.isArray(i)&&(i=Dg(i)),function(t){Ng(t.x),Ng(t.y)}(i),t.datum&&e.datum&&function(t,e){return(t.datum.datum_type===Cf||t.datum.datum_type===Rf)&&"WGS84"!==e.datumCode||(e.datum.datum_type===Cf||e.datum.datum_type===Rf)&&"WGS84"!==t.datumCode}(t,e)&&(i=Fg(t,n=new Pg("WGS84"),i),t=n),"enu"!==t.axis&&(i=Ig(t,!1,i)),"longlat"===t.projName)i={x:i.x*Gf,y:i.y*Gf,z:i.z||0};else if(t.to_meter&&(i={x:i.x*t.to_meter,y:i.y*t.to_meter,z:i.z||0}),!(i=t.inverse(i)))return;return t.from_greenwich&&(i.x+=t.from_greenwich),i=Rg(t.datum,e.datum,i),e.from_greenwich&&(i={x:i.x-e.from_greenwich,y:i.y,z:i.z||0}),"longlat"===e.projName?i={x:i.x*Hf,y:i.y*Hf,z:i.z||0}:(i=e.forward(i),e.to_meter&&(i={x:i.x/e.to_meter,y:i.y/e.to_meter,z:i.z||0})),"enu"!==e.axis?Ig(e,!0,i):i}Ag.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},Ag.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},Ag.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},Ag.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},Ag.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},Ag.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},Ag.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},Ag.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},Ag.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},Ag.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},Ag.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},Ag.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},Ag.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},Ag.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},Ag.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},Ag.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},Ag.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},Pg.projections=Sg,Pg.projections.start();var zg=Pg("WGS84");function kg(t,e,i){var n,r,a;return Array.isArray(i)?(n=Fg(t,e,i)||{x:NaN,y:NaN},i.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name?"number"==typeof n.z?[n.x,n.y,n.z].concat(i.splice(3)):[n.x,n.y,i[2]].concat(i.splice(3)):[n.x,n.y].concat(i.splice(2)):[n.x,n.y]):(r=Fg(t,e,i),2===(a=Object.keys(i)).length?r:(a.forEach(function(n){if(void 0!==t.name&&"geocent"===t.name||void 0!==e.name&&"geocent"===e.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;r[n]=i[n]}),r))}function Bg(t){return t instanceof Pg?t:t.oProj?t.oProj:Pg(t)}function Ug(t,e,i){t=Bg(t);var n,r=!1;return void 0===e?(e=t,t=zg,r=!0):(void 0!==e.x||Array.isArray(e))&&(i=e,e=t,t=zg,r=!0),e=Bg(e),i?kg(t,e,i):(n={forward:function(i){return kg(t,e,i)},inverse:function(i){return kg(e,t,i)}},r&&(n.oProj=e),n)}var Gg=6,Hg="AJSAJS",jg="AFAFAF",Vg=65,Wg=73,qg=79,Xg=86,Yg=90,Zg={forward:Jg,inverse:function(t){var e=tv(nv(t.toUpperCase()));if(e.lat&&e.lon)return[e.lon,e.lat,e.lon,e.lat];return[e.left,e.bottom,e.right,e.top]},toPoint:Kg};function Jg(t,e){return e=e||5,function(t,e){var i="00000"+t.easting,n="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(d=t.easting,m=t.northing,f=t.zoneNumber,g=iv(f),v=Math.floor(d/1e5),y=Math.floor(m/1e5)%20,r=v,a=y,s=g,o=s-1,l=Hg.charCodeAt(o),h=jg.charCodeAt(o),c=l+r-1,u=h+a,p=!1,c>Yg&&(c=c-Yg+Vg-1,p=!0),(c===Wg||l<Wg&&c>Wg||(c>Wg||l<Wg)&&p)&&c++,(c===qg||l<qg&&c>qg||(c>qg||l<qg)&&p)&&++c===Wg&&c++,c>Yg&&(c=c-Yg+Vg-1),u>Xg?(u=u-Xg+Vg-1,p=!0):p=!1,(u===Wg||h<Wg&&u>Wg||(u>Wg||h<Wg)&&p)&&u++,(u===qg||h<qg&&u>qg||(u>qg||h<qg)&&p)&&++u===Wg&&u++,u>Xg&&(u=u-Xg+Vg-1),String.fromCharCode(c)+String.fromCharCode(u))+i.substr(i.length-5,e)+n.substr(n.length-5,e);var r,a,s,o,l,h,c,u,p;var d,m,f,g,v,y}(function(t){var e,i,n,r,a,s,o,l=t.lat,h=t.lon,c=6378137,u=Qg(l),p=Qg(h);o=Math.floor((h+180)/6)+1,180===h&&(o=60);l>=56&&l<64&&h>=3&&h<12&&(o=32);l>=72&&l<84&&(h>=0&&h<9?o=31:h>=9&&h<21?o=33:h>=21&&h<33?o=35:h>=33&&h<42&&(o=37));s=Qg(6*(o-1)-180+3),.006739496752268451,e=c/Math.sqrt(1-.00669438*Math.sin(u)*Math.sin(u)),i=Math.tan(u)*Math.tan(u),n=.006739496752268451*Math.cos(u)*Math.cos(u),r=Math.cos(u)*(p-s),a=c*(.9983242984503243*u-.002514607064228144*Math.sin(2*u)+2639046602129982e-21*Math.sin(4*u)-3.418046101696858e-9*Math.sin(6*u));var d=.9996*e*(r+(1-i+n)*r*r*r/6+(5-18*i+i*i+72*n-.39089081163157013)*r*r*r*r*r/120)+5e5,m=.9996*(a+e*Math.tan(u)*(r*r/2+(5-i+9*n+4*n*n)*r*r*r*r/24+(61-58*i+i*i+600*n-2.2240339282485886)*r*r*r*r*r*r/720));l<0&&(m+=1e7);return{northing:Math.round(m),easting:Math.round(d),zoneNumber:o,zoneLetter:ev(l)}}({lat:t[1],lon:t[0]}),e)}function Kg(t){var e=tv(nv(t.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function Qg(t){return t*(Math.PI/180)}function $g(t){return t/Math.PI*180}function tv(t){var e=t.northing,i=t.easting,n=t.zoneLetter,r=t.zoneNumber;if(r<0||r>60)return null;var a,s,o,l,h,c,u,p,d=6378137,m=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),f=i-5e5,g=e;n<"N"&&(g-=1e7),c=6*(r-1)-180+3,p=(u=g/.9996/6367449.145945056)+(3*m/2-27*m*m*m/32)*Math.sin(2*u)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*u)+151*m*m*m/96*Math.sin(6*u),a=d/Math.sqrt(1-.00669438*Math.sin(p)*Math.sin(p)),s=Math.tan(p)*Math.tan(p),o=.006739496752268451*Math.cos(p)*Math.cos(p),l=.99330562*d/Math.pow(1-.00669438*Math.sin(p)*Math.sin(p),1.5),h=f/(.9996*a);var v=p-a*Math.tan(p)/l*(h*h/2-(5+3*s+10*o-4*o*o-.06065547077041606)*h*h*h*h/24+(61+90*s+298*o+45*s*s-1.6983531815716497-3*o*o)*h*h*h*h*h*h/720);v=$g(v);var y,x=(h-(1+2*s+o)*h*h*h/6+(5-2*o+28*s-3*o*o+.05391597401814761+24*s*s)*h*h*h*h*h/120)/Math.cos(p);if(x=c+$g(x),t.accuracy){var b=tv({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});y={top:b.lat,right:b.lon,bottom:v,left:x}}else y={lat:v,lon:x};return y}function ev(t){var e="Z";return 84>=t&&t>=72?e="X":72>t&&t>=64?e="W":64>t&&t>=56?e="V":56>t&&t>=48?e="U":48>t&&t>=40?e="T":40>t&&t>=32?e="S":32>t&&t>=24?e="R":24>t&&t>=16?e="Q":16>t&&t>=8?e="P":8>t&&t>=0?e="N":0>t&&t>=-8?e="M":-8>t&&t>=-16?e="L":-16>t&&t>=-24?e="K":-24>t&&t>=-32?e="J":-32>t&&t>=-40?e="H":-40>t&&t>=-48?e="G":-48>t&&t>=-56?e="F":-56>t&&t>=-64?e="E":-64>t&&t>=-72?e="D":-72>t&&t>=-80&&(e="C"),e}function iv(t){var e=t%Gg;return 0===e&&(e=Gg),e}function nv(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var e,i=t.length,n=null,r="",a=0;!/[A-Z]/.test(e=t.charAt(a));){if(a>=2)throw"MGRSPoint bad conversion from: "+t;r+=e,a++}var s=parseInt(r,10);if(0===a||a+3>i)throw"MGRSPoint bad conversion from: "+t;var o=t.charAt(a++);if(o<="A"||"B"===o||"Y"===o||o>="Z"||"I"===o||"O"===o)throw"MGRSPoint zone letter "+o+" not handled: "+t;n=t.substring(a,a+=2);for(var l=iv(s),h=function(t,e){var i=Hg.charCodeAt(e-1),n=1e5,r=!1;for(;i!==t.charCodeAt(0);){if(++i===Wg&&i++,i===qg&&i++,i>Yg){if(r)throw"Bad character: "+t;i=Vg,r=!0}n+=1e5}return n}(n.charAt(0),l),c=function(t,e){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var i=jg.charCodeAt(e-1),n=0,r=!1;for(;i!==t.charCodeAt(0);){if(++i===Wg&&i++,i===qg&&i++,i>Xg){if(r)throw"Bad character: "+t;i=Vg,r=!0}n+=1e5}return n}(n.charAt(1),l);c<rv(o);)c+=2e6;var u=i-a;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var p,d,m,f=u/2,g=0,v=0;return f>0&&(p=1e5/Math.pow(10,f),d=t.substring(a,a+f),g=parseFloat(d)*p,m=t.substring(a+f),v=parseFloat(m)*p),{easting:g+h,northing:v+c,zoneLetter:o,zoneNumber:s,accuracy:p}}function rv(t){var e;switch(t){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+t}function av(t,e,i){if(!(this instanceof av))return new av(t,e,i);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===e){var n=t.split(",");this.x=parseFloat(n[0],10),this.y=parseFloat(n[1],10),this.z=parseFloat(n[2],10)||0}else this.x=t,this.y=e,this.z=i||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}av.fromMGRS=function(t){return new av(Kg(t))},av.prototype.toMGRS=function(t){return Jg([this.x,this.y],t)};var sv=1,ov=.25,lv=.046875,hv=.01953125,cv=.01068115234375,uv=.75,pv=.46875,dv=.013020833333333334,mv=.007120768229166667,fv=.3645833333333333,gv=.005696614583333333,vv=.3076171875;function yv(t){var e=[];e[0]=sv-t*(ov+t*(lv+t*(hv+t*cv))),e[1]=t*(uv-t*(lv+t*(hv+t*cv)));var i=t*t;return e[2]=i*(pv-t*(dv+t*mv)),i*=t,e[3]=i*(fv-t*gv),e[4]=i*t*vv,e}function xv(t,e,i,n){return i*=e,e*=e,n[0]*t-i*(n[1]+e*(n[2]+e*(n[3]+e*n[4])))}var bv=20;function wv(t,e,i){for(var n=1/(1-e),r=t,a=bv;a;--a){var s=Math.sin(r),o=1-e*s*s;if(r-=o=(xv(r,s,Math.cos(r),i)-t)*(o*Math.sqrt(o))*n,Math.abs(o)<Uf)return r}return r}var _v={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=yv(this.es),this.ml0=xv(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var e,i,n,r=t.x,a=t.y,s=gg(r-this.long0),o=Math.sin(a),l=Math.cos(a);if(this.es){var h=l*s,c=Math.pow(h,2),u=this.ep2*Math.pow(l,2),p=Math.pow(u,2),d=Math.abs(l)>Uf?Math.tan(a):0,m=Math.pow(d,2),f=Math.pow(m,2);e=1-this.es*Math.pow(o,2),h/=Math.sqrt(e);var g=xv(a,o,l,this.en);i=this.a*(this.k0*h*(1+c/6*(1-m+u+c/20*(5-18*m+f+14*u-58*m*u+c/42*(61+179*f-f*m-479*m)))))+this.x0,n=this.a*(this.k0*(g-this.ml0+o*s*h/2*(1+c/12*(5-m+9*u+4*p+c/30*(61+f-58*m+270*u-330*m*u+c/56*(1385+543*f-f*m-3111*m))))))+this.y0}else{var v=l*Math.sin(s);if(Math.abs(Math.abs(v)-1)<Uf)return 93;if(i=.5*this.a*this.k0*Math.log((1+v)/(1-v))+this.x0,n=l*Math.cos(s)/Math.sqrt(1-Math.pow(v,2)),(v=Math.abs(n))>=1){if(v-1>Uf)return 93;n=0}else n=Math.acos(n);a<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return t.x=i,t.y=n,t},inverse:function(t){var e,i,n,r,a=(t.x-this.x0)*(1/this.a),s=(t.y-this.y0)*(1/this.a);if(this.es)if(i=wv(e=this.ml0+s/this.k0,this.es,this.en),Math.abs(i)<Ff){var o=Math.sin(i),l=Math.cos(i),h=Math.abs(l)>Uf?Math.tan(i):0,c=this.ep2*Math.pow(l,2),u=Math.pow(c,2),p=Math.pow(h,2),d=Math.pow(p,2);e=1-this.es*Math.pow(o,2);var m=a*Math.sqrt(e)/this.k0,f=Math.pow(m,2);n=i-(e*=h)*f/(1-this.es)*.5*(1-f/12*(5+3*p-9*c*p+c-4*u-f/30*(61+90*p-252*c*p+45*d+46*c-f/56*(1385+3633*p+4095*d+1574*d*p)))),r=gg(this.long0+m*(1-f/6*(1+2*p+c-f/20*(5+28*p+24*d+8*c*p+6*c-f/42*(61+662*p+1320*d+720*d*p))))/l)}else n=Ff*fg(s),r=0;else{var g=Math.exp(a/this.k0),v=.5*(g-1/g),y=this.lat0+s/this.k0,x=Math.cos(y);e=Math.sqrt((1-Math.pow(x,2))/(1+Math.pow(v,2))),n=Math.asin(e),s<0&&(n=-n),r=0===v&&0===x?0:gg(Math.atan2(v,x)+this.long0)}return t.x=r,t.y=n,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]};function Mv(t){var e=Math.exp(t);return e=(e-1/e)/2}function Sv(t,e){t=Math.abs(t),e=Math.abs(e);var i=Math.max(t,e),n=Math.min(t,e)/(i||1);return i*Math.sqrt(1+Math.pow(n,2))}function Tv(t){var e=Math.abs(t);return e=function(t){var e=1+t,i=e-1;return 0===i?t:t*Math.log(e)/i}(e*(1+e/(Sv(1,e)+1))),t<0?-e:e}function Ev(t,e){for(var i,n=2*Math.cos(2*e),r=t.length-1,a=t[r],s=0;--r>=0;)i=n*a-s+t[r],s=a,a=i;return e+i*Math.sin(2*e)}function Av(t,e,i){for(var n,r,a=Math.sin(e),s=Math.cos(e),o=Mv(i),l=function(t){var e=Math.exp(t);return e=(e+1/e)/2}(i),h=2*s*l,c=-2*a*o,u=t.length-1,p=t[u],d=0,m=0,f=0;--u>=0;)n=m,r=d,p=h*(m=p)-n-c*(d=f)+t[u],f=c*m-r+h*d;return[(h=a*l)*p-(c=s*o)*f,h*f+c*p]}var Pv={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),e=t/(2-t),i=e;this.cgb[0]=e*(2+e*(-2/3+e*(e*(116/45+e*(26/45+e*(-2854/675)))-2))),this.cbg[0]=e*(e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))-2),i*=e,this.cgb[1]=i*(7/3+e*(e*(-227/45+e*(2704/315+e*(2323/945)))-1.6)),this.cbg[1]=i*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),i*=e,this.cgb[2]=i*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=i*(-26/15+e*(34/21+e*(1.6+e*(-12686/2835)))),i*=e,this.cgb[3]=i*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=i*(1237/630+e*(e*(-24832/14175)-2.4)),i*=e,this.cgb[4]=i*(4174/315+e*(-144838/6237)),this.cbg[4]=i*(-734/315+e*(109598/31185)),i*=e,this.cgb[5]=i*(601676/22275),this.cbg[5]=i*(444337/155925),i=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+i*(.25+i*(1/64+i/256))),this.utg[0]=e*(e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))-.5),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=i*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=i*(13/48+e*(e*(557/1440+e*(281/630+e*(-1983433/1935360)))-.6)),i*=e,this.utg[2]=i*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=i*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),i*=e,this.utg[3]=i*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=i*(49561/161280+e*(-179/168+e*(6601661/7257600))),i*=e,this.utg[4]=i*(-4583/161280+e*(108847/3991680)),this.gtu[4]=i*(34729/80640+e*(-3418889/1995840)),i*=e,this.utg[5]=-.03233083094085698*i,this.gtu[5]=.6650675310896665*i;var n=Ev(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(t,e){for(var i,n=2*Math.cos(e),r=t.length-1,a=t[r],s=0;--r>=0;)i=n*a-s+t[r],s=a,a=i;return Math.sin(e)*i}(this.gtu,2*n))},forward:function(t){var e=gg(t.x-this.long0),i=t.y;i=Ev(this.cbg,i);var n=Math.sin(i),r=Math.cos(i),a=Math.sin(e),s=Math.cos(e);i=Math.atan2(n,s*r),e=Math.atan2(a*r,Sv(n,r*s)),e=Tv(Math.tan(e));var o,l,h=Av(this.gtu,2*i,2*e);return i+=h[0],e+=h[1],Math.abs(e)<=2.623395162778?(o=this.a*(this.Qn*e)+this.x0,l=this.a*(this.Qn*i+this.Zb)+this.y0):(o=1/0,l=1/0),t.x=o,t.y=l,t},inverse:function(t){var e,i,n=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);if(r=(r-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var a=Av(this.utg,2*r,2*n);r+=a[0],n+=a[1],n=Math.atan(Mv(n));var s=Math.sin(r),o=Math.cos(r),l=Math.sin(n),h=Math.cos(n);r=Math.atan2(s*h,Sv(l,h*o)),e=gg((n=Math.atan2(l,h*o))+this.long0),i=Ev(this.cgb,r)}else e=1/0,i=1/0;return t.x=e,t.y=i,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]};var Lv={init:function(){var t=function(t,e){if(void 0===t){if((t=Math.floor(30*(gg(e)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Gf,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Pv.init.apply(this),this.forward=Pv.forward,this.inverse=Pv.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function Ov(t,e){return Math.pow((1-t)/(1+t),e)}var Cv=20;var Rv={init:function(){var t=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+jf)/(Math.pow(Math.tan(.5*this.lat0+jf),this.C)*Ov(this.e*t,this.ratexp))},forward:function(t){var e=t.x,i=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*i+jf),this.C)*Ov(this.e*Math.sin(i),this.ratexp))-Ff,t.x=this.C*e,t},inverse:function(t){for(var e=t.x/this.C,i=t.y,n=Math.pow(Math.tan(.5*i+jf)/this.K,1/this.C),r=Cv;r>0&&(i=2*Math.atan(n*Ov(this.e*Math.sin(t.y),-.5*this.e))-Ff,!(Math.abs(i-t.y)<1e-14));--r)t.y=i;return r?(t.x=e,t.y=i,t):null},names:["gauss"]};var Iv={init:function(){Rv.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var e,i,n,r;return t.x=gg(t.x-this.long0),Rv.forward.apply(this,[t]),e=Math.sin(t.y),i=Math.cos(t.y),n=Math.cos(t.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*i*n),t.x=r*i*Math.sin(t.x),t.y=r*(this.cosc0*e-this.sinc0*i*n),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var e,i,n,r,a;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,a=Math.sqrt(t.x*t.x+t.y*t.y)){var s=2*Math.atan2(a,this.R2);e=Math.sin(s),i=Math.cos(s),r=Math.asin(i*this.sinc0+t.y*e*this.cosc0/a),n=Math.atan2(t.x*e,a*this.cosc0*i-t.y*this.sinc0*e)}else r=this.phic0,n=0;return t.x=n,t.y=r,Rv.inverse.apply(this,[t]),t.x=gg(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var Dv={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Uf&&(this.k0=.5*(1+fg(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=Uf&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=Uf&&(this.k0=.5*this.cons*mg(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/vg(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=mg(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Ff,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var e,i,n,r,a,s,o=t.x,l=t.y,h=Math.sin(l),c=Math.cos(l),u=gg(o-this.long0);return Math.abs(Math.abs(o-this.long0)-Math.PI)<=Uf&&Math.abs(l+this.lat0)<=Uf?(t.x=NaN,t.y=NaN,t):this.sphere?(e=2*this.k0/(1+this.sinlat0*h+this.coslat0*c*Math.cos(u)),t.x=this.a*e*c*Math.sin(u)+this.x0,t.y=this.a*e*(this.coslat0*h-this.sinlat0*c*Math.cos(u))+this.y0,t):(i=2*Math.atan(this.ssfn_(l,h,this.e))-Ff,r=Math.cos(i),n=Math.sin(i),Math.abs(this.coslat0)<=Uf?(a=vg(this.e,l*this.con,this.con*h),s=2*this.a*this.k0*a/this.cons,t.x=this.x0+s*Math.sin(o-this.long0),t.y=this.y0-this.con*s*Math.cos(o-this.long0),t):(Math.abs(this.sinlat0)<Uf?(e=2*this.a*this.k0/(1+r*Math.cos(u)),t.y=e*n):(e=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*r*Math.cos(u))),t.y=e*(this.cosX0*n-this.sinX0*r*Math.cos(u))+this.y0),t.x=e*r*Math.sin(u)+this.x0,t))},inverse:function(t){var e,i,n,r,a;t.x-=this.x0,t.y-=this.y0;var s=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var o=2*Math.atan(s/(2*this.a*this.k0));return e=this.long0,i=this.lat0,s<=Uf?(t.x=e,t.y=i,t):(i=Math.asin(Math.cos(o)*this.sinlat0+t.y*Math.sin(o)*this.coslat0/s),e=Math.abs(this.coslat0)<Uf?this.lat0>0?gg(this.long0+Math.atan2(t.x,-1*t.y)):gg(this.long0+Math.atan2(t.x,t.y)):gg(this.long0+Math.atan2(t.x*Math.sin(o),s*this.coslat0*Math.cos(o)-t.y*this.sinlat0*Math.sin(o))),t.x=e,t.y=i,t)}if(Math.abs(this.coslat0)<=Uf){if(s<=Uf)return i=this.lat0,e=this.long0,t.x=e,t.y=i,t;t.x*=this.con,t.y*=this.con,n=s*this.cons/(2*this.a*this.k0),i=this.con*yg(this.e,n),e=this.con*gg(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else r=2*Math.atan(s*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,s<=Uf?a=this.X0:(a=Math.asin(Math.cos(r)*this.sinX0+t.y*Math.sin(r)*this.cosX0/s),e=gg(this.long0+Math.atan2(t.x*Math.sin(r),s*this.cosX0*Math.cos(r)-t.y*this.sinX0*Math.sin(r)))),i=-1*yg(this.e,Math.tan(.5*(Ff+a)));return t.x=e,t.y=i,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,e,i){return e*=i,Math.tan(.5*(Ff+t))*Math.pow((1-e)/(1+e),.5*i)}};var Nv={init:function(){var t=this.lat0;this.lambda0=this.long0;var e=Math.sin(t),i=this.a,n=1/this.rf,r=2*n-Math.pow(n,2),a=this.e=Math.sqrt(r);this.R=this.k0*i*Math.sqrt(1-r)/(1-r*Math.pow(e,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(e/this.alpha);var s=Math.log(Math.tan(Math.PI/4+this.b0/2)),o=Math.log(Math.tan(Math.PI/4+t/2)),l=Math.log((1+a*e)/(1-a*e));this.K=s-this.alpha*o+this.alpha*a/2*l},forward:function(t){var e=Math.log(Math.tan(Math.PI/4-t.y/2)),i=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),n=-this.alpha*(e+i)+this.K,r=2*(Math.atan(Math.exp(n))-Math.PI/4),a=this.alpha*(t.x-this.lambda0),s=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(a));return t.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,t.x=this.R*s+this.x0,t},inverse:function(t){for(var e=t.x-this.x0,i=t.y-this.y0,n=e/this.R,r=2*(Math.atan(Math.exp(i/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(n)),s=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(r))),o=this.lambda0+s/this.alpha,l=0,h=a,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return t.x=o,t.y=h,t},names:["somerc"]};var Fv={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),e=Math.cos(this.lat0),i=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(e,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-i*i);var n,r,a=vg(this.e,this.lat0,t),s=this.bl/e*Math.sqrt((1-this.es)/(1-i*i));if(s*s<1&&(s=1),isNaN(this.longc)){var o=vg(this.e,this.lat1,Math.sin(this.lat1)),l=vg(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(s+Math.sqrt(s*s-1))*Math.pow(a,this.bl):this.el=(s-Math.sqrt(s*s-1))*Math.pow(a,this.bl);var h=Math.pow(o,this.bl),c=Math.pow(l,this.bl);r=.5*((n=this.el/h)-1/n);var u=(this.el*this.el-c*h)/(this.el*this.el+c*h),p=(c-h)/(c+h),d=gg(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(u*Math.tan(.5*this.bl*d)/p)/this.bl,this.long0=gg(this.long0);var m=gg(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*m)/r),this.alpha=Math.asin(s*Math.sin(this.gamma0))}else n=this.lat0>=0?s+Math.sqrt(s*s-1):s-Math.sqrt(s*s-1),this.el=n*Math.pow(a,this.bl),r=.5*(n-1/n),this.gamma0=Math.asin(Math.sin(this.alpha)/s),this.long0=this.longc-Math.asin(r*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(s*s-1),Math.cos(this.alpha))},forward:function(t){var e,i,n,r=t.x,a=t.y,s=gg(r-this.long0);if(Math.abs(Math.abs(a)-Ff)<=Uf)n=a>0?-1:1,i=this.al/this.bl*Math.log(Math.tan(jf+n*this.gamma0*.5)),e=-1*n*Ff*this.al/this.bl;else{var o=vg(this.e,a,Math.sin(a)),l=this.el/Math.pow(o,this.bl),h=.5*(l-1/l),c=.5*(l+1/l),u=Math.sin(this.bl*s),p=(h*Math.sin(this.gamma0)-u*Math.cos(this.gamma0))/c;i=Math.abs(Math.abs(p)-1)<=Uf?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-p)/(1+p))/this.bl,e=Math.abs(Math.cos(this.bl*s))<=Uf?this.al*this.bl*s:this.al*Math.atan2(h*Math.cos(this.gamma0)+u*Math.sin(this.gamma0),Math.cos(this.bl*s))/this.bl}return this.no_rot?(t.x=this.x0+e,t.y=this.y0+i):(e-=this.uc,t.x=this.x0+i*Math.cos(this.alpha)+e*Math.sin(this.alpha),t.y=this.y0+e*Math.cos(this.alpha)-i*Math.sin(this.alpha)),t},inverse:function(t){var e,i;this.no_rot?(i=t.y-this.y0,e=t.x-this.x0):(i=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),e=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),e+=this.uc);var n=Math.exp(-1*this.bl*i/this.al),r=.5*(n-1/n),a=.5*(n+1/n),s=Math.sin(this.bl*e/this.al),o=(s*Math.cos(this.gamma0)+r*Math.sin(this.gamma0))/a,l=Math.pow(this.el/Math.sqrt((1+o)/(1-o)),1/this.bl);return Math.abs(o-1)<Uf?(t.x=this.long0,t.y=Ff):Math.abs(o+1)<Uf?(t.x=this.long0,t.y=-1*Ff):(t.y=yg(this.e,l),t.x=gg(this.long0-Math.atan2(r*Math.cos(this.gamma0)-s*Math.sin(this.gamma0),Math.cos(this.bl*e/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]};var zv={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<Uf)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var e=Math.sin(this.lat1),i=Math.cos(this.lat1),n=mg(this.e,e,i),r=vg(this.e,this.lat1,e),a=Math.sin(this.lat2),s=Math.cos(this.lat2),o=mg(this.e,a,s),l=vg(this.e,this.lat2,a),h=vg(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>Uf?this.ns=Math.log(n/o)/Math.log(r/l):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=n/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var e=t.x,i=t.y;Math.abs(2*Math.abs(i)-Math.PI)<=Uf&&(i=fg(i)*(Ff-2*Uf));var n,r,a=Math.abs(Math.abs(i)-Ff);if(a>Uf)n=vg(this.e,i,Math.sin(i)),r=this.a*this.f0*Math.pow(n,this.ns);else{if((a=i*this.ns)<=0)return null;r=0}var s=this.ns*gg(e-this.long0);return t.x=this.k0*(r*Math.sin(s))+this.x0,t.y=this.k0*(this.rh-r*Math.cos(s))+this.y0,t},inverse:function(t){var e,i,n,r,a,s=(t.x-this.x0)/this.k0,o=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(s*s+o*o),i=1):(e=-Math.sqrt(s*s+o*o),i=-1);var l=0;if(0!==e&&(l=Math.atan2(i*s,i*o)),0!==e||this.ns>0){if(i=1/this.ns,n=Math.pow(e/(this.a*this.f0),i),-9999===(r=yg(this.e,n)))return null}else r=-Ff;return a=gg(l/this.ns+this.long0),t.x=a,t.y=r,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]};var kv={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var e,i,n,r,a,s,o,l=t.x,h=t.y,c=gg(l-this.long0);return e=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),i=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/e)-this.s45),n=-c*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(i)+Math.sin(this.ad)*Math.cos(i)*Math.cos(n)),a=Math.asin(Math.cos(i)*Math.sin(n)/Math.cos(r)),s=this.n*a,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),t.y=o*Math.cos(s)/1,t.x=o*Math.sin(s)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var e,i,n,r,a,s,o,l=t.x;t.x=t.y,t.y=l,this.czech||(t.y*=-1,t.x*=-1),a=Math.sqrt(t.x*t.x+t.y*t.y),r=Math.atan2(t.y,t.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(r)),i=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(e)),t.x=this.long0-i/this.alfa,s=e,o=0;var h=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(s))/(1-this.e*Math.sin(s)),this.e/2))-this.s45),Math.abs(s-t.y)<1e-10&&(o=1),s=t.y,h+=1}while(0===o&&h<15);return h>=15?null:t},names:["Krovak","krovak"]};function Bv(t,e,i,n,r){return t*r-e*Math.sin(2*r)+i*Math.sin(4*r)-n*Math.sin(6*r)}function Uv(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Gv(t){return.375*t*(1+.25*t*(1+.46875*t))}function Hv(t){return.05859375*t*t*(1+.75*t)}function jv(t){return t*t*t*(35/3072)}function Vv(t,e,i){var n=e*i;return t/Math.sqrt(1-n*n)}function Wv(t){return Math.abs(t)<Ff?t:t-fg(t)*Math.PI}function qv(t,e,i,n,r){var a,s;a=t/e;for(var o=0;o<15;o++)if(a+=s=(t-(e*a-i*Math.sin(2*a)+n*Math.sin(4*a)-r*Math.sin(6*a)))/(e-2*i*Math.cos(2*a)+4*n*Math.cos(4*a)-6*r*Math.cos(6*a)),Math.abs(s)<=1e-10)return a;return NaN}var Xv={init:function(){this.sphere||(this.e0=Uv(this.es),this.e1=Gv(this.es),this.e2=Hv(this.es),this.e3=jv(this.es),this.ml0=this.a*Bv(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var e,i,n=t.x,r=t.y;if(n=gg(n-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(n)),i=this.a*(Math.atan2(Math.tan(r),Math.cos(n))-this.lat0);else{var a=Math.sin(r),s=Math.cos(r),o=Vv(this.a,this.e,a),l=Math.tan(r)*Math.tan(r),h=n*Math.cos(r),c=h*h,u=this.es*s*s/(1-this.es);e=o*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),i=this.a*Bv(this.e0,this.e1,this.e2,this.e3,r)-this.ml0+o*a/s*c*(.5+(5-l+6*u)*c/24)}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n=t.x/this.a,r=t.y/this.a;if(this.sphere){var a=r+this.lat0;e=Math.asin(Math.sin(a)*Math.cos(n)),i=Math.atan2(Math.tan(n),Math.cos(a))}else{var s=qv(this.ml0/this.a+r,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(s)-Ff)<=Uf)return t.x=this.long0,t.y=Ff,r<0&&(t.y*=-1),t;var o=Vv(this.a,this.e,Math.sin(s)),l=o*o*o/this.a/this.a*(1-this.es),h=Math.pow(Math.tan(s),2),c=n*this.a/o,u=c*c;e=s-o*Math.tan(s)/l*c*c*(.5-(1+3*h)*c*c/24),i=c*(1-u*(h/3+(1+3*h)*h*u/15))/Math.cos(s)}return t.x=gg(i+this.long0),t.y=Wv(e),t},names:["Cassini","Cassini_Soldner","cass"]};function Yv(t,e){var i;return t>1e-7?(1-t*t)*(e/(1-(i=t*e)*i)-.5/t*Math.log((1-i)/(1+i))):2*e}var Zv=.3333333333333333,Jv=.17222222222222222,Kv=.10257936507936508,Qv=.06388888888888888,$v=.0664021164021164,ty=.016415012942191543;var ey={init:function(){var t,e=Math.abs(this.lat0);if(Math.abs(e-Ff)<Uf?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Uf?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=Yv(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var e,i=[];return i[0]=t*Zv,e=t*t,i[0]+=e*Jv,i[1]=e*Qv,e*=t,i[0]+=e*Kv,i[1]+=e*$v,i[2]=e*ty,i}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Yv(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var e,i,n,r,a,s,o,l,h,c,u=t.x,p=t.y;if(u=gg(u-this.long0),this.sphere){if(a=Math.sin(p),c=Math.cos(p),n=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((i=this.mode===this.EQUIT?1+c*n:1+this.sinph0*a+this.cosph0*c*n)<=Uf)return null;e=(i=Math.sqrt(2/i))*c*Math.sin(u),i*=this.mode===this.EQUIT?a:this.cosph0*a-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(p+this.lat0)<Uf)return null;i=jf-.5*p,e=(i=2*(this.mode===this.S_POLE?Math.cos(i):Math.sin(i)))*Math.sin(u),i*=n}}else{switch(o=0,l=0,h=0,n=Math.cos(u),r=Math.sin(u),a=Math.sin(p),s=Yv(this.e,a),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(o=s/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*n;break;case this.EQUIT:h=1+l*n;break;case this.N_POLE:h=Ff+p,s=this.qp-s;break;case this.S_POLE:h=p-Ff,s=this.qp+s}if(Math.abs(h)<Uf)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),i=this.mode===this.OBLIQ?this.ymf*h*(this.cosb1*o-this.sinb1*l*n):(h=Math.sqrt(2/(1+l*n)))*o*this.ymf,e=this.xmf*h*l*r;break;case this.N_POLE:case this.S_POLE:s>=0?(e=(h=Math.sqrt(s))*r,i=n*(this.mode===this.S_POLE?h:-h)):e=i=0}}return t.x=this.a*e+this.x0,t.y=this.a*i+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e,i,n,r,a,s,o,l,h,c,u=t.x/this.a,p=t.y/this.a;if(this.sphere){var d,m=0,f=0;if((i=.5*(d=Math.sqrt(u*u+p*p)))>1)return null;switch(i=2*Math.asin(i),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(f=Math.sin(i),m=Math.cos(i)),this.mode){case this.EQUIT:i=Math.abs(d)<=Uf?0:Math.asin(p*f/d),u*=f,p=m*d;break;case this.OBLIQ:i=Math.abs(d)<=Uf?this.lat0:Math.asin(m*this.sinph0+p*f*this.cosph0/d),u*=f*this.cosph0,p=(m-Math.sin(i)*this.sinph0)*d;break;case this.N_POLE:p=-p,i=Ff-i;break;case this.S_POLE:i-=Ff}e=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(u,p):0}else{if(o=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(u/=this.dd,p*=this.dd,(s=Math.sqrt(u*u+p*p))<Uf)return t.x=this.long0,t.y=this.lat0,t;r=2*Math.asin(.5*s/this.rq),n=Math.cos(r),u*=r=Math.sin(r),this.mode===this.OBLIQ?(o=n*this.sinb1+p*r*this.cosb1/s,a=this.qp*o,p=s*this.cosb1*n-p*this.sinb1*r):(o=p*r/s,a=this.qp*o,p=s*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(a=u*u+p*p))return t.x=this.long0,t.y=this.lat0,t;o=1-a/this.qp,this.mode===this.S_POLE&&(o=-o)}e=Math.atan2(u,p),l=Math.asin(o),h=this.apa,c=l+l,i=l+h[0]*Math.sin(c)+h[1]*Math.sin(c+c)+h[2]*Math.sin(c+c+c)}return t.x=gg(this.long0+e),t.y=i,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function iy(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}var ny={init:function(){Math.abs(this.lat1+this.lat2)<Uf||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=mg(this.e3,this.sin_po,this.cos_po),this.qs1=Yv(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=mg(this.e3,this.sin_po,this.cos_po),this.qs2=Yv(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Yv(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>Uf?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var e=t.x,i=t.y;this.sin_phi=Math.sin(i),this.cos_phi=Math.cos(i);var n=Yv(this.e3,this.sin_phi,this.cos_phi),r=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*gg(e-this.long0),s=r*Math.sin(a)+this.x0,o=this.rh-r*Math.cos(a)+this.y0;return t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r,a,s;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(e=Math.sqrt(t.x*t.x+t.y*t.y),n=1):(e=-Math.sqrt(t.x*t.x+t.y*t.y),n=-1),r=0,0!==e&&(r=Math.atan2(n*t.x,n*t.y)),n=e*this.ns0/this.a,this.sphere?s=Math.asin((this.c-n*n)/(2*this.ns0)):(i=(this.c-n*n)/this.ns0,s=this.phi1z(this.e3,i)),a=gg(r/this.ns0+this.long0),t.x=a,t.y=s,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,e){var i,n,r,a,s=iy(.5*e);if(t<Uf)return s;for(var o=t*t,l=1;l<=25;l++)if(s+=a=.5*(r=1-(n=t*(i=Math.sin(s)))*n)*r/Math.cos(s)*(e/(1-o)-i/r+.5/t*Math.log((1-n)/(1+n))),Math.abs(a)<=1e-7)return s;return null}};var ry={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var e,i,n,r,a,s,o,l=t.x,h=t.y;return n=gg(l-this.long0),e=Math.sin(h),i=Math.cos(h),r=Math.cos(n),(a=this.sin_p14*e+this.cos_p14*i*r)>0||Math.abs(a)<=Uf?(s=this.x0+1*this.a*i*Math.sin(n)/a,o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*r)/a):(s=this.x0+this.infinity_dist*i*Math.sin(n),o=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*i*r)),t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r,a,s;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(e=Math.sqrt(t.x*t.x+t.y*t.y))?(r=Math.atan2(e,this.rc),i=Math.sin(r),s=iy((n=Math.cos(r))*this.sin_p14+t.y*i*this.cos_p14/e),a=Math.atan2(t.x*i,e*this.cos_p14*n-t.y*this.sin_p14*i),a=gg(this.long0+a)):(s=this.phic0,a=0),t.x=a,t.y=s,t},names:["gnom"]};var ay={init:function(){this.sphere||(this.k0=mg(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var e,i,n=t.x,r=t.y,a=gg(n-this.long0);if(this.sphere)e=this.x0+this.a*a*Math.cos(this.lat_ts),i=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);else{var s=Yv(this.e,Math.sin(r));e=this.x0+this.a*this.k0*a,i=this.y0+this.a*s*.5/this.k0}return t.x=e,t.y=i,t},inverse:function(t){var e,i;return t.x-=this.x0,t.y-=this.y0,this.sphere?(e=gg(this.long0+t.x/this.a/Math.cos(this.lat_ts)),i=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(i=function(t,e){var i=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(e)-i)<1e-6)return e<0?-1*Ff:Ff;for(var n,r,a,s,o=Math.asin(.5*e),l=0;l<30;l++)if(r=Math.sin(o),a=Math.cos(o),s=t*r,o+=n=Math.pow(1-s*s,2)/(2*a)*(e/(1-t*t)-r/(1-s*s)+.5/t*Math.log((1-s)/(1+s))),Math.abs(n)<=1e-10)return o;return NaN}(this.e,2*t.y*this.k0/this.a),e=gg(this.long0+t.x/(this.a*this.k0))),t.x=e,t.y=i,t},names:["cea"]};var sy={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var e=t.x,i=t.y,n=gg(e-this.long0),r=Wv(i-this.lat0);return t.x=this.x0+this.a*n*this.rc,t.y=this.y0+this.a*r,t},inverse:function(t){var e=t.x,i=t.y;return t.x=gg(this.long0+(e-this.x0)/(this.a*this.rc)),t.y=Wv(this.lat0+(i-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},oy=20;var ly={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Uv(this.es),this.e1=Gv(this.es),this.e2=Hv(this.es),this.e3=jv(this.es),this.ml0=this.a*Bv(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var e,i,n,r=t.x,a=t.y,s=gg(r-this.long0);if(n=s*Math.sin(a),this.sphere)Math.abs(a)<=Uf?(e=this.a*s,i=-1*this.a*this.lat0):(e=this.a*Math.sin(n)/Math.tan(a),i=this.a*(Wv(a-this.lat0)+(1-Math.cos(n))/Math.tan(a)));else if(Math.abs(a)<=Uf)e=this.a*s,i=-1*this.ml0;else{var o=Vv(this.a,this.e,Math.sin(a))/Math.tan(a);e=o*Math.sin(n),i=this.a*Bv(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+o*(1-Math.cos(n))}return t.x=e+this.x0,t.y=i+this.y0,t},inverse:function(t){var e,i,n,r,a,s,o,l,h;if(n=t.x-this.x0,r=t.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=Uf)e=gg(n/this.a+this.long0),i=0;else{var c;for(s=this.lat0+r/this.a,o=n*n/this.a/this.a+s*s,l=s,a=oy;a;--a)if(l+=h=-1*(s*(l*(c=Math.tan(l))+1)-l-.5*(l*l+o)*c)/((l-s)/c-1),Math.abs(h)<=Uf){i=l;break}e=gg(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(i))}else if(Math.abs(r+this.ml0)<=Uf)i=0,e=gg(this.long0+n/this.a);else{var u,p,d,m,f;for(s=(this.ml0+r)/this.a,o=n*n/this.a/this.a+s*s,l=s,a=oy;a;--a)if(f=this.e*Math.sin(l),u=Math.sqrt(1-f*f)*Math.tan(l),p=this.a*Bv(this.e0,this.e1,this.e2,this.e3,l),d=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),l-=h=(s*(u*(m=p/this.a)+1)-m-.5*u*(m*m+o))/(this.es*Math.sin(2*l)*(m*m+o-2*s*m)/(4*u)+(s-m)*(u*d-2/Math.sin(2*l))-d),Math.abs(h)<=Uf){i=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(i),2))*Math.tan(i),e=gg(this.long0+Math.asin(n*u/this.a)/Math.sin(i))}return t.x=e,t.y=i,t},names:["Polyconic","poly"]};var hy={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var e,i=t.x,n=t.y-this.lat0,r=i-this.long0,a=n/Nf*1e-5,s=r,o=1,l=0;for(e=1;e<=10;e++)o*=a,l+=this.A[e]*o;var h,c=l,u=s,p=1,d=0,m=0,f=0;for(e=1;e<=6;e++)h=d*c+p*u,p=p*c-d*u,d=h,m=m+this.B_re[e]*p-this.B_im[e]*d,f=f+this.B_im[e]*p+this.B_re[e]*d;return t.x=f*this.a+this.x0,t.y=m*this.a+this.y0,t},inverse:function(t){var e,i,n=t.x,r=t.y,a=n-this.x0,s=(r-this.y0)/this.a,o=a/this.a,l=1,h=0,c=0,u=0;for(e=1;e<=6;e++)i=h*s+l*o,l=l*s-h*o,h=i,c=c+this.C_re[e]*l-this.C_im[e]*h,u=u+this.C_im[e]*l+this.C_re[e]*h;for(var p=0;p<this.iterations;p++){var d,m=c,f=u,g=s,v=o;for(e=2;e<=6;e++)d=f*c+m*u,m=m*c-f*u,f=d,g+=(e-1)*(this.B_re[e]*m-this.B_im[e]*f),v+=(e-1)*(this.B_im[e]*m+this.B_re[e]*f);m=1,f=0;var y=this.B_re[1],x=this.B_im[1];for(e=2;e<=6;e++)d=f*c+m*u,m=m*c-f*u,f=d,y+=e*(this.B_re[e]*m-this.B_im[e]*f),x+=e*(this.B_im[e]*m+this.B_re[e]*f);var b=y*y+x*x;c=(g*y+v*x)/b,u=(v*y-g*x)/b}var w=c,_=u,M=1,S=0;for(e=1;e<=9;e++)M*=w,S+=this.D[e]*M;var T=this.lat0+S*Nf*1e5,E=this.long0+_;return t.x=E,t.y=T,t},names:["New_Zealand_Map_Grid","nzmg"]};var cy={init:function(){},forward:function(t){var e=t.x,i=t.y,n=gg(e-this.long0),r=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Math.PI/4+i/2.5))*1.25;return t.x=r,t.y=a,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var e=gg(this.long0+t.x/this.a),i=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=e,t.y=i,t},names:["Miller_Cylindrical","mill"]},uy=20;var py={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=yv(this.es)},forward:function(t){var e,i,n=t.x,r=t.y;if(n=gg(n-this.long0),this.sphere){if(this.m)for(var a=this.n*Math.sin(r),s=uy;s;--s){var o=(this.m*r+Math.sin(r)-a)/(this.m+Math.cos(r));if(r-=o,Math.abs(o)<Uf)break}else r=1!==this.n?Math.asin(this.n*Math.sin(r)):r;e=this.a*this.C_x*n*(this.m+Math.cos(r)),i=this.a*this.C_y*r}else{var l=Math.sin(r),h=Math.cos(r);i=this.a*xv(r,l,h,this.en),e=this.a*n*h/Math.sqrt(1-this.es*l*l)}return t.x=e,t.y=i,t},inverse:function(t){var e,i,n;return t.x-=this.x0,i=t.x/this.a,t.y-=this.y0,e=t.y/this.a,this.sphere?(e/=this.C_y,i/=this.C_x*(this.m+Math.cos(e)),this.m?e=iy((this.m*e+Math.sin(e))/this.n):1!==this.n&&(e=iy(Math.sin(e)/this.n)),i=gg(i+this.long0),e=Wv(e)):(e=wv(t.y/this.a,this.es,this.en),(n=Math.abs(e))<Ff?(n=Math.sin(e),i=gg(this.long0+t.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(e)))):n-Uf<Ff&&(i=this.long0)),t.x=i,t.y=e,t},names:["Sinusoidal","sinu"]};var dy={init:function(){},forward:function(t){for(var e=t.x,i=t.y,n=gg(e-this.long0),r=i,a=Math.PI*Math.sin(i);;){var s=-(r+Math.sin(r)-a)/(1+Math.cos(r));if(r+=s,Math.abs(s)<Uf)break}r/=2,Math.PI/2-Math.abs(i)<Uf&&(n=0);var o=.900316316158*this.a*n*Math.cos(r)+this.x0,l=1.4142135623731*this.a*Math.sin(r)+this.y0;return t.x=o,t.y=l,t},inverse:function(t){var e,i;t.x-=this.x0,t.y-=this.y0,i=t.y/(1.4142135623731*this.a),Math.abs(i)>.999999999999&&(i=.999999999999),e=Math.asin(i);var n=gg(this.long0+t.x/(.900316316158*this.a*Math.cos(e)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),i=(2*e+Math.sin(2*e))/Math.PI,Math.abs(i)>1&&(i=1);var r=Math.asin(i);return t.x=n,t.y=r,t},names:["Mollweide","moll"]};var my={init:function(){Math.abs(this.lat1+this.lat2)<Uf||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Uv(this.es),this.e1=Gv(this.es),this.e2=Hv(this.es),this.e3=jv(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=mg(this.e,this.sinphi,this.cosphi),this.ml1=Bv(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<Uf?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=mg(this.e,this.sinphi,this.cosphi),this.ml2=Bv(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Bv(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var e,i=t.x,n=t.y;if(this.sphere)e=this.a*(this.g-n);else{var r=Bv(this.e0,this.e1,this.e2,this.e3,n);e=this.a*(this.g-r)}var a=this.ns*gg(i-this.long0),s=this.x0+e*Math.sin(a),o=this.y0+this.rh-e*Math.cos(a);return t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1);var a=0;return 0!==i&&(a=Math.atan2(e*t.x,e*t.y)),this.sphere?(r=gg(this.long0+a/this.ns),n=Wv(this.g-i/this.a),t.x=r,t.y=n,t):(n=qv(this.g-i/this.a,this.e0,this.e1,this.e2,this.e3),r=gg(this.long0+a/this.ns),t.x=r,t.y=n,t)},names:["Equidistant_Conic","eqdc"]};var fy={init:function(){this.R=this.a},forward:function(t){var e,i,n=t.x,r=t.y,a=gg(n-this.long0);Math.abs(r)<=Uf&&(e=this.x0+this.R*a,i=this.y0);var s=iy(2*Math.abs(r/Math.PI));(Math.abs(a)<=Uf||Math.abs(Math.abs(r)-Ff)<=Uf)&&(e=this.x0,i=r>=0?this.y0+Math.PI*this.R*Math.tan(.5*s):this.y0+Math.PI*this.R*-Math.tan(.5*s));var o=.5*Math.abs(Math.PI/a-a/Math.PI),l=o*o,h=Math.sin(s),c=Math.cos(s),u=c/(h+c-1),p=u*u,d=u*(2/h-1),m=d*d,f=Math.PI*this.R*(o*(u-m)+Math.sqrt(l*(u-m)*(u-m)-(m+l)*(p-m)))/(m+l);a<0&&(f=-f),e=this.x0+f;var g=l+u;return f=Math.PI*this.R*(d*g-o*Math.sqrt((m+l)*(l+1)-g*g))/(m+l),i=r>=0?this.y0+f:this.y0-f,t.x=e,t.y=i,t},inverse:function(t){var e,i,n,r,a,s,o,l,h,c,u,p;return t.x-=this.x0,t.y-=this.y0,u=Math.PI*this.R,a=(n=t.x/u)*n+(r=t.y/u)*r,u=3*(r*r/(l=-2*(s=-Math.abs(r)*(1+a))+1+2*r*r+a*a)+(2*(o=s-2*r*r+n*n)*o*o/l/l/l-9*s*o/l/l)/27)/(h=(s-o*o/3/l)/l)/(c=2*Math.sqrt(-h/3)),Math.abs(u)>1&&(u=u>=0?1:-1),p=Math.acos(u)/3,i=t.y>=0?(-c*Math.cos(p+Math.PI/3)-o/3/l)*Math.PI:-(-c*Math.cos(p+Math.PI/3)-o/3/l)*Math.PI,e=Math.abs(n)<Uf?this.long0:gg(this.long0+Math.PI*(a-1+Math.sqrt(1+2*(n*n-r*r)+a*a))/2/n),t.x=e,t.y=i,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var gy={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var e,i,n,r,a,s,o,l,h,c,u,p,d,m,f,g,v,y,x,b,w,_,M=t.x,S=t.y,T=Math.sin(t.y),E=Math.cos(t.y),A=gg(M-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=Uf?(t.x=this.x0+this.a*(Ff-S)*Math.sin(A),t.y=this.y0-this.a*(Ff-S)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=Uf?(t.x=this.x0+this.a*(Ff+S)*Math.sin(A),t.y=this.y0+this.a*(Ff+S)*Math.cos(A),t):(y=this.sin_p12*T+this.cos_p12*E*Math.cos(A),v=(g=Math.acos(y))?g/Math.sin(g):1,t.x=this.x0+this.a*v*E*Math.sin(A),t.y=this.y0+this.a*v*(this.cos_p12*T-this.sin_p12*E*Math.cos(A)),t):(e=Uv(this.es),i=Gv(this.es),n=Hv(this.es),r=jv(this.es),Math.abs(this.sin_p12-1)<=Uf?(a=this.a*Bv(e,i,n,r,Ff),s=this.a*Bv(e,i,n,r,S),t.x=this.x0+(a-s)*Math.sin(A),t.y=this.y0-(a-s)*Math.cos(A),t):Math.abs(this.sin_p12+1)<=Uf?(a=this.a*Bv(e,i,n,r,Ff),s=this.a*Bv(e,i,n,r,S),t.x=this.x0+(a+s)*Math.sin(A),t.y=this.y0+(a+s)*Math.cos(A),t):(o=T/E,l=Vv(this.a,this.e,this.sin_p12),h=Vv(this.a,this.e,T),c=Math.atan((1-this.es)*o+this.es*l*this.sin_p12/(h*E)),x=0===(u=Math.atan2(Math.sin(A),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(A)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(u)-Math.PI)<=Uf?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(A)*Math.cos(c)/Math.sin(u)),p=this.e*this.sin_p12/Math.sqrt(1-this.es),g=l*x*(1-(b=x*x)*(f=(d=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es))*d)*(1-f)/6+(w=b*x)/8*(m=p*d)*(1-2*f)+(_=w*x)/120*(f*(4-7*f)-3*p*p*(1-7*f))-_*x/48*m),t.x=this.x0+g*Math.sin(u),t.y=this.y0+g*Math.cos(u),t))},inverse:function(t){var e,i,n,r,a,s,o,l,h,c,u,p,d,m,f,g,v,y,x,b,w,_,M;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((e=Math.sqrt(t.x*t.x+t.y*t.y))>2*Ff*this.a)return;return i=e/this.a,n=Math.sin(i),r=Math.cos(i),a=this.long0,Math.abs(e)<=Uf?s=this.lat0:(s=iy(r*this.sin_p12+t.y*n*this.cos_p12/e),o=Math.abs(this.lat0)-Ff,a=Math.abs(o)<=Uf?this.lat0>=0?gg(this.long0+Math.atan2(t.x,-t.y)):gg(this.long0-Math.atan2(-t.x,t.y)):gg(this.long0+Math.atan2(t.x*n,e*this.cos_p12*r-t.y*this.sin_p12*n))),t.x=a,t.y=s,t}return l=Uv(this.es),h=Gv(this.es),c=Hv(this.es),u=jv(this.es),Math.abs(this.sin_p12-1)<=Uf?(s=qv(((p=this.a*Bv(l,h,c,u,Ff))-(e=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,l,h,c,u),a=gg(this.long0+Math.atan2(t.x,-1*t.y)),t.x=a,t.y=s,t):Math.abs(this.sin_p12+1)<=Uf?(p=this.a*Bv(l,h,c,u,Ff),s=qv(((e=Math.sqrt(t.x*t.x+t.y*t.y))-p)/this.a,l,h,c,u),a=gg(this.long0+Math.atan2(t.x,t.y)),t.x=a,t.y=s,t):(e=Math.sqrt(t.x*t.x+t.y*t.y),f=Math.atan2(t.x,t.y),d=Vv(this.a,this.e,this.sin_p12),g=Math.cos(f),y=-(v=this.e*this.cos_p12*g)*v/(1-this.es),x=3*this.es*(1-y)*this.sin_p12*this.cos_p12*g/(1-this.es),_=1-y*(w=(b=e/d)-y*(1+y)*Math.pow(b,3)/6-x*(1+3*y)*Math.pow(b,4)/24)*w/2-b*w*w*w/6,m=Math.asin(this.sin_p12*Math.cos(w)+this.cos_p12*Math.sin(w)*g),a=gg(this.long0+Math.asin(Math.sin(f)*Math.sin(w)/Math.cos(m))),M=Math.sin(m),s=Math.atan2((M-this.es*_*this.sin_p12)*Math.tan(m),M*(1-this.es)),t.x=a,t.y=s,t)},names:["Azimuthal_Equidistant","aeqd"]};var vy={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var e,i,n,r,a,s,o,l=t.x,h=t.y;return n=gg(l-this.long0),e=Math.sin(h),i=Math.cos(h),r=Math.cos(n),((a=this.sin_p14*e+this.cos_p14*i*r)>0||Math.abs(a)<=Uf)&&(s=1*this.a*i*Math.sin(n),o=this.y0+1*this.a*(this.cos_p14*e-this.sin_p14*i*r)),t.x=s,t.y=o,t},inverse:function(t){var e,i,n,r,a,s,o;return t.x-=this.x0,t.y-=this.y0,i=iy((e=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),n=Math.sin(i),r=Math.cos(i),s=this.long0,Math.abs(e)<=Uf?(o=this.lat0,t.x=s,t.y=o,t):(o=iy(r*this.sin_p14+t.y*n*this.cos_p14/e),a=Math.abs(this.lat0)-Ff,Math.abs(a)<=Uf?(s=this.lat0>=0?gg(this.long0+Math.atan2(t.x,-t.y)):gg(this.long0-Math.atan2(-t.x,t.y)),t.x=s,t.y=o,t):(s=gg(this.long0+Math.atan2(t.x*n,e*this.cos_p14*r-t.y*this.sin_p14*n)),t.x=s,t.y=o,t))},names:["ortho"]},yy={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},xy={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function by(t,e,i,n){var r;return t<Uf?(n.value=xy.AREA_0,r=0):(r=Math.atan2(e,i),Math.abs(r)<=jf?n.value=xy.AREA_0:r>jf&&r<=Ff+jf?(n.value=xy.AREA_1,r-=Ff):r>Ff+jf||r<=-(Ff+jf)?(n.value=xy.AREA_2,r=r>=0?r-Wf:r+Wf):(n.value=xy.AREA_3,r+=Ff)),r}function wy(t,e){var i=t+e;return i<-Wf?i+=Vf:i>+Wf&&(i-=Vf),i}var _y={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Ff-jf/2?this.face=yy.TOP:this.lat0<=-(Ff-jf/2)?this.face=yy.BOTTOM:Math.abs(this.long0)<=jf?this.face=yy.FRONT:Math.abs(this.long0)<=Ff+jf?this.face=this.long0>0?yy.RIGHT:yy.LEFT:this.face=yy.BACK,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var e,i,n,r,a,s,o={x:0,y:0},l={value:0};if(t.x-=this.long0,e=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,i=t.x,this.face===yy.TOP)r=Ff-e,i>=jf&&i<=Ff+jf?(l.value=xy.AREA_0,n=i-Ff):i>Ff+jf||i<=-(Ff+jf)?(l.value=xy.AREA_1,n=i>0?i-Wf:i+Wf):i>-(Ff+jf)&&i<=-jf?(l.value=xy.AREA_2,n=i+Ff):(l.value=xy.AREA_3,n=i);else if(this.face===yy.BOTTOM)r=Ff+e,i>=jf&&i<=Ff+jf?(l.value=xy.AREA_0,n=-i+Ff):i<jf&&i>=-jf?(l.value=xy.AREA_1,n=-i):i<-jf&&i>=-(Ff+jf)?(l.value=xy.AREA_2,n=-i-Ff):(l.value=xy.AREA_3,n=i>0?-i+Wf:-i-Wf);else{var h,c,u,p,d,m;this.face===yy.RIGHT?i=wy(i,+Ff):this.face===yy.BACK?i=wy(i,+Wf):this.face===yy.LEFT&&(i=wy(i,-Ff)),p=Math.sin(e),d=Math.cos(e),m=Math.sin(i),h=d*Math.cos(i),c=d*m,u=p,this.face===yy.FRONT?n=by(r=Math.acos(h),u,c,l):this.face===yy.RIGHT?n=by(r=Math.acos(c),u,-h,l):this.face===yy.BACK?n=by(r=Math.acos(-h),u,-c,l):this.face===yy.LEFT?n=by(r=Math.acos(-c),u,h,l):(r=n=0,l.value=xy.AREA_0)}return s=Math.atan(12/Wf*(n+Math.acos(Math.sin(n)*Math.cos(jf))-Ff)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(s)*Math.cos(s))/(1-Math.cos(Math.atan(1/Math.cos(n))))),l.value===xy.AREA_1?s+=Ff:l.value===xy.AREA_2?s+=Wf:l.value===xy.AREA_3&&(s+=1.5*Wf),o.x=a*Math.cos(s),o.y=a*Math.sin(s),o.x=o.x*this.a+this.x0,o.y=o.y*this.a+this.y0,t.x=o.x,t.y=o.y,t},inverse:function(t){var e,i,n,r,a,s,o,l,h,c,u,p,d={lam:0,phi:0},m={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,i=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),e=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?m.value=xy.AREA_0:t.y>=0&&t.y>=Math.abs(t.x)?(m.value=xy.AREA_1,e-=Ff):t.x<0&&-t.x>=Math.abs(t.y)?(m.value=xy.AREA_2,e=e<0?e+Wf:e-Wf):(m.value=xy.AREA_3,e+=Ff),h=Wf/12*Math.tan(e),a=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),s=Math.atan(a),(o=1-(n=Math.cos(e))*n*(r=Math.tan(i))*r*(1-Math.cos(Math.atan(1/Math.cos(s)))))<-1?o=-1:o>1&&(o=1),this.face===yy.TOP)l=Math.acos(o),d.phi=Ff-l,m.value===xy.AREA_0?d.lam=s+Ff:m.value===xy.AREA_1?d.lam=s<0?s+Wf:s-Wf:m.value===xy.AREA_2?d.lam=s-Ff:d.lam=s;else if(this.face===yy.BOTTOM)l=Math.acos(o),d.phi=l-Ff,m.value===xy.AREA_0?d.lam=-s+Ff:m.value===xy.AREA_1?d.lam=-s:m.value===xy.AREA_2?d.lam=-s-Ff:d.lam=s<0?-s-Wf:-s+Wf;else{var f,g,v;h=(f=o)*f,g=(h+=(v=h>=1?0:Math.sqrt(1-h)*Math.sin(s))*v)>=1?0:Math.sqrt(1-h),m.value===xy.AREA_1?(h=g,g=-v,v=h):m.value===xy.AREA_2?(g=-g,v=-v):m.value===xy.AREA_3&&(h=g,g=v,v=-h),this.face===yy.RIGHT?(h=f,f=-g,g=h):this.face===yy.BACK?(f=-f,g=-g):this.face===yy.LEFT&&(h=f,f=g,g=-h),d.phi=Math.acos(-v)-Ff,d.lam=Math.atan2(g,f),this.face===yy.RIGHT?d.lam=wy(d.lam,-Ff):this.face===yy.BACK?d.lam=wy(d.lam,-Wf):this.face===yy.LEFT&&(d.lam=wy(d.lam,+Ff))}return 0!==this.es&&(c=d.phi<0?1:0,u=Math.tan(d.phi),p=this.b/Math.sqrt(u*u+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-p*p)/(this.one_minus_f*p)),c&&(d.phi=-d.phi)),d.lam+=this.long0,t.x=d.lam,t.y=d.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},My=[[1,2.2199e-17,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Sy=[[-5.20417e-18,.0124,1.21431e-18,-8.45284e-11],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Ty=.8487,Ey=1.3523,Ay=Hf/5,Py=1/Ay,Ly=18,Oy=function(t,e){return t[0]+e*(t[1]+e*(t[2]+e*t[3]))},Cy=function(t,e){return t[1]+e*(2*t[2]+3*e*t[3])};var Ry={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var e=gg(t.x-this.long0),i=Math.abs(t.y),n=Math.floor(i*Ay);n<0?n=0:n>=Ly&&(n=Ly-1),i=Hf*(i-Py*n);var r={x:Oy(My[n],i)*e,y:Oy(Sy[n],i)};return t.y<0&&(r.y=-r.y),r.x=r.x*this.a*Ty+this.x0,r.y=r.y*this.a*Ey+this.y0,r},inverse:function(t){var e={x:(t.x-this.x0)/(this.a*Ty),y:Math.abs(t.y-this.y0)/(this.a*Ey)};if(e.y>=1)e.x/=My[Ly][0],e.y=t.y<0?-Ff:Ff;else{var i=Math.floor(e.y*Ly);for(i<0?i=0:i>=Ly&&(i=Ly-1);;)if(Sy[i][0]>e.y)--i;else{if(!(Sy[i+1][0]<=e.y))break;++i}var n=Sy[i],r=5*(e.y-n[0])/(Sy[i+1][0]-n[0]);r=function(t,e,i,n){for(var r=e;n;--n){var a=t(r);if(r-=a,Math.abs(a)<i)break}return r}(function(t){return(Oy(n,t)-e.y)/Cy(n,t)},r,Uf,100),e.x/=Oy(My[i],r),e.y=(5*i+r)*Gf,t.y<0&&(e.y=-e.y)}return e.x=gg(e.x+this.long0),e},names:["Robinson","robin"]};var Iy={init:function(){this.name="geocent"},forward:function(t){return Lg(t,this.es,this.a)},inverse:function(t){return Og(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};Ug.defaultDatum="WGS84",Ug.Proj=Pg,Ug.WGS84=new Ug.Proj("WGS84"),Ug.Point=av,Ug.toPoint=Dg,Ug.defs=hg,Ug.transform=Fg,Ug.mgrs=Zg,Ug.version="__VERSION__",function(t){t.Proj.projections.add(_v),t.Proj.projections.add(Pv),t.Proj.projections.add(Lv),t.Proj.projections.add(Iv),t.Proj.projections.add(Dv),t.Proj.projections.add(Nv),t.Proj.projections.add(Fv),t.Proj.projections.add(zv),t.Proj.projections.add(kv),t.Proj.projections.add(Xv),t.Proj.projections.add(ey),t.Proj.projections.add(ny),t.Proj.projections.add(ry),t.Proj.projections.add(ay),t.Proj.projections.add(sy),t.Proj.projections.add(ly),t.Proj.projections.add(hy),t.Proj.projections.add(cy),t.Proj.projections.add(py),t.Proj.projections.add(dy),t.Proj.projections.add(my),t.Proj.projections.add(fy),t.Proj.projections.add(gy),t.Proj.projections.add(vy),t.Proj.projections.add(_y),t.Proj.projections.add(Ry),t.Proj.projections.add(Iy)}(Ug);var Dy=ld(function(t,e){!function(t){if("performance"in t==!1&&(t.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in t.performance==!1){var e=t.performance.timing&&t.performance.timing.navigationStart?performance.timing.navigationStart:Date.now();t.performance.now=function(){return Date.now()-e}}}(od);var i,n,r=r||(i=[],{REVISION:"14",getAll:function(){return i},removeAll:function(){i=[]},add:function(t){i.push(t)},remove:function(t){var e=i.indexOf(t);-1!==e&&i.splice(e,1)},update:function(t){if(0===i.length)return!1;var e=0;for(t=void 0!==t?t:window.performance.now();e<i.length;)i[e].update(t)?e++:i.splice(e,1);return!0}});r.Tween=function(t){var e=t,i={},n={},a={},s=1e3,o=0,l=!1,h=!1,c=!1,u=0,p=null,d=r.Easing.Linear.None,m=r.Interpolation.Linear,f=[],g=null,v=!1,y=null,x=null,b=null;for(var w in t)i[w]=parseFloat(t[w],10);this.to=function(t,e){return void 0!==e&&(s=e),n=t,this},this.start=function(t){for(var s in r.add(this),h=!0,v=!1,p=void 0!==t?t:window.performance.now(),p+=u,n){if(n[s]instanceof Array){if(0===n[s].length)continue;n[s]=[e[s]].concat(n[s])}i[s]=e[s],i[s]instanceof Array==!1&&(i[s]*=1),a[s]=i[s]||0}return this},this.stop=function(){return h?(r.remove(this),h=!1,null!==b&&b.call(e),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var t=0,e=f.length;t<e;t++)f[t].stop()},this.delay=function(t){return u=t,this},this.repeat=function(t){return o=t,this},this.yoyo=function(t){return l=t,this},this.easing=function(t){return d=t,this},this.interpolation=function(t){return m=t,this},this.chain=function(){return f=arguments,this},this.onStart=function(t){return g=t,this},this.onUpdate=function(t){return y=t,this},this.onComplete=function(t){return x=t,this},this.onStop=function(t){return b=t,this},this.update=function(t){var r;if(t<p)return!0;!1===v&&(null!==g&&g.call(e),v=!0);var h=(t-p)/s;h=h>1?1:h;var b=d(c?1-h:h);for(r in n){var w=i[r]||0,_=n[r];_ instanceof Array?e[r]=m(_,b):("string"==typeof _&&(_=w+parseFloat(_,10)),"number"==typeof _&&(e[r]=w+(_-w)*b))}if(null!==y&&y.call(e,b),1==h){if(o>0){for(r in isFinite(o)&&o--,a){if("string"==typeof n[r]&&(a[r]=a[r]+parseFloat(n[r],10)),l){var M=a[r];a[r]=n[r],n[r]=M}i[r]=a[r]}return l&&(c=!c),p=t+u,!0}null!==x&&x.call(e);for(var S=0,T=f.length;S<T;S++)f[S].start(t);return!1}return!0}},r.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},Out:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-r.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*r.Easing.Bounce.In(2*t):.5*r.Easing.Bounce.Out(2*t-1)+.5}}},r.Interpolation={Linear:function(t,e){var i=t.length-1,n=i*e,a=Math.floor(n),s=r.Interpolation.Utils.Linear;return e<0?s(t[0],t[1],n):e>1?s(t[i],t[i-1],i-n):s(t[a],t[a+1>i?i:a+1],n-a)},Bezier:function(t,e){var i,n=0,a=t.length-1,s=Math.pow,o=r.Interpolation.Utils.Bernstein;for(i=0;i<=a;i++)n+=s(1-e,a-i)*s(e,i)*t[i]*o(a,i);return n},CatmullRom:function(t,e){var i=t.length-1,n=i*e,a=Math.floor(n),s=r.Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(a=Math.floor(n=i*(1+e))),s(t[(a-1+i)%i],t[a],t[(a+1)%i],t[(a+2)%i],n-a)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):s(t[a?a-1:0],t[a],t[i<a+1?i:a+1],t[i<a+2?i:a+2],n-a)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=r.Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:(n=[1],function(t){var e,i=1;if(n[t])return n[t];for(e=t;e>1;e--)i*=e;return n[t]=i}),CatmullRom:function(t,e,i,n,r){var a=.5*(i-t),s=.5*(n-e),o=r*r;return(2*e-2*i+a+s)*(r*o)+(-3*e+3*i-2*a-s)*o+a*r+e}}},t.exports=r}),Ny={};"undefined"!=typeof window&&window.location&&(Ny=md.getURLParameters());var Fy=function(){},zy={};function ky(t){var e,i;this.mapviewerParameters=t,this.wireframe=!1;var n=1,r=!0;this.useDepthWriteForPOIs=!0;var a=this;this.pois={},this._anonymous_poi_counter=0,this.places=new Em(this),this.pois_with_selector=[],this.polygons_table={},this.pofs_table={},this.pois_floor_table={},this.plugins={},this.viewportWidth=0,this.viewportHeight=0,this.scene=new $s,this.camera=null,this.light=null,this.ambient=null,this.skybox=null,this.cameraDrivenExplorer,this.multiBuildingView,this.navigationTranslator,this.nbUpdatableObjects=0,this.mustUpdateCameraObjects=!1,this.textures={},this.models={},this.loaderStatistics={models:0,textures:0,pois:0},this.current_lod=2,this.currentFloorName="",this.currentFloor=null,this.activeLODList=[],this.manipulator=null,this.manipulatorTypeName="map",this.inertiaManipulator=null,this.customPreManipulatorListener=!1,this.customPostManipulatorListener=!1,this.globalCameraUpdatebleLinks=[],this.routingSolver=!1,this.navigationSolver=!1,this.extraData=!1,this.mapName=!1,this.pending={addPOI:{},addTiledImages:[]},this.loadStarted=!1,this.loadCompleted=!1,this.setupViewStarted=!1,this.setupViewCompleted=!1,this.initializeCompleted=!1,this.logNotReadyWarning=function(t){!1!==this.mapviewerParameters.hideNotReadyWarnings&&zy.log("%c VisioWeb %c is %cnot ready%c Move your call to %c"+t+"%c API after %cinitializeCompleted%c is triggered.","background:#35495e ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #fff; font-weight: bold;","background:transparent","background:#ff5333 ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #1d2833","background:transparent","background:#35495e ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #fff","background:transparent","background:#35495e ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #fff","background:transparent")},this.publicLodFactor=1,this.logDeprecatedWarning=function(t,e){if(!1!==this.mapviewerParameters.hideDeprecationWarnings){var i="%c"+t+"%c is %cdeprecated%c and will be removed soon.";e&&(i+=" Please use %c"+e+"%c instead."),zy.log("%c VisioWeb %c warning: "+i,"background:#35495e ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #fff; font-weight: bold;","background:transparent","background:#35495e ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #fff;","background:transparent","background:#ff5333 ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #1d2833","background:transparent","background:#35495e ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #fff;","background:transparent")}},this.publicCamera=null,this.layersParameters={receiveShadow:{order:9},wall:{enabled:!0,order:10},debugLabel:{enabled:!1,order:87,offset:5.5,thickness:0},reflection:{order:89},sprite:{order:90,offset:2,scale:2},overlay:{order:91},global:{fog:{color:0,near:6500,far:7e3}}};var s="VgID",o="VgLabel",l=null,h=null,c=!1,u="";this.mapTimestamp="",this.bundleLayout="single_file",this.logStatistics=!1,this.statistics=void 0;var p,d,m,f,g={fovX:45,fovY:45,near:1,far:7e3,update:function(t,e){if(0!==t&&0!==e){var i=.5*this.fovY*nd.DEG2RAD,n=Math.tan(i)/e;this.projectedPixelSize=Math.tan(i)/e,this.cosFovY=Math.cos(i),this.fovX=2*Math.atan(n*t)*nd.RAD2DEG}}},v=!1,y=!1,x=!0,b=(new ui,0),w=Date.now();this.plane_geometry=new jr(1,1),this.plane_geometry.vg={permanent:!0};var _=void 0===Ny.vgcontinuous;_||(this.nbUpdatableObjects=1);var M,S,T,E=!1,A=[],P=function(t,e,i){},L=!1,O=[];this.floors=O;var C={};this.publicFloors=!1;var R,I,D,N="",F={translate:new li(0,0,2048),opacity:!0,transitionTime:500},z={button:-1,lastX:0,lastY:0},k=200,B=!1,U=0,G=0,H={rotation_angle_in_degrees:0,meters_per_pixel:.2,geo_xref:0,geo_yref:0,utm_zone:1},j=!1,V=0,W=0,q=!1;function X(t){if(void 0===C[t]){var e=new kd(a,t);return e.index=O.length,O.push(e),C[t]=e,e}return C[t]}function Y(t,e,i){var n=function(t){var e=t.getAttribute("d");if(void 0===e)return[];var i=new vd.Transform;if(t.getAttribute("transform")){var n=t.getAttribute("transform");i=vd.Transform.parse(n)}try{var r=pd.transformSVGPath(e),a=ql.isClockWise(r.subPaths[0].getPoints()),s=r.toShapes(!a),o=(n=function(t){i.multiplyVector(t);var e=yt(t);t.x=e.x,t.y=e.y},function(t){if(t instanceof Sc)n(t.v1),n(t.v2);else if(t instanceof Ec)n(t.v0),n(t.v1),n(t.v2);else if(t instanceof _c)n(t.v0),n(t.v1),n(t.v2),n(t.v3);else if(t instanceof Pc)t.points.forEach(function(t){n(t)});else{if(!(t instanceof uc))throw new Error("weird Curve type");zy.log("EllipseCurve not transformed")}});return s.forEach(function(t){t.curves.forEach(o),t.holes.forEach(function(t){t.curves.forEach(o)})}),s}catch(t){return zy.log("convertPathToShape failed",t),[]}}(t);if(null!==n&&n.length){var r=a.getFloor(i.floor),o=r.getLOD(i.lod);null===o&&(o=r.floorContentLOD);var l=Z(t.getAttribute("vg_id"),s),h=t.getAttribute("fill");null===h&&(h=e.color);for(var c=vd.Parser.color(h),u=0;u<n.length;++u){var p=n[u],d=new td.MeshBasicMaterial({color:16777215,vertexColors:Wp,transparent:!1}),m={depth:e.thickness,steps:1,bevelEnabled:!1,generateSides:!1,generateTop:!0,generateBottom:!1};try{M=new rd(p,m);for(var f=new On(c),g=M.faces,v=0,y=g.length;v<y;++v)g[v].color=f}catch(t){return zy.log("ExtrudeGeometry failed",t),void zy.log(t.stack)}e.is_reflection&&(D.uniforms.uColor.value=new On(c),d=D),(T=new Fi).makeTranslation(0,0,e.offset),M.applyMatrix(T);var x=new br(M,d);x.matrixAutoUpdate=!1,x.geometry.computeBoundingBox();var b=o.node;e.is_reflection&&(b=o.node);if(b.add(x),void 0!==l){x.vg={id:l,floor:i.floor,originalColor:c,nb_faces:x.geometry.faces.length,faces_offset:0,layer:b},o.pickables.push(x),a.places.registerGeometryElement(x,l);var w=new li;w.addVectors(x.geometry.boundingBox.max,x.geometry.boundingBox.min),w.multiplyScalar(.5),w.multiply(x.scale),w.add(x.position),x.vg.position=w}if(e.thickness>0&&e.wall_geometry&&a.layersParameters.wall.enabled){var _;_=c;var M,S=new td.MeshBasicMaterial({color:16777215,vertexColors:Wp,transparent:!1});(M=new rd(p,m={depth:e.thickness,steps:1,bevelEnabled:!1,generateSides:!0,generateTop:!1,generateBottom:!1})).computeVertexNormals();var T,E=new On(_),A=new On(_);if(e.wall_color_gradient){var P=parseFloat(e.wall_color_gradient_top_ratio);isNaN(P)||E.multiplyScalar(P);var L=parseFloat(e.wall_color_gradient_bottom_ratio);isNaN(L)||A.multiplyScalar(L)}var O=["a","b","c"];for(v=0,y=M.faces.length;v<y;++v){var C=M.faces[v];for(var R in O){var I=O[R];M.vertices[C[I]].z>0?C.vertexColors[R]=E:C.vertexColors[R]=A}}(T=new Fi).makeTranslation(0,0,e.offset),M.applyMatrix(T);var N=new br(M,S);N.matrixAutoUpdate=!1;var F=o.getOrCreateLayer(a.layersParameters.wall.order);0===F.children.length?F.add(N):F.children[0].geometry.merge(N.geometry)}}}else zy.log("Cannot convert to shape.")}function Z(t,e){if(!t)return t;var i=t.replace(e,"").split(/(_x[0-9A-Fa-f]*_)/);for(var n in i)if(-1!==i[n].indexOf("_x")){var r=parseInt(i[n].substr(2),16);i[n]=String.fromCharCode(r)}return i.join("")}function J(t){null!==t&&(t.geoinformation?((H=t.geoinformation).rotation_angle_in_degrees=parseFloat(H.rotation_angle_in_degrees),H.meters_per_pixel=parseFloat(H.meters_per_pixel),H.geo_xref=parseFloat(H.geo_xref),H.geo_yref=parseFloat(H.geo_yref),H.pixel_xref=parseFloat(H.pixel_xref),a.cameraNorthRotation=-H.rotation_angle_in_degrees):a.cameraNorthRotation=!1,$d.each(t.features,function(t,e){a.layersParameters[gd.ucfirst(e)]={thickness:parseFloat(t.extrusion_height),side_color:t.side_color}}),t.proj4string&&t.offsetX&&t.offsetY&&!1===a.initializeProjection(t)&&zy.log("Cannot initialize projection"))}function K(){var t=H.rotation_angle_in_degrees*nd.DEG2RAD;H.matrixUTMToSVG=new Fi,H.matrixUTMToSVG.elements[0]=Math.cos(-t)/H.meters_per_pixel,H.matrixUTMToSVG.elements[1]=-Math.sin(-t)/H.meters_per_pixel,H.matrixUTMToSVG.elements[2]=-Math.sin(-t)/H.meters_per_pixel,H.matrixUTMToSVG.elements[3]=-Math.cos(-t)/H.meters_per_pixel,H.matrixUTMToSVG.elements[4]=f,H.matrixUTMToSVG.elements[5]=f,H.matrixSVGToUTM=new Fi,H.matrixSVGToUTM.elements[0]=Math.cos(t)*H.meters_per_pixel,H.matrixSVGToUTM.elements[1]=-Math.sin(t)*H.meters_per_pixel,H.matrixSVGToUTM.elements[2]=Math.sin(t)*H.meters_per_pixel,H.matrixSVGToUTM.elements[3]=Math.cos(t)*H.meters_per_pixel,H.matrixSVGToUTM.elements[4]=-f,H.matrixSVGToUTM.elements[5]=f}function Q(t,e,i){var n;n=zy.log,zy.log=function(){},Y(t,e,i),zy.log=n}function $(t,e){var i=X(t.userData.name),n=(new ui,t.children.slice());e||(n[0].traverse(function(t){t.matrixAutoUpdate=!1,void 0!==t.userData.water&&!0===t.userData.water&&i.floorContentLOD.groundObjects.push(t)}),i.floorContentLOD.node.add(n[0]));for(var r=1,s=n.length;r<s;++r){var o=n[r],l=i.createLOD(o.userData.index);if(o.traverse(function(t){t.matrixAutoUpdate=!1,void 0!==t.userData.water&&!0===t.userData.water&&l.groundObjects.push(t)}),l.node.add(o),void 0!==o.userData.pickables){l.pickables=o.userData.pickables;for(var h=0,c=l.pickables.length;h<c;++h){var u=l.pickables[h];a.places.registerGeometryElement({vg:u,geometry:o.children[0].geometry},u.id)}}}}function tt(t,e){var i;return new Promise(function(n,r){x=!1;var s={};if(cd.check(t,"String.length*Math.cos(window.length)",s)||r(new Error(s.message)),void 0!==t.extra_data&&(a.extraData=t.extra_data),void 0!==t.map_name&&(a.mapName=t.map_name),t.gltf){var o=new Kd;const a=new Qd;a.setDecoderPath("/lib/draco/"),o.setDRACOLoader(a),"string"==typeof t.gltf?o.load(u+"/"+t.gltf,t=>{i=t.scene,e(.6,"sceneLoader parse GLTF finished"),n()},null,t=>{r(t)}):o.parse(t.gltf,"",t=>{i=t.scene,e(.6,"sceneLoader parse GLTF finished"),n()},t=>{r(t)})}else{i=t.scene;var l=new Ad;i instanceof $s||(i=l.parse(i)),e(.6,"sceneLoader parse finished"),n()}}).then(function(){for(var n=0;n<i.children.length;++n)$(i.children[n]);var r={};if(void 0!==t.routing)for(n=0;n<t.routing.floors.length;++n){r[(o=t.routing.floors[n]).name]=o}n=0;for(var s=O.length;n<s;++n){var o;void 0!==r[(o=O[n]).name]&&(o.heightMin=r[o.name].zmin,o.heightMax=r[o.name].zmax),a.scene.add(o.node)}if(a.places.load(),m=i.userData.svgHeight,f=m/2,J({features:[],geoinformation:i.userData.geoinformation,proj4string:i.userData.proj4string,offsetX:i.userData.offsetX,offsetY:i.userData.offsetY}),K(),void 0!==t.routing){var l={convertSVGToPoint:yt,convertPointToSVG:xt,convertPointToLatLon:a.convertPointToLatLon.bind(a),convertLatLonToPoint:a.convertLatLonToPoint.bind(a),meters_per_pixel:H.meters_per_pixel,rotation_angle_in_degrees:H.rotation_angle_in_degrees};a.routingSolver=new of({routing:t.routing},l),a.navigationSolver=new lf(a.routingSolver,l.meters_per_pixel,a.routingSolver.hasIntersections())}e(.75,"setup except POIs finished")}).then(function(){if(void 0!==t.pois){var i=t.pois,n=i.pois,r=i.images,s=i.labels,o=i.models,l=i.tiledImages;a.loaderStatistics.pois+=r.length,a.loaderStatistics.pois+=o.length,a.loaderStatistics.pois+=s.length,l&&(a.loaderStatistics.pois+=l.length);for(var h=a.pois_floor_table,c=0,p=n.length;c<p;++c){var d=n[c];h[d.poiID]=d}if(void 0!==t.pois.places&&a.places.initFromList(t.pois.places),void 0!==t.pois.polygons){var m=t.pois.polygons;for(c=0,p=m.length;c<p;++c){var f=m[c];void 0===a.polygons_table[f.poiID]&&(a.polygons_table[f.poiID]=[]),a.polygons_table[f.poiID].push(f)}}if(void 0!==t.pois.points){var g=t.pois.points;for(c=0,p=g.length;c<p;++c){var v=g[c];a.pofs_table[v.poiID]=v}}for(c=0,p=r.length;c<p;++c){var y=r[c],x=y.poiID;v={x:y.centerX,y:y.centerY,z:y.altitude};"facing"===y.type&&(v.z+=.5*y.width),v=yt(v);var b=u+"icons/"+y.imageName+".png?"+a.mapTimestamp;void 0===a.pending.addPOI[x]&&(a.pending.addPOI[x]=[]),a.pending.addPOI[x].push({url:b,id:y.poiID,position:v,scale:{x:y.width,y:y.height,z:1},floor:h[y.poiID].floorName,lod:y.lod,fixed:"fixed"===y.type,angle:y.angleInDegrees,face2d:"facing"!==y.type,image:!0,clickable:!(!y.poiID||null!==y.poiID.match(/^mapIcon/)),track:!1,vgdelaycanvascreation:a.optimizations.batchIcons.delayCanvasCreation})}for(c=0,p=o.length;c<p;++c){var w=o[c];x=w.poiID;v=yt(v={x:w.centerX,y:w.centerY,z:w.altitude}),void 0===a.pending.addPOI[x]&&(a.pending.addPOI[x]=[]),a.pending.addPOI[x].push({model:u+"models/"+w.modelName+(w.format?"."+w.format:".json")+"?"+a.mapTimestamp,id:w.poiID,startAnimations:w.startAnimations,textureAnimation:w.textureAnimation,position:v,scale:{x:w.width,y:w.height,z:1},floor:h[w.poiID].floorName,lod:w.lod,fixed:"fixed"===w.type,angle:w.angleInDegrees,face2d:"facing"!==w.type,clickable:!(!w.poiID||null!==w.poiID.match(/^mapModel/)),track:!1,forceVisible:w.forceVisible})}if(l)for(c=0,p=l.length;c<p;++c){var _=l[c];v=yt(v={x:_.centerX,y:_.centerY,z:_.altitude}),a.pending.addTiledImages.push({position:v,scale:{x:_.width,y:_.height,z:1},floor:h[_.poiID].floorName,lod:_.lod,id:_.poiID,clickable:!0,mapviewer:a,angle:_.angleInDegrees,name:u+_.name,tileSize:_.tileSize,depth:_.depth,pruned:_.pruned})}for(c=0,p=s.length;c<p;++c){var M=s[c],S=h[x=M.poiID];v=yt(v={x:M.centerX,y:M.centerY,z:M.altitude}),void 0===a.pending.addPOI[x]&&(a.pending.addPOI[x]=[]);var T={id:x,text:S.name,color:M.fontColor,position:v,scale:{x:1,y:1,z:1},floor:S.floorName,lod:M.lod,fixed:!0,angle:M.angleInDegrees,width:M.width,height:M.height,flip:!0,clickable:!(!M.poiID||null!==M.poiID.match(/^mapLabel/)),vgdelaycanvascreation:a.optimizations.batchTexts.delayCanvasCreation},E=a.places.getOrCreatePlaceState(x);E&&(T=$d.extend(T,E.name,E.icon)),a.pending.addPOI[x].push(T)}}return t=null,e(1,"done"),Promise.resolve()})}function it(t,e){return Promise.resolve(t).then(function(){return e(.25,"map downloaded"),JSON.parse(t)}).then(function(t){return e(.5,"json parsed"),tt(t,e)}).catch(function(t){return Promise.reject(t)})}function nt(t,e){r=!1,a.useDepthWriteForPOIs=!1;var i=t.querySelector("svg");m=parseInt(i.getAttribute("height"),10),f=m/2;var l=i.getAttribute("onabort");if((l=JSON.parse(l)).version>n){var h="map data version "+l.version+", this SDK supports "+n+". Please update SDK";return Promise.reject(new Error(h))}!function(t){var e={};for(var i in t.parameters){var n=t.parameters[i];"object"!=typeof n&&(e[i]=n)}var r=t.parameters.styles;for(var i in r){var a=r[i];for(var s in e)void 0===a[s]&&(a[s]=e[s])}}(l),l.parameters.background&&(a.extraData={},a.extraData.background=l.parameters.background);var c={features:l.parameters.styles,geoinformation:l.geo,proj4string:l.proj4string,offsetX:l.offsetX,offsetY:l.offsetY};if(void 0!==l.builder_parameters&&void 0!==l.builder_parameters.distance_coeff&&(c.geoinformation.distance_coef=l.builder_parameters.distance_coeff),J(c),K(),void 0!==l.routing){var p={convertSVGToPoint:yt,convertPointToSVG:xt,convertPointToLatLon:a.convertPointToLatLon.bind(a),convertLatLonToPoint:a.convertLatLonToPoint.bind(a),meters_per_pixel:H.meters_per_pixel};a.routingSolver=new of({routing:l.routing},p),a.navigationSolver=new lf(a.routingSolver,p.meters_per_pixel,a.routingSolver.hasIntersections())}var d=[];for(var g in l.parameters.styles)d.push(g);d.sort(function(t,e){return(t=l.parameters.styles[t]&&void 0!==l.parameters.styles[t].extrusion_height?parseFloat(l.parameters.styles[t].extrusion_height):0)-(e=l.parameters.styles[e]&&void 0!==l.parameters.styles[e].extrusion_height?parseFloat(l.parameters.styles[e].extrusion_height):0)});var v=[],y={};void 0!==l.routing&&void 0!==l.routing.floors&&$d.each(l.routing.floors,function(t){y[t.name]=t}),t.querySelectorAll("svg>g[id^=floor]").forEach(function(t){var e=t.getAttribute("id").substr("floor".length),i={};i.floor=e;var n=a.getFloor(i.floor);null===n&&(n=X(i.floor),a.scene.add(n.node),void 0!==y[i.floor]&&(n.heightMin=y[i.floor].zmin,n.heightMax=y[i.floor].zmax)),md.queryChildren(t,"g[id^=vg-common-foreground]>g[id^=vg-model]").forEach(function(t){var e="vg-model",n={thickness:0,offset:0,order:d.indexOf(e)};$d.extend(n,l.parameters.styles[e]),n.thickness=parseFloat(n.extrusion_height),n.order=0,md.queryChildren(t,"image").forEach(function(t){v.push({element:t,type:e,parameters:$d.extend({},n),layer_info:$d.extend({},i)})})}),md.queryChildren(t,"g[id^=lod]").forEach(function(t){var e=t.getAttribute("id").substr("lod".length);i.lod=parseInt(e,10);var r=n.getLOD(i.lod);null===r&&(r=n.createLOD(i.lod)),md.queryChildren(t,"g").forEach(function(t){var e=t.getAttribute("id");i.type=e;var n={lod:0,thickness:0,offset:0,order:d.indexOf(e)};$d.extend(n,l.parameters.styles[e]),void 0!==n.footprint&&!0===n.footprint||(n.thickness=parseFloat(n.extrusion_height),n.order=0,md.queryChildren(t,"*:not(.vghelper)").forEach(function(t){v.push({element:t,type:e,parameters:$d.extend({},n),layer_info:$d.extend({},i)})}))})})});var x=function(t,e){var i=t.element,n=t.type,r=i.getAttribute("onabort");if(r&&(r=JSON.parse(r)),i.getAttribute("id")&&i.setAttribute("vg_id",i.getAttribute("id")),"vg-model"===n)!r||"fixed"!==r.vg_orientationType&&"fixed"!==r.vg_orientationtype?!r||"facing"!==r.vg_orientationType&&"facing"!==r.vg_orientationtype?i.setAttribute("vg_face2d","true"):i.setAttribute("vg_face2d","false"):i.setAttribute("vg_orientationType","fixed"),r&&void 0!==r.vg_model&&i.setAttribute("vg_model",r.vg_model),function(t,e,i){var n=t.getAttribute("transform"),r=vd.Transform.parse(n),o=(a.layersParameters.sprite,null===t.getAttribute("x")?0:parseFloat(t.getAttribute("x"))),l=null===t.getAttribute("y")?0:parseFloat(t.getAttribute("y")),h=parseFloat(t.getAttribute("width")),c=parseFloat(t.getAttribute("height")),p=new vd.Point(o,l);r.multiplyVector(p);var d=new vd.Point(o+h,l+c);r.multiplyVector(d);var m=r.decompose();h*=Math.abs(m.sx),c*=Math.abs(m.sy);var f={x:(p.x+d.x)/2,y:(p.y+d.y)/2,z:0};f=yt(f);var g=Z(t.getAttribute("vg_id"),s),v=t.getAttribute("vg_model"),y="fixed"===t.getAttribute("vg_orientationType"),x=null===t.getAttribute("vg_face2d")||"true"===t.getAttribute("vg_face2d");void 0===a.pending.addPOI[g]&&(a.pending.addPOI[g]=[]),a.pending.addPOI[g].push({model:u+v+"?"+a.mapTimestamp,id:g,position:f,scale:{x:h*H.meters_per_pixel,y:c*H.meters_per_pixel,z:1},floor:i.floor,lod:i.lod,fixed:y,angle:m.angle,face2d:x,clickable:!(!g||null!==g.match(/^mapModel/)),track:!1})}(i,t.parameters,t.layer_info);else if("vg-image"===n)!r||"fixed"!==r.vg_orientationType&&"fixed"!==r.vg_orientationtype?!r||"facing"!==r.vg_orientationType&&"facing"!==r.vg_orientationtype?i.setAttribute("vg_face2d","true"):i.setAttribute("vg_face2d","false"):i.setAttribute("vg_orientationType","fixed"),function(t,e,i){var n=t.getAttribute("transform"),r=vd.Transform.parse(n),o=a.layersParameters.sprite,l=null===t.getAttribute("x")?0:parseFloat(t.getAttribute("x")),h=null===t.getAttribute("y")?0:parseFloat(t.getAttribute("y")),c=parseFloat(t.getAttribute("width")),p=parseFloat(t.getAttribute("height")),d=new vd.Point(l,h);r.multiplyVector(d);var m=new vd.Point(l+c,h+p);r.multiplyVector(m);var f=r.decompose();c*=Math.abs(f.sx),p*=Math.abs(f.sy);var g={x:(d.x+m.x)/2,y:(d.y+m.y)/2,z:o.offset};g=yt(g);var v=Z(t.getAttribute("vg_id"),s),y=t.getAttribute("xlink:href"),x="fixed"===t.getAttribute("vg_orientationType"),b=null===t.getAttribute("vg_face2d")||"true"===t.getAttribute("vg_face2d");void 0===a.pending.addPOI[v]&&(a.pending.addPOI[v]=[]),a.pending.addPOI[v].push({url:u+y+"?"+a.mapTimestamp,id:v,position:g,scale:{x:c*H.meters_per_pixel,y:p*H.meters_per_pixel,z:1},floor:i.floor,lod:i.lod,fixed:x,angle:f.angle,face2d:b,image:!0,clickable:!(!v||null!==v.match(/^mapIcon/)),track:!1})}(i,t.parameters,t.layer_info);else if("vg-label"===n)r&&r.vg_legend&&i.setAttribute("vg_legend",r.vg_legend),function(t,e,i){var n=t.querySelector("rect"),r=t.querySelector("text"),s=t.getAttribute("transform"),l=vd.Transform.parse(s),h=a.layersParameters.sprite,c=null===n.getAttribute("x")?0:parseFloat(n.getAttribute("x")),u=null===n.getAttribute("y")?0:parseFloat(n.getAttribute("y")),p=parseFloat(n.getAttribute("width")),d=parseFloat(n.getAttribute("height")),m=new vd.Point(c,u);l.multiplyVector(m);var f=new vd.Point(c+p,u+d);l.multiplyVector(f);var g=l.decompose();p*=Math.abs(g.sx),d*=Math.abs(g.sy);var v={x:(m.x+f.x)/2,y:(m.y+f.y)/2,z:h.offset};v=yt(v),a.layersParameters.debugLabel.enabled&&(vd.convertRectToPath(n),n.getAttribute("fill","#ff0000"),n.getAttribute("transform",s),Q(n,a.layersParameters.debugLabel,i));var y,x=Z(t.getAttribute("vg_id"),o);Math.min(Math.abs(p),Math.abs(d)),H.meters_per_pixel,y=null!==r?vd.Parser.color(r.getAttribute("fill")):vd.Parser.color(n.getAttribute("stroke"));var b="";null!==r&&"true"===t.getAttribute("vg_legend")?b=Z(r.text()):null===r&&t.getAttribute("vg_legend")&&(b=t.getAttribute("vg_legend")),void 0===a.pending.addPOI[x]&&(a.pending.addPOI[x]=[]);var w={id:x,text:b,color:y,position:v,scale:{x:1,y:1,z:1},floor:i.floor,lod:i.lod,fixed:!0,angle:g.angle,width:p*H.meters_per_pixel,height:d*H.meters_per_pixel,flip:!0,clickable:!1};a.pending.addPOI[x].push(w)}(i,t.parameters,t.layer_info);else{switch(i.localName){case"rect":vd.convertRectToPath(i),Q(i,t.parameters,t.layer_info);break;case"polygon":case"polyline":vd.convertPolygonToPath(i),Q(i,t.parameters,t.layer_info);break;case"ellipse":vd.convertEllipseToPath(i),Q(i,t.parameters,t.layer_info);break;case"circle":vd.convertCircleToPath(i),Q(i,t.parameters,t.layer_info);break;case"path":Q(i,t.parameters,t.layer_info)}}},b=0,w=Math.ceil(v.length/100),_=0,M=function(){for(;;){var t=b,i=v[t];if(x.apply(a,[i,t]),_++,++b===v.length)return e(1),Promise.resolve();if(_===w)return _=0,e(b/v.length),Promise.resolve(M())}};return Promise.resolve(M()).then(function(){a.places.load()})}function rt(t,e){return Promise.resolve(t).then(function(t){e(.25,"map downloaded");var i=new DOMParser;return Promise.resolve(i.parseFromString(t,"application/xml"))}).then(function(t){return e(.5,"json parsed"),nt(t,e)}).catch(function(t){return Promise.reject(t)})}function at(t){t.progressHandler(0,"ajax request called");var e=0;void 0!==t.mapName&&(a.mapName=t.mapName);var i={progressCallBack:function(i){if(i.lengthComputable){var n=i.loaded/i.total;t.progressHandler(.25*n)}else e=Math.min(e+.0024,.24),t.progressHandler(e)}};return a.mapviewerParameters.useJSONP&&(i.crossDomain=!0),md.request(t.path,"GET",null,i)}function st(t){var n=a.currentFloorName;if(t.keyCode==="C".charCodeAt())_=!E,a.requestContinuousUpdate(!E),a.requestRedraw();else if(t.keyCode==="F".charCodeAt())a.requestRedraw();else if(t.keyCode==="H".charCodeAt());else if(t.keyCode==="G".charCodeAt())null===i.parent?(a.scene.add(i),a.scene.add(e)):(a.scene.remove(i),a.scene.remove(e)),a.requestRedraw();else if(t.keyCode==="W".charCodeAt())a.wireframe=!a.wireframe,a.scene.traverse(function(t){if(t.material instanceof qp)for(var e in t.material.materials)t.material.materials[e].wireframe=a.wireframe;else t.material&&(Array.isArray(t.material)?t.material.forEach(function(e,i){t.material[i].wireframe=a.wireframe}):t.material.wireframe=a.wireframe)}),a.requestRedraw();else if(t.keyCode==="L".charCodeAt())q=!q,a.requestContinuousUpdate(q);else if(t.keyCode==="U".charCodeAt()){var r=0;for(var s in O)O[s].name===n&&(r=s);r<O.length-1&&(a.getFloor(n).setEnabled(!1),a.getFloor(n).getLOD(a.current_lod).setEnabled(!1),n=O[++r].name,a.current_lod=Math.min(a.current_lod,a.getFloor(n).lods.length-1),a.getFloor(n).setEnabled(!0),a.getFloor(n).getLOD(a.current_lod).setEnabled(!0))}else if(t.keyCode==="J".charCodeAt()){r=0;for(var s in O)O[s].name===n&&(r=s);r>0&&(a.getFloor(n).setEnabled(!1),a.getFloor(n).getLOD(a.current_lod).setEnabled(!1),n=O[--r].name,a.current_lod=Math.min(a.current_lod,a.getFloor(n).lods.length-1),a.getFloor(n).setEnabled(!0),a.getFloor(n).getLOD(a.current_lod).setEnabled(!0))}else if(t.keyCode==="I".charCodeAt()){var o=a.getFloor(n);if(a.current_lod<o.lods.length-1){for(var s in o.lods)void 0!==o.lods[s]&&o.lods[s].setEnabled(!1);a.current_lod++,o.getLOD(a.current_lod).setEnabled(!0)}a.requestRedraw()}else if(t.keyCode==="K".charCodeAt()){if(a.current_lod>0){o=a.getFloor(n);for(var s in o.lods)void 0!==o.lods[s]&&o.lods[s].setEnabled(!1);a.current_lod=Math.min(a.current_lod-1,o.lods.length-1),o.getLOD(a.current_lod).setEnabled(!0)}a.requestRedraw()}}function ot(t){switch(B=!1,G=Date.now(),a.manipulatorTypeName){case"map":case"hybrid":if(t.target!==p.domElement)return!1;$d.each(a.pois_with_selector,function(t,e){document.querySelector(t.selector).style["pointer-events"]="none"});var e=pt(t);z.button=t.button,z.lastX=e.x,z.lastY=e.y,a.inertiaManipulator.enabled&&a.inertiaManipulator.onGestureStart()}return!1}function lt(t){return B=!1,ct(t)}function ht(t){return B=!1,ct(t)}function ct(t){if(a.inertiaManipulator.enabled&&a.inertiaManipulator.onGestureEnd(),0==z.button&&0==t.button){var e=pt(t);if(0!==G&&Date.now()-G>k)return void(z.button=-1);("hybrid"!==a.manipulatorTypeName||a.multiBuildingView.multifloorConfig.click)&&a.onTapWithCenter(e,t)}else 2==z.button&&t.button;$d.each(a.pois_with_selector,function(t,e){document.querySelector(t.selector).style["pointer-events"]="all"}),z.button=-1}function ut(t){z.button=-1}function pt(t){return void 0===t.offsetX?{x:t.layerX-t.target.offsetLeft,y:t.layerY-t.target.offsetTop}:{x:t.offsetX,y:t.offsetY}}function dt(t){var e,i=[],n=new li(t.x/a.viewportWidth*2-1,-t.y/a.viewportHeight*2+1,.5);if(n.unproject(a.camera),a.camera instanceof Uc){var s=new li(t.x/a.viewportWidth*2-1,-t.y/a.viewportHeight*2+1,1);s.unproject(a.camera);var o=new li(t.x/a.viewportWidth*2-1,-t.y/a.viewportHeight*2+1,-1);o.unproject(a.camera),s.sub(o).normalize(),e=new Vu(o,s)}else e=new Vu(a.camera.position,n.sub(a.camera.position).normalize());var l=[];if(r){for(var h=0,c=a.activeLODList.length;h<c;++h)a.activeLODList[h].floor.name==a.currentFloorName&&l.push(a.activeLODList[h].node);if(0==(u=e.intersectObjects(l,!0)).length){l=[];for(h=0,c=a.activeLODList.length;h<c;++h)l.push(a.activeLODList[h].node);u=e.intersectObjects(l,!0)}if(0==u.length){l=[];for(h=0,c=a.floors.length;h<c;++h)l.push(a.floors[h].node);u=e.intersectObjects(l,!0)}$d.each(u,function(t,e){var n=!1,r=t.object;if(!1!==r.visible&&-1===A.indexOf(r)){var s,o,l=r.parent.userData.pickables;if(void 0!==l)for(var h=0,c=l.length;h<c;++h){var u=l[h],p=!1;if(t.object.geometry instanceof al?p=t.faceIndex>=u.faces_offset&&t.faceIndex<u.faces_offset+u.nb_faces:t.object.geometry instanceof ir&&(p=t.faceIndex>=u.faces_offset&&t.faceIndex<u.faces_offset+u.nb_faces),p&&(s=a.getPlace(u.id))){o=u;break}}if(void 0===s)if(r.vg&&r.vg.batch){var d=r.vg.batch.getPickableFromIntersection(t);d&&d.options.poi.clickable&&(s=d.publicObject,n=(o=d.options).poi.overlay)}else if(void 0!==r&&void 0!==r.vg&&null!==r.vg.id&&r.vg.poi&&r.vg.poi.clickable){if(1===(s=a.pois[r.vg.id]).length)s=s[0];else for(t.object,h=0,c=s.length;h<c;h++)if($d.isMatch(r.vg.poi,s[h].options())){s=s[h];break}o=r.vg,n=r.vg.poi.overlay}if(void 0===s)return!1;i.push({vg:o,target:s,distance:t.distance,overlay:n})}})}else{for(h=0,c=a.activeLODList.length;h<c;++h)l.push(a.activeLODList[h].pickables);l=l.concat.apply([],l);var u=e.intersectObjects(l,!0);$d.each(u,function(t,e){var n,r,s=!1,o=t.object;if(!1!==o.visible&&-1===A.indexOf(t.object)&&!(void 0===o.vg||void 0===o.vg.id&&void 0===o.vg.batch||null===o.vg.id||o.vg.poi&&!1===o.vg.poi.clickable)){if(r=o.vg,o.vg.batch){var l=o.vg.batch.getPickableFromIntersection(t);l&&l.options.poi.clickable&&(n=l.publicObject,s=(r=l.options).poi.overlay)}else if(!(n=a.getPlace(o.vg.id))){if(0===o.vg.poi._opacity)return;if(s=o.vg.poi.overlay,1===(n=a.pois[o.vg.id]).length)n=n[0];else for(var h=0,c=n.length;h<c;h++)if($d.isMatch(o.vg.poi,n[h].options())){n=n[h];break}}void 0!==n&&i.push({vg:r,target:n,distance:t.distance,overlay:s})}})}return i.sort(function(t,e){return t.overlay===e.overlay?t.distance-e.distance:t.overlay?-1:1}),i.length>0?[i[0]]:[]}this.initialize=function(t,e){return this.initializeCompleted?(this.notifications.trigger("loadFailed",void 0,!0),this.notifications.trigger("initializeFailed",void 0,!0),Promise.reject("Already initialized. Call destroy method and re-create the Mapviewer instance.")):this.loadCompleted?(this.notifications.trigger("loadFailed",void 0,!0),this.notifications.trigger("initializeFailed",void 0,!0),Promise.reject("A map is loaded. Call setupView to complete the initialization.")):(void 0!==e&&(this.mapviewerParameters=e),this.mapviewerParameters?this.setupViewInternal(t).then(this.loadInternal.bind(this)).then(function(){}.bind(this)).catch(function(t){return this.notifications.trigger("initializeFailed",void 0,!0),Promise.reject(t)}.bind(this)):(this.notifications.trigger("initializeFailed",void 0,!0),Promise.reject("Missing mapviewerParameters, either in Mapviewer's constructor or in Mapviewer#initialize.")))},this.checkOptimizations=function(){if(this.optimizations={batchTexts:{enabled:!0,padding:2,atlasSize:1024,delayCanvasCreation:!1},batchIcons:{enabled:!0,padding:2,atlasSize:1024,delayCanvasCreation:!0}},void 0!==Ny.vgnobatch&&(this.optimizations.batchTexts.enabled=!1,this.optimizations.batchIcons.enabled=!1),void 0!==Ny.vgnobatchtext&&(this.optimizations.batchTexts.enabled=!1),void 0!==Ny.vgnobatchicon&&(this.optimizations.batchIcons.enabled=!1),void 0!==Ny.vgtextpadding&&(this.optimizations.batchTexts.padding=Ny.vgtextpadding),void 0!==Ny.vgiconpadding&&(this.optimizations.batchIcons.padding=Ny.vgiconpadding),void 0!==Ny.vgtextatlassize&&(this.optimizations.batchTexts.atlasSize=Ny.vgtextatlassize),void 0!==Ny.vgiconatlassize&&(this.optimizations.batchIcons.atlasSize=Ny.vgiconatlassize),void 0!==Ny.vgtextatlasnodelay&&(this.optimizations.batchTexts.delayCanvasCreation=!1),void 0!==Ny.vgiconatlasnodelay&&(this.optimizations.batchIcons.delayCanvasCreation=!1),void 0!==this.mapviewerParameters.optimizations){var t=this.mapviewerParameters.optimizations;void 0!==t.load1&&(x=!t.load1),void 0!==t.nobatch&&(this.optimizations.batchTexts.enabled=!1,this.optimizations.batchIcons.enabled=!1),void 0!==t.batchTexts&&(this.optimizations.batchTexts=$d.extend(this.optimizations.batchTexts,t.batchTexts)),void 0!==t.batchIcons&&(this.optimizations.batchIcons=$d.extend(this.optimizations.batchIcons,t.batchIcons)),void 0!==t.unloadDelay&&(kd.prototype.UNLOAD_DELAY=t.unloadDelay)}},this.loadInternal=function(){return this.loadStarted=!0,this.checkOptimizations(),void 0===this.mapviewerParameters.progressHandler&&(this.mapviewerParameters.progressHandler=Fy),void 0!==this.mapviewerParameters.path||void 0!==this.mapviewerParameters.svg||void 0!==this.mapviewerParameters.mapContentString?this.loadMap().then(function(){this.loadCompleted=!0,this.on("setupViewCompleted",this.realizeBind),this.notifications.trigger("loadCompleted",void 0,!0)}.bind(this)):Promise.reject(new Error("missing .path or .mapContentString parameter"))},this.load=function(t){return this.loadCompleted?(this.notifications.trigger("loadFailed",void 0,!0),Promise.reject("Call unload method before reloading map.")):(void 0!==t&&(this.mapviewerParameters=t),this.mapviewerParameters?this.loadInternal().catch(function(t){return this.notifications.trigger("loadFailed",void 0,!0),Promise.reject(t)}.bind(this)):(this.notifications.trigger("loadFailed",void 0,!0),Promise.reject("Missing mapviewerParameters, either in Mapviewer's constructor, in Mapviewer#initialize or in Mapviewer#load.")))},this.setupCamera=function(t){d=t,this.viewportWidth=md.getElementWidth(d),this.viewportHeight=md.getElementHeight(d),g.update(this.viewportWidth,this.viewportHeight),this.publicCamera=new uf(this),void 0!==this.mapviewerParameters.cameraType&&"orthographic"===this.mapviewerParameters.cameraType?this.camera=new Uc(this.viewportWidth/-2,this.viewportWidth/2,this.viewportHeight/2,this.viewportHeight/-2,.1,2e4):this.camera=new Cr(g.fovY,this.viewportWidth/this.viewportHeight,g.near,g.far),this.camera.matrixAutoUpdate=!1,this.camera.position.copy({x:0,y:0,z:300}),this.camera.updateMatrix(),this.scene.add(this.camera),this.manipulator=new Af(this,this.camera),a.manipulator.update(),this.inertiaManipulator=new Lf(a),this.camera instanceof Uc&&(this.publicCamera.pitch=-90,this.publicCamera.pitchManipulatorEnabled=!1,this.publicCamera.rotationManipulatorEnabled=!1)},this.setupRenderer=function(){for(var t in ky.available_plugins){var e=ky.available_plugins[t];this.plugins[e.name]=new e.factory(this)}if(isNaN(this.viewportWidth)||isNaN(this.viewportHeight))return Promise.reject(new Error("Container's width or height is NaN. Make sure the map container is displayed before initializing Mapviewer."));"visible"!==d.style.visibility&&(d.style.visibility="visible");var i=void 0===this.mapviewerParameters.disable_console||this.mapviewerParameters.disable_console,n={antialias:void 0===this.mapviewerParameters.antialias||this.mapviewerParameters.antialias,stencil:!1,alpha:!0,bugPixelStorei:this.mapviewerParameters.bugPixelStorei,bugWP81:this.mapviewerParameters.bugWP81,disable_console:i,useSkeleton:!1,recomputeCameraInverse:!1,preserveDrawingBuffer:!0};try{p=new Zs(n)}catch(t){return Promise.reject(t)}p&&p.setSize||zy.log("bad"),this.renderer=p,p.setSize(this.viewportWidth,this.viewportHeight),p.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1),d.innerHTML="",d.appendChild(p.domElement);var r=document.createElement("img");r.src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",ni.DEFAULT_IMAGE=r,this.clock=new gu,this.scene.autoUpdate=!1,this.scene.matrixAutoUpdate=!1,this.scene.fog=!1,this.ambient=new jc(4473924),this.ambient.matrixAutoUpdate=!1,this.scene.add(this.ambient),this.light=new Hc(16777215,1),this.light.matrixAutoUpdate=!1,this.light.position.set(0,100,100),this.light.target.position.set(0,0,0),this.light.updateMatrix(),this.scene.add(this.light),sc.crossOrigin="",this.textureLoader=new hc,this.textureLoader.setCrossOrigin("")},this.setupHandlers=function(){function t(t){var e=d.getBoundingClientRect();return{left:t.center.x-e.left,top:t.center.y-e.top}}var e,i;T=this.mapviewerParameters.onObjectMouseDown,M=this.mapviewerParameters.onObjectMouseOver,S=this.mapviewerParameters.onObjectMouseOut,P=function(t,e,i){void 0!==a.logStatistics&&a.logStatistics&&void 0===e.vg.poi&&a.statistics.logStat("selectPlace",e);var n=!0;return i&&i.onObjectMouseUp&&(n=i.onObjectMouseUp(t,e)),!1!==n&&(!1!==a.notifications.trigger("mouseup",{event:t,element:e})&&void(a.mapviewerParameters.onObjectMouseUp&&a.mapviewerParameters.onObjectMouseUp(t,e)))};var n=0,r=0,s=1;function o(t,e){var i=Date.now();if(!(i-U<k)&&(U=i,(!1===a.customPreManipulatorListener||!1!==a.customPreManipulatorListener(e))&&("hybrid"!==a.manipulatorTypeName||a.multiBuildingView.multifloorConfig.click))){switch(a.manipulatorTypeName){case"map":case"hybrid":var n=dt(t);if(!1!==n&&n.length>0){var r=n[0].target,s=n[0].vg;P(e,r,s.poi)}}!1===a.customPostManipulatorListener||a.customPostManipulatorListener(e)}}this.onTapWithCenter=o,this.mc=new Of.Manager(p.domElement),this.mc.add(new Of.Pan({threshold:10,pointers:0})),this.mc.add(new Of.Rotate({threshold:0})).recognizeWith(this.mc.get("pan")),this.mc.add(new Of.Pinch({threshold:0})).recognizeWith([this.mc.get("pan"),this.mc.get("rotate")]),this.mc.add(new Of.Tap({event:"doubletap",taps:2})),this.mc.add(new Of.Tap),this.mc.on("panstart panmove",function(n){if(!1===a.customPreManipulatorListener||!1!==a.customPreManipulatorListener(n)){switch(a.manipulatorTypeName){case"map":if("panstart"===n.type){var r=t(n);a.manipulator.pitchManipulatorEnabled&&(e=r.top),a.manipulator.panManipulatorEnabled&&(i=a.convertScreenToPoint(r),(a.inertiaManipulator.panEnabled||a.inertiaManipulator.pitchEnabled)&&a.inertiaManipulator.onGestureStart())}else{var s=t(n),o=2===n.pointers.length&&Math.abs(n.pointers[0].y-n.pointers[1].y)<.05*a.viewportHeight;if(a.manipulator.pitchManipulatorEnabled&&void 0!==e&&o&&("panmove"===n.type||"panup"===n.type||"pandown"===n.type)&&(a.publicCamera.pitch+=a.manipulator.rotationSpeed*(s.top-e),a.inertiaManipulator.pitchEnabled&&a.inertiaManipulator.pushCameraSample()),a.manipulator.panManipulatorEnabled&&void 0!==i){var l=a.publicCamera.position,h=a.convertScreenToPoint(s);a.publicCamera.position={x:i.x-h.x+l.x,y:i.y-h.y+l.y,radius:l.radius},a.inertiaManipulator.panEnabled&&a.inertiaManipulator.pushCameraSample()}e=s.top}break;case"hybrid":o=2===n.pointers.length&&Math.abs(n.pointers[0].y-n.pointers[1].y)<.05*a.viewportHeight,"panstart"===n.type&&a.manipulator.pitchManipulatorEnabled?e=t(n).top:a.manipulator.pitchManipulatorEnabled&&void 0!==e&&o&&("panmove"===n.type||"panup"===n.type||"pandown"===n.type)&&(s=t(n),a.publicCamera.pitch+=a.manipulator.rotationSpeed*(s.top-e),e=s.top)}!1===a.customPostManipulatorListener||a.customPostManipulatorListener(n)}}),this.mc.on("rotatestart rotatemove",function(t){if(a.manipulator.rotationManipulatorEnabled&&(!1===a.customPreManipulatorListener||!1!==a.customPreManipulatorListener(t))&&("hybrid"!==a.manipulatorTypeName||a.multiBuildingView.multifloorConfig.rotation)){switch(a.manipulatorTypeName){case"map":case"hybrid":"rotatestart"==t.type?(n=a.publicCamera.rotation,r=t.rotation,a.inertiaManipulator.rotationEnabled&&a.inertiaManipulator.onGestureStart()):(a.publicCamera.rotation=n+t.rotation-r,a.inertiaManipulator.rotationEnabled&&a.inertiaManipulator.pushCameraSample())}!1===a.customPostManipulatorListener||a.customPostManipulatorListener(t)}}),this.mc.on("pinchstart pinchmove",function(t){if(a.manipulator.zoomManipulatorEnabled&&(!1===a.customPreManipulatorListener||!1!==a.customPreManipulatorListener(t))&&("hybrid"!==a.manipulatorTypeName||a.multiBuildingView.multifloorConfig.zoom)){switch(a.manipulatorTypeName){case"map":case"hybrid":if("pinchstart"==t.type)a.publicCamera.position.radius,s=a.publicCamera.position.radius||1,a.inertiaManipulator.zoomEnabled&&a.inertiaManipulator.onGestureStart();else{var e=a.publicCamera.position;e.radius=s/t.scale,a.publicCamera.position=e,a.inertiaManipulator.zoomEnabled&&a.inertiaManipulator.pushCameraSample()}}!1===a.customPostManipulatorListener||a.customPostManipulatorListener(t)}}),this.inertiaManipulator.enabled&&this.mc.on("panend rotateend pinchend",a.inertiaManipulator.onGestureEnd.bind(a.inertiaManipulator)),this.mc.on("tap",function(e){B=!1;var i=t(e);return o({x:i.left,y:i.top},e)}),this.mc.on("doubletap",function(t){}),void 0!==T&&(this.mc.add(new Of.Press({time:100})),this.mc.on("press",function(e){var i=t(e),n=dt({x:i.left,y:i.top});if(!1!==n&&n.length>0){var r=n[0].target;r.vg&&r.vg.poi&&T(e,r)}})),d.addEventListener("mousedown",ot,!1),d.addEventListener("mousemove",ft,!1),d.addEventListener("mouseup",ht,!1),document.addEventListener("mouseup",lt,!1),d.addEventListener("mouseout",ut,!1),d.addEventListener("contextmenu",vt,!1);var l="mousewheel";window.navigator&&window.navigator.userAgent&&-1!=window.navigator.userAgent.indexOf("Firefox")&&(l="DOMMouseScroll"),d.addEventListener(l,gt)},this.setupOverlay=function(){},this.setupViewInternal=function(t){return this.setupViewStarted=!0,this.setupCamera(t),this.setupRenderer(),this.setupHandlers(),this.setupOverlay(),this.setupViewCompleted=!0,this.notifications.trigger("setupViewCompleted",void 0,!0),Promise.resolve()},this.setupView=function(t){return this.setupViewCompleted?Promise.reject("setupView is already completed."):this.mapviewerParameters?this.setupViewInternal(t):(this.notifications.trigger("initializeFailed",void 0,!0),Promise.reject("Missing mapviewerParameters, either in Mapviewer's constructor, in Mapviewer#initialize or in Mapviewer#load."))},this.setSkybox=function(t){if(!this.initializeCompleted)return this.logNotReadyWarning("setSkybox"),!1;if(void 0!==t&&void 0!==t.type)switch(null!==this.skybox&&this.skybox.dispose(),this.skybox=new dd(this),void 0!==t&&"number"==typeof t.fov&&this.skybox.setFov(t.fov),t.type){case"faces":this.skybox.initializeWithFaces(t.data);break;case"strip":this.skybox.initializeWithStrip(t.data);break;case"gradient":this.skybox.initializeWithGradient(t.data)}},this.synthesizeVenueLayout=function(){var t=100;void 0!==Ny.gap&&(t=parseFloat(Ny.gap));var e=this.getFloors();if(0===e.length)return zy.log("ERROR: no floors found!"),!1;var i=[];for(var n in e)i.push(e[n]);i.sort(function(t,e){return t.heightMin-e.heightMin});var r={config:{venue_layout:{buildings:{},defaultBuilding:"default",version:1,layer:""}}},a={defaultFloor:i[0].name,displayIndex:0,floors:{}},s={},o=0,l=0;for(var n in i){var h=i[n];s[h.name]={layer:h.name,levelIndex:o,stackGap:t,stackHeightMax:h.heightMax-h.heightMin,stackHeightMin:0},(h.heightMax+h.heightMin)/2==0&&(a.defaultFloor=h.name,l=o),o++}if(0!=l)for(var n in s)s[n].levelIndex-=l;return a.floors=s,r.config.venue_layout.buildings.default=a,r},this.setupMultiBuildingView=function(t){if(!this.initializeCompleted)return this.logNotReadyWarning("setupMultiBuildingView"),!1;var e,i,n=this.getExtraData();if(!n||!n.config||!n.config.venue_layout){if(!1===(n=this.synthesizeVenueLayout()))return zy.log("ERROR: no vg_venue_layout, mode not supported, you need data setup for multibuilding on map editor AND synthesizeVenueLayout failed."),!1;"multibuilding"===t.viewType&&(t.viewType="multifloor")}if(n&&n.resources&&window.navigator){var r=window.navigator.userLanguage||window.navigator.language,a=[];for(var s in"string"==typeof r&&(r=r.replace(/-.*/,""),a.push(r)),a.push("default"),a)if(i=a[s],n.resources[i]&&n.resources[i].localized&&1==n.resources[i].localized.version&&n.resources[i].localized.locale&&n.resources[i].localized.locale[i]&&n.resources[i].localized.locale[i].venueLayout){e=n.resources[i].localized.locale[i].venueLayout;break}}var o=n.config.venue_layout;if(this.multiBuildingView=new wf(this,o,e,t),this.cameraDrivenExplorer=new gf(this.multiBuildingView),this.camera instanceof Uc){this.multiBuildingView.globalModePitch=-90,this.multiBuildingView.buildingModePitch=-90,this.multiBuildingView.floorModePitch=-90}return this.setAutoUpdateLOD(!1),!0},this.setupNavigationTranslator=function(t){return this.navigationTranslator=new Ef(this,t),!0},this.getFloor=function(t){var e=C[t];return void 0===e?null:e},this.addShapeToScene=function(t,e,i){var n=new Rc(t),r=a.getFloor(i.floor),s=r.getLOD(i.lod);null===s&&(s=r.floorContentLOD);var o="#ffffff";e.color&&(o=e.color);for(var l=vd.Parser.color(o),h=new td.MeshBasicMaterial({color:16777215,vertexColors:Wp,transparent:!1}),c=new rd(n,{depth:e.thickness,steps:1,bevelEnabled:!1,generateSides:!1,generateTop:!0,generateBottom:!1}),u=new On(l),p=c.faces,d=0,m=p.length;d<m;++d)p[d].color=u;var f=new br(c,h);if(f.matrixAutoUpdate=!1,f.geometry.computeBoundingBox(),s.node.add(f),"undefined"!=typeof id){f.vg={id:id,floor:layer_info.floor,originalColor:l,nb_faces:f.geometry.faces.length,faces_offset:faces_offset,layer:roofLayer},s.pickables.push(f),this.places.registerGeometryElement(f,id);var g=new li;g.addVectors(f.geometry.boundingBox.max,f.geometry.boundingBox.min),g.multiplyScalar(.5),g.multiply(f.scale),g.add(f.position),f.vg.position=g}if(e.thickness>0&&e.wall_geometry){var v;v=l;var y=new td.MeshBasicMaterial({color:16777215,vertexColors:Wp,transparent:!1});(c=new rd(n,{depth:e.thickness,steps:1,bevelEnabled:!1,generateSides:!0,generateTop:!1,generateBottom:!1})).computeVertexNormals();var x=new On(v),b=new On(v);if(e.wall_color_gradient){var w=parseFloat(e.wall_color_gradient_top_ratio);isNaN(w)||x.multiplyScalar(w);var _=parseFloat(e.wall_color_gradient_bottom_ratio);isNaN(_)||b.multiplyScalar(_)}var M=["a","b","c"];for(d=0,m=c.faces.length;d<m;++d){var S=c.faces[d];for(var T in M){var E=M[T];c.vertices[S[E]].z>0?S.vertexColors[T]=x:S.vertexColors[T]=b}}var A=new br(c,y);A.matrixAutoUpdate=!1,s.getOrCreateLayer(a.layersParameters.wall.order).add(A)}},this.loadMap=function(){var t=this.mapviewerParameters.svg||this.mapviewerParameters.mapContentString;if(void 0!==this.mapviewerParameters.mapName&&(a.mapName=this.mapviewerParameters.mapName),void 0!==this.mapviewerParameters.mapContentDirectory&&(u=this.mapviewerParameters.mapContentDirectory+"/"),"string"==typeof t)return null!==t.match(/^</)?rt(t,this.mapviewerParameters.progressHandler):it(t,this.mapviewerParameters.progressHandler);this.mapviewerParameters.path=this.mapviewerParameters.path||"map.svg";var e=function(t){var e=t.match(/^(.*\/)[^\/]+$/);e&&e.length>0&&(u=e[1])};e(this.mapviewerParameters.path);var i=this.mapviewerParameters;return null!==this.mapviewerParameters.path.match(/.svg$/)?at(this.mapviewerParameters).then(function(t){return rt(t.response,i.progressHandler)}).catch(function(t){return"404"===t.message?(i.path=i.path.replace(".svg",".json"),at(i).then(function(t){return it(t.response,i.progressHandler)})):Promise.reject(t)}):at(this.mapviewerParameters).then(function(t){var n=JSON.parse(t.response);return void 0!==n.maps?fd.checkSlotDescription(n,i,{sdkType:["web","kiosk"],sdkVersion:a.version,minimumDataSDKVersion:a.minimumDataSDKVersion}).then(function(t){return i.progressHandler(0,"start download"),e(t.path),a.mapTimestamp=t.timestamp,void 0!==t.bundleLayout&&(a.bundleLayout=t.bundleLayout),at(t)}).then(function(t){return-1!==n.maps[0].path.indexOf(".svg")?rt(t.response,i.progressHandler):it(t.response,i.progressHandler)}):Promise.resolve(n).then(function(t){return i.progressHandler(.5,"json parsed"),tt(t,i.progressHandler)}).catch(function(t){return Promise.reject(t)})}).catch(function(t){return"404"===t.message&&null!==i.path.match(/map.json$/)?(i.path=i.path.replace(".json",".svg"),at(i).then(function(t){return rt(t.response,i.progressHandler)}).catch(function(t){return Promise.reject(t)})):Promise.reject(t)})},this.loadFloor=function(t){if("single_file"===this.bundleLayout)return Promise.reject("nocontent");var e=u+"floors/map."+t+".json",i={};return this.mapviewerParameters.useJSONP&&(i.crossDomain=!0),md.request(e,"GET",null,i).then(function(t){switch(t.status){case 200:return JSON.parse(t.response);case 204:return Promise.reject("nocontent");default:return Promise.reject(t.response)}}).then(function(t){t instanceof $s||(t=(new Ad).parse(t));return Array.isArray(t.children)&&0!==t.children.length?t.children[0]:Promise.reject("wrong format")}).then(function(e){if($(e,!0),$d.each(a.pending.addPOI,function(e){e.forEach(function(i,n){if(i.floor===t&&i.lod>0){var r=this.addPOIInternal(md.extendDeep({},i));null!==r?(a.loaderStatistics.pois--,e[n]=r):e.splice(n,1)}})}),a.optimizations.batchIcons.delayCanvasCreation){var i=function(){a.graphicsLoading()||(a.iconGenerator.realize(),a.off("redraw",i),a.requestRedraw())};a.on("redraw",i)}if(a.optimizations.batchTexts.delayCanvasCreation){var n=function(){a.graphicsLoading()||(a.getFloor(t).lods.forEach(function(t){Object.values(t.poiBatches.texts).forEach(function(t){t.textureGenerator.realize()})}),a.off("redraw",n),a.requestRedraw())};a.on("redraw",n)}a.places.load(t),a.places.realize(t),a.mustUpdateCameraObjects=!0,a.requestRedraw()}).catch(function(t){return Promise.reject("nocontent")})},this.realizeInternal=function(){this.logStatistics&&this.initStatistics(),N=this.mapviewerParameters.initialFloorName||N,(w=this.getFloor(N))?(this.currentFloorName=N,this.currentFloor=w):(this.currentFloorName=O[0].name,this.currentFloor=O[0]);for(var t=0,e=O.length;t<e;++t){(w=O[t]).setEnabled(w.name===this.currentFloorName),w.name===this.currentFloorName&&(this.current_lod=w.lods[w.lods.length-1].index);for(var i=0,n=w.lods.length;i<n;++i){if(void 0!==(M=w.lods[i])){var r=w.name===this.currentFloorName&&M.index===this.current_lod;M.setEnabled(r),M.node.traverse(function(t){t.geometry})}}}if($d.each(this.pending.addPOI,function(t){t.forEach(function(e,i){var n=this.addPOIInternal(md.extendDeep({},e));null!==n?(this.loaderStatistics.pois--,t[i]=n):t.splice(i,1)},this)}.bind(this)),this.optimizations.batchIcons.delayCanvasCreation){var s=function(){a.graphicsLoading()||(a.iconGenerator.realize(),a.off("redraw",s),a.requestRedraw())};this.on("redraw",s)}if(this.optimizations.batchTexts.delayCanvasCreation){var o=function(){a.graphicsLoading()||(a.floors.forEach(function(t){t.lods.forEach(function(t){Object.values(t.poiBatches.texts).forEach(function(t){t.textureGenerator.realize()})})}),a.off("redraw",o),a.requestRedraw())};this.on("redraw",o)}this.places.realize(),this.pending.addTiledImages.length>0&&this.pending.addTiledImages.forEach(function(t){this.addTiledImages(t)},this);var l=new li(0,0,-1),h=new li,c=new Vu(h,l);if(x)for(var p in this.pois){var m=this.pois[p];for(var f in m){var g=m[f],v=g.options("lod");if(void 0!==v){var y=g.options("position"),b=g.options("floor"),w=this.getFloor(b);h.copy({x:y.x,y:y.y,z:1e3}),c.set(h,l);var _=w.floorContentLOD.pickables,M=w.getLOD(v);_=_.concat(M.node);var S=c.intersectObjects(_,!0);if(0!==S.length){var T=S[0].point.z;T!==y.z&&(y.z=T,g.options("position",y,!0))}}}}var E=this.getExtraData().background;if(void 0!==E)switch(E.type){case"skybox":E.parameters.data.image=u+E.parameters.data.image,this.once("initializeCompleted",function(){this.setSkybox(E.parameters)}.bind(this));break;case"image":d.style["background-image"]="url("+u+E.file+")",d.style["background-size"]="cover";break;case"gradient":d.style.background="linear-gradient("+E.start+","+E.stop+")";break;case"color":d.style["background-color"]=E.color}this.resizeInternal(md.getElementWidth(d),md.getElementHeight(d),!1),this.mustUpdateCameraObjects=!0,this.requestRedraw()},this.realize=function(){this.loadCompleted&&(this.realizeInternal(),this.initializeCompleted=!0,this.notifications.trigger("initializeCompleted",void 0,!0))},this.realizeBind=this.realize.bind(this),this.removePOIs=function(){for(var t=Object.keys(this.pois),e=t.length-1;e>=0;e--)for(var i=this.pois[t[e]],n=i.length-1;n>=0;n--)i[n].remove();this.pois={},this._anonymous_poi_counter=0,this.pois_with_selector=[],this.pois_floor_table={};var r=Object.keys(this.textures);for(e=r.length-1;e>=0;e--)this.textures[r[e]].texture.dispose();this.textures={};var a=Object.keys(this.models);for(e=a.length-1;e>=0;e--)mm.removeModel(this,a[e]);this.models={}},this.unloadInternal=function(){return!this.loadStarted||!(!this.loadCompleted||this.graphicsLoading())&&(this.removePOIs(),this.pending.addPOI={},this.pending.addTiledImages=[],this.polygons_table={},this.pofs_table={},this.nbUpdatableObjects=0,this.publicFootprintsTable={},this.publicFootprintsTableInitialized=!1,this.publicPOFTable={},this.publicPOFTableInitialized=!1,O.forEach(function(t){t.unload()}),O=[],C={},this.publicFloors=null,this.currentFloorName="",this.currentFloor=null,this.activeLODList=[],this.places.destroy(),void 0!==this.multiBuildingView&&null!==this.multiBuildingView&&(this.multiBuildingView.removeCallbacks(),this.multiBuildingView.publicMultiBuildingView.destroyPublicInterface(),this.multiBuildingView=null),void 0!==this.cameraDrivenExplorer&&null!==this.cameraDrivenExplorer&&(this.cameraDrivenExplorer.setEnabled(!1),this.cameraDrivenExplorer.publicCameraDrivenExplorer.destroyPublicInterface(),this.cameraDrivenExplorer=null),void 0!==this.navigationTranslator&&null!==this.navigationTranslator&&(this.navigationTranslator.publicNavigationTranslator.destroyPublicInterface(),this.navigationTranslator=null),this.routingSolver=!1,this.navigationSolver=!1,this.cameraNorthRotation=!1,this.postRenderListeners=[],this.postRenderListenersRemoveList=[],this.loadStarted=!1,this.loadCompleted=!1,this.initializeCompleted=!1,this.off("setupViewCompleted",this.realizeBind),this.notifications.unstick("loadCompleted initializeCompleted"),!0)},this.unload=function(){return new Promise(function(t){var e=!1,i=function(){a.unloadInternal()&&(e=!0,t())};if(i(),!e)if(a.graphicsLoading()){var n=function(){a.graphicsLoading()||(i(),a.off("redraw",n))};a.on("redraw",n)}else a.once("loadCompleted",i)})},this.destroyViewInternal=function(){if(!this.setupViewStarted)return!0;if(!this.setupViewCompleted||this.graphicsLoading())return!1;for(var t=O.length-1;t>=0;t--){var e=O[t];if(e.tiledImages){for(var i=0,n=e.tiledImages.length;i<n;++i){e.tiledImages[i].remove()}e.tiledImages=[],delete e.tiledImages}}return this.removePOIs(),void 0!==this.multiBuildingView&&null!==this.multiBuildingView&&(this.multiBuildingView.removeCallbacks(),this.multiBuildingView.publicMultiBuildingView.destroyPublicInterface(),this.multiBuildingView=null),void 0!==this.cameraDrivenExplorer&&null!==this.cameraDrivenExplorer&&(this.cameraDrivenExplorer.setEnabled(!1),this.cameraDrivenExplorer.publicCameraDrivenExplorer.destroyPublicInterface(),this.cameraDrivenExplorer=null),void 0!==this.navigationTranslator&&null!==this.navigationTranslator&&(this.navigationTranslator.publicNavigationTranslator.destroyPublicInterface(),this.navigationTranslator=null),this.off("redraw"),this.off("resize"),this.off("mouseup"),this.off("routeComputed"),this.off("floorChanged"),this.off("exploreStateWillChange"),this.off("exploreStateChanged"),this.setupViewStarted=!1,this.setupViewCompleted=!1,this.initializeCompleted=!1,this.notifications.unstick("setupViewCompleted initializeCompleted"),d&&(!function(){document.removeEventListener("keyup",st,!1),document.removeEventListener("mouseup",lt,!1),d.removeEventListener("mousedown",ot,!1),d.removeEventListener("mousemove",ft,!1),d.removeEventListener("mouseup",ht,!1),d.removeEventListener("mouseout",ut,!1),d.removeEventListener("contextmenu",vt,!1);var t="mousewheel";navigator&&navigator.userAgent&&-1!=navigator.userAgent.indexOf("Firefox")&&(t="DOMMouseScroll");d.removeEventListener(t,gt)}(),this.hide(),d=null),this.mc&&(this.mc.destroy(),this.mc=null),Dy.removeAll(),this.renderer&&this.renderer.clear(),null!==this.skybox&&this.skybox.dispose(),E=!1,v=!1,this.scene.remove(this.ambient,this.light,this.camera),this.publicCamera=null,!0},this.destroyView=function(){return new Promise(function(t){var e=!1,i=function(){a.destroyViewInternal()&&(e=!0,t())};if(i(),!e)if(a.graphicsLoading()){var n=function(){a.graphicsLoading()||(i(),a.off("redraw",n))};a.on("redraw",n)}else a.once("setupViewCompleted",i)})},this.destroy=function(){return this.unload().then(this.destroyView).then(function(){this.scene=null,this.notifications=null,a=null}.bind(this))};var mt=0;function ft(t){if(B){switch(a.manipulatorTypeName){case"map":case"hybrid":if(t.target!==p.domElement)return!1;t.preventDefault();var e=pt(t);if(a.notifications.trigger("mousemove",{event:t,position:e}),a.inertiaManipulator.enabled&&a.inertiaManipulator.hasGestureStarted()&&a.inertiaManipulator.pushCameraSample(),0===z.button);else if(1===z.button)a.manipulator.zoomManipulatorEnabled&&("hybrid"!==a.manipulatorTypeName||a.multiBuildingView.multifloorConfig.zoom)&&(a.manipulator.radius*=1+a.manipulator.zoomSpeed*(z.lastY-e.y),a.manipulator.update(),!1!==a.customPostManipulatorListener&&a.customPostManipulatorListener({type:"dragmiddle",center:e,event:t}));else if(2===z.button){var i=!1;a.manipulator.pitchManipulatorEnabled&&("hybrid"!==a.manipulatorTypeName||a.multiBuildingView.multifloorConfig.pitch)&&(a.publicCamera.pitch+=a.manipulator.rotationSpeed*(e.y-z.lastY),i=!0),a.manipulator.rotationManipulatorEnabled&&("hybrid"!==a.manipulatorTypeName||a.multiBuildingView.multifloorConfig.rotation)&&(a.publicCamera.rotation+=a.manipulator.rotationSpeed*(e.x-z.lastX),i=!0),i&&(a.manipulator.update(),!1!==a.customPostManipulatorListener&&a.customPostManipulatorListener({type:"dragright",center:e,event:t}))}else!function(t,e){var i=dt(t);if(!1!==i){var n,r,a,s,o,l,h,c,u=A.slice(0);for(n in A=i,u){for(r in o=(a=u[n]).vg.id,l=!1,i)if(o===(s=i[r]).vg.id){l=!0;break}if(!l){h=a.vg,c=a.target;var p=!0;h.poi&&h.poi.onObjectMouseOut&&(p=h.poi.onObjectMouseOut(e,c,mt)),!1!==p&&void 0!==S&&S(e,c,mt)}}for(r in i){(s=i[r]).vg.id,h=s.vg,c=s.target;var d=!0;h.poi&&h.poi.onObjectMouseOver&&(d=h.poi.onObjectMouseOver(e,c,mt)),!1!==d&&void 0!==M&&M(e,c,mt)}mt++}}(e,t);z.lastX=e.x,z.lastY=e.y}return!1}B=!0}function gt(t,e){if(void 0===e&&(t.wheelDeltaY?e=t.wheelDeltaY:t.wheelDelta?e=t.wheelDelta:t.detail&&(e=-t.detail),void 0===e&&window.event&&((t=window.event).wheelDeltaY?e=t.wheelDeltaY:t.wheelDelta?e=t.wheelDelta:t.detail&&(e=-t.detail))),!1===a.customPreManipulatorListener||!1!==a.customPreManipulatorListener({type:"wheel",delta:e})){switch(a.manipulatorTypeName){case"map":{t.preventDefault();let u=.1,p=1200;var i=.8,n=(new Date).getTime();if(this.wheelLastTime){const t=24;var r=n-this.wheelLastTime;r<1e3?(i=Math.abs(u-p)<.001?1-r/1e3*t/2:1-r/1e3*(Math.abs(e)-u)/(p-u)*t,Math.abs(i-1)<1e-5&&(i=.99)):i=.8}else i=1;if(i<.8&&(i=.8),this.wheelLastTime=n,Math.abs(i-1)<1e-6)return;if(void 0!==e&&a.manipulator.zoomManipulatorEnabled){var s=d.getBoundingClientRect(),o={left:t.clientX-s.left,top:t.clientY-s.top},l=a.convertScreenToPoint(o);if(e>0?a.manipulator.radius*=i:a.manipulator.radius/=i,a.manipulator.update(),"map"==a.manipulatorTypeName){var h=a.convertScreenToPoint(o),c=a.publicCamera.position;a.publicCamera.position={x:l.x-h.x+c.x,y:l.y-h.y+c.y,radius:c.radius}}}}}if(!1===a.customPostManipulatorListener||!1!==a.customPostManipulatorListener({type:"wheel",delta:e}))return!1}}function vt(t){return t.target===p.domElement&&(t.preventDefault(),!1)}function yt(t){var e={};return e.x=(t.x-f)*H.meters_per_pixel,e.y=(f-t.y)*H.meters_per_pixel,void 0!==t.z&&(e.z=t.z),e}function xt(t){var e={};return e.x=t.x/H.meters_per_pixel+f,e.y=f-t.y/H.meters_per_pixel,void 0!==t.z&&(e.z=t.z),e}this.wheelLastTime=0,this.requestRedraw=function(){y&&(E||!1!==v||(v=requestAnimationFrame(a.animateBind)))},this.requestContinuousUpdate=function(t){y&&(E=t,!1===v&&(v=requestAnimationFrame(a.animateBind)))};var bt,wt=function(t,e){var i=Math.sin(H.rotation_angle_in_degrees*Math.PI/180),n=Math.cos(H.rotation_angle_in_degrees*Math.PI/180),r=t-H.pixel_xref,a=e-H.pixel_yref;return[H.meters_per_pixel*(r*n-a*i),H.meters_per_pixel*(r*i+a*n)]};function _t(t,e,i,n,r,a){for(var s in void 0===t.initialValue&&(t.initialValue={}),e)r?t.initialValue[s]=t[s]:(void 0===t.initialValue[s]&&(t.initialValue[s]=t[s]),t[s]=e[s]);var o,l;if(n=n||0,r)o=e;else for(var h in o={},e){void 0!==t.initialValue[h]&&(o[h]=t.initialValue[h])}if(0===i&&0===n){for(var h in o)t[h]=o[h];"function"==typeof a&&a()}else l=new Dy.Tween(t).to(o,i).delay(n).start(),"function"==typeof a&&l.onUpdate(a)}function Mt(t,e,i,n){var r=t.index<i.index?-1:1,s=F.translate.clone().multiplyScalar(r),o=n&&"number"==typeof n.animationDuration?n.animationDuration:F.transitionTime;return _t(t.node.position,{x:s.x,y:s.y,z:s.z},o,0,e,function(){t.node.updateMatrix(),t.node.updateMatrixWorld(!0)}),t.node.traverse(function(t){if(void 0!==t.material)if(t.material instanceof qp)for(var i in t.material.materials)_t(t.material.materials[i],{opacity:0},o,0,e);else _t(t.material,{opacity:0},o,0,e)}),new Promise(function(t,e){if(0===o)t();else{new Dy.Tween({dummy:0}).to({dummy:1},o).onComplete(function(){a.forcePoiUpdateOpacity||(a.forcePoiUpdateOpacity=!0,a.updateCameraObjects(),a.forcePoiUpdateOpacity=!1,a.requestRedraw()),t()}).start()}})}this.setAutoUpdateLOD=function(t){for(var e=0,i=O.length;e<i;e++)O[e].setAutoUpdateLOD(t)},this.forcePoiUpdateOpacity=!1,this._updateObjectOpacity=function(t,e){if(void 0!==t.vg.poi&&void 0!==t.vg.poi.visibilityRampStartVisible&&void 0!==t.vg.poi.visibilityRampFullyVisible&&void 0!==t.vg.poi.visibilityRampStartInvisible&&void 0!==t.vg.poi.visibilityRampFullyInvisible){var i=a.computeOpacity(t.position,t.vg.poi,e);t.visible=0!=i&&!1!==t.vg.poi.visible;var n=t.vg.poi._opacity;(this.forcePoiUpdateOpacity||n!==i)&&(t.vg.poi._opacity=i,t.traverse(function(t){if(t.material)if(void 0!==t.material.materials)for(var e=t.material.materials,n=0,r=e.length;n<r;++n)e[n].opacity=i;else if(void 0!==t.material.length)for(n=0,r=t.material.length;n<r;++n)t.material[n].opacity=i;else t.material.opacity=i;if(t.vg&&t.vg.poi&&t.vg.poi.selector){var a=document.querySelector(t.vg.poi.selector);0===i||!1===t.vg.poi.visible?a.style.display="none":(a.style.opacity=i,a.style.display="")}}))}},this.updateCameraObjects=function(){for(var t=0,e=O.length;t<e;t++){if((x=O[t]).isAutoUpdateLOD()&&x.isEnabled())for(var i=this.computeTargetLod(x.name),n=0,r=x.lods.length;n<r;n++)x.lods[n].setEnabled(n==i),x.lods[n].setActive(n==i);if(x.isEnabled()&&x.tiledImages)for(var s=0,o=x.tiledImages.length;s<o;++s){x.tiledImages[s].update()}x.name==this.currentFloorName&&(this.current_lod=i)}var l;for(t=0,e=a.activeLODList.length;t<e;++t){var h=a.activeLODList[t],c=a.camera.position.clone();h.node.worldToLocal(c);for(var u=0,p=h.rampObjects.length;u<p;++u)l=h.rampObjects[u],this._updateObjectOpacity(l,c);for(var d=0,m=h.cameraUpdatableObjects.length;d<m;++d)(l=h.cameraUpdatableObjects[d]).updateMatrix(),l.updateMatrixWorld();if(h.tiledImages)for(s=0,o=h.tiledImages.length;s<o;++s){h.tiledImages[s].update()}}for(var f=new li,g=(t=0,this.pois_with_selector.length);t<g;++t){var v=this.pois_with_selector[t];if(v.selector){var y=document.querySelector(v.selector),x=a.getFloor(v.floor);if((h=void 0!==v.lod?x.getLOD(v.lod):x.floorContentLOD).isActive()&&h.isContentEnabled()&&v.visible&&0!==v._opacity){f.copy(v.position);var b=a.getFloor(v.floor).getPosition();if(f.add(b),f.project(a.camera),f.z>1)y.style.display="none";else{y.style.display="";var w=this.viewportWidth*((f.x+1)/2),_=this.viewportHeight*((1-f.y)/2),M=md.getElementWidth(y),S=md.getElementHeight(y);w+=M*(v.alignment.x-1)/2,_-=S*(v.alignment.y+1)/2,""!==y.textContent&&(w=Math.round(w),_=Math.round(_)),y.style.transform="translate("+w+"px,"+_+"px)",y.style["webkit-transform"]="translate("+w+"px,"+_+"px)"}}else y.style.display="none",v._opacity=0}}for(t=0,e=a.globalCameraUpdatebleLinks.length;t<e;++t){a.globalCameraUpdatebleLinks[t].updateCamerafacing()}},this.removeLink=function(t){for(var e=0,i=a.globalCameraUpdatebleLinks.length;e<i;e++)if(a.globalCameraUpdatebleLinks[e]===t)return a.globalCameraUpdatebleLinks.splice(e,1),!0;return!1},this.removePath=function(t){var e=t.lod.pathObjects.indexOf(t);-1!==e&&t.lod.pathObjects.splice(e,1)},this.addActiveLOD=function(t){this.activeLODList.push(t)},this.removeActiveLOD=function(t){for(var e=0,i=a.activeLODList.length;e<i;e++)if(a.activeLODList[e]===t)return a.activeLODList.splice(e,1),!0;return!1},this.computeTargetLod=function(t){var e,i,n,r,a,s,o,u,p=0;if(null===l||h!==t){var d,f=this.getFloor(t).lods.length;if(l=[],h=t,H.meters_per_pixel){H.distance_coef||(H.distance_coef=.5),!1===c&&(e=m,a=n=(i=wt(0,0))[0],o=r=i[1],s=n,u=r,n=(i=wt(0,e))[0],r=i[1],a=Math.min(a,n),o=Math.min(o,r),s=Math.max(s,n),u=Math.max(u,r),n=(i=wt(e,e))[0],r=i[1],a=Math.min(a,n),o=Math.min(o,r),s=Math.max(s,n),u=Math.max(u,r),n=(i=wt(e,0))[0],r=i[1],a=Math.min(a,n),o=Math.min(o,r),s=Math.max(s,n),u=Math.max(u,r),c=Math.max(s-a,u-o)),d=.5*c*H.distance_coef,d/=1800*(Math.tan(.5*g.fovY*nd.DEG2RAD)/this.viewportHeight);for(var v=0;v<f-1;v++)l.push(d),d*=.5}else if(d=800,f>1){var y=700/(f-1);for(v=0;v<f-1;v++)d-=y,l.push(d)}}var x=this.manipulator.radius/this.publicLodFactor;H.meters_per_pixel&&(x*=Math.sin(-this.publicCamera.pitch*nd.DEG2RAD)*H.meters_per_pixel);v=0;for(var b=l.length;v<b&&x<l[v];++v)p++;return p},this.computeOpacity=(bt=new li,function(t,e,i){var n;return bt.copy(t),bt.sub(i),n=(n=bt.length())<e.visibilityRampStartVisible||n>e.visibilityRampFullyInvisible?0:n<e.visibilityRampFullyVisible?Ke.mapLinear(n,e.visibilityRampStartVisible,e.visibilityRampFullyVisible,0,1):n<=e.visibilityRampStartInvisible?1:Ke.mapLinear(n,e.visibilityRampFullyInvisible,e.visibilityRampStartInvisible,0,1)}),this.frameCounter=0,this.frameRate=0,this.frameRateRange=60,this.frameTimes=[],this.frameLastTime=0,this.frameRateDivider=1,this.frameRateProbing=!1,this.frameTimeLastProbe=0,this.animate=function(t){if(y&&(v=!1,this.frameCounter++,!E||!y||(v=requestAnimationFrame(a.animateBind),this.frameCounter%this.frameRateDivider==0))){var e;a.mustUpdateCameraObjects&&(a.updateCameraObjects(),a.mustUpdateCameraObjects=!1);for(var i=0,n=a.activeLODList.length;i<n;++i)for(var r=a.activeLODList[i],s=0,o=r.pathObjects.length;s<o;++s)if((e=r.pathObjects[s].mesh).vg.path&&e.material.map){var l=e.vg.path.speed;e.material.map.offset.x=-b*l}this.render()}},this.animateBind=this.animate.bind(this),this.postRenderListeners=[],this.postRenderListenersRemoveList=[],this.addPostRenderListener=function(t){this.postRenderListeners.push(t)},this.removePostRenderListener=function(t){for(var e=0,i=this.postRenderListeners.length;e<i;e++)if(this.postRenderListeners[e]===t)return this.postRenderListenersRemoveList.push(t),!0;return!1},this.render=function(){if(this.nbUpdatableObjects>0)for(var t,e=this.clock.getDelta(),i=0,n=a.activeLODList.length;i<n;++i)for(var r=a.activeLODList[i],s=0,o=r.animatedObjects.length;s<o;++s)(t=r.animatedObjects[s]).updateMatrixWorld(!0),t.vg.mixer.update(e);(Dy.update(),document.body.contains(d))&&(p.autoClear=!1,p.clear(),null!==this.skybox&&this.skybox.render(),p.render(this.scene,this.camera));b=(Date.now()-w)/1e3;for(i=0;i<this.postRenderListeners.length;i++)this.postRenderListeners[i]();for(a.notifications.trigger("redraw",void 0);this.postRenderListenersRemoveList.length>0;){var l=this.postRenderListenersRemoveList.pop();for(i=0,n=this.postRenderListeners.length;i<n;i++)if(this.postRenderListeners[i]===l){this.postRenderListeners.splice(i,1);break}}},this.animateObject=_t,this.getGeoinformation=function(){return H},this.convertPointToScreen=function(t){if(!this.initializeCompleted)return this.logNotReadyWarning("convertPointToScreen"),!1;var e=new li(t.x,t.y,t.z||0);return e.project(a.camera),{left:.5*this.viewportWidth*(e.x+1),top:.5*this.viewportHeight*(1-e.y)}},this.convertScreenToPoint=function(t,e){if(!this.initializeCompleted)return this.logNotReadyWarning("convertScreenToPoint"),!1;e=e||0;var i=new li(2*t.left/a.viewportWidth-1,1-2*t.top/a.viewportHeight,1);if(i.unproject(a.camera),this.camera instanceof Uc){var n=new li(2*t.left/a.viewportWidth-1,1-2*t.top/a.viewportHeight,-1);if(n.unproject(a.camera),i.z==n.z)return{x:n.x,y:n.y,z:e};var r=n.clone();return r.sub(i),r.multiplyScalar((n.z-e)/r.z),n.sub(r),{x:n.x,y:n.y,z:e}}var s=i.clone().sub(a.camera.position).normalize();if(Math.abs(s.z)<.001){var o=a.publicCamera.position;return{x:o.x,y:o.y,z:0}}var l=(a.camera.position.z-e)/-s.z,h=s.clone().multiplyScalar(l);return{x:(h=h.add(a.camera.position)).x,y:h.y,z:h.z}},this.convertLatLonToPoint=function(t){if(!j)return{x:0,y:0,z:1,valid:!1};var e,i,n,r,a=new Ug.toPoint([t.lon,t.lat]),s=Ug.transform(R,I,a),o={x:s.x-V,y:s.y-W},l=(i={},n=(e=o).x,r=e.y,i.x=n*H.matrixUTMToSVG.elements[0]+r*H.matrixUTMToSVG.elements[1]+H.matrixUTMToSVG.elements[4],i.y=n*H.matrixUTMToSVG.elements[2]+r*H.matrixUTMToSVG.elements[3]+H.matrixUTMToSVG.elements[5],void 0!==e.z&&(i.z=e.z),i);return l.z=2,o=yt(l)},this.convertPointToLatLon=function(t){if(!j)return{lat:0,lon:0,valid:!1};var e,i,n,r,a=xt(t),s=(i={},n=(e=a).x+H.matrixSVGToUTM.elements[4],r=H.matrixSVGToUTM.elements[5]-e.y,i.x=n*H.matrixSVGToUTM.elements[0]+r*H.matrixSVGToUTM.elements[1],i.y=n*H.matrixSVGToUTM.elements[2]+r*H.matrixSVGToUTM.elements[3],void 0!==e.z&&(i.z=e.z),i),o=[s.x+V,s.y+W,t.z||0],l=new Ug.toPoint(o),h=Ug.transform(I,R,l);return{lat:h.y,lon:h.x}},this.offsetPosition=function(t,e,i,n){var r=xt(t),a=Math.PI*(e+H.rotation_angle_in_degrees)/180,s=Math.PI*i/180;r.z=r.z||0;var o=n/H.meters_per_pixel;return yt({x:r.x+Math.sin(a)*Math.cos(s)*o,y:r.y-Math.cos(a)*Math.cos(s)*o,z:r.z+Math.sin(s)*n})},this.computeHeadingAngle=function(t,e,i){var n=lf._getVector(xt(t)),r=lf._getVector(xt(e)),a=lf._getVector(xt(i)),s=lf._subVectors(r,n),o=lf._subVectors(a,n);return s.z=0,o.z=0,0!=s.lengthSq()&&0!=o.lengthSq()&&lf._computeAngle(s.normalize(),o.normalize())},this.computeDistance=function(t,e){var i=lf._getVector(xt(t)),n=lf._getVector(xt(e)),r=(t.z||0)-(e.z||0),a=lf._subVectors(n,i);a.z=0;var s=a.length()*H.meters_per_pixel;return 0==r?s:Math.sqrt(s*s+r*r)},this.initializeProjection=function(t){return j=!1,"string"==typeof t.proj4string&&(!!t.proj4string.replace(/\+proj=(\S+).*$/,"$1").match(/utm|somerc|tmerc|lcc/)&&(R=new Ug.Proj("WGS84"),I=new Ug.Proj(t.proj4string),V=parseFloat(t.offsetX)||0,W=parseFloat(t.offsetY)||0,j=!0,!0))},this.textGenerator=new _d,this.iconGenerator=new Md,this.addPOI=function(t){var e=a.getFloor(t.floor),i=null!==e,n=!1;if(i){var r=void 0!==t.lod?e.getLOD(t.lod):e.floorContentLOD;(t.overlay||r)&&(n=!0)}return!this.initializeCompleted||i&&!n?(t.id?(void 0===this.pending.addPOI[t.id]&&(this.pending.addPOI[t.id]=[]),this.pending.addPOI[t.id].push(t),this.loaderStatistics.pois++):(void 0===this.pending.addPOI.anonymous&&(this.pending.addPOI.anonymous=[]),this.pending.addPOI.anonymous.push(t),this.loaderStatistics.pois++),!1):this.addPOIInternal(t)},this.addPOIInternal=function(t){return mm.createPOI({container:d,_mapviewer:a,MapviewerPrivate:ky},t)},this.addTiledImages=function(t){new Pm(a.camera,t).add()},this.addPath=function(t){if(!this.initializeCompleted)return this.logNotReadyWarning("addPath"),!1;var e=this.createPath(t);return!!e&&e.getPublicPath()},this.createPath=function(t){var e,i,n={};if(n.points=t.points,void 0===n.points||n.points.length<2)return!1;if(i=n.points,!t.forceCreatePath&&2===i.length&&i[0].x===i[1].x&&i[0].y===i[1].y&&i[0].z===i[1].z)return!1;n.url=t.url,n.speed=void 0!==t.speed?t.speed:0,n.repeat=t.repeat||-1,n.overlay=void 0!==t.overlay?t.overlay:!a.useDepthWriteForPOIs,n.segments=t.segments||-1,n.thickness=void 0!==t.thickness?t.thickness:2,n.lod=t.lod,n.floor=t.floor||a.currentFloorName,n.visible=void 0===t.visible||t.visible,n.color=void 0!==t.color?t.color:16777215,n.opacity=void 0!==t.opacity?t.opacity:1,n.interpolationStart=t.interpolationStart||0,n.interpolationEnd=void 0===t.interpolationEnd?1:t.interpolationEnd,n.interpolationTextureLikeWindow=void 0===t.interpolationTextureLikeWindow||t.interpolationTextureLikeWindow,n.thickness<0&&(n.thickness*=-1),void 0!==t.quality&&(n.decimationThreshold=5*(1-Math.max(0,Math.min(1,t.quality)))*Math.PI/180);var r=new Oc,s=i.length;for(e=0;e<s;e++)i[e].z=i[e].z||0,i[e]=new li(i[e].x,i[e].y,i[e].z);if(2===s)r.add(new Tc(i[0],i[1]));else{var o=new li,l=new li;for(e=0,l.subVectors(i[e+1],i[e]).multiplyScalar(.5).add(i[e]),r.add(new Tc(i[e],l.clone())),e=1,o.subVectors(i[e],i[e-1]),o.multiplyScalar(.5),o.add(i[e-1]),e=1;e<s-1;++e)l.subVectors(i[e+1],i[e]),l.multiplyScalar(.5),l.add(i[e]),r.add(new Mc(o.clone(),i[e],i[e],l.clone())),o=l.clone();e=s-2,o.subVectors(i[e+1],i[e]),o.multiplyScalar(.5),o.add(i[e]),r.add(new Tc(o,i[e+1]))}var h=r.getLength();n.segments<0&&(n.segments=Math.ceil(-h/n.segments));var c=n.repeat;c<0&&(c*=-h/n.thickness);var u=new ud(r,{segments:n.segments,decimationThreshold:n.decimationThreshold,radius:n.thickness,segmentsRadius:2,closed:!1,debug:!1,interpolationStart:n.interpolationStart,interpolationEnd:n.interpolationEnd,interpolationTextureLikeWindow:n.interpolationTextureLikeWindow,zOffset:ky.zOffsetPath}),p=u.geometry,d=new Dn({color:n.color,opacity:n.opacity,wireframe:!1,transparent:!0,depthWrite:!1,depthTest:!n.overlay});if(n.url){var m=new ed(a,n.url,!1);m.wrapS=et,m.wrapT=et,m.repeat.x=c,m.repeat.y=-1,d.map=m}else n.speed=0;var f=new br(p,d);f.matrixAutoUpdate=!1,f.renderOrder=-(n.overlay?ky.renderDepthPathOverlay:ky.renderDepthPath)+p.vertices[0].z,f.doubleSided=!1;var g=a.scene,v=a.getFloor(n.floor);if(null===v&&(v=a.getFloor(a.currentFloorName)),null!==v){var y=void 0!==n.lod?v.getLOD(n.lod):v.floorContentLOD;g=(n.overlay,y.contentNode)}g.add(f),f.updateMatrixWorld(!0),f.vg={path:n};var x=new bm(a,n,r,h,f,u,v.floorContentLOD);return v.floorContentLOD.pathObjects.push(x),0!==n.speed&&n.visible&&a.incrementUpdatableObjects(),n.visible&&a.requestRedraw(),x},this.addFloorLink=function(t){if(!this.initializeCompleted)return this.logNotReadyWarning("addFloorLink"),!1;if(void 0===(t=t||{}).startPoint||void 0===t.endPoint)return!1;var e=a.getFloor(t.startFloor||a.currentFloorName);if(null===e)return!1;var i=a.getFloor(t.endFloor||a.currentFloorName);if(null===i)return!1;var n=e.getPosition(),r={x:t.startPoint.x,y:t.startPoint.y,z:t.startPoint.z||0},s=i.getPosition(),o={x:t.endPoint.x,y:t.endPoint.y,z:t.endPoint.z||0},l={x:s.x-n.x+o.x,y:s.y-n.y+o.y,z:s.z-n.z+o.z},h={floor:e.name,points:[r,l],forceCreatePath:!0,segments:1,url:t.url,color:t.color,repeat:t.repeat,speed:t.speed,thickness:t.thickness,visible:t.visible,opacity:t.opacity,interpolationStart:t.interpolationStart,interpolationEnd:t.interpolationEnd,interpolationTextureLikeWindow:t.interpolationTextureLikeWindow,overlay:t.overlay};if(h.points&&2!=h.points.length)return!1;this.mustUpdateCameraObjects=!0;var c=this.createPath(h);return!1!==c&&(c.setLinkOptions({cameraFacing:!0,startFloor:e,endFloor:i,startPoint:r,endPoint:o}),this.globalCameraUpdatebleLinks.push(c),c.getPublicLink())},this.recreateAndUpdateMeshFromPathGeometry=function(t,e,i){i=void 0===i||i;var n=e.parent;n&&n.remove(e);var r=e.vg||{},s=e.doubleSided||!1,o=e.material;return e.geometry.dispose(),(e=new br(t.clone(),o)).matrixAutoUpdate=!1,e.renderOrder=-(r.path.overlay?ky.renderDepthPathOverlay:ky.renderDepthPath),t.vertices.length>0&&(e.renderOrder+=t.vertices[0].z),e.vg=r,e.doubleSided=s,n&&(n.add(e),e.updateMatrixWorld(!0)),e.traverse(function(t){t.visible=i}),a.requestRedraw(),e},this.plugin=function(t){return this.plugins[t]},this.incrementUpdatableObjects=function(){++this.nbUpdatableObjects,this.requestContinuousUpdate(!0),_=!1},this.decrementUpdatableObjects=function(){0!==this.nbUpdatableObjects?(--this.nbUpdatableObjects,0===this.nbUpdatableObjects&&(this.requestContinuousUpdate(!1),_=!0)):zy.log("ERROR INTERNAL: decrementUpdatableObjects below 0")},this.computeRoute=function(t){return new Promise(function(e,i){if(void 0!==t&&void 0!==t.src&&void 0!==t.dst){var n={src:t.src,dst:t.dst};void 0!==a.logStatistics&&a.logStatistics&&a.statistics.logStat("routing",n);var r=["computeNavigation","language","routingParameters","navigationParameters"];for(var s in r){var o=r[s];void 0!==t[o]&&(n[o]=t[o])}n.version=this.version,n.sdk="VisioWeb";var l=this.routingSolver.computeRoute(t);l.sdkVersion=a.version,200===l.status&&t.computeNavigation&&!1!==this.navigationSolver&&(l.navigation=this.navigationSolver.computeNavigation(l,t.navigationParameters)),e({request:t,data:l})}else i(new Error("routeRequest invalid, maybe missing src or dst"))}.bind(this)).then(function(e){return a.notifications.trigger("routeComputed",{request:e.request,data:e.data}),void 0!==t.success&&t.success(e),e}).catch(function(e){throw void 0!==t.error&&t.error(),e})},this.getRoutingModalities=function(){return!1!==a.routingSolver&&a.routingSolver.getModalities()},this.getRoutingAttributes=function(){return!1!==a.routingSolver&&a.routingSolver.getAttributes()},this.getRoutingNode=function(t,e){return!1!==a.routingSolver?a.routingSolver.getRoutingNode(t,e):t},this.getLoaderStatistics=function(){return this.loaderStatistics.requestRedraw=!1!==v,this.loaderStatistics},this.graphicsLoading=function(){return!(0==this.loaderStatistics.models&&0==this.loaderStatistics.textures)},this.queryNearPlaces=function(t,e){return!1!==a.routingSolver?a.routingSolver.queryNearPlaces(t,e):[]},this.start=function(){if(!this.initializeCompleted)return this.logNotReadyWarning("start"),!1;y=!0,_?a.requestRedraw():a.requestContinuousUpdate(!0)},this.stop=function(){y=!1},this.show=function(){d&&"hidden"===d.style.visibility&&(d.style.visibility="visible",document.addEventListener("mouseup",lt,!1),this.initializeCompleted&&this.start())},this.hide=function(){d&&"visible"===d.style.visibility&&(d.style.visibility="hidden",document.removeEventListener("mouseup",lt,!1),this.stop())},this.getFloors=function(){if(!this.publicFloors){this.publicFloors=[];for(var t=0,e=O.length;t<e;t++)this.publicFloors.push(O[t].getPublicFloor());this.publicFloors.sort(function(t,e){return void 0!==t.heightMin&&void 0!==t.heightMax&&void 0!==e.heightMin&&void 0!==e.heightMax?t.heightMax+t.heightMin-(e.heightMax+e.heightMin):0});for(t=0,e=this.publicFloors.length;t<e;t++)this.getFloor(this.publicFloors[t].name).index=t}return this.publicFloors},this.publicPOFTable={},this.publicPOFTableInitialized=!1,this.getPOF=function(t){var e=this.publicPOFTable[t];if(e)return e;if(void 0!==this.pofs_table[t]){e=this.pofs_table[t];var i=yt({x:parseFloat(e.x),y:parseFloat(e.y)}),n=this.pois_floor_table[t],r={id:t,x:i.x,y:i.y,height:e.height,headingInDegrees:e.headingInDegrees,floor:n?n.floorName:void 0};return this.publicPOFTable[t]=r,r}return!1},this.getPOFs=function(){if(!this.publicPOFTableInitialized){for(var t in this.pofs_table)this.getPOF(t);this.publicPOFTableInitialized=this.initializeCompleted}return this.publicPOFTable},this.isInside2D=function(t,e){return nd.isInside2D(t,e)},this.isInsideFootprint=function(t,e){var i=this.getFootprint(e);return!!i&&("number"==typeof i.length?i.some(function(e){return this.isInside2D(t,e.points)},this):this.isInside2D(t,i.points))},this.getFootprint=function(t){var e=this.publicFootprintsTable[t];if(void 0!==e)return e;if(void 0!==this.polygons_table[t]&&this.polygons_table[t].length>0){var i=this.pois_floor_table[t],n=i?i.floorName:void 0,r=this.polygons_table[t];if(r.length>1){e=[];for(var a=0;a<r.length;a++){for(var s=[],o=0,l=(c=r[a].points.split(/,/)).length;o<l;++o)u=c[o].split(/ /),s.push(yt({x:parseFloat(u[0]),y:parseFloat(u[1])}));var h={id:t,points:s,floor:n};e.push(h)}}else{var c,u;for(s=[],o=0,l=(c=r[0].points.split(/,/)).length;o<l;++o)u=c[o].split(/ /),s.push(yt({x:parseFloat(u[0]),y:parseFloat(u[1])}));e={id:t,points:s,floor:n}}return this.publicFootprintsTable[t]=e,e}var p=this.getPOI(t),d=this.pending.addPOI[t];if(p&&p.length>0)return e={id:t,points:[p[0].options("position")],floor:p[0].options("floor")},this.publicFootprintsTable[t]=e,e;if(void 0!==d&&d.length>0)return e={id:t,points:d[0].position,floor:d[0].floor},this.publicFootprintsTable[t]=e,e;var m=this.getPOF(t);return!!m&&(e={id:t,points:[{x:m.x,y:m.y}],floor:m.floor},this.publicFootprintsTable[t]=e,e)},this.publicFootprintsTable={},this.publicFootprintsTableInitialized=!1,this.getFootprintPoints=function(t){var e=this.getFootprint(t);if(e){if("number"==typeof e.length){var i=[];return e.forEach(function(t){i.push.apply(i,t.points)}),i}return e.points}return!1},this.getFootprints=function(){if(!this.publicFootprintsTableInitialized){for(var t in this.polygons_table)this.getFootprint(t);this.publicFootprintsTableInitialized=this.initializeCompleted}return this.publicFootprintsTable},this.changeFloor=function(t,e){if(!this.initializeCompleted)return this.logNotReadyWarning("changeFloor"),!1;if(void 0===t)return Promise.reject();if(this.currentFloorName===t)return Promise.resolve();if(!1===a.notifications.trigger("floorWillChange",{current:a.currentFloorName,target:t}))return Promise.reject();var i=a.currentFloorName,n=this.currentFloor,r=n.getLOD(a.current_lod);if(r&&!L){var s=this.getFloor(t),o=this.computeTargetLod(t),l=s.getLOD(o);if(null===l&&0!==s.lods.length)for(var h in s.lods){o=h,l=s.lods[h];break}L=!0,a.incrementUpdatableObjects();var c=Mt;return c(n,!0,s,e).then(function(){return n.setEnabled(!1),r.setEnabled(!1),r.setActive(!1),s.setEnabled(!0),l.setEnabled(!0),l.setActive(!0),a.currentFloorName=t,a.currentFloor=s,a.current_lod=o,a.mustUpdateCameraObjects=!0,c(s,!1,n,e)}).then(function(){a.mustUpdateCameraObjects=!0,a.decrementUpdatableObjects(),a.requestRedraw(),L=!1,a.notifications.trigger("floorChanged",{current:i,target:t})})}return Promise.reject()},this.resize=function(t,e){return this.initializeCompleted?this.resizeInternal(t,e,!0):(this.logNotReadyWarning("resize"),!1)},this.resizeInternal=function(t,e,i){(this.viewportWidth=t,this.viewportHeight=e,g.update(this.viewportWidth,this.viewportHeight),void 0!==m&&void 0!==H)&&function(t,e){void 0===e&&(e=!1),a.manipulator.maxRadius=.5*t/Math.tan(.5*Math.min(g.fovY,g.fovX)*nd.DEG2RAD),a.manipulator.wholeRadius=a.manipulator.maxRadius,void 0!==Ny.radius||e||(a.manipulator.radius=a.manipulator.maxRadius),a.layersParameters.global.fog.far=3*t,a.sideInMeters=t,a.camera.far=a.layersParameters.global.fog.far;var i=a.getFootprint("limits");if(!1!==i&&i.points.length>0){var n={x:1/0,y:1/0},r={x:-1/0,y:-1/0};i.points.forEach(function(t){n.x=Math.min(n.x,t.x),n.y=Math.min(n.y,t.y),r.x=Math.max(r.x,t.x),r.y=Math.max(r.y,t.y)});var s=Math.max(r.x-n.x,r.y-n.y);a.manipulator.maxRadius=.5*s/Math.tan(.5*Math.min(g.fovY,g.fovX)*nd.DEG2RAD),a.publicCamera.setBoundary(i.points)}else{var o=.5*t;a.publicCamera.setBoundary([{x:-o,y:-o},{x:o,y:-o},{x:o,y:o},{x:-o,y:o},{x:-o,y:-o}])}a.manipulator.update()}(m*H.meters_per_pixel,!0);var n=this.camera;return n.aspect=this.viewportWidth/this.viewportHeight,n instanceof Uc?(n.left=this.viewportWidth/-2,n.right=this.viewportWidth/2,n.top=this.viewportHeight/2,n.bottom=this.viewportHeight/-2,n.aspect<1?this.orthographicNormalizedZoom=this.viewportWidth/this.sideInMeters:this.orthographicNormalizedZoom=this.viewportHeight/this.sideInMeters):n.fov=g.fovY,null!==this.skybox&&this.skybox.update(g.fovY,n.aspect),n.updateProjectionMatrix(),a.manipulator.update(),p.setSize(this.viewportWidth,this.viewportHeight),l=null,a.requestRedraw(),this.notifications.trigger("resize",{mapWidth:t,mapHeight:e},!0),i&&this.render(),!0},this.getCurrentFloor=function(){return this.initializeCompleted?this.currentFloorName:(this.logNotReadyWarning("getCurrentFloor"),!1)},this.getViewpointPosition=function(t){if(!this.initializeCompleted)return this.logNotReadyWarning("getViewpointPosition"),!1;var e,i,n=function(t,e){return void 0!==t?t<.5?t*e:t:0},r=n(t.top,this.viewportHeight),s=n(t.bottom,this.viewportHeight),o=n(t.left,this.viewportWidth),l=n(t.right,this.viewportWidth),h=t.points;if(void 0===h||!h.length)return!1;var c="number"==typeof t.pitch,u="number"==typeof t.heading;c&&(e=this.publicCamera.pitch,this.publicCamera.pitch=t.pitch),u&&(i=this.publicCamera.heading,this.publicCamera.heading=t.heading);var p=!1;(c||u)&&(p=function(){c&&(this.publicCamera.pitch=e),u&&(this.publicCamera.heading=i)}.bind(this));var d={right:new li(a.camera.matrix.elements[0],a.camera.matrix.elements[1],a.camera.matrix.elements[2]),up:new li(a.camera.matrix.elements[4],a.camera.matrix.elements[5],a.camera.matrix.elements[6]),view:new li(a.camera.matrix.elements[8],a.camera.matrix.elements[9],a.camera.matrix.elements[10])},m=.5*a.viewportWidth,f=.5*a.viewportHeight,g=m/f,v={};v.top=Math.tan(Ke.degToRad(.5*a.camera.fov)),v.bottom=-v.top,v.right=v.top*g,v.left=-v.right;var y={};for(var x in y.top=v.top*(f-r)/f,y.bottom=v.bottom*(f-s)/f,y.right=v.right*(m-l)/m,y.left=v.left*(m-o)/m,y.midVert=.5*(y.top+y.bottom),y.midHori=.5*(y.right+y.left),y.rngVert=y.top-y.bottom,y.rngHori=y.right-y.left,this.helpers)a.scene.remove(this.helpers[x]);if(this.helpers=[],1===h.length){var b=h[0];if(void 0===b||void 0===b.x||void 0===b.y)return p&&p(),!1;var w={left:m+.5*(o-l),top:f+.5*(r-s)},_=a.convertScreenToPoint(w,b.z||0),M=a.publicCamera.position,S={x:b.x-_.x+M.x,y:b.y-_.y+M.y,radius:M.radius};return p&&p(),S}for(var T,E=new li(h[0].x,h[0].y,h[0].z||0),A=E.clone(),P=-d.view.dot(new li(h[0].x,h[0].y,h[0].z||0)),L=(x=1,h.length);x<L;++x)T=h[x],E.x=Math.max(E.x,T.x),E.y=Math.max(E.y,T.y),E.z=Math.max(E.z,T.z||0),A.x=Math.min(A.x,T.x),A.y=Math.min(A.y,T.y),A.z=Math.min(A.z,T.z||0),P=Math.min(P,-d.view.dot(new li(h[x].x,h[x].y,h[x].z||0)));var O=new li;O.addVectors(A,E),O.multiplyScalar(.5),O=O.sub(d.view.clone().multiplyScalar(P+d.view.dot(O)));var C=new li(h[0].x,h[0].y,h[0].z||0);if(C.sub(O),E.x-A.x<1e-6&&E.y-A.y<1e-6&&E.z-A.z<1e-6)return S=this.getViewpointPosition({points:[h[0]],top:r,bottom:s,left:o,right:l}),p&&p(),S;if(a.camera instanceof Uc){p&&p();var R=Math.max(E.x-A.x,E.y-E.y),I=this.manipulator.wholeRadius*R/this.sideInMeters;return{x:O.x,y:O.y,radius:I}}var D={},N={};D.view=C.dot(d.view),N.top=C.dot(d.up),N.bottom=N.top,N.right=C.dot(d.right),N.left=N.right,N.top=N.top+D.view*y.top,N.bottom=N.bottom+D.view*y.bottom,N.right=N.right+D.view*y.right,N.left=N.left+D.view*y.left,N.topIndex=0,N.bottomIndex=0,N.rightIndex=0,N.leftIndex=0;for(x=1;x<h.length;++x)(C=new li(h[x].x,h[x].y,h[x].z||0)).sub(O),D.view=C.dot(d.view),D.top=C.dot(d.up),D.bottom=D.top,D.right=C.dot(d.right),D.left=D.right,D.top=D.top+D.view*y.top,D.bottom=D.bottom+D.view*y.bottom,D.right=D.right+D.view*y.right,D.left=D.left+D.view*y.left,D.top>N.top&&(N.top=D.top,N.topIndex=x),D.bottom<N.bottom&&(N.bottom=D.bottom,N.bottomIndex=x),D.left<N.left&&(N.left=D.left,N.leftIndex=x),D.right>N.right&&(N.right=D.right,N.rightIndex=x);N.midVert=.5*(N.top+N.bottom),N.midHori=.5*(N.right+N.left),N.rngVert=N.top-N.bottom,N.rngHori=N.right-N.left;var F={vertical:N.rngVert/y.rngVert,horizontal:N.rngHori/y.rngHori};if(F.vertical>F.horizontal){var z=F.vertical;j=O.clone().add(d.up.clone().multiplyScalar(N.midVert-z*y.midVert)).add(d.right.clone().multiplyScalar(N.midHori-z*y.midHori)).add(d.view.clone().multiplyScalar(z));var k=new li(h[N.leftIndex].x,h[N.leftIndex].y,h[N.leftIndex].z).sub(j.clone().sub(d.view.clone().multiplyScalar(z))),B=new li(h[N.rightIndex].x,h[N.rightIndex].y,h[N.rightIndex].z).sub(j.clone().sub(d.view.clone().multiplyScalar(z))),U=z-k.dot(d.view),G=z-B.dot(d.view),H=(k.dot(d.right)*G+B.dot(d.right)*U-2*y.midHori*U*G)/(U+G);j.add(d.right.clone().multiplyScalar(H))}else{z=F.horizontal;var j=O.clone().add(d.up.clone().multiplyScalar(N.midVert-z*y.midVert)).add(d.right.clone().multiplyScalar(N.midHori-z*y.midHori)).add(d.view.clone().multiplyScalar(z)),V=new li(h[N.topIndex].x,h[N.topIndex].y,h[N.topIndex].z).sub(j.clone().sub(d.view.clone().multiplyScalar(z))),W=new li(h[N.bottomIndex].x,h[N.bottomIndex].y,h[N.bottomIndex].z).sub(j.clone().sub(d.view.clone().multiplyScalar(z))),q=z-V.dot(d.view),X=z-W.dot(d.view),Y=(V.dot(d.up)*X+W.dot(d.up)*q-2*y.midVert*q*X)/(q+X);j.add(d.up.clone().multiplyScalar(Y))}var Z=j.z/d.view.z,J=d.view.clone().multiplyScalar(j.z/d.view.z);return j.sub(J),p&&p(),{x:j.x,y:j.y,radius:Z}},this.notifications=new Bd;var St=["loadCompleted","loadFailed","setupViewCompleted","initializeCompleted","initializeFailed","redraw","resize","mousemove","mouseup","routeComputed","floorWillChange","floorChanged","exploreStateWillChange","exploreStateChanged"];this.on=function(t,e){return this.notifications.on(t,e,!1)},this.once=function(t,e){return this.notifications.on(t,e,!0)},this.off=function(t,e){return this.notifications.off(t,e)},this.trigger=function(t,e,i){return-1!==St.indexOf(t)?(zy.log("%c"+t+"%c event type can only be triggered by %c VisioWeb %c","background:#ff5333 ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #1d2833","background:transparent","background:#35495e ; padding: 1px; border-radius: 3px 3px 3px 3px;  color: #fff; font-weight: bold;","background:transparent"),!1):this.notifications.trigger(t,e,i)},this.animateValue=function(t,e,i){return this.initializeCompleted?void 0!==i?(t=parseFloat(t),e=parseFloat(e),i.duration=void 0!==i.duration?i.duration:1e3,"number"==typeof i.duration&&(n=new Dy.Tween(t).to(e,i.duration),a.incrementUpdatableObjects(),"function"==typeof i.step&&n.onUpdate((o=i.step,function(i){o(t+i*(e-t))})),n.onComplete((s=i.complete,function(){if(a.decrementUpdatableObjects(),n.onStop(null),"function"==typeof s){var t=function(){setTimeout(function(){s()},0),a.removePostRenderListener(t)};a.addPostRenderListener(t),a.requestRedraw()}})),n.onStop((r=i.stop,function(){a.decrementUpdatableObjects(),n.onStop(null),"function"==typeof r&&r()})),n.start(),function(t){return{stop:function(){t.stop()},repeat:function(e){t.repeat(e)},yoyo:function(e){t.yoyo(e)}}}(n))):void 0:(this.logNotReadyWarning("animateValue"),!1);var n,r,s,o},this.cameraNorthRotation=!1,Object.defineProperty(this,"isAccelerated",{get:function(){return!0}}),Object.defineProperty(this,"version",{get:function(){return"1.11.0"}}),Object.defineProperty(this,"minimumDataSDKVersion",{get:function(){return"1.7.14"}}),Object.defineProperty(this,"sdkType",{get:function(){return"web"}}),Object.defineProperty(this,"revision",{get:function(){return"Error: not found: bash"}}),this.getExtraData=function(){return this.extraData},this.getMapName=function(){return this.mapName},this.getPOIs=function(){return this.initializeCompleted?$d.extend({},this.pois):$d.extend({},this.pending.addPOI)},this.getPOI=function(t){var e=this.pois[t];return void 0===e&&this.pending.addPOI[t]?this.pending.addPOI[t]:e},this.generatePOIClusters=function(t,e){if(!this.initializeCompleted)return this.logNotReadyWarning("generatePOIClusters"),!1;e&&delete e.log;var i=e&&e.log;i&&zy.time("total time");var n=new tf(this,e);if(!n.load(t))return zy.log("Could not load points. Input is empty or does not fit the expected format."),[];var r=n.getClusters();for(var a in n.finalize(),i&&zy.time("hide POIs"),t)t[a].poi.hide();return i&&zy.timeEnd("hide POIs"),i&&zy.timeEnd("total time"),$d.map(r,function(t){return t.getPublicPOICluster()})},this.initStatistics=function(){void 0===this.statistics&&(this.statistics=new Am(this)),this.statistics.setMapParameters(this.mapviewerParameters)},this.getLogStatistic=function(){return this.logStatistics},this.setLogStatistic=function(t){this.logStatistics=t,t?this.initStatistics():this.statistics=void 0},this.getLogStatisticURL=function(){return this.statistics.getURL()},this.setLogStatisticURL=function(t){this.statistics.setURL(t)},this.getLogStatisticAppID=function(){return this.statistics.getAppID()},this.setLogStatisticAppID=function(t){this.statistics.setAppID(t)},this.setTrackingEnabled=function(t,e,i){if("camera"===t)return this.camera.track=i,!0;if("poi"===t){var n=this.getPOI(e);if(n)return n.forEach(function(t){t.options("track",i)}),!0}return!1}}"undefined"!=typeof window&&window.console?((zy=window.console).time=zy.time||Fy,zy.timeEnd=zy.timeEnd||Fy):"undefined"!=typeof global&&global.console?((zy=global.console).time=zy.time||Fy,zy.timeEnd=zy.timeEnd||Fy):(zy.log=Fy,zy.warn=Fy,zy.error=Fy,zy.time=Fy,zy.timeEnd=Fy),ky.available_plugins=[],ky.zOffsetPOI=.1,ky.zOffsetPath=.1,ky.renderDepthPOIOverlayFacing=-45e4,ky.renderDepthPOIOverlay=-4e5,ky.renderDepthPathOverlay=-3e5,ky.renderDepthPath=-2e5,ky.renderDepthPOIFacing=-15e4,ky.renderDepthPOI=-1e5;var By=0;function Uy(t,e){this.mapviewer=t,this.colors=$d.extend({past:"#d7d8d9",current:"#00c5eb",future:"#0099ae"},e.pathColor),this.imagePath=e.imagePath||"../media",this.images=$d.extend({arrow:this.imagePath+"/track_arrow.png",start:this.imagePath+"/track_start.png",waypoint:this.imagePath+"/track_intermediate_destination.png",end:this.imagePath+"/track_end.png",up:this.imagePath+"/track_up.png",down:this.imagePath+"/track_down.png",modalityChange:this.imagePath+"/track_modality_change.png",layerChange:this.imagePath+"/track_layer_change.png"},e.images),this.floorChangeTag=$d.extend({},e.floorChangeTag);var i=function(){return!1};this.options=$d.extend({onClickStart:i,onClickWaypoint:i,onClickEnd:i,pathOpacity:.7,arrowRepeat:-.8,arrowWidth:5,arrowSpeed:1,pathOverlay:!1,pathSegments:-.5,pathQuality:.8,pathWidth:2,pathHeight:1,pinHeight:3},e),this._basePaths=[],this._animatedPaths=[],this._animatedPathSpeeds=[],this._links=[],this._routeIcons=[],this._instructionIcons=[],this._routeTags=[],this._modalitySpeeds={train:5,APM:5,shuttle:4,bus:4,travelator:3}}Uy.prototype.constructor=Uy,Uy.prototype.remove=function(){var t;for(t in this._basePaths)this._basePaths[t].remove();for(t in this._basePaths=[],this._animatedPaths)this._animatedPaths[t].remove();for(t in this._animatedPaths=[],this._links)this._links[t].remove();for(t in this._animatedPaths=[],this._routeIcons)this._routeIcons[t].remove();for(t in this._routeIcons=[],this._instructionIcons)this._instructionIcons[t].remove();for(t in this._instructionIcons=[],this._routeTags){var e=this._routeTags[t].options("selector"),i=document.querySelector(e);this._routeTags[t].remove(),i.remove()}this._routeTags=[],By=0},Uy.prototype.showPaths=function(){var t;for(t in this._basePaths)this._basePaths[t].show();for(t in this._animatedPaths)this._animatedPaths[t].show()},Uy.prototype.showIcons=function(){var t;for(t in this._routeIcons)this._routeIcons[t].show();for(t in this._instructionIcons)this._instructionIcons[t].show()},Uy.prototype.showTags=function(){var t;for(t in this._routeTags)this._routeTags[t].show()},Uy.prototype.showLinks=function(){for(var t in this._links)this._links[t].show()},Uy.prototype.hidePaths=function(){var t;for(t in this._basePaths)this._basePaths[t].hide();for(t in this._animatedPaths)this._animatedPaths[t].hide()},Uy.prototype.hideIcons=function(){var t;for(t in this._routeIcons)this._routeIcons[t].hide();for(t in this._instructionIcons)this._instructionIcons[t].hide()},Uy.prototype.hideTags=function(){var t;for(t in this._routeTags)this._routeTags[t].hide()},Uy.prototype.hideLinks=function(){for(var t in this._links)this._links[t].hide()},Uy.prototype.addLink=function(t){t.speed||(t.modality&&this._modalitySpeeds[t.modality]?t.speed=this._modalitySpeeds[t.modality]:t.speed=this.options.arrowSpeed);var e=$d.extend(t,{url:this.images.arrow,repeat:this.options.arrowRepeat,thickness:this.options.arrowWidth,segments:this.options.pathSegments,fixed:!1});let i=this.mapviewer.addFloorLink(e);i&&this._links.push(i)},Uy.prototype.addStartIcon=function(t){var e=$d.extend(t,{url:this.images.start,onObjectMouseUp:this.options.onClickStart,zoomScaleFactor:3,zoomScaleFast:!0,alignment:{x:0,y:1},overlay:!0,vgdelaycanvascreation:!1});e.position.z=this.options.pinHeight;let i=this.mapviewer.addPOI(e);i&&this._routeIcons.push(i)},Uy.prototype.addWaypointIcon=function(t){var e=$d.extend(t,{url:this.images.waypoint,onObjectMouseUp:this.options.onClickWaypoint,zoomScaleFactor:3,zoomScaleFast:!0,alignment:{x:0,y:1},overlay:!0,vgdelaycanvascreation:!1});e.position.z=this.options.pinHeight;let i=this.mapviewer.addPOI(e);i&&this._routeIcons.push(i)},Uy.prototype.addEndIcon=function(t){var e=$d.extend(t,{url:this.images.end,onObjectMouseUp:this.options.onClickEnd,zoomScaleFactor:3,zoomScaleFast:!0,alignment:{x:0,y:1},overlay:!0});e.position.z=this.options.pinHeight;let i=this.mapviewer.addPOI(e);i&&this._routeIcons.push(i)},Uy.prototype.addFloorChangeTag=function(t,e,i){var n=this.mapviewer.multiBuildingView?this.mapviewer.multiBuildingView.getLocalizedName(e):e,r="VGROUTE-floorChange-"+By++,a=this.floorChangeTag.innerHTML(r,n,i);document.getElementById(this.floorChangeTag.parent).innerHTML+=a;var s=$d.extend(t,{selector:"#"+r,alignment:{x:1,y:0}});s.position.z=this.options.pathHeight;let o=this.mapviewer.addPOI(s);o&&this._routeTags.push(o)},Uy.prototype.addFloorChangeIcon=function(t,e){var i=$d.extend(t,{url:e?this.images.up:this.images.down,alignment:{x:-1,y:1},zoomScaleFactor:3,overlay:!0,clickable:!1,vgdelaycanvascreation:!1});i.position.z=this.options.pinHeight;let n=this.mapviewer.addPOI(i);n&&this._routeIcons.push(n)},Uy.prototype.addLayerChangeIcon=function(t){var e=$d.extend(t,{url:this.images.layerChange,alignment:{x:1,y:1},zoomScaleFactor:3,overlay:!0,clickable:!1,vgdelaycanvascreation:!1});e.position.z=this.options.pinHeight;let i=this.mapviewer.addPOI(e);i&&this._routeIcons.push(i)},Uy.prototype.addModalityChangeIcon=function(t){var e=$d.extend(t,{url:this.images.modalityChange,alignment:{x:0,y:1},zoomScaleFactor:3,overlay:!0,clickable:!1,vgdelaycanvascreation:!1});e.position.z=this.options.pinHeight;let i=this.mapviewer.addPOI(e);i&&this._routeIcons.push(i)},Uy.prototype.addInstructionIcon=function(t){var e=$d.extend(t,{fixed:!0,scale:1.5*this.options.pathWidth,overlay:!0,clickable:!1,vgdelaycanvascreation:!1});e.position.z=this.options.pathHeight+.1,e.url=this.imagePath+"/"+e.url;let i=this.mapviewer.addPOI(e);i&&this._instructionIcons.push(i)},Uy.prototype.setNbPaths=function(t){this._basePaths=new Array(t),this._animatedPaths=new Array(t),this._animatedPathSpeeds=new Array(t)},Uy.prototype.setBasePath=function(t,e){e.color||(e.color=this.colors.future);for(var i=$d.extend(e,{repeat:-1,thickness:this.options.pathWidth,opacity:this.options.pathOpacity,overlay:this.options.pathOverlay,segments:this.options.pathSegments,quality:this.options.pathQuality}),n=0;n<i.points.length;++n)i.points[n].z=this.options.pathHeight-.2;this._basePaths[t]=this.mapviewer.addPath(i)},Uy.prototype.setAnimatedPath=function(t,e){e.speed||(e.modality&&this._modalitySpeeds[e.modality]?e.speed=this._modalitySpeeds[e.modality]:e.speed=this.options.arrowSpeed);for(var i=$d.extend(e,{url:this.images.arrow,repeat:this.options.arrowRepeat,thickness:this.options.arrowWidth,opacity:1,overlay:!0,segments:this.options.pathSegments,quality:this.options.pathQuality}),n=0;n<i.points.length;++n)i.points[n].z=this.options.pathHeight;this._animatedPaths[t]=this.mapviewer.addPath(i),this._animatedPathSpeeds[t]=i.speed},Uy.prototype.setBasePathColorType=function(t,e){void 0===this.colors[e]&&(e="future"),this._basePaths[t].options("color",this.colors[e])},Uy.prototype.stopAnimatedPath=function(t){this._animatedPaths[t].options("speed",0)},Uy.prototype.startAnimatedPath=function(t){this._animatedPaths[t].options("speed",this._animatedPathSpeeds[t])};var Gy=["navigationInstructionRadius"],Hy=[],jy=["getNbInstructions","getCurrentInstructionIndex","getInstructionData","getInstructionHeading","getInstructionViewpointPosition","displayNextInstruction","displayPrevInstruction"];function Vy(t){Pd.create(this,t,Gy,Hy,jy)}function Wy(t,e,i){this.mapviewer=t,this._instructions,this._instructionHeadings=[],this._currentInstructionIndex=0,this._numberOfInstructions=0,this._routeOverlay=new Uy(this.mapviewer,i),this.init(e),this._publicNavigation=null}Wy.prototype.getPublicNavigation=function(){return this._publicNavigation=this._publicNavigation||new Vy(this),this._publicNavigation},Wy.prototype.getNbInstructions=function(){return this._numberOfInstructions},Wy.prototype.getCurrentInstructionIndex=function(){return this._currentInstructionIndex},Wy.prototype.getInstructionData=function(t){return this._instructions[t]},Wy.prototype.navigationInstructionRadius=50,Wy.prototype.getInstructionIconFromAngle=function(t){var e=Math.abs(t);return e>180&&(t=(t>0?1:-1)*((e+180)%360-180),e=Math.abs(t)),e<30?"transit_instruction_straight.png":e<45?t>0?"transit_instruction_turn_gentle_right.png":"transit_instruction_turn_gentle_left.png":e<135?t>0?"transit_instruction_turn_right.png":"transit_instruction_turn_left.png":e<150?t>0?"transit_instruction_turn_sharp_right.png":"transit_instruction_turn_sharp_left.png":t>0?"transit_instruction_uturn_right.png":"transit_instruction_uturn_left.png"},Wy.prototype.displayNextInstruction=function(t,e){return this._currentInstructionIndex<this._numberOfInstructions-1&&(this._currentInstructionIndex++,this._routeOverlay.setBasePathColorType(this._currentInstructionIndex,"current"),this._routeOverlay.startAnimatedPath(this._currentInstructionIndex),this._routeOverlay.setBasePathColorType(this._currentInstructionIndex-1,"past"),this._routeOverlay.stopAnimatedPath(this._currentInstructionIndex-1),void 0===t||t)?this.goToCurrentInstruction(!!e):Promise.resolve()},Wy.prototype.displayPrevInstruction=function(t,e){return this._currentInstructionIndex>0&&(this._currentInstructionIndex--,this._routeOverlay.setBasePathColorType(this._currentInstructionIndex,"current"),this._routeOverlay.startAnimatedPath(this._currentInstructionIndex),this._routeOverlay.setBasePathColorType(this._currentInstructionIndex+1,"future"),this._routeOverlay.stopAnimatedPath(this._currentInstructionIndex+1,0),void 0===t||t)?this.goToCurrentInstruction(!!e):Promise.resolve()},Wy.prototype.show=function(){this._routeOverlay.showPaths(),this._routeOverlay.showIcons(),this._routeOverlay.showTags()},Wy.prototype.hide=function(){this._routeOverlay.hidePaths(),this._routeOverlay.hideIcons(),this._routeOverlay.hideTags()},Wy.prototype.remove=function(){this._routeOverlay.remove(),this._currentInstructionIndex=0,this._numberOfInstructions=0},Wy.prototype.goToCurrentInstruction=function(t){-1==this._currentInstructionIndex&&(this._currentInstructionIndex=0);var e=this.mapviewer.getCurrentFloor(),i=this._instructions[this._currentInstructionIndex].dataset;if(this.mapviewer.multiBuildingView){if(t){var n=this.getInstructionHeading(this._currentInstructionIndex).whole,r=this.getInstructionViewpointPosition(this._currentInstructionIndex,n);return this.mapviewer.multiBuildingView.goTo({mode:"floor",viewpoint:{position:r,heading:n},floorID:i})}r=this.getInstructionViewpointPosition(this._currentInstructionIndex);return this.mapviewer.multiBuildingView.goTo({mode:"floor",viewpoint:{position:r},floorID:i})}r=this.getInstructionViewpointPosition(this._currentInstructionIndex);return e!=i?this.mapviewer.changeFloor(i).then(function(){this.mapviewer.camera.goTo(r)}.bind(this)):this.mapviewer.camera.goTo(r)},Wy.prototype.getInstructionHeading=function(t){if(!this._instructionHeadings[t]){var e=this._instructions[t];if(e&&e.positions.length>1){var i=this.mapviewer,n=function(t,e){var n=i.convertLatLonToPoint(t),r=i.convertLatLonToPoint(e),a=i.offsetPosition(n,0,0,10);return i.computeHeadingAngle(n,a,r)};this._instructionHeadings[t]={start:n(e.positions[0],e.positions[1]),end:n(e.positions[e.positions.length-2],e.positions[e.positions.length-1]),whole:n(e.positions[0],e.positions[e.positions.length-1])}}else this._instructionHeadings[t]={start:0,end:0,whole:0}}return $d.extend({},this._instructionHeadings[t])},Wy.prototype.getInstructionViewpointPosition=function(t,e){var i=this._instructions[t];if(i.positions&&i.positions.length>0){for(var n=i.positions,r=[],a=0,s=n.length;a<s;a++){var o=n[a];o=this.mapviewer.convertLatLonToPoint(o),r.push(o)}var l;return(l=this.mapviewer.getViewpointPosition({points:r,top:50,bottom:50,left:50,right:50,heading:e})).radius=Math.max(l.radius,this.navigationInstructionRadius),l}return(l=this.mapviewer.convertLatLonToPoint(i.position)).radius=this.navigationInstructionRadius,l},Wy.prototype.createInstructionSegment=function(t){var e=this._instructions[t];if(e&&e.positions&&e.positions.length>1){var i=$d.map(e.positions,function(t){return this.mapviewer.convertLatLonToPoint(t)}.bind(this));this._routeOverlay.setAnimatedPath(t,{floor:e.dataset,points:i,modality:e.modality}),t>0&&this._routeOverlay.stopAnimatedPath(t),this._routeOverlay.setBasePath(t,{floor:e.dataset,points:i}),t<this._numberOfInstructions-1&&this._routeOverlay.addInstructionIcon({floor:e.dataset,position:this.mapviewer.convertLatLonToPoint(e.positions[e.positions.length-1]),heading:this.getInstructionHeading(t).end,url:e.icon})}},Wy.prototype.init=function(t){if(void 0!==t){if(this._instructions=t.instructions,Array.isArray(this._instructions)){if(this._numberOfInstructions=this._instructions.length,this._numberOfInstructions>0){this._routeOverlay.setNbPaths(this._numberOfInstructions);for(var e=0;e<this._instructions.length;++e)this.createInstructionSegment(e);if(t.parameters.initialHeading){var i=this._instructions[0];this._routeOverlay.addInstructionIcon({floor:i.dataset,position:this.mapviewer.convertLatLonToPoint(i.positions[0]),heading:t.parameters.initialHeading,url:this.getInstructionIconFromAngle(this.getInstructionHeading(0).start-t.parameters.initialHeading)})}}this._routeOverlay.setBasePathColorType(0,"current")}}else this.remove()};var qy=[],Xy=["finalFloor","initialFloor","navigation"],Yy=["getViewpointPosition","hide","hideLinks","isValid","show","showLinks"];function Zy(t,e,i){this.mapviewer=t,this.floors=this.mapviewer.getFloors(),i=i||{},this.showStartPin="boolean"!=typeof i.showStartPin||i.showStartPin,this.showWaypointPin="boolean"!=typeof i.showWaypointPin||i.showWaypointPin,this.showEndPin="boolean"!=typeof i.showEndPin||i.showEndPin,this.useFloorChangeTags="object"==typeof i.floorChangeTag&&"string"==typeof i.floorChangeTag.parent&&"function"==typeof i.floorChangeTag.innerHTML,this.useLinks="boolean"==typeof i.useLinks&&i.useLinks,this.addGoBackPins="boolean"==typeof i.addGoBackPins&&i.addGoBackPins;this.floorFilter="string"==typeof i.floorFilter&&-1!==["all","involved","traversed"].indexOf(i.floorFilter)?i.floorFilter:"all",this._routeFloors=[],this._routePrefix="VGROUTE-",this.initialFloor=!1,this._initialFloorPoints=[],this.finalFloor=!1,this._finalFloorPoints=[],this._allPoints=[],this._modalityChangeCounter=0,this._layerChangeCounter=0,this._valid=!1,this._navigation=null,e&&e.navigation&&(this._navigation=new Wy(this.mapviewer,e.navigation,i)),this._routeOverlay=new Uy(this.mapviewer,i),this.init(e)}Zy.prototype.getFloorHeight=function(t){if(void 0!==t.height)return t.height;for(var e in this.floors){var i=this.floors[e];if(i.name==t.dataset)return i.index}return 0},Zy.prototype.init=function(t){var e=t&&t.legs;if(e){this._navigation||this._routeOverlay.setNbPaths(e.length);for(var i=0,n=e.length;i<n;i++){for(var r=e[i],a=[],s=r.dataset,o=this.getFloorHeight(r),l=r.modality,h=r.destinationIndex,c=r.points,u=0,p=c.length;u<p;u++)a.push(this.mapviewer.convertLatLonToPoint(c[u]));if(!1===this.initialFloor&&(this.initialFloor=s),this.initialFloor==s&&(this._initialFloorPoints=this._initialFloorPoints.concat(a)),this.finalFloor=s,this._finalFloorPoints=a,this._allPoints=this._allPoints.concat(a),!this._navigation&&a.length>1&&(this._routeOverlay.setAnimatedPath(i,{floor:s,points:$d.map(a,function(t){return{x:t.x,y:t.y,z:t.z}}),modality:l}),this._routeOverlay.setBasePath(i,{floor:s,points:$d.map(a,function(t){return{x:t.x,y:t.y,z:t.z-.2}})})),0==i&&this.showStartPin){var d=this._routePrefix+"START";"string"==typeof t.request.src&&(d+="-"+t.request.src),this._routeOverlay.addStartIcon({floor:s,id:d,position:Object.assign({},a[0])})}var m=a.length-1;if(i==e.length-1&&this.showEndPin){var f=this._routePrefix+"END";"string"==typeof t.request.dst?f+="-"+t.request.dst:"string"==typeof t.request.dst[h]&&(f+="-"+t.request.dst[h]),this._routeOverlay.addEndIcon({floor:s,id:f,position:Object.assign({},a[m])})}if("all"!==this.floorFilter&&this._routeFloors.push(s),e.length>1){if(i>0){var g=e[i-1].dataset,v=this.getFloorHeight(e[i-1]);if(v!=o){if(this.addGoBackPins){var y={floor:s,id:this._routePrefix+"GOTOPREV-"+s+"->"+g,position:Object.assign({},a[0])},x=v>o;this.useFloorChangeTags?this._routeOverlay.addFloorChangeTag(y,g,x):this._routeOverlay.addFloorChangeIcon(y,x)}if(this.useLinks){var b=e[i-1].points,w=this.mapviewer.convertLatLonToPoint(b[b.length-1]),_=Object.assign({},a[0]);this._routeOverlay.addLink({floor:g,modality:l,startFloor:g,endFloor:s,startPoint:w,endPoint:_})}}}if(i<e.length-1){var M=e[i+1],S=M.dataset,T=this.getFloorHeight(M),E=M.modality;if(M.destinationIndex!=h&&this.showWaypointPin){var A=this._routePrefix+"WAYPOINT";"string"==typeof t.request.dst[h]&&(A+="-"+t.request.dst[h]),this._routeOverlay.addWaypointIcon({floor:s,id:A,position:Object.assign({},a[m])})}if(T!=o){y={floor:s,id:this._routePrefix+"GOTONEXT-"+s+"->"+S,position:Object.assign({},a[m])},x=T>o;if(this.useFloorChangeTags?this._routeOverlay.addFloorChangeTag(y,S,x):this._routeOverlay.addFloorChangeIcon(y,x),"traversed"===this.floorFilter&&this.mapviewer.multiBuildingView)for(var P=this.mapviewer.multiBuildingView.getVenueLayout().buildingByFloorID[s].floors.sort(function(t,e){return t.levelIndex-e.levelIndex}),L=P.findIndex(function(t){return t.id===s}),O=P.findIndex(function(t){return t.id===S}),C=Math.min(L,O),R=Math.max(L,O),I=C+1;I<R;I++)this._routeFloors.push(P[I].id)}else if(S!=s){y={floor:s,id:this._routePrefix+"LAYERCHANGE-"+this._layerChangeCounter++,position:Object.assign({},a[m])};this._routeOverlay.addLayerChangeIcon(y)}else if(E!=l){y={floor:s,id:this._routePrefix+"MODALITYCHANGE-"+this._modalityChangeCounter++,position:Object.assign({},a[m])};this._routeOverlay.addModalityChangeIcon(y)}}}}this._valid=!0}},Object.defineProperty(Zy.prototype,"navigation",{get:function(){return this._navigation?this._navigation.getPublicNavigation():null}}),Zy.prototype.isValid=function(){return this._valid},Zy.prototype.show=function(){return this._routeOverlay.showPaths(),this._routeOverlay.showIcons(),this._routeOverlay.showTags(),this._navigation&&this._navigation.show(),"all"!==this.floorFilter&&this.enableFloorFilter(),new Promise(function(t){requestAnimationFrame(t)})},Zy.prototype.hide=function(){this._routeOverlay.hidePaths(),this._routeOverlay.hideIcons(),this._routeOverlay.hideTags(),this._navigation&&this._navigation.hide(),"all"!==this.floorFilter&&this.disableFloorFilter()},Zy.prototype.showLinks=function(){this._routeOverlay.showLinks()},Zy.prototype.hideLinks=function(){this._routeOverlay.hideLinks()},Zy.prototype.remove=function(){"all"!==this.floorFilter&&this.disableFloorFilter(),this._routeOverlay.remove(),this._navigation&&(this._navigation.remove(),this._navigation.getPublicNavigation().destroyPublicInterface(),this._navigation=null)},Zy.prototype.getViewpointPosition=function(t){switch(t){case"start":return this.mapviewer.getViewpointPosition({points:[this._initialFloorPoints[0]]});case"end":return this.mapviewer.getViewpointPosition({points:[this._finalFloorPoints[this._finalFloorPoints.length-1]]});case"finalFloor":return this.mapviewer.getViewpointPosition({points:this._finalFloorPoints,top:50,bottom:50,left:50,right:50});case"wholeRoute":return this.mapviewer.getViewpointPosition({points:this._allPoints,top:50,bottom:50,left:50,right:50});case"initialFloor":default:return this.mapviewer.getViewpointPosition({points:this._initialFloorPoints,top:50,bottom:50,left:50,right:50})}},Zy.prototype.enableFloorFilter=function(){this.mapviewer.multiBuildingView.setFloorWhitelist(this._routeFloors)},Zy.prototype.disableFloorFilter=function(){this.mapviewer.multiBuildingView.resetFloorWhitelist()};var Jy={getURLParameters:md.getURLParameters,getLanguageMatch:md.getLanguageMatch};t.Mapviewer=function(t){var e=new ky(t),i={load:!0,unload:!0,setupView:!0,destroyView:!0,initialize:!0,start:!0,stop:!0,show:!0,hide:!0,getFloors:!0,setPlaceName:!0,getPlaceName:!0,setPlaceIcon:!0,getPlaceIcon:!0,getPlace:!0,getPlaces:!0,getPOI:!0,getPOIs:!0,generatePOIClusters:!0,setPlaceColor:!0,resetPlaceColor:!0,computeRoute:!0,changeFloor:!0,resize:!0,getCurrentFloor:!0,getExtraData:!0,getMapName:!0,getRoutingAttributes:!0,getRoutingModalities:!0,getRoutingNode:!0,queryNearPlaces:!0,getViewpointPosition:!0,convertLatLonToPoint:!0,convertPointToLatLon:!0,offsetPosition:!0,computeHeadingAngle:!0,computeDistance:!0,initializeProjection:!0,addPOI:!0,addPath:!0,addFloorLink:!0,convertScreenToPoint:!0,convertPointToScreen:!0,plugin:!0,isInside2D:!0,isInsideFootprint:!0,getFootprint:!0,getFootprintPoints:!0,getFootprints:!0,getPOF:!0,getPOFs:!0,setAutoUpdateLOD:!0,on:!0,once:!0,off:!0,trigger:!0,animateValue:!0,getLoaderStatistics:!0,graphicsLoading:!0,requestRedraw:!0,getLogStatistic:!0,setLogStatistic:!0,getLogStatisticURL:!0,setLogStatisticURL:!0,getLogStatisticAppID:!0,setLogStatisticAppID:!0,setTrackingEnabled:!0,setupMultiBuildingView:!0,setupNavigationTranslator:!0,setSkybox:!0};return Object.defineProperty(this,"lodFactor",{get:function(){return e.publicLodFactor},set:function(t){t<=0||(e.publicLodFactor=t,e.manipulator.update())}}),Object.defineProperty(this,"navigationTranslator",{get:function(){return void 0!==e.navigationTranslator&&null!==e.navigationTranslator&&e.navigationTranslator.publicNavigationTranslator}}),Object.defineProperty(this,"multiBuildingView",{get:function(){return void 0!==e.multiBuildingView&&null!==e.multiBuildingView&&e.multiBuildingView.publicMultiBuildingView}}),Object.defineProperty(this,"cameraDrivenExplorer",{get:function(){return void 0!==e.cameraDrivenExplorer&&null!==e.cameraDrivenExplorer&&e.cameraDrivenExplorer.publicCameraDrivenExplorer}}),Object.defineProperty(this,"camera",{get:function(){return e.publicCamera}}),Object.defineProperty(this,"cameraNorthRotation",{get:function(){return e.cameraNorthRotation}}),Object.defineProperty(this,"isAccelerated",{get:function(){return e.isAccelerated}}),Object.defineProperty(this,"version",{get:function(){return e.version}}),Object.defineProperty(this,"minimumDataSDKVersion",{get:function(){return e.minimumDataSDKVersion}}),Object.defineProperty(this,"sdkType",{get:function(){return e.sdkType}}),Object.defineProperty(this,"revision",{get:function(){return e.revision}}),Object.defineProperty(this,"frameRateDivider",{get:function(){return e.frameRateDivider},set:function(t){t<=0||(e.frameRateDivider=t)}}),Object.keys(i).forEach(function(t){var n,r,a,s=t,o=i[t];void 0!==e[s]&&(a=o,(n=this)[r=s]=!0!==a?function(){return a.apply(n,arguments)}:function(){return e[r].apply(e,arguments)})},this),this.destroy=function(){return e.destroy().then(function(){Object.keys(i).forEach(function(t){this[t]=null}.bind(this)),e=null}.bind(this))},this},t.Route=function(t,e,i){var n=new Zy(t,e,i);Pd.create(this,n,qy,Xy,Yy),this.remove=function(){n.remove(),this.destroyPublicInterface()}},t.Utils=Jy,Object.defineProperty(t,"__esModule",{value:!0})});
